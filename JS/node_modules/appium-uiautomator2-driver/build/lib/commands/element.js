"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _logger = _interopRequireDefault(require("../logger"));

var _lodash = _interopRequireDefault(require("lodash"));

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

function toBool(s) {
  return _lodash.default.isString(s) ? s.toLowerCase() === 'true' : !!s;
}

commands.getAttribute = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (attribute, elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/attribute/${attribute}`, 'GET', {});
  });

  return function (_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

commands.elementDisplayed = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return toBool((yield this.getAttribute("displayed", elementId)));
  });

  return function (_x3) {
    return _ref2.apply(this, arguments);
  };
}();

commands.elementEnabled = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return toBool((yield this.getAttribute("enabled", elementId)));
  });

  return function (_x4) {
    return _ref3.apply(this, arguments);
  };
}();

commands.elementSelected = function () {
  var _ref4 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return toBool((yield this.getAttribute("selected", elementId)));
  });

  return function (_x5) {
    return _ref4.apply(this, arguments);
  };
}();

commands.getName = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/name`, 'GET', {});
  });

  return function (_x6) {
    return _ref5.apply(this, arguments);
  };
}();

commands.getLocation = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (elementId) {
    _logger.default.info(`calling get location: ${elementId}`);

    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/location`, 'GET', {});
  });

  return function (_x7) {
    return _ref6.apply(this, arguments);
  };
}();

commands.getSize = function () {
  var _ref7 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/size`, 'GET', {});
  });

  return function (_x8) {
    return _ref7.apply(this, arguments);
  };
}();

commands.touchLongClick = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (element, x, y, duration) {
    let params = {
      element,
      x,
      y,
      duration
    };
    return yield this.uiautomator2.jwproxy.command(`/touch/longclick`, 'POST', {
      params
    });
  });

  return function (_x9, _x10, _x11, _x12) {
    return _ref8.apply(this, arguments);
  };
}();

commands.touchDown = function () {
  var _ref9 = (0, _asyncToGenerator2.default)(function* (element, x, y) {
    let params = {
      element,
      x,
      y
    };
    return yield this.uiautomator2.jwproxy.command(`/touch/down`, 'POST', {
      params
    });
  });

  return function (_x13, _x14, _x15) {
    return _ref9.apply(this, arguments);
  };
}();

commands.touchUp = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (element, x, y) {
    let params = {
      element,
      x,
      y
    };
    return yield this.uiautomator2.jwproxy.command(`/touch/up`, 'POST', {
      params
    });
  });

  return function (_x16, _x17, _x18) {
    return _ref10.apply(this, arguments);
  };
}();

commands.touchMove = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (element, x, y) {
    let params = {
      element,
      x,
      y
    };
    return yield this.uiautomator2.jwproxy.command(`/touch/move`, 'POST', {
      params
    });
  });

  return function (_x19, _x20, _x21) {
    return _ref11.apply(this, arguments);
  };
}();

helpers.doSetElementValue = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (params) {
    return yield this.uiautomator2.jwproxy.command(`/element/${params.elementId}/value`, 'POST', params);
  });

  return function (_x22) {
    return _ref12.apply(this, arguments);
  };
}();

commands.setValueImmediate = function () {
  var _ref13 = (0, _asyncToGenerator2.default)(function* (keys, elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/value`, 'POST', {
      elementId,
      text: _lodash.default.isArray(keys) ? keys.join('') : keys,
      replace: false,
      unicodeKeyboard: this.opts.unicodeKeyboard
    });
  });

  return function (_x23, _x24) {
    return _ref13.apply(this, arguments);
  };
}();

commands.getText = function () {
  var _ref14 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/text`, 'GET', {});
  });

  return function (_x25) {
    return _ref14.apply(this, arguments);
  };
}();

commands.click = function () {
  var _ref15 = (0, _asyncToGenerator2.default)(function* (element) {
    return yield this.uiautomator2.jwproxy.command(`/element/${element}/click`, 'POST', {
      element
    });
  });

  return function (_x26) {
    return _ref15.apply(this, arguments);
  };
}();

commands.getElementScreenshot = function () {
  var _ref16 = (0, _asyncToGenerator2.default)(function* (element) {
    return yield this.uiautomator2.jwproxy.command(`/element/${element}/screenshot`, 'GET', {});
  });

  return function (_x27) {
    return _ref16.apply(this, arguments);
  };
}();

commands.tap = function () {
  var _ref17 = (0, _asyncToGenerator2.default)(function* (element, x = 0, y = 0, count = 1) {
    for (let i = 0; i < count; i++) {
      if (element) {
        let params = {
          element
        };

        if (x !== 0 || y !== 0) {
          params.x = x;
          params.y = y;
        }

        yield this.uiautomator2.jwproxy.command(`/element/${element}/click`, 'POST', params);
      } else {
        yield this.uiautomator2.jwproxy.command(`/appium/tap`, 'POST', {
          x,
          y
        });
      }
    }
  });

  return function (_x28) {
    return _ref17.apply(this, arguments);
  };
}();

commands.clear = function () {
  var _ref18 = (0, _asyncToGenerator2.default)(function* (elementId) {
    return yield this.uiautomator2.jwproxy.command(`/element/${elementId}/clear`, 'POST', {
      elementId
    });
  });

  return function (_x29) {
    return _ref18.apply(this, arguments);
  };
}();

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJ0b0Jvb2wiLCJzIiwiXyIsImlzU3RyaW5nIiwidG9Mb3dlckNhc2UiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGUiLCJlbGVtZW50SWQiLCJ1aWF1dG9tYXRvcjIiLCJqd3Byb3h5IiwiY29tbWFuZCIsImVsZW1lbnREaXNwbGF5ZWQiLCJlbGVtZW50RW5hYmxlZCIsImVsZW1lbnRTZWxlY3RlZCIsImdldE5hbWUiLCJnZXRMb2NhdGlvbiIsImxvZyIsImluZm8iLCJnZXRTaXplIiwidG91Y2hMb25nQ2xpY2siLCJlbGVtZW50IiwieCIsInkiLCJkdXJhdGlvbiIsInBhcmFtcyIsInRvdWNoRG93biIsInRvdWNoVXAiLCJ0b3VjaE1vdmUiLCJkb1NldEVsZW1lbnRWYWx1ZSIsInNldFZhbHVlSW1tZWRpYXRlIiwia2V5cyIsInRleHQiLCJpc0FycmF5Iiwiam9pbiIsInJlcGxhY2UiLCJ1bmljb2RlS2V5Ym9hcmQiLCJvcHRzIiwiZ2V0VGV4dCIsImNsaWNrIiwiZ2V0RWxlbWVudFNjcmVlbnNob3QiLCJ0YXAiLCJjb3VudCIsImkiLCJjbGVhciIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDOzs7O0FBRUEsU0FBU0MsTUFBVCxDQUFpQkMsQ0FBakIsRUFBb0I7QUFDbEIsU0FBT0MsZ0JBQUVDLFFBQUYsQ0FBV0YsQ0FBWCxJQUFpQkEsQ0FBQyxDQUFDRyxXQUFGLE9BQW9CLE1BQXJDLEdBQStDLENBQUMsQ0FBQ0gsQ0FBeEQ7QUFDRDs7QUFFREosUUFBUSxDQUFDUSxZQUFUO0FBQUEsNkNBQXdCLFdBQWdCQyxTQUFoQixFQUEyQkMs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QUZEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQUlBcUMsTUFBTSxDQUFDQyxNQUFQLENBQWM5QyxVQUFkLEVBQTBCRixRQUExQixFQUFvQ0MsT0FBcEM7ZUFFZUMsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmxldCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuZnVuY3Rpb24gdG9Cb29sIChzKSB7XG4gIHJldHVybiBfLmlzU3RyaW5nKHMpID8gKHMudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnKSA6ICEhcztcbn1cblxuY29tbWFuZHMuZ2V0QXR0cmlidXRlID0gYXN5bmMgZnVuY3Rpb24gKGF0dHJpYnV0ZSwgZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9hdHRyaWJ1dGUvJHthdHRyaWJ1dGV9YCwgJ0dFVCcsIHt9KTtcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnREaXNwbGF5ZWQgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiB0b0Jvb2woYXdhaXQgdGhpcy5nZXRBdHRyaWJ1dGUoXCJkaXNwbGF5ZWRcIiwgZWxlbWVudElkKSk7XG59O1xuXG5jb21tYW5kcy5lbGVtZW50RW5hYmxlZCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIHRvQm9vbChhd2FpdCB0aGlzLmdldEF0dHJpYnV0ZShcImVuYWJsZWRcIiwgZWxlbWVudElkKSk7XG59O1xuXG5jb21tYW5kcy5lbGVtZW50U2VsZWN0ZWQgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiB0b0Jvb2woYXdhaXQgdGhpcy5nZXRBdHRyaWJ1dGUoXCJzZWxlY3RlZFwiLCBlbGVtZW50SWQpKTtcbn07XG5cbmNvbW1hbmRzLmdldE5hbWUgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9uYW1lYCwgJ0dFVCcsIHt9KTtcbn07XG5cbmNvbW1hbmRzLmdldExvY2F0aW9uID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICBsb2cuaW5mbyhgY2FsbGluZyBnZXQgbG9jYXRpb246ICR7ZWxlbWVudElkfWApO1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vbG9jYXRpb25gLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMuZ2V0U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L3NpemVgLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMudG91Y2hMb25nQ2xpY2sgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudCwgeCwgeSwgZHVyYXRpb24pIHtcbiAgbGV0IHBhcmFtcyA9IHtlbGVtZW50LCB4LCB5LCBkdXJhdGlvbn07XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC90b3VjaC9sb25nY2xpY2tgLCAnUE9TVCcsIHtwYXJhbXN9KTtcbn07XG5cbmNvbW1hbmRzLnRvdWNoRG93biA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50LCB4LCB5KSB7XG4gIGxldCBwYXJhbXMgPSB7ZWxlbWVudCwgeCwgeX07XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC90b3VjaC9kb3duYCwgJ1BPU1QnLCB7cGFyYW1zfSk7XG59O1xuXG5jb21tYW5kcy50b3VjaFVwID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQsIHgsIHkpIHtcbiAgbGV0IHBhcmFtcyA9IHtlbGVtZW50LCB4LCB5fTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL3RvdWNoL3VwYCwgJ1BPU1QnLCB7cGFyYW1zfSk7XG59O1xuXG5jb21tYW5kcy50b3VjaE1vdmUgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudCwgeCwgeSkge1xuICBsZXQgcGFyYW1zID0ge2VsZW1lbnQsIHgsIHl9O1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvdG91Y2gvbW92ZWAsICdQT1NUJywge3BhcmFtc30pO1xufTtcblxuaGVscGVycy5kb1NldEVsZW1lbnRWYWx1ZSA9IGFzeW5jIGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtwYXJhbXMuZWxlbWVudElkfS92YWx1ZWAsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLnNldFZhbHVlSW1tZWRpYXRlID0gYXN5bmMgZnVuY3Rpb24gKGtleXMsIGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vdmFsdWVgLCAnUE9TVCcsIHtcbiAgICBlbGVtZW50SWQsXG4gICAgdGV4dDogXy5pc0FycmF5KGtleXMpID8ga2V5cy5qb2luKCcnKSA6IGtleXMsXG4gICAgcmVwbGFjZTogZmFsc2UsXG4gICAgdW5pY29kZUtleWJvYXJkOiB0aGlzLm9wdHMudW5pY29kZUtleWJvYXJkLFxuICB9KTtcbn07XG5cbmNvbW1hbmRzLmdldFRleHQgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS90ZXh0YCwgJ0dFVCcsIHt9KTtcbn07XG5cbmNvbW1hbmRzLmNsaWNrID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50fS9jbGlja2AsICdQT1NUJywge2VsZW1lbnR9KTtcbn07XG5cbmNvbW1hbmRzLmdldEVsZW1lbnRTY3JlZW5zaG90ID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50fS9zY3JlZW5zaG90YCwgJ0dFVCcsIHt9KTtcbn07XG5cbmNvbW1hbmRzLnRhcCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50LCB4ID0gMCwgeSA9IDAsIGNvdW50ID0gMSkge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICBpZiAoZWxlbWVudCkge1xuICAgICAgLy8gd2UgYXJlIGVpdGhlciB0YXBwaW5nIG9uIHRoZSBkZWZhdWx0IGxvY2F0aW9uIG9mIHRoZSBlbGVtZW50XG4gICAgICAvLyBvciBhbiBvZmZzZXQgZnJvbSB0aGUgdG9wIGxlZnQgY29ybmVyXG4gICAgICBsZXQgcGFyYW1zID0ge2VsZW1lbnR9O1xuICAgICAgaWYgKHggIT09IDAgfHwgeSAhPT0gMCkge1xuICAgICAgICBwYXJhbXMueCA9IHg7XG4gICAgICAgIHBhcmFtcy55ID0geTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50fS9jbGlja2AsICdQT1NUJywgcGFyYW1zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvYXBwaXVtL3RhcGAsICdQT1NUJywge3gsIHl9KTtcbiAgICB9XG4gIH1cbn07XG5cbmNvbW1hbmRzLmNsZWFyID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vY2xlYXJgLCAnUE9TVCcsIHtlbGVtZW50SWR9KTtcbn07XG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgY29tbWFuZHMsIGhlbHBlcnMpO1xuZXhwb3J0IHsgY29tbWFuZHMsIGhlbHBlcnMgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
