"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("../logger.js"));

var _helpers = require("../helpers.js");

var _appiumSupport = require("appium-support");

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _xmldom = _interopRequireDefault(require("xmldom"));

var _xpath = _interopRequireDefault(require("xpath"));

var _shellQuote = require("shell-quote");

let manifestMethods = {};

manifestMethods.processFromManifest = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (localApk) {
    yield this.initAapt();

    _logger.default.info("Retrieving process from manifest");

    let args = ['dump', 'xmltree', localApk, 'AndroidManifest.xml'];

    let _ref2 = yield (0, _teen_process.exec)(this.binaries.aapt, args),
        stdout = _ref2.stdout;

    let result = null;
    let lines = stdout.split("\n");
    let applicationRegex = new RegExp(/\s+E: application \(line=\d+\).*/);
    let applicationFound = false;
    let attributeRegex = new RegExp(/\s+A: .+/);
    let processRegex = new RegExp(/\s+A: android:process\(0x01010011\)="([^"]+).*"/);
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = lines[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        let line = _step.value;

        if (!applicationFound) {
          if (applicationRegex.test(line)) {
            applicationFound = true;
          }
        } else {
          let notAttribute = !attributeRegex.test(line);

          if (notAttribute) {
            break;
          }

          let process = processRegex.exec(line);

          if (process && process.length > 1) {
            result = process[1];

            if (result.length > 15) {
              result = result.substr(result.length - 15);
            }

            break;
          }
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    return result;
  });

  return function (_x) {
    return _ref.apply(this, arguments);
  };
}();

function extractApkInfoWithApkTools(_x2, _x3, _x4, _x5) {
  return _extractApkInfoWithApkTools.apply(this, arguments);
}

function _extractApkInfoWithApkTools() {
  _extractApkInfoWithApkTools = (0, _asyncToGenerator2.default)(function* (localApk, aaptPath, jarPath, tmpRoot) {
    _logger.default.info("Extracting package and launch activity from manifest");

    let args = ['dump', 'badging', localApk];
    let stdout = (yield (0, _teen_process.exec)(aaptPath, args)).stdout;
    let apkPackage = new RegExp(/package: name='([^']+)'/g).exec(stdout);

    if (!apkPackage || apkPackage.length < 2) {
      throw new Error(`Cannot parse package name from ` + `'${_lodash.default.join([aaptPath, 'dump', 'badging', '"' + localApk + '"'], ' ')}' command  output`);
    }

    apkPackage = apkPackage[1];
    let apkActivity = new RegExp(/launchable-activity: name='([^']+)'/g).exec(stdout);

    if (apkActivity && apkActivity.length >= 2) {
      apkActivity = apkActivity[1];
      return {
        apkPackage,
        apkActivity
      };
    }

    let outputPath = _path.default.resolve(tmpRoot, apkPackage);

    let getLaunchActivity = ['-jar', jarPath, 'printLaunchActivity', localApk, outputPath];
    const output = yield (0, _teen_process.exec)('java', getLaunchActivity);

    if (output.stderr) {
      throw new Error(`Cannot parse launchActivity from manifest: ${output.stderr}`);
    }

    stdout = output.stdout;
    let act = new RegExp(/Launch activity parsed:([^']+)/g).exec(stdout);

    if (act && act.length >= 2) {
      apkActivity = act[1];
      return {
        apkPackage,
        apkActivity
      };
    }

    throw new Error(`Cannot parse main activity name from '${stdout}' command  output`);
  });
  return _extractApkInfoWithApkTools.apply(this, arguments);
}

function extractApkInfoWithApkanalyzer(_x6, _x7) {
  return _extractApkInfoWithApkanalyzer.apply(this, arguments);
}

function _extractApkInfoWithApkanalyzer() {
  _extractApkInfoWithApkanalyzer = (0, _asyncToGenerator2.default)(function* (localApk, apkanalyzerPath) {
    const args = ['-h', 'manifest', 'print', localApk];

    _logger.default.debug(`Starting '${apkanalyzerPath}' with args ${JSON.stringify(args)}`);

    const manifestXml = (yield (0, _teen_process.exec)(apkanalyzerPath, args, {
      shell: true,
      cwd: _path.default.dirname(apkanalyzerPath)
    })).stdout;
    const doc = new _xmldom.default.DOMParser().parseFromString(manifestXml);

    const apkPackageAttribute = _xpath.default.select1('//manifest/@package', doc);

    if (!apkPackageAttribute) {
      throw new Error(`Cannot parse package name from ${manifestXml}`);
    }

    const apkPackage = apkPackageAttribute.value;

    const apkActivityAttribute = _xpath.default.select1("//application/*[starts-with(name(), 'activity') " + "and .//action[@*[local-name()='name' and .='android.intent.action.MAIN']] " + "and .//category[@*[local-name()='name' and .='android.intent.category.LAUNCHER']]]" + "/@*[local-name()='name']", doc);

    if (!apkActivityAttribute) {
      throw new Error(`Cannot parse main activity name from ${manifestXml}`);
    }

    const apkActivity = apkActivityAttribute.value;
    return {
      apkPackage,
      apkActivity
    };
  });
  return _extractApkInfoWithApkanalyzer.apply(this, arguments);
}

manifestMethods.packageAndLaunchActivityFromManifest = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (localApk) {
    var _this = this;

    const apkInfoGetters = [(0, _asyncToGenerator2.default)(function* () {
      const apkanalyzerPath = yield (0, _helpers.getApkanalyzerForOs)(_this);
      return yield extractApkInfoWithApkanalyzer(localApk, apkanalyzerPath);
    }), (0, _asyncToGenerator2.default)(function* () {
      yield _this.initAapt();
      return yield extractApkInfoWithApkTools(localApk, _this.binaries.aapt, _this.jars['appium_apk_tools.jar'], _this.tmpDir);
    })];
    let savedError;

    for (var _i = 0; _i < apkInfoGetters.length; _i++) {
      const infoGetter = apkInfoGetters[_i];

      try {
        const _ref6 = yield infoGetter(),
              apkPackage = _ref6.apkPackage,
              apkActivity = _ref6.apkActivity;

        _logger.default.info(`Package name: '${apkPackage}'`);

        _logger.default.info(`Main activity name: '${apkActivity}'`);

        return {
          apkPackage,
          apkActivity
        };
      } catch (e) {
        if (infoGetter !== _lodash.default.last(apkInfoGetters)) {
          _logger.default.info(`Using the alternative activity name detection method ` + `because of: ${e.message}`);
        }

        savedError = e;
      }
    }

    throw new Error(`packageAndLaunchActivityFromManifest failed. ` + `Original error: ${savedError.message}` + (savedError.stderr ? `; StdErr: ${savedError.stderr}` : ''));
  });

  return function (_x8) {
    return _ref3.apply(this, arguments);
  };
}();

manifestMethods.targetSdkVersionFromManifest = function () {
  var _ref7 = (0, _asyncToGenerator2.default)(function* (localApk) {
    yield this.initAapt();

    _logger.default.info("Extracting package and launch activity from manifest");

    let args = ['dump', 'badging', localApk];
    let output;

    try {
      let _ref8 = yield (0, _teen_process.exec)(this.binaries.aapt, args),
          stdout = _ref8.stdout;

      output = stdout;
    } catch (e) {
      throw new Error(`fetching targetSdkVersion from local APK failed. Original error: ${e.message}`);
    }

    let targetSdkVersion = new RegExp(/targetSdkVersion:'([^']+)'/g).exec(output);

    if (!targetSdkVersion) {
      throw new Error(`targetSdkVersion is not specified in the application.`);
    }

    return parseInt(targetSdkVersion[1], 10);
  });

  return function (_x9) {
    return _ref7.apply(this, arguments);
  };
}();

manifestMethods.targetSdkVersionUsingPKG = function () {
  var _ref9 = (0, _asyncToGenerator2.default)(function* (pkg, cmdOutput = null) {
    let stdout = cmdOutput || (yield this.shell(['dumpsys', 'package', pkg]));
    let targetSdkVersion = new RegExp(/targetSdk=([^\s\s]+)/g).exec(stdout);

    if (targetSdkVersion && targetSdkVersion.length >= 2) {
      targetSdkVersion = targetSdkVersion[1];
    } else {
      targetSdkVersion = 0;
    }

    return parseInt(targetSdkVersion, 10);
  });

  return function (_x10) {
    return _ref9.apply(this, arguments);
  };
}();

manifestMethods.compileManifest = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (manifest, manifestPackage, targetPackage) {
    const _ref11 = yield (0, _helpers.getAndroidPlatformAndPath)(),
          platform = _ref11.platform,
          platformPath = _ref11.platformPath;

    if (!platform) {
      throw new Error('Cannot compile the manifest. The required platform does not exist (API level >= 17)');
    }

    const resultPath = `${manifest}.apk`;
    const args = ['package', '-M', manifest, '--rename-manifest-package', manifestPackage, '--rename-instrumentation-target-package', targetPackage, '-I', _path.default.resolve(platformPath, 'android.jar'), '-F', resultPath, '-f'];

    try {
      yield this.initAapt();

      _logger.default.debug(`Compiling the manifest: ${this.binaries.aapt} ${(0, _shellQuote.quote)(args)}`);

      yield (0, _teen_process.exec)(this.binaries.aapt, args);

      _logger.default.debug(`Compiled the manifest at '${resultPath}'`);
    } catch (err) {
      throw new Error(`Cannot compile the manifest. Original error: ${err.message}`);
    }
  });

  return function (_x11, _x12, _x13) {
    return _ref10.apply(this, arguments);
  };
}();

manifestMethods.insertManifest = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (manifest, srcApk, dstApk) {
    _logger.default.debug(`Inserting manifest, src: ${srcApk} dst: ${dstApk}`);

    yield this.initAapt();
    yield (0, _helpers.unzipFile)(`${manifest}.apk`);
    yield _appiumSupport.fs.copyFile(srcApk, dstApk);

    _logger.default.debug("Testing new tmp apk");

    yield (0, _helpers.assertZipArchive)(dstApk);

    _logger.default.debug("Moving manifest");

    try {
      yield (0, _teen_process.exec)(this.binaries.aapt, ['remove', dstApk, _path.default.basename(manifest)]);
    } catch (ign) {}

    yield (0, _teen_process.exec)(this.binaries.aapt, ['add', dstApk, _path.default.basename(manifest)], {
      cwd: _path.default.dirname(manifest)
    });

    _logger.default.debug("Inserted manifest.");
  });

  return function (_x14, _x15, _x16) {
    return _ref12.apply(this, arguments);
  };
}();

manifestMethods.hasInternetPermissionFromManifest = function () {
  var _ref13 = (0, _asyncToGenerator2.default)(function* (localApk) {
    yield this.initAapt();

    _logger.default.debug(`Checking if '${localApk}' requires internet access permission in the manifest`);

    try {
      let _ref14 = yield (0, _teen_process.exec)(this.binaries.aapt, ['dump', 'badging', localApk]),
          stdout = _ref14.stdout;

      return new RegExp(/uses-permission:.*'android.permission.INTERNET'/).test(stdout);
    } catch (e) {
      throw new Error(`Cannot check if '${localApk}' requires internet access permission. ` + `Original error: ${e.message}`);
    }
  });

  return function (_x17) {
    return _ref13.apply(this, arguments);
  };
}();

manifestMethods.printManifestFromApk = function () {
  var _printManifestFromApk = (0, _asyncToGenerator2.default)(function* (localApk, logLevel = 'debug') {
    yield this.initAapt();

    _logger.default[logLevel](`Android manifest extracted from '${localApk}'`);

    let out = false;

    const _ref15 = yield (0, _teen_process.exec)(this.binaries.aapt, ['l', '-a', localApk]),
          stdout = _ref15.stdout;

    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
      for (var _iterator2 = stdout.split('\n')[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
        const line = _step2.value;

        if (!out && line.includes('Android manifest:')) {
          out = true;
        }

        if (out) {
          _logger.default[logLevel](line);
        }
      }
    } catch (err) {
      _didIteratorError2 = true;
      _iteratorError2 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
          _iterator2.return();
        }
      } finally {
        if (_didIteratorError2) {
          throw _iteratorError2;
        }
      }
    }
  });

  return function printManifestFromApk(_x18) {
    return _printManifestFromApk.apply(this, arguments);
  };
}();

var _default = manifestMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hbmRyb2lkLW1hbmlmZXN0LmpzIl0sIm5hbWVzIjpbIm1hbmlmZXN0TWV0aG9kcyIsInByb2Nlc3NGcm9tTWFuaWZlc3QiLCJsb2NhbEFwayIsImluaXRBYXB0IiwibG9nIiwiaW5mbyIsImFyZ3MiLCJiaW5hcmllcyIsImFhcHQiLCJzdGRvdXQiLCJyZXN1bHQiLCJsaW5lcyIsInNwbGl0IiwiYXBwbGljYXRpb25SZWdleCIsIlJlZ0V4cCIsImFwcGxpY2F0aW9uRm91bmQiLCJhdHRyaWJ1dGVSZWdleCIsInByb2Nlc3NSZWdleCIsImxpbmUiLCJ0ZXN0Iiwibm90QXR0cmlidXRlIiwicHJvY2VzcyIsImV4ZWMiLCJsZW5ndGgiLCJzdWJzdHIiLCJleHRyYWN0QXBrSW5mb1dpdGhBcGtUb29scyIsImFhcHRQYXRoIiwiamFyUGF0aCIsInRtcFJvb3QiLCJhcGtQYWNrYWdlIiwiRXJyb3IiLCJfIiwiam9pbiIsImFwa0FjdGl2aXR5Iiwib3V0cHV0UGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiZ2V0TGF1bmNoQWN0aXZpdHkiLCJvdXRwdXQiLCJzdGRlcnIiLCJhY3QiLCJleHRyYWN0QXBrSW5mb1dpdGhBcGthbmFseXplciIsImFwa2FuYWx5emVyUGF0aCIsImRlYnVnIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1hbmlmZXN0WG1sIiwic2hlbGwiLCJjd2QiLCJkaXJuYW1lIiwiZG9jIiwieG1sZG9tIiwiRE9NUGFyc2VyIiwicGFyc2VGcm9tU3RyaW5nIiwiYXBrUGFja2FnZUF0dHJpYnV0ZSIsInhwYXRoIiwic2VsZWN0MSIsInZhbHVlIiwiYXBrQWN0aXZpdHlBdHRyaWJ1dGUiLCJwYWNrYWdlQW5kTGF1bmNoQWN0aXZpdHlGcm9tTWFuaWZlc3QiLCJhcGtJbmZvR2V0dGVycyIsImphcnMiLCJ0bXBEaXIiLCJzYXZlZEVycm9yIiwiaW5mb0dldHRlciIsImUiLCJsYXN0IiwibWVzc2FnZSIsInRhcmdldFNka1ZlcnNpb25Gcm9tTWFuaWZlc3QiLCJ0YXJnZXRTZGtWZXJzaW9uIiwicGFyc2VJbnQiLCJ0YXJnZXRTZGtWZXJzaW9uVXNpbmdQS0ciLCJwa2ciLCJjbWRPdXRwdXQiLCJjb21waWxlTWFuaWZlc3QiLCJtYW5pZmVzdCIsIm1hbmlmZXN0UGFja2FnZSIsInRhcmdldFBhY2thZ2UiLCJwbGF0Zm9ybSIsInBsYXRmb3JtUGF0aCIsInJlc3VsdFBhdGgiLCJlcnIiLCJpbnNlcnRNYW5pZmVzdCIsInNyY0FwayIsImRzdEFwayIsImZzIiwiY29weUZpbGUiLCJiYXNlbmFtZSIsImlnbiIsImhhc0ludGVybmV0UGVybWlzc2lvbkZyb21NYW5pZmVzdCIsInByaW50TWFuaWZlc3RGcm9tQXBrIiwibG9nTGV2ZWwiLCJvdXQiLCJpbmNsdWRlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFJQSxlQUFlLEdBQUcsRUFBdEI7O0FBTUFBLGVBQWUsQ0FBQ0MsbUJBQWhCO0FBQUEsNkNBQXNDLFdBQWdCQyxRQUFoQixFQUEwQjtBQUM5RCxVQUFNLEtBQUtDLFFBQUwsRUFBTjs7QUFDQUMsb0JBQUlDLElBQUosQ0FBUyxrQ0FBVDs7QUFDQSxRQUFJQyxJQUFJLEdBQUcsQ0FBQyxNQUFELEVBQVMsU0FBVCxFQUFvQkosUUFBcEIsRUFBOEIscUJBQTlCLENBQVg7O0FBSDhELHNCQUl6Qyx3QkFBSyxLQUFLSyxRQUFMLENBQWNDLElBQW5CLEVBQXlCRixJQUF6QixDQUp5QztBQUFBLFFBSXpERyxNQUp5RCxTQUl6REEsTUFKeUQ7O0FBSzlELFFBQUlDLE1BQU0sR0FBRyxJQUFiO0FBQ0EsUUFBSUMsS0FBSyxHQUFHRixNQUFNLENBQUNHLEtBQVAsQ0FBYSxJQUFiLENBQVo7QUFDQSxRQUFJQyxnQkFBZ0IsR0FBRyxJQUFJQyxNQUFKLENBQVcsa0NBQVgsQ0FBdkI7QUFDQSxRQUFJQyxnQkFBZ0IsR0FBRyxLQUF2QjtBQUNBLFFBQUlDLGNB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LEVBQWN6RSxJQUFkO0FBQ0Q7QUFDRjtBQVp1RztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBYXpHLEdBYkQ7O0FBQUEsa0JBQXNEd0Usb0JBQXREO0FBQUE7QUFBQTtBQUFBOztlQWdCZTFGLGUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyLmpzJztcbmltcG9ydCB7IGdldEFuZHJvaWRQbGF0Zm9ybUFuZFBhdGgsIHVuemlwRmlsZSwgYXNzZXJ0WmlwQXJjaGl2ZSxcbiAgICAgICAgIGdldEFwa2FuYWx5emVyRm9yT3MgfSBmcm9tICcuLi9oZWxwZXJzLmpzJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHhtbGRvbSBmcm9tICd4bWxkb20nO1xuaW1wb3J0IHhwYXRoIGZyb20gJ3hwYXRoJztcbmltcG9ydCB7IHF1b3RlIH0gZnJvbSAnc2hlbGwtcXVvdGUnO1xuXG5sZXQgbWFuaWZlc3RNZXRob2RzID0ge307XG5cbi8vIGFuZHJvaWQ6cHJvY2Vzcz0gbWF5IGJlIGRlZmluZWQgaW4gQW5kcm9pZE1hbmlmZXN0LnhtbFxuLy8gaHR0cDovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9yZWZlcmVuY2UvYW5kcm9pZC9SLmF0dHIuaHRtbCNwcm9jZXNzXG4vLyBub3RlIHRoYXQgdGhlIHByb2Nlc3MgbmFtZSB3aGVuIHVzZWQgd2l0aCBwcyBtdXN0IGJlIHRydW5jYXRlZCB0byB0aGUgbGFzdCAxNSBjaGFyc1xuLy8gcHMgLWMgY29tLmV4YW1wbGUuYW5kcm9pZC5hcGlzIGJlY29tZXMgcHMgLWMgbGUuYW5kcm9pZC5hcGlzXG5tYW5pZmVzdE1ldGhvZHMucHJvY2Vzc0Zyb21NYW5pZmVzdCA9IGFzeW5jIGZ1bmN0aW9uIChsb2NhbEFwaykge1xuICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG4gIGxvZy5pbmZvKFwiUmV0cmlldmluZyBwcm9jZXNzIGZyb20gbWFuaWZlc3RcIik7XG4gIGxldCBhcmdzID0gWydkdW1wJywgJ3htbHRyZWUnLCBsb2NhbEFwaywgJ0FuZHJvaWRNYW5pZmVzdC54bWwnXTtcbiAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLmFhcHQsIGFyZ3MpO1xuICBsZXQgcmVzdWx0ID0gbnVsbDtcbiAgbGV0IGxpbmVzID0gc3Rkb3V0LnNwbGl0KFwiXFxuXCIpO1xuICBsZXQgYXBwbGljYXRpb25SZWdleCA9IG5ldyBSZWdFeHAoL1xccytFOiBhcHBsaWNhdGlvbiBcXChsaW5lPVxcZCtcXCkuKi8pO1xuICBsZXQgYXBwbGljYXRpb25Gb3VuZCA9IGZhbHNlO1xuICBsZXQgYXR0cmlidXRlUmVnZXggPSBuZXcgUmVnRXhwKC9cXHMrQTogLisvKTtcbiAgbGV0IHByb2Nlc3NSZWdleCA9IG5ldyBSZWdFeHAoL1xccytBOiBhbmRyb2lkOnByb2Nlc3NcXCgweDAxMDEwMDExXFwpPVwiKFteXCJdKykuKlwiLyk7XG4gIGZvciAobGV0IGxpbmUgb2YgbGluZXMpIHtcbiAgICBpZiAoIWFwcGxpY2F0aW9uRm91bmQpIHtcbiAgICAgIGlmIChhcHBsaWNhdGlvblJlZ2V4LnRlc3QobGluZSkpIHtcbiAgICAgICAgYXBwbGljYXRpb25Gb3VuZCA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBub3RBdHRyaWJ1dGUgPSAhYXR0cmlidXRlUmVnZXgudGVzdChsaW5lKTtcbiAgICAgIC8vIHByb2Nlc3MgbXVzdCBiZSBhbiBhdHRyaWJ1dGUgYWZ0ZXIgYXBwbGljYXRpb24uXG4gICAgICBpZiAobm90QXR0cmlidXRlKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgbGV0IHByb2Nlc3MgPSBwcm9jZXNzUmVnZXguZXhlYyhsaW5lKTtcbiAgICAgIC8vIHRoaXMgaXMgYW4gYXBwbGljYXRpb24gYXR0cmlidXRlIHByb2Nlc3MuXG4gICAgICBpZiAocHJvY2VzcyAmJiBwcm9jZXNzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgcmVzdWx0ID0gcHJvY2Vzc1sxXTtcbiAgICAgICAgLy8gbXVzdCB0cmltIHRvIGxhc3QgMTUgZm9yIGFuZHJvaWQncyBwcyBiaW5hcnlcbiAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAxNSkge1xuICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5zdWJzdHIocmVzdWx0Lmxlbmd0aCAtIDE1KTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQVBLSW5mb1xuICogQHByb3BlcnR5IHtzdHJpbmd9IGFwa1BhY2thZ2UgLSBUaGUgbmFtZSBvZiBhcHBsaWNhdGlvbiBwYWNrYWdlLCBmb3IgZXhhbXBsZSAnY29tLmFjbWUuYXBwJy5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhcGtBY3Rpdml0eSAtIFRoZSBuYW1lIG9mIG1haW4gYXBwbGljYXRpb24gYWN0aXZpdHkuXG4gKi9cblxuLyoqXG4gKiBFeHRyYWN0IHBhY2thZ2UgYW5kIG1haW4gYWN0aXZpdHkgbmFtZSBmcm9tIGFwcGxpY2F0aW9uIG1hbmlmZXN0IHVzaW5nXG4gKiB0aGUgY3VzdG9tIGFwayB0b29scy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbG9jYWxBcGsgLSBUaGUgZnVsbCBwYXRoIHRvIGFwcGxpY2F0aW9uIHBhY2thZ2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gYWFwdFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIGFwcHQgYmluYXJ5LlxuICogQHBhcmFtIHtzdHJpbmd9IGphclBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIGFwcGl1bV9hcGtfdG9vbHMuamFyIHV0aWxpdHlcbiAqIEBwYXJhbSB7c3RyaW5nfSB0bXBSb290IC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgY2xhc3Mtd2lkZSB0ZW1wb3JhcnkgZm9sZGVyLlxuICogQHJldHVybiB7QVBLSW5mb30gVGhlIHBhcnNlZCBhcHBsaWNhdGlvbiBpbmZvLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBnZXR0aW5nIHRoZSBkYXRhIGZyb20gdGhlIGdpdmVuXG4gKiAgICAgICAgICAgICAgICAgYXBwbGljYXRpb24gcGFja2FnZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZXh0cmFjdEFwa0luZm9XaXRoQXBrVG9vbHMgKGxvY2FsQXBrLCBhYXB0UGF0aCwgamFyUGF0aCwgdG1wUm9vdCkge1xuICBsb2cuaW5mbyhcIkV4dHJhY3RpbmcgcGFja2FnZSBhbmQgbGF1bmNoIGFjdGl2aXR5IGZyb20gbWFuaWZlc3RcIik7XG4gIGxldCBhcmdzID0gWydkdW1wJywgJ2JhZGdpbmcnLCBsb2NhbEFwa107XG4gIGxldCBzdGRvdXQgPSAoYXdhaXQgZXhlYyhhYXB0UGF0aCwgYXJncykpLnN0ZG91dDtcbiAgbGV0IGFwa1BhY2thZ2UgPSBuZXcgUmVnRXhwKC9wYWNrYWdlOiBuYW1lPScoW14nXSspJy9nKS5leGVjKHN0ZG91dCk7XG4gIGlmICghYXBrUGFja2FnZSB8fCBhcGtQYWNrYWdlLmxlbmd0aCA8IDIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBwYXJzZSBwYWNrYWdlIG5hbWUgZnJvbSBgICtcbiAgICAgIGAnJHtfLmpvaW4oW2FhcHRQYXRoLCAnZHVtcCcsICdiYWRnaW5nJywgJ1wiJyArIGxvY2FsQXBrICsgJ1wiJ10sICcgJyl9JyBjb21tYW5kICBvdXRwdXRgKTtcbiAgfVxuICBhcGtQYWNrYWdlID0gYXBrUGFja2FnZVsxXTtcbiAgbGV0IGFwa0FjdGl2aXR5ID0gbmV3IFJlZ0V4cCgvbGF1bmNoYWJsZS1hY3Rpdml0eTogbmFtZT0nKFteJ10rKScvZykuZXhlYyhzdGRvdXQpO1xuICBpZiAoYXBrQWN0aXZpdHkgJiYgYXBrQWN0aXZpdHkubGVuZ3RoID49IDIpIHtcbiAgICBhcGtBY3Rpdml0eSA9IGFwa0FjdGl2aXR5WzFdO1xuICAgIHJldHVybiB7YXBrUGFja2FnZSwgYXBrQWN0aXZpdHl9O1xuICB9XG5cbiAgbGV0IG91dHB1dFBhdGggPSBwYXRoLnJlc29sdmUodG1wUm9vdCwgYXBrUGFja2FnZSk7XG4gIGxldCBnZXRMYXVuY2hBY3Rpdml0eSA9IFtcbiAgICAnLWphcicsIGphclBhdGgsXG4gICAgJ3ByaW50TGF1bmNoQWN0aXZpdHknLCBsb2NhbEFwayxcbiAgICBvdXRwdXRQYXRoXG4gIF07XG4gIGNvbnN0IG91dHB1dCA9IGF3YWl0IGV4ZWMoJ2phdmEnLCBnZXRMYXVuY2hBY3Rpdml0eSk7XG4gIGlmIChvdXRwdXQuc3RkZXJyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgcGFyc2UgbGF1bmNoQWN0aXZpdHkgZnJvbSBtYW5pZmVzdDogJHtvdXRwdXQuc3RkZXJyfWApO1xuICB9XG4gIHN0ZG91dCA9IG91dHB1dC5zdGRvdXQ7XG4gIGxldCBhY3QgPSBuZXcgUmVnRXhwKC9MYXVuY2ggYWN0aXZpdHkgcGFyc2VkOihbXiddKykvZykuZXhlYyhzdGRvdXQpO1xuICBpZiAoYWN0ICYmIGFjdC5sZW5ndGggPj0gMikge1xuICAgIGFwa0FjdGl2aXR5ID0gYWN0WzFdO1xuICAgIHJldHVybiB7YXBrUGFja2FnZSwgYXBrQWN0aXZpdHl9O1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHBhcnNlIG1haW4gYWN0aXZpdHkgbmFtZSBmcm9tICcke3N0ZG91dH0nIGNvbW1hbmQgIG91dHB1dGApO1xufVxuXG4vKipcbiAqIEV4dHJhY3QgcGFja2FnZSBhbmQgbWFpbiBhY3Rpdml0eSBuYW1lIGZyb20gYXBwbGljYXRpb24gbWFuaWZlc3QgdXNpbmdcbiAqIGFwa2FuYWx5emVyIHRvb2wuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsQXBrIC0gVGhlIGZ1bGwgcGF0aCB0byBhcHBsaWNhdGlvbiBwYWNrYWdlLlxuICogQHBhcmFtIHtzdHJpbmd9IGFwa2FuYWx5emVyUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gYXBrYW5hbHl6ZXIgdG9vbC5cbiAqIEByZXR1cm4ge0FQS0luZm99IFRoZSBwYXJzZWQgYXBwbGljYXRpb24gaW5mby5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZ2V0dGluZyB0aGUgZGF0YSBmcm9tIHRoZSBnaXZlblxuICogICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9uIHBhY2thZ2Ugb3IgaWYgdGhlIHRvb2wgaXRzZWxmXG4gKiAgICAgICAgICAgICAgICAgaXMgbm90IHByZXNlbnQgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtLlxuICovXG5hc3luYyBmdW5jdGlvbiBleHRyYWN0QXBrSW5mb1dpdGhBcGthbmFseXplciAobG9jYWxBcGssIGFwa2FuYWx5emVyUGF0aCkge1xuICBjb25zdCBhcmdzID0gWyctaCcsICdtYW5pZmVzdCcsICdwcmludCcsIGxvY2FsQXBrXTtcbiAgbG9nLmRlYnVnKGBTdGFydGluZyAnJHthcGthbmFseXplclBhdGh9JyB3aXRoIGFyZ3MgJHtKU09OLnN0cmluZ2lmeShhcmdzKX1gKTtcbiAgY29uc3QgbWFuaWZlc3RYbWwgPSAoYXdhaXQgZXhlYyhhcGthbmFseXplclBhdGgsIGFyZ3MsIHtcbiAgICBzaGVsbDogdHJ1ZSxcbiAgICBjd2Q6IHBhdGguZGlybmFtZShhcGthbmFseXplclBhdGgpXG4gIH0pKS5zdGRvdXQ7XG4gIGNvbnN0IGRvYyA9IG5ldyB4bWxkb20uRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKG1hbmlmZXN0WG1sKTtcbiAgY29uc3QgYXBrUGFja2FnZUF0dHJpYnV0ZSA9IHhwYXRoLnNlbGVjdDEoJy8vbWFuaWZlc3QvQHBhY2thZ2UnLCBkb2MpO1xuICBpZiAoIWFwa1BhY2thZ2VBdHRyaWJ1dGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBwYXJzZSBwYWNrYWdlIG5hbWUgZnJvbSAke21hbmlmZXN0WG1sfWApO1xuICB9XG4gIGNvbnN0IGFwa1BhY2thZ2UgPSBhcGtQYWNrYWdlQXR0cmlidXRlLnZhbHVlO1xuICAvLyBMb29rIGZvciBhY3Rpdml0eSBvciBhY3Rpdml0eS1hbGlhcyB3aXRoXG4gIC8vIGFjdGlvbiA9PSBhbmRyb2lkLmludGVudC5hY3Rpb24uTUFJTiBhbmRcbiAgLy8gY2F0ZWdvcnkgPT0gYW5kcm9pZC5pbnRlbnQuY2F0ZWdvcnkuTEFVTkNIRVJcbiAgLy8gZGVzY2VuZGFudHNcbiAgY29uc3QgYXBrQWN0aXZpdHlBdHRyaWJ1dGUgPSB4cGF0aC5zZWxlY3QxKFxuICAgIFwiLy9hcHBsaWNhdGlvbi8qW3N0YXJ0cy13aXRoKG5hbWUoKSwgJ2FjdGl2aXR5JykgXCIgK1xuICAgIFwiYW5kIC4vL2FjdGlvbltAKltsb2NhbC1uYW1lKCk9J25hbWUnIGFuZCAuPSdhbmRyb2lkLmludGVudC5hY3Rpb24uTUFJTiddXSBcIiArXG4gICAgXCJhbmQgLi8vY2F0ZWdvcnlbQCpbbG9jYWwtbmFtZSgpPSduYW1lJyBhbmQgLj0nYW5kcm9pZC5pbnRlbnQuY2F0ZWdvcnkuTEFVTkNIRVInXV1dXCIgK1xuICAgIFwiL0AqW2xvY2FsLW5hbWUoKT0nbmFtZSddXCIsIGRvYyk7XG4gIGlmICghYXBrQWN0aXZpdHlBdHRyaWJ1dGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBwYXJzZSBtYWluIGFjdGl2aXR5IG5hbWUgZnJvbSAke21hbmlmZXN0WG1sfWApO1xuICB9XG4gIGNvbnN0IGFwa0FjdGl2aXR5ID0gYXBrQWN0aXZpdHlBdHRyaWJ1dGUudmFsdWU7XG4gIHJldHVybiB7YXBrUGFja2FnZSwgYXBrQWN0aXZpdHl9O1xufVxuXG4vKipcbiAqIEV4dHJhY3QgcGFja2FnZSBhbmQgbWFpbiBhY3Rpdml0eSBuYW1lIGZyb20gYXBwbGljYXRpb24gbWFuaWZlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsQXBrIC0gVGhlIGZ1bGwgcGF0aCB0byBhcHBsaWNhdGlvbiBwYWNrYWdlLlxuICogQHJldHVybiB7QVBLSW5mb30gVGhlIHBhcnNlZCBhcHBsaWNhdGlvbiBpbmZvLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBnZXR0aW5nIHRoZSBkYXRhIGZyb20gdGhlIGdpdmVuXG4gKiAgICAgICAgICAgICAgICAgYXBwbGljYXRpb24gcGFja2FnZS5cbiAqL1xubWFuaWZlc3RNZXRob2RzLnBhY2thZ2VBbmRMYXVuY2hBY3Rpdml0eUZyb21NYW5pZmVzdCA9IGFzeW5jIGZ1bmN0aW9uIChsb2NhbEFwaykge1xuICBjb25zdCBhcGtJbmZvR2V0dGVycyA9IFtcbiAgICBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhcGthbmFseXplclBhdGggPSBhd2FpdCBnZXRBcGthbmFseXplckZvck9zKHRoaXMpO1xuICAgICAgcmV0dXJuIGF3YWl0IGV4dHJhY3RBcGtJbmZvV2l0aEFwa2FuYWx5emVyKGxvY2FsQXBrLCBhcGthbmFseXplclBhdGgpO1xuICAgIH0sXG4gICAgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgdGhpcy5pbml0QWFwdCgpO1xuICAgICAgcmV0dXJuIGF3YWl0IGV4dHJhY3RBcGtJbmZvV2l0aEFwa1Rvb2xzKGxvY2FsQXBrLFxuICAgICAgICB0aGlzLmJpbmFyaWVzLmFhcHQsIHRoaXMuamFyc1snYXBwaXVtX2Fwa190b29scy5qYXInXSwgdGhpcy50bXBEaXIpO1xuICAgIH0sXG4gIF07XG5cbiAgbGV0IHNhdmVkRXJyb3I7XG4gIGZvciAoY29uc3QgaW5mb0dldHRlciBvZiBhcGtJbmZvR2V0dGVycykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7YXBrUGFja2FnZSwgYXBrQWN0aXZpdHl9ID0gYXdhaXQgaW5mb0dldHRlcigpO1xuICAgICAgbG9nLmluZm8oYFBhY2thZ2UgbmFtZTogJyR7YXBrUGFja2FnZX0nYCk7XG4gICAgICBsb2cuaW5mbyhgTWFpbiBhY3Rpdml0eSBuYW1lOiAnJHthcGtBY3Rpdml0eX0nYCk7XG4gICAgICByZXR1cm4ge2Fwa1BhY2thZ2UsIGFwa0FjdGl2aXR5fTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoaW5mb0dldHRlciAhPT0gXy5sYXN0KGFwa0luZm9HZXR0ZXJzKSkge1xuICAgICAgICBsb2cuaW5mbyhgVXNpbmcgdGhlIGFsdGVybmF0aXZlIGFjdGl2aXR5IG5hbWUgZGV0ZWN0aW9uIG1ldGhvZCBgICtcbiAgICAgICAgICAgICAgICAgYGJlY2F1c2Ugb2Y6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgICAgc2F2ZWRFcnJvciA9IGU7XG4gICAgfVxuICB9XG4gIHRocm93IG5ldyBFcnJvcihgcGFja2FnZUFuZExhdW5jaEFjdGl2aXR5RnJvbU1hbmlmZXN0IGZhaWxlZC4gYCArXG4gICAgICAgICAgICAgICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7c2F2ZWRFcnJvci5tZXNzYWdlfWAgK1xuICAgICAgICAgICAgICAgICAgKHNhdmVkRXJyb3Iuc3RkZXJyID8gYDsgU3RkRXJyOiAke3NhdmVkRXJyb3Iuc3RkZXJyfWAgOiAnJykpO1xufTtcblxuLyoqXG4gKiBFeHRyYWN0IHRhcmdldCBTREsgdmVyc2lvbiBmcm9tIGFwcGxpY2F0aW9uIG1hbmlmZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsb2NhbEFwayAtIFRoZSBmdWxsIHBhdGggdG8gYXBwbGljYXRpb24gcGFja2FnZS5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIHZlcnNpb24gb2YgdGhlIHRhcmdldCBTREsuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGdldHRpbmcgdGhlIGRhdGEgZnJvbSB0aGUgZ2l2ZW5cbiAqICAgICAgICAgICAgICAgICBhcHBsaWNhdGlvbiBwYWNrYWdlLlxuICovXG5tYW5pZmVzdE1ldGhvZHMudGFyZ2V0U2RrVmVyc2lvbkZyb21NYW5pZmVzdCA9IGFzeW5jIGZ1bmN0aW9uIChsb2NhbEFwaykge1xuICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG4gIGxvZy5pbmZvKFwiRXh0cmFjdGluZyBwYWNrYWdlIGFuZCBsYXVuY2ggYWN0aXZpdHkgZnJvbSBtYW5pZmVzdFwiKTtcbiAgbGV0IGFyZ3MgPSBbJ2R1bXAnLCAnYmFkZ2luZycsIGxvY2FsQXBrXTtcbiAgbGV0IG91dHB1dDtcbiAgdHJ5IHtcbiAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgYXJncyk7XG4gICAgb3V0cHV0ID0gc3Rkb3V0O1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBmZXRjaGluZyB0YXJnZXRTZGtWZXJzaW9uIGZyb20gbG9jYWwgQVBLIGZhaWxlZC4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG4gIGxldCB0YXJnZXRTZGtWZXJzaW9uID0gbmV3IFJlZ0V4cCgvdGFyZ2V0U2RrVmVyc2lvbjonKFteJ10rKScvZykuZXhlYyhvdXRwdXQpO1xuICBpZiAoIXRhcmdldFNka1ZlcnNpb24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYHRhcmdldFNka1ZlcnNpb24gaXMgbm90IHNwZWNpZmllZCBpbiB0aGUgYXBwbGljYXRpb24uYCk7XG4gIH1cbiAgcmV0dXJuIHBhcnNlSW50KHRhcmdldFNka1ZlcnNpb25bMV0sIDEwKTtcbn07XG5cbi8qKlxuICogRXh0cmFjdCB0YXJnZXQgU0RLIHZlcnNpb24gZnJvbSBwYWNrYWdlIGluZm9ybWF0aW9uLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwa2cgLSBUaGUgY2xhc3MgbmFtZSBvZiB0aGUgcGFja2FnZSBpbnN0YWxsZWQgb24gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICogQHBhcmFtIHs/c3RyaW5nfSBjbWRPdXRwdXQgLSBPcHRpb25hbCBwYXJhbWV0ZXIgY29udGFpbmluZyB0aGUgb3V0cHV0IG9mXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9kdW1wc3lzIHBhY2thZ2VfIGNvbW1hbmQuIEl0IG1heSBzcGVlZCB1cCB0aGUgbWV0aG9kIGV4ZWN1dGlvbi5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIHZlcnNpb24gb2YgdGhlIHRhcmdldCBTREsuXG4gKi9cbm1hbmlmZXN0TWV0aG9kcy50YXJnZXRTZGtWZXJzaW9uVXNpbmdQS0cgPSBhc3luYyBmdW5jdGlvbiAocGtnLCBjbWRPdXRwdXQgPSBudWxsKSB7XG4gIGxldCBzdGRvdXQgPSBjbWRPdXRwdXQgfHwgYXdhaXQgdGhpcy5zaGVsbChbJ2R1bXBzeXMnLCAncGFja2FnZScsIHBrZ10pO1xuICBsZXQgdGFyZ2V0U2RrVmVyc2lvbiA9IG5ldyBSZWdFeHAoL3RhcmdldFNkaz0oW15cXHNcXHNdKykvZykuZXhlYyhzdGRvdXQpO1xuICBpZiAodGFyZ2V0U2RrVmVyc2lvbiAmJiB0YXJnZXRTZGtWZXJzaW9uLmxlbmd0aCA+PSAyKSB7XG4gICAgdGFyZ2V0U2RrVmVyc2lvbiA9IHRhcmdldFNka1ZlcnNpb25bMV07XG4gIH0gZWxzZSB7XG4gICAgLy8gdGFyZ2V0U2RrIG5vdCBmb3VuZCBpbiB0aGUgZHVtcCwgYXNzaWduaW5nIDAgdG8gdGFyZ2V0U2RrVmVyc2lvblxuICAgIHRhcmdldFNka1ZlcnNpb24gPSAwO1xuICB9XG4gIHJldHVybiBwYXJzZUludCh0YXJnZXRTZGtWZXJzaW9uLCAxMCk7XG59O1xuXG4vKipcbiAqIENyZWF0ZSBiaW5hcnkgcmVwcmVzZW50YXRpb24gb2YgcGFja2FnZSBtYW5pZmVzdCAodXN1YWxseSBBbmRyb2lkTWFuaWZlc3QueG1sKS5cbiAqIGAke21hbmlmZXN0fS5hcGtgIGZpbGUgd2lsbCBiZSBjcmVhdGVkIGFzIHRoZSByZXN1bHQgb2YgdGhpcyBtZXRob2RcbiAqIGNvbnRhaW5pbmcgdGhlIGNvbXBpbGVkIG1hbmlmZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBtYW5pZmVzdCAtIEZ1bGwgcGF0aCB0byB0aGUgaW5pdGlhbCBtYW5pZmVzdCB0ZW1wbGF0ZVxuICogQHBhcmFtIHtzdHJpbmd9IG1hbmlmZXN0UGFja2FnZSAtIFRoZSBuYW1lIG9mIHRoZSBtYW5pZmVzdCBwYWNrYWdlXG4gKiBAcGFyYW0ge3N0cmluZ30gdGFyZ2V0UGFja2FnZSAtIFRoZSBuYW1lIG9mIHRoZSBkZXN0aW5hdGlvbiBwYWNrYWdlXG4gKi9cbm1hbmlmZXN0TWV0aG9kcy5jb21waWxlTWFuaWZlc3QgPSBhc3luYyBmdW5jdGlvbiAobWFuaWZlc3QsIG1hbmlmZXN0UGFja2FnZSwgdGFyZ2V0UGFja2FnZSkge1xuICBjb25zdCB7cGxhdGZvcm0sIHBsYXRmb3JtUGF0aH0gPSBhd2FpdCBnZXRBbmRyb2lkUGxhdGZvcm1BbmRQYXRoKCk7XG4gIGlmICghcGxhdGZvcm0pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjb21waWxlIHRoZSBtYW5pZmVzdC4gVGhlIHJlcXVpcmVkIHBsYXRmb3JtIGRvZXMgbm90IGV4aXN0IChBUEkgbGV2ZWwgPj0gMTcpJyk7XG4gIH1cbiAgY29uc3QgcmVzdWx0UGF0aCA9IGAke21hbmlmZXN0fS5hcGtgO1xuICBjb25zdCBhcmdzID0gW1xuICAgICdwYWNrYWdlJyxcbiAgICAnLU0nLCBtYW5pZmVzdCxcbiAgICAnLS1yZW5hbWUtbWFuaWZlc3QtcGFja2FnZScsIG1hbmlmZXN0UGFja2FnZSxcbiAgICAnLS1yZW5hbWUtaW5zdHJ1bWVudGF0aW9uLXRhcmdldC1wYWNrYWdlJywgdGFyZ2V0UGFja2FnZSxcbiAgICAnLUknLCBwYXRoLnJlc29sdmUocGxhdGZvcm1QYXRoLCAnYW5kcm9pZC5qYXInKSxcbiAgICAnLUYnLCByZXN1bHRQYXRoLFxuICAgICctZicsXG4gIF07XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5pbml0QWFwdCgpO1xuICAgIGxvZy5kZWJ1ZyhgQ29tcGlsaW5nIHRoZSBtYW5pZmVzdDogJHt0aGlzLmJpbmFyaWVzLmFhcHR9ICR7cXVvdGUoYXJncyl9YCk7XG4gICAgYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLmFhcHQsIGFyZ3MpO1xuICAgIGxvZy5kZWJ1ZyhgQ29tcGlsZWQgdGhlIG1hbmlmZXN0IGF0ICcke3Jlc3VsdFBhdGh9J2ApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjb21waWxlIHRoZSBtYW5pZmVzdC4gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogUmVwbGFjZS9pbnNlcnQgdGhlIHNwZWNpYWxseSBwcmVjb21waWxlZCBtYW5pZmVzdCBmaWxlIGludG8gdGhlXG4gKiBwYXJ0aWN1bGFyIHBhY2thZ2UuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG1hbmlmZXN0IC0gRnVsbCBwYXRoIHRvIHRoZSBwcmVjb21waWxlZCBtYW5pZmVzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZCBieSBgY29tcGlsZU1hbmlmZXN0YCBtZXRob2QgY2FsbFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aG91dCAuYXBrIGV4dGVuc2lvblxuICogQHBhcmFtIHtzdHJpbmd9IHNyY0FwayAtIEZ1bGwgcGF0aCB0byB0aGUgZXhpc3RpbmcgdmFsaWQgYXBwbGljYXRpb24gcGFja2FnZSwgd2hlcmVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzIG1hbmlmZXN0IGhhcyB0byBiZSBpbnNldHJlZCB0by4gVGhpcyBwYWNrYWdlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBOT1QgYmUgbW9kaWZpZWQuXG4gKiBAcGFyYW0ge3N0cmluZ30gZHN0QXBrIC0gRnVsbCBwYXRoIHRvIHRoZSByZXN1bHRpbmcgcGFja2FnZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgZmlsZSB3aWxsIGJlIG92ZXJyaWRlbiBpZiBpdCBhbHJlYWR5IGV4aXN0cy5cbiAqL1xubWFuaWZlc3RNZXRob2RzLmluc2VydE1hbmlmZXN0ID0gYXN5bmMgZnVuY3Rpb24gKG1hbmlmZXN0LCBzcmNBcGssIGRzdEFwaykge1xuICBsb2cuZGVidWcoYEluc2VydGluZyBtYW5pZmVzdCwgc3JjOiAke3NyY0Fwa30gZHN0OiAke2RzdEFwa31gKTtcbiAgYXdhaXQgdGhpcy5pbml0QWFwdCgpO1xuICBhd2FpdCB1bnppcEZpbGUoYCR7bWFuaWZlc3R9LmFwa2ApO1xuICBhd2FpdCBmcy5jb3B5RmlsZShzcmNBcGssIGRzdEFwayk7XG4gIGxvZy5kZWJ1ZyhcIlRlc3RpbmcgbmV3IHRtcCBhcGtcIik7XG4gIGF3YWl0IGFzc2VydFppcEFyY2hpdmUoZHN0QXBrKTtcbiAgbG9nLmRlYnVnKFwiTW92aW5nIG1hbmlmZXN0XCIpO1xuICB0cnkge1xuICAgIGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbXG4gICAgICAncmVtb3ZlJywgZHN0QXBrLCBwYXRoLmJhc2VuYW1lKG1hbmlmZXN0KVxuICAgIF0pO1xuICB9IGNhdGNoIChpZ24pIHt9XG4gIGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbXG4gICAgJ2FkZCcsIGRzdEFwaywgcGF0aC5iYXNlbmFtZShtYW5pZmVzdClcbiAgXSwge2N3ZDogcGF0aC5kaXJuYW1lKG1hbmlmZXN0KX0pO1xuICBsb2cuZGVidWcoXCJJbnNlcnRlZCBtYW5pZmVzdC5cIik7XG59O1xuXG4vKipcbiAqIENoZWNrIHdoZXRoZXIgcGFja2FnZSBtYW5pZmVzdCBjb250YWlucyBJbnRlcm5ldCBwZXJtaXNzaW9ucy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbG9jYWxBcGsgLSBUaGUgZnVsbCBwYXRoIHRvIGFwcGxpY2F0aW9uIHBhY2thZ2UuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBtYW5pZmVzdCByZXF1aXJlcyBJbnRlcm5ldCBhY2Nlc3MgcGVybWlzc2lvbi5cbiAqL1xubWFuaWZlc3RNZXRob2RzLmhhc0ludGVybmV0UGVybWlzc2lvbkZyb21NYW5pZmVzdCA9IGFzeW5jIGZ1bmN0aW9uIChsb2NhbEFwaykge1xuICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG4gIGxvZy5kZWJ1ZyhgQ2hlY2tpbmcgaWYgJyR7bG9jYWxBcGt9JyByZXF1aXJlcyBpbnRlcm5ldCBhY2Nlc3MgcGVybWlzc2lvbiBpbiB0aGUgbWFuaWZlc3RgKTtcbiAgdHJ5IHtcbiAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgWydkdW1wJywgJ2JhZGdpbmcnLCBsb2NhbEFwa10pO1xuICAgIHJldHVybiBuZXcgUmVnRXhwKC91c2VzLXBlcm1pc3Npb246LionYW5kcm9pZC5wZXJtaXNzaW9uLklOVEVSTkVUJy8pLnRlc3Qoc3Rkb3V0KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNoZWNrIGlmICcke2xvY2FsQXBrfScgcmVxdWlyZXMgaW50ZXJuZXQgYWNjZXNzIHBlcm1pc3Npb24uIGAgK1xuICAgICAgICAgICAgICAgICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG4vKlxuICogUHJpbnRzIG91dCB0aGUgbWFuaWZlc3QgZXh0cmFjdGVkIGZyb20gdGhlIGFwa1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsb2NhbEFwayAtIFRoZSBmdWxsIHBhdGggdG8gYXBwbGljYXRpb24gcGFja2FnZS5cbiAqIEBwYXJhbSB7P3N0cmluZ30gbG9nTGV2ZWwgLSBUaGUgbGV2ZWwgYXQgd2hpY2ggdG8gbG9nLiBFLmcuLCAnZGVidWcnXG4gKi9cbm1hbmlmZXN0TWV0aG9kcy5wcmludE1hbmlmZXN0RnJvbUFwayA9IGFzeW5jIGZ1bmN0aW9uIHByaW50TWFuaWZlc3RGcm9tQXBrIChsb2NhbEFwaywgbG9nTGV2ZWwgPSAnZGVidWcnKSB7XG4gIGF3YWl0IHRoaXMuaW5pdEFhcHQoKTtcbiAgbG9nW2xvZ0xldmVsXShgQW5kcm9pZCBtYW5pZmVzdCBleHRyYWN0ZWQgZnJvbSAnJHtsb2NhbEFwa30nYCk7XG4gIGxldCBvdXQgPSBmYWxzZTtcbiAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgWydsJywgJy1hJywgbG9jYWxBcGtdKTtcbiAgZm9yIChjb25zdCBsaW5lIG9mIHN0ZG91dC5zcGxpdCgnXFxuJykpIHtcbiAgICBpZiAoIW91dCAmJiBsaW5lLmluY2x1ZGVzKCdBbmRyb2lkIG1hbmlmZXN0OicpKSB7XG4gICAgICBvdXQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAob3V0KSB7XG4gICAgICBsb2dbbG9nTGV2ZWxdKGxpbmUpO1xuICAgIH1cbiAgfVxufTtcblxuXG5leHBvcnQgZGVmYXVsdCBtYW5pZmVzdE1ldGhvZHM7XG4iXSwiZmlsZSI6ImxpYi90b29scy9hbmRyb2lkLW1hbmlmZXN0LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
