"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _helpers = require("../helpers.js");

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("../logger.js"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncbox = require("asyncbox");

var _appiumSupport = require("appium-support");

var _semver = _interopRequireDefault(require("semver"));

var _os = _interopRequireDefault(require("os"));

let apkUtilsMethods = {};
const ACTIVITIES_TROUBLESHOOTING_LINK = 'https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/android/activity-startup.md';

apkUtilsMethods.isAppInstalled = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (pkg) {
    _logger.default.debug(`Getting install status for ${pkg}`);

    const installedPattern = new RegExp(`^\\s*Package\\s+\\[${_lodash.default.escapeRegExp(pkg)}\\][^:]+:$`, 'm');

    try {
      const stdout = yield this.shell(['dumpsys', 'package', pkg]);
      const isInstalled = installedPattern.test(stdout);

      _logger.default.debug(`'${pkg}' is${!isInstalled ? ' not' : ''} installed`);

      return isInstalled;
    } catch (e) {
      throw new Error(`Error finding if '${pkg}' is installed. Original error: ${e.message}`);
    }
  });

  return function (_x) {
    return _ref.apply(this, arguments);
  };
}();

apkUtilsMethods.startUri = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (uri, pkg) {
    if (!uri || !pkg) {
      throw new Error("URI and package arguments are required");
    }

    const args = ["am", "start", "-W", "-a", "android.intent.action.VIEW", "-d", uri.replace(/&/g, '\\&'), pkg];

    try {
      const res = yield this.shell(args);

      if (res.toLowerCase().includes('unable to resolve intent')) {
        throw new Error(res);
      }
    } catch (e) {
      throw new Error(`Error attempting to start URI. Original error: ${e}`);
    }
  });

  return function (_x2, _x3) {
    return _ref2.apply(this, arguments);
  };
}();

apkUtilsMethods.startApp = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (startAppOptions = {}) {
    if (!startAppOptions.activity || !startAppOptions.pkg) {
      throw new Error("activity and pkg are required to start an application");
    }

    startAppOptions = _lodash.default.clone(startAppOptions);
    startAppOptions.activity = startAppOptions.activity.replace('$', '\\$');

    _lodash.default.defaults(startAppOptions, {
      waitPkg: startAppOptions.pkg,
      waitActivity: false,
      retry: true,
      stopApp: true
    });

    startAppOptions.waitPkg = startAppOptions.waitPkg || startAppOptions.pkg;
    const apiLevel = yield this.getApiLevel();
    const cmd = (0, _helpers.buildStartCmd)(startAppOptions, apiLevel);

    try {
      const shellOpts = {};

      if (_lodash.default.isInteger(startAppOptions.waitDuration) && startAppOptions.waitDuration > 20000) {
        shellOpts.timeout = startAppOptions.waitDuration;
      }

      const stdout = yield this.shell(cmd, shellOpts);

      if (stdout.includes("Error: Activity class") && stdout.includes("does not exist")) {
        if (startAppOptions.retry && !startAppOptions.activity.startsWith(".")) {
          _logger.default.debug(`We tried to start an activity that doesn't exist, ` + `retrying with '.${startAppOptions.activity}' activity name`);

          startAppOptions.activity = `.${startAppOptions.activity}`;
          startAppOptions.retry = false;
          return yield this.startApp(startAppOptions);
        }

        throw new Error(`Activity name '${startAppOptions.activity}' used to start the app doesn't ` + `exist or cannot be launched! Make sure it exists and is a launchable activity`);
      } else if (stdout.includes("java.lang.SecurityException")) {
        throw new Error(`The permission to start '${startAppOptions.activity}' activity has been denied.` + `Make sure the activity/package names are correct.`);
      }

      if (startAppOptions.waitActivity) {
        yield this.waitForActivity(startAppOptions.waitPkg, startAppOptions.waitActivity, startAppOptions.waitDuration);
      }

      return stdout;
    } catch (e) {
      throw new Error(`Cannot start the '${startAppOptions.pkg}' application. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting. ` + `Original error: ${e.message}`);
    }
  });

  return function () {
    return _ref3.apply(this, arguments);
  };
}();

apkUtilsMethods.getFocusedPackageAndActivity = (0, _asyncToGenerator2.default)(function* () {
  _logger.default.debug("Getting focused package and activity");

  const cmd = ['dumpsys', 'window', 'windows'];
  const nullFocusedAppRe = new RegExp(/^\s*mFocusedApp=null/, 'm');
  const focusedAppRe = new RegExp('^\\s*mFocusedApp.+Record\\{.*\\s([^\\s\\/\\}]+)' + '\\/([^\\s\\/\\}\\,]+)\\,?(\\s[^\\s\\/\\}]+)*\\}', 'm');
  const nullCurrentFocusRe = new RegExp(/^\s*mCurrentFocus=null/, 'm');
  const currentFocusAppRe = new RegExp('^\\s*mCurrentFocus.+\\{.+\\s([^\\s\\/]+)\\/([^\\s]+)\\b', 'm');

  try {
    const stdout = yield this.shell(cmd);
    var _arr = [focusedAppRe, currentFocusAppRe];

    for (var _i = 0; _i < _arr.length; _i++) {
      const pattern = _arr[_i];
      const match = pattern.exec(stdout);

      if (match) {
        return {
          appPackage: match[1].trim(),
          appActivity: match[2].trim()
        };
      }
    }

    var _arr2 = [nullFocusedAppRe, nullCurrentFocusRe];

    for (var _i2 = 0; _i2 < _arr2.length; _i2++) {
      const pattern = _arr2[_i2];

      if (pattern.exec(stdout)) {
        return {
          appPackage: null,
          appActivity: null
        };
      }
    }

    throw new Error("Could not parse activity from dumpsys");
  } catch (e) {
    throw new Error(`Could not get focusPackageAndActivity. Original error: ${e.message}`);
  }
});

apkUtilsMethods.waitForActivityOrNot = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (pkg, activity, waitForStop, waitMs = 20000) {
    var _this = this;

    if (!pkg || !activity) {
      throw new Error('Package and activity required.');
    }

    _logger.default.debug(`Waiting up to ${waitMs}ms for activity matching pkg: '${pkg}' and ` + `activity: '${activity}' to${waitForStop ? ' not' : ''} be focused`);

    const splitNames = names => names.split(',').map(name => name.trim());

    const allPackages = splitNames(pkg);
    const allActivities = splitNames(activity);
    let possibleActivityNames = [];
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = allActivities[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        let oneActivity = _step.value;

        if (oneActivity.startsWith('.')) {
          var _iteratorNormalCompletion2 = true;
          var _didIteratorError2 = false;
          var _iteratorError2 = undefined;

          try {
            for (var _iterator2 = allPackages[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              let currentPkg = _step2.value;
              possibleActivityNames.push(`${currentPkg}${oneActivity}`.replace(/\.+/g, '.'));
            }
          } catch (err) {
            _didIteratorError2 = true;
            _iteratorError2 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
                _iterator2.return();
              }
            } finally {
              if (_didIteratorError2) {
                throw _iteratorError2;
              }
            }
          }
        } else {
          possibleActivityNames.push(oneActivity);
          possibleActivityNames.push(`${pkg}.${oneActivity}`);
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    _logger.default.debug(`Possible activities, to be checked: ${possibleActivityNames.map(name => `'${name}'`).join(', ')}`);

    let possibleActivityPatterns = possibleActivityNames.map(possibleActivityName => new RegExp(`^${possibleActivityName.replace(/\./g, '\\.').replace(/\*/g, '.*?').replace(/\$/g, '\\$')}$`));
    let retries = parseInt(waitMs / 750, 10) || 1;
    retries = isNaN(retries) ? 30 : retries;
    yield (0, _asyncbox.retryInterval)(retries, 750, (0, _asyncToGenerator2.default)(function* () {
      let _ref7 = yield _this.getFocusedPackageAndActivity(),
          appPackage = _ref7.appPackage,
          appActivity = _ref7.appActivity;

      if (appActivity && appPackage) {
        let fullyQualifiedActivity = appActivity.startsWith('.') ? `${appPackage}${appActivity}` : appActivity;

        _logger.default.debug(`Found package: '${appPackage}' and fully qualified activity name : '${fullyQualifiedActivity}'`);

        let foundAct = _lodash.default.includes(allPackages, appPackage) && _lodash.default.findIndex(possibleActivityPatterns, possiblePattern => possiblePattern.test(fullyQualifiedActivity)) !== -1;

        if (!waitForStop && foundAct || waitForStop && !foundAct) {
          return;
        }
      }

      _logger.default.debug('Incorrect package and activity. Retrying.');

      throw new Error(`${possibleActivityNames.map(name => `'${name}'`).join(' or ')} never ${waitForStop ? 'stopped' : 'started'}. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting`);
    }));
  });

  return function (_x4, _x5, _x6) {
    return _ref5.apply(this, arguments);
  };
}();

apkUtilsMethods.waitForActivity = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (pkg, act, waitMs = 20000) {
    yield this.waitForActivityOrNot(pkg, act, false, waitMs);
  });

  return function (_x7, _x8) {
    return _ref8.apply(this, arguments);
  };
}();

apkUtilsMethods.waitForNotActivity = function () {
  var _ref9 = (0, _asyncToGenerator2.default)(function* (pkg, act, waitMs = 20000) {
    yield this.waitForActivityOrNot(pkg, act, true, waitMs);
  });

  return function (_x9, _x10) {
    return _ref9.apply(this, arguments);
  };
}();

const APK_UNINSTALL_TIMEOUT = 20000;

apkUtilsMethods.uninstallApk = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (pkg, options = {}) {
    _logger.default.debug(`Uninstalling ${pkg}`);

    if (!(yield this.isAppInstalled(pkg))) {
      _logger.default.info(`${pkg} was not uninstalled, because it was not present on the device`);

      return false;
    }

    let timeout = APK_UNINSTALL_TIMEOUT;

    if (_appiumSupport.util.hasValue(options.timeout) && !isNaN(options.timeout)) {
      timeout = parseInt(options.timeout, 10);
    }

    const cmd = ['uninstall'];

    if (options.keepData) {
      cmd.push('-k');
    }

    cmd.push(pkg);
    let stdout;

    try {
      yield this.forceStop(pkg);
      stdout = (yield this.adbExec(cmd, {
        timeout
      })).trim();
    } catch (e) {
      throw new Error(`Unable to uninstall APK. Original error: ${e.message}`);
    }

    _logger.default.debug(`'adb ${cmd.join(' ')}' command output: ${stdout}`);

    if (stdout.includes("Success")) {
      _logger.default.info(`${pkg} was successfully uninstalled`);

      return true;
    }

    _logger.default.info(`${pkg} was not uninstalled`);

    return false;
  });

  return function (_x11) {
    return _ref10.apply(this, arguments);
  };
}();

apkUtilsMethods.installFromDevicePath = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (apkPathOnDevice, opts = {}) {
    let stdout = yield this.shell(['pm', 'install', '-r', apkPathOnDevice], opts);

    if (stdout.indexOf("Failure") !== -1) {
      throw new Error(`Remote install failed: ${stdout}`);
    }
  });

  return function (_x12) {
    return _ref11.apply(this, arguments);
  };
}();

const APK_INSTALL_TIMEOUT = 60000;

apkUtilsMethods.install = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (apk, options = {}) {
    var _this2 = this;

    if (!_appiumSupport.util.hasValue(options.replace)) {
      options.replace = true;
    }

    let timeout = APK_INSTALL_TIMEOUT;

    if (_appiumSupport.util.hasValue(options.timeout) && !isNaN(options.timeout)) {
      timeout = parseInt(options.timeout, 10);
    }

    const additionalArgs = [];

    if (options.allowTestPackages) {
      additionalArgs.push('-t');
    }

    if (options.useSdcard) {
      additionalArgs.push('-s');
    }

    if (options.grantPermissions) {
      const apiLevel = yield this.getApiLevel();

      if (apiLevel < 23) {
        _logger.default.debug(`Skipping granting permissions for '${apk}', since ` + `the current API level ${apiLevel} does not support applications ` + `permissions customization`);
      } else {
        additionalArgs.push('-g');
      }
    }

    const executeInstall = function () {
      var _ref13 = (0, _asyncToGenerator2.default)(function* (args) {
        const output = yield _this2.adbExec(['install', ...args, apk], {
          timeout
        });
        const truncatedOutput = !_lodash.default.isString(output) || output.length <= 300 ? output : `${output.substr(0, 150)}...${output.substr(output.length - 150)}`;

        _logger.default.debug(`Install command stdout: ${truncatedOutput}`);

        if (_lodash.default.isString(output) && output.includes('INSTALL_FAILED')) {
          throw new Error(output);
        }
      });

      return function executeInstall(_x14) {
        return _ref13.apply(this, arguments);
      };
    }();

    if (options.replace) {
      return yield executeInstall(['-r', ...additionalArgs]);
    }

    try {
      yield executeInstall(additionalArgs);
    } catch (err) {
      if (!err.message.includes('INSTALL_FAILED_ALREADY_EXISTS')) {
        throw err;
      }

      _logger.default.debug(`Application '${apk}' already installed. Continuing.`);
    }
  });

  return function (_x13) {
    return _ref12.apply(this, arguments);
  };
}();

apkUtilsMethods.installOrUpgrade = function () {
  var _ref14 = (0, _asyncToGenerator2.default)(function* (apk, pkg = null, options = {}) {
    if (!_appiumSupport.util.hasValue(options.timeout)) {
      options.timeout = APK_INSTALL_TIMEOUT;
    }

    let apkInfo = null;

    if (!pkg) {
      apkInfo = yield this.getApkInfo(apk);
      pkg = apkInfo.name;
    }

    if (!pkg) {
      _logger.default.warn(`Cannot read the package name of ${apk}. Assuming correct app version is already installed`);

      return;
    }

    if (!(yield this.isAppInstalled(pkg))) {
      _logger.default.debug(`App '${apk}' not installed. Installing`);

      yield this.install(apk, Object.assign({}, options, {
        replace: false
      }));
      return;
    }

    const _ref15 = yield this.getPackageInfo(pkg),
          pkgVersionCode = _ref15.versionCode,
          pkgVersionNameStr = _ref15.versionName;

    const pkgVersionName = _semver.default.valid(_semver.default.coerce(pkgVersionNameStr));

    if (!apkInfo) {
      apkInfo = yield this.getApkInfo(apk);
    }

    const _apkInfo = apkInfo,
          apkVersionCode = _apkInfo.versionCode,
          apkVersionNameStr = _apkInfo.versionName;

    const apkVersionName = _semver.default.valid(_semver.default.coerce(apkVersionNameStr));

    if (!_lodash.default.isInteger(apkVersionCode) || !_lodash.default.isInteger(pkgVersionCode)) {
      _logger.default.warn(`Cannot read version codes of '${apk}' and/or '${pkg}'`);

      if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
        _logger.default.warn(`Cannot read version names of '${apk}' and/or '${pkg}'. Assuming correct app version is already installed`);

        return;
      }
    }

    if (_lodash.default.isInteger(apkVersionCode) && _lodash.default.isInteger(pkgVersionCode)) {
      if (pkgVersionCode > apkVersionCode) {
        _logger.default.debug(`The installed '${pkg}' package does not require upgrade (${pkgVersionCode} > ${apkVersionCode})`);

        return;
      }

      if (pkgVersionCode === apkVersionCode) {
        if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
          _logger.default.debug(`The installed '${pkg}' package does not require upgrade ('${pkgVersionName}' >= '${apkVersionName}')`);

          return;
        }

        if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
          _logger.default.debug(`The installed '${pkg}' package does not require upgrade (${pkgVersionCode} === ${apkVersionCode})`);

          return;
        }
      }
    } else if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
      _logger.default.debug(`The installed '${pkg}' package does not require upgrade ('${pkgVersionName}' >= '${apkVersionName}')`);

      return;
    }

    _logger.default.debug(`The installed '${pkg}' package is older than '${apk}' ` + `(${pkgVersionCode} < ${apkVersionCode} or '${pkgVersionName}' < '${apkVersionName}')'. ` + `Executing upgrade`);

    try {
      yield this.install(apk, Object.assign({}, options, {
        replace: true
      }));
    } catch (err) {
      _logger.default.warn(`Cannot upgrade '${pkg}' because of '${err.message}'. Trying full reinstall`);

      if (!(yield this.uninstallApk(pkg))) {
        throw new Error(`'${pkg}' package cannot be uninstalled`);
      }

      yield this.install(apk, Object.assign({}, options, {
        replace: false
      }));
    }
  });

  return function (_x15) {
    return _ref14.apply(this, arguments);
  };
}();

apkUtilsMethods.extractStringsFromApk = function () {
  var _ref16 = (0, _asyncToGenerator2.default)(function* (apk, language, out) {
    _logger.default.debug(`Extracting strings for language: ${language || 'default'}`);

    yield this.initAapt();
    let rawAaptOutput;

    try {
      const _ref17 = yield (0, _teen_process.exec)(this.binaries.aapt, ['d', '--values', 'resources', apk]),
            stdout = _ref17.stdout;

      rawAaptOutput = stdout;
    } catch (e) {
      throw new Error(`Cannot extract resources from '${apk}'. Original error: ${e.message}`);
    }

    const defaultConfigMarker = '(default)';
    let configMarker = language || defaultConfigMarker;

    if (configMarker.includes('-') && !configMarker.includes('-r')) {
      configMarker = configMarker.replace('-', '-r');
    }

    if (configMarker.toLowerCase().startsWith('en')) {
      const _ref18 = yield (0, _teen_process.exec)(this.binaries.aapt, ['d', 'configurations', apk]),
            stdout = _ref18.stdout;

      const configs = stdout.split(_os.default.EOL);

      if (!configs.includes(configMarker)) {
        _logger.default.debug(`There is no '${configMarker}' configuration. ` + `Replacing it with '${defaultConfigMarker}'`);

        configMarker = defaultConfigMarker;
      }
    }

    const apkStrings = {};
    let isInConfig = false;
    let currentResourceId = null;
    let isInPluralGroup = false;

    const startsWithAny = (s, arr) => arr.reduce((acc, x) => acc || s.startsWith(x), false);

    const normalizeStringMatch = s => s.replace(/"$/, '').replace(/^"/, '').replace(/\\"/g, '"');

    var _iteratorNormalCompletion3 = true;
    var _didIteratorError3 = false;
    var _iteratorError3 = undefined;

    try {
      for (var _iterator3 = rawAaptOutput.split(_os.default.EOL)[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
        const line = _step3.value;
        const trimmedLine = line.trim();

        if (_lodash.default.isEmpty(trimmedLine)) {
          continue;
        }

        if (startsWithAny(trimmedLine, ['config', 'type', 'spec', 'Package'])) {
          isInConfig = trimmedLine.startsWith(`config ${configMarker}:`);
          currentResourceId = null;
          isInPluralGroup = false;
          continue;
        }

        if (!isInConfig) {
          continue;
        }

        if (trimmedLine.startsWith('resource')) {
          isInPluralGroup = false;
          currentResourceId = null;

          if (trimmedLine.includes(':string/')) {
            const match = /:string\/(\S+):/.exec(trimmedLine);

            if (match) {
              currentResourceId = match[1];
            }
          } else if (trimmedLine.includes(':plurals/')) {
            const match = /:plurals\/(\S+):/.exec(trimmedLine);

            if (match) {
              currentResourceId = match[1];
              isInPluralGroup = true;
            }
          }

          continue;
        }

        if (currentResourceId && trimmedLine.startsWith('(string')) {
          const match = /"[^"\\]*(?:\\.[^"\\]*)*"/.exec(trimmedLine);

          if (match) {
            apkStrings[currentResourceId] = normalizeStringMatch(match[0]);
          }

          currentResourceId = null;
          continue;
        }

        if (currentResourceId && isInPluralGroup && trimmedLine.includes(': (string')) {
          const match = /"[^"\\]*(?:\\.[^"\\]*)*"/.exec(trimmedLine);

          if (match) {
            apkStrings[currentResourceId] = [...(apkStrings[currentResourceId] || []), normalizeStringMatch(match[0])];
          }

          continue;
        }
      }
    } catch (err) {
      _didIteratorError3 = true;
      _iteratorError3 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
          _iterator3.return();
        }
      } finally {
        if (_didIteratorError3) {
          throw _iteratorError3;
        }
      }
    }

    if (_lodash.default.isEmpty(apkStrings)) {
      _logger.default.warn(`No strings have been found in '${apk}' resources ` + `for '${configMarker}' configuration`);
    } else {
      _logger.default.info(`Successfully extracted ${_lodash.default.keys(apkStrings).length} strings from '${apk}' resources ` + `for '${configMarker}' configuration`);
    }

    const localPath = _path.default.resolve(out, 'strings.json');

    yield (0, _appiumSupport.mkdirp)(out);
    yield _appiumSupport.fs.writeFile(localPath, JSON.stringify(apkStrings, null, 2), 'utf-8');
    return {
      apkStrings,
      localPath
    };
  });

  return function (_x16, _x17, _x18) {
    return _ref16.apply(this, arguments);
  };
}();

apkUtilsMethods.getDeviceLanguage = (0, _asyncToGenerator2.default)(function* () {
  let language;

  if ((yield this.getApiLevel()) < 23) {
    language = yield this.getDeviceSysLanguage();

    if (!language) {
      language = yield this.getDeviceProductLanguage();
    }
  } else {
    language = (yield this.getDeviceLocale()).split("-")[0];
  }

  return language;
});

apkUtilsMethods.setDeviceLanguage = function () {
  var _ref20 = (0, _asyncToGenerator2.default)(function* (language) {
    yield this.setDeviceSysLanguage(language);
  });

  return function (_x19) {
    return _ref20.apply(this, arguments);
  };
}();

apkUtilsMethods.getDeviceCountry = (0, _asyncToGenerator2.default)(function* () {
  let country = yield this.getDeviceSysCountry();

  if (!country) {
    country = yield this.getDeviceProductCountry();
  }

  return country;
});

apkUtilsMethods.setDeviceCountry = function () {
  var _ref22 = (0, _asyncToGenerator2.default)(function* (country) {
    yield this.setDeviceSysCountry(country);
  });

  return function (_x20) {
    return _ref22.apply(this, arguments);
  };
}();

apkUtilsMethods.getDeviceLocale = (0, _asyncToGenerator2.default)(function* () {
  let locale = yield this.getDeviceSysLocale();

  if (!locale) {
    locale = yield this.getDeviceProductLocale();
  }

  return locale;
});

apkUtilsMethods.setDeviceLocale = function () {
  var _ref24 = (0, _asyncToGenerator2.default)(function* (locale) {
    const validateLocale = new RegExp(/[a-zA-Z]+-[a-zA-Z0-9]+/);

    if (!validateLocale.test(locale)) {
      _logger.default.warn(`setDeviceLocale requires the following format: en-US or ja-JP`);

      return;
    }

    let split_locale = locale.split("-");
    yield this.setDeviceLanguageCountry(split_locale[0], split_locale[1]);
  });

  return function (_x21) {
    return _ref24.apply(this, arguments);
  };
}();

apkUtilsMethods.ensureCurrentLocale = function () {
  var _ref25 = (0, _asyncToGenerator2.default)(function* (language, country) {
    var _this3 = this;

    const hasLanguage = _lodash.default.isString(language);

    const hasCountry = _lodash.default.isString(country);

    if (!hasLanguage && !hasCountry) {
      _logger.default.warn('ensureCurrentLocale requires language or country');

      return false;
    }

    language = (language || '').toLowerCase();
    country = (country || '').toLowerCase();
    const apiLevel = yield this.getApiLevel();
    return yield (0, _asyncbox.retryInterval)(5, 1000, (0, _asyncToGenerator2.default)(function* () {
      try {
        if (apiLevel < 23) {
          let curLanguage, curCountry;

          if (hasLanguage) {
            curLanguage = (yield _this3.getDeviceLanguage()).toLowerCase();

            if (!hasCountry && language === curLanguage) {
              return true;
            }
          }

          if (hasCountry) {
            curCountry = (yield _this3.getDeviceCountry()).toLowerCase();

            if (!hasLanguage && country === curCountry) {
              return true;
            }
          }

          if (language === curLanguage && country === curCountry) {
            return true;
          }
        } else {
          const curLocale = (yield _this3.getDeviceLocale()).toLowerCase();

          if (`${language}-${country}` === curLocale) {
            return true;
          }
        }

        return false;
      } catch (err) {
        _logger.default.error(`Unable to check device localization: ${err.message}`);

        _logger.default.debug('Restarting ADB and retrying...');

        yield _this3.restartAdb();
        throw err;
      }
    }));
  });

  return function (_x22, _x23) {
    return _ref25.apply(this, arguments);
  };
}();

apkUtilsMethods.setDeviceLanguageCountry = function () {
  var _ref27 = (0, _asyncToGenerator2.default)(function* (language, country) {
    let hasLanguage = language && _lodash.default.isString(language);

    let hasCountry = country && _lodash.default.isString(country);

    if (!hasLanguage && !hasCountry) {
      _logger.default.warn(`setDeviceLanguageCountry requires language or country.`);

      _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

      return;
    }

    let wasSettingChanged = false;
    let apiLevel = yield this.getApiLevel();
    language = (language || '').toLowerCase();
    country = (country || '').toUpperCase();

    if (apiLevel < 23) {
      let curLanguage = (yield this.getDeviceLanguage()).toLowerCase();
      let curCountry = (yield this.getDeviceCountry()).toUpperCase();

      if (hasLanguage && language !== curLanguage) {
        yield this.setDeviceLanguage(language);
        wasSettingChanged = true;
      }

      if (hasCountry && country !== curCountry) {
        yield this.setDeviceCountry(country);
        wasSettingChanged = true;
      }
    } else {
      let curLocale = yield this.getDeviceLocale();

      if (apiLevel === 23) {
        let locale;

        if (!hasCountry) {
          locale = language;
        } else if (!hasLanguage) {
          locale = country;
        } else {
          locale = `${language}-${country}`;
        }

        _logger.default.debug(`Current locale: '${curLocale}'; requested locale: '${locale}'`);

        if (locale.toLowerCase() !== curLocale.toLowerCase()) {
          yield this.setDeviceSysLocale(locale);
          wasSettingChanged = true;
        }
      } else {
        if (!hasCountry || !hasLanguage) {
          _logger.default.warn(`setDeviceLanguageCountry requires both language and country to be set for API 24+`);

          _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

          return;
        }

        _logger.default.debug(`Current locale: '${curLocale}'; requested locale: '${language}-${country}'`);

        if (`${language}-${country}`.toLowerCase() !== curLocale.toLowerCase()) {
          yield this.setDeviceSysLocaleViaSettingApp(language, country);
        }
      }
    }

    if (wasSettingChanged) {
      _logger.default.info("Rebooting the device in order to apply new locale via 'setting persist.sys.locale' command.");

      yield this.reboot();
    }
  });

  return function (_x24, _x25) {
    return _ref27.apply(this, arguments);
  };
}();

apkUtilsMethods.getPackageName = function () {
  var _ref28 = (0, _asyncToGenerator2.default)(function* (apk) {
    let args = ['dump', 'badging', apk];
    yield this.initAapt();

    let _ref29 = yield (0, _teen_process.exec)(this.binaries.aapt, args),
        stdout = _ref29.stdout;

    let apkPackage = new RegExp(/package: name='([^']+)'/g).exec(stdout);

    if (apkPackage && apkPackage.length >= 2) {
      apkPackage = apkPackage[1];
    } else {
      apkPackage = null;
    }

    return apkPackage;
  });

  return function (_x26) {
    return _ref28.apply(this, arguments);
  };
}();

apkUtilsMethods.getApkInfo = function () {
  var _ref30 = (0, _asyncToGenerator2.default)(function* (apkPath) {
    if (!(yield _appiumSupport.fs.exists(apkPath))) {
      throw new Error(`The file at path ${apkPath} does not exist or is not accessible`);
    }

    yield this.initAapt();

    try {
      const _ref31 = yield (0, _teen_process.exec)(this.binaries.aapt, ['d', 'badging', apkPath]),
            stdout = _ref31.stdout;

      const matches = new RegExp(/package: name='([^']+)' versionCode='(\d+)' versionName='([^']+)'/).exec(stdout);

      if (matches) {
        return {
          name: matches[1],
          versionCode: parseInt(matches[2], 10),
          versionName: matches[3]
        };
      }
    } catch (err) {
      _logger.default.warn(`Error "${err.message}" while getting badging info`);
    }

    return {};
  });

  return function (_x27) {
    return _ref30.apply(this, arguments);
  };
}();

apkUtilsMethods.getPackageInfo = function () {
  var _ref32 = (0, _asyncToGenerator2.default)(function* (pkg) {
    _logger.default.debug(`Getting package info for '${pkg}'`);

    let result = {
      name: pkg
    };

    try {
      const stdout = yield this.shell(['dumpsys', 'package', pkg]);
      const versionNameMatch = new RegExp(/versionName=([\d+.]+)/).exec(stdout);

      if (versionNameMatch) {
        result.versionName = versionNameMatch[1];
      }

      const versionCodeMatch = new RegExp(/versionCode=(\d+)/).exec(stdout);

      if (versionCodeMatch) {
        result.versionCode = parseInt(versionCodeMatch[1], 10);
      }

      return result;
    } catch (err) {
      _logger.default.warn(`Error '${err.message}' while dumping package info`);
    }

    return result;
  });

  return function (_x28) {
    return _ref32.apply(this, arguments);
  };
}();

apkUtilsMethods.pullApk = function () {
  var _pullApk = (0, _asyncToGenerator2.default)(function* (pkg, tmpDir) {
    const pkgPath = (yield this.adbExec(['shell', 'pm', 'path', pkg])).replace('package:', '');

    const tmpApp = _path.default.resolve(tmpDir, `${pkg}.apk`);

    yield this.pull(pkgPath, tmpApp);

    _logger.default.debug(`Pulled app for package '${pkg}' to '${tmpApp}'`);

    return tmpApp;
  });

  return function pullApk(_x29, _x30) {
    return _pullApk.apply(this, arguments);
  };
}();

var _default = apkUtilsMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hcGstdXRpbHMuanMiXSwibmFtZXMiOlsiYXBrVXRpbHNNZXRob2RzIiwiQUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOSyIsImlzQXBwSW5zdGFsbGVkIiwicGtnIiwibG9nIiwiZGVidWciLCJpbnN0YWxsZWRQYXR0ZXJuIiwiUmVnRXhwIiwiXyIsImVzY2FwZVJlZ0V4cCIsInN0ZG91dCIsInNoZWxsIiwiaXNJbnN0YWxsZWQiLCJ0ZXN0IiwiZSIsIkVycm9yIiwibWVzc2FnZSIsInN0YXJ0VXJpIiwidXJpIiwiYXJncyIsInJlcGxhY2UiLCJyZXMiLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwic3RhcnRBcHAiLCJzdGFydEFwcE9wdGlvbnMiLCJhY3Rpdml0eSIsImNsb25lIiwiZGVmYXVsdHMiLCJ3YWl0UGtnIiwid2FpdEFjdGl2aXR5IiwicmV0cnkiLCJzdG9wQXBwIiwiYXBpTGV2ZWwiLCJnZXRBcGlMZXZlbCIsImNtZCIsInNoZWxsT3B0cyIsImlzSW50ZWdlciIsIndhaXREdXJhdGlvbiIsInRpbWVvdXQiLCJzdGFydHNXaXRoIiwid2FpdEZvckFjdGl2aXR5IiwiZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSIsIm51bGxGb2N1c2VkQXBwUmUiLCJmb2N1c2VkQXBwUmUiLCJudWxsQ3VycmVudEZvY3VzUmUiLCJjdXJyZW50Rm9jdXNBcHBSZSIsInBhdHRlcm4iLCJtYXRjaCIsImV4ZWMiLCJhcHBQYWNrYWdlIiwidHJpbSIsImFwcEFjdGl2aXR5Iiwid2FpdEZvckFjdGl2aXR5T3JOb3QiLCJ3YWl0Rm9yU3RvcCIsIndhaXRNcyIsInNwbGl0TmFtZXMiLCJuYW1lcyIsInNwbGl0IiwibWFwIiwibmFtZSIsImFsbFBhY2thZ2VzIiwiYWxsQWN0aXZpdGllcyIsInBvc3NpYmxlQWN0aXZpdHlOYW1lcyIsIm9uZUFjdGl2aXR5IiwiY3VycmVudFBrZyIsInB1c2giLCJqb2luIiwicG9zc2libGVBY3Rpdml0eVBhdHRlcm5zIiwicG9zc2libGVBY3Rpdml0eU5hbWUiLCJyZXRyaWVzIiwicGFyc2VJbnQiLCJpc05hTiIsImZ1bGx5UXVhbGlmaWVkQWN0aXZpdHkiLCJmb3VuZEFjdCIsImZpbmRJbmRleCIsInBvc3NpYmxlUGF0dGVybiIsImFjdCIsIndhaXRGb3JOb3RBY3Rpdml0eSIsIkFQS19VTklOU1RBTExfVElNRU9VVCIsInVuaW5zdGFsbEFwayIsIm9wdGlvbnMiLCJpbmZvIiwidXRpbCIsImhhc1ZhbHVlIiwia2VlcERhdGEiLCJmb3JjZVN0b3AiLCJhZGJFeGVjIiwiaW5zdGFsbEZyb21EZXZpY2VQYXRoIiwiYXBrUGF0aE9uRGV2aWNlIiwib3B0cyIsImluZGV4T2YiLCJBUEtfSU5TVEFMTF9USU1FT1VUIiwiaW5zdGFsbCIsImFwayIsImFkZGl0aW9uYWxBcmdzIiwiYWxsb3dUZXN0UGFja2FnZXMiLCJ1c2VTZGNhcmQiLCJncmFudFBlcm1pc3Npb25zIiwiZXhlY3V0ZUluc3RhbGwiLCJvdXRwdXQiLCJ0cnVuY2F0ZWRPdXRwdXQiLCJpc1N0cmluZyIsImxlbmd0aCIsInN1YnN0ciIsImVyciIsImluc3RhbGxPclVwZ3JhZGUiLCJhcGtJbmZvIiwiZ2V0QXBrSW5mbyIsIndhcm4iLCJPYmplY3QiLCJhc3NpZ24iLCJnZXRQYWNrYWdlSW5mbyIsInBrZ1ZlcnNpb25Db2RlIiwidmVyc2lvbkNvZGUiLCJwa2dWZXJzaW9uTmFtZVN0ciIsInZlcnNpb25OYW1lIiwicGtnVmVyc2lvbk5hbWUiLCJzZW12ZXIiLCJ2YWxpZCIsImNvZXJjZSIsImFwa1ZlcnNpb25Db2RlIiwiYXBrVmVyc2lvbk5hbWVTdHIiLCJhcGtWZXJzaW9uTmFtZSIsInNhdGlzZmllcyIsImV4dHJhY3RTdHJpbmdzRnJvbUFwayIsImxhbmd1YWdlIiwib3V0IiwiaW5pdEFhcHQiLCJyYXdBYXB0T3V0cHV0IiwiYmluYXJpZXMiLCJhYXB0IiwiZGVmYXVsdENvbmZpZ01hcmtlciIsImNvbmZpZ01hcmtlciIsImNvbmZpZ3MiLCJvcyIsIkVPTCIsImFwa1N0cmluZ3MiLCJpc0luQ29uZmlnIiwiY3VycmVudFJlc291cmNlSWQiLCJpc0luUGx1cmFsR3JvdXAiLCJzdGFydHNXaXRoQW55IiwicyIsImFyciIsInJlZHVjZSIsImFjYyIsIngiLCJub3JtYWxpemVTdHJpbmdNYXRjaCIsImxpbmUiLCJ0cmltbWVkTGluZSIsImlzRW1wdHkiLCJrZXlzIiwibG9jYWxQYXRoIiwicGF0aCIsInJlc29sdmUiLCJmcyIsIndyaXRlRmlsZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXREZXZpY2VMYW5ndWFnZSIsImdldERldmljZVN5c0xhbmd1YWdlIiwiZ2V0RGV2aWNlUHJvZHVjdExhbmd1YWdlIiwiZ2V0RGV2aWNlTG9jYWxlIiwic2V0RGV2aWNlTGFuZ3VhZ2UiLCJzZXREZXZpY2VTeXNMYW5ndWFnZSIsImdldERldmljZUNvdW50cnkiLCJjb3VudHJ5IiwiZ2V0RGV2aWNlU3lzQ291bnRyeSIsImdldERldmljZVByb2R1Y3RDb3VudHJ5Iiwic2V0RGV2aWNlQ291bnRyeSIsInNldERldmljZVN5c0NvdW50cnkiLCJsb2NhbGUiLCJnZXREZXZpY2VTeXNMb2NhbGUiLCJnZXREZXZpY2VQcm9kdWN0TG9jYWxlIiwic2V0RGV2aWNlTG9jYWxlIiwidmFsaWRhdGVMb2NhbGUiLCJzcGxpdF9sb2NhbGUiLCJzZXREZXZpY2VMYW5ndWFnZUNvdW50cnkiLCJlbnN1cmVDdXJyZW50TG9jYWxlIiwiaGFzTGFuZ3VhZ2UiLCJoYXNDb3VudHJ5IiwiY3VyTGFuZ3VhZ2UiLCJjdXJDb3VudHJ5IiwiY3VyTG9jYWxlIiwiZXJyb3IiLCJyZXN0YXJ0QWRiIiwid2FzU2V0dGluZ0NoYW5nZWQiLCJ0b1VwcGVyQ2FzZSIsInNldERldmljZVN5c0xvY2FsZSIsInNldERldmljZVN5c0xvY2FsZVZpYVNldHRpbmdBcHAiLCJyZWJvb3QiLCJnZXRQYWNrYWdlTmFtZSIsImFwa1BhY2thZ2UiLCJhcGtQYXRoIiwiZXhpc3RzIiwibWF0Y2hlcyIsInJlc3VsdCIsInZlcnNpb25OYW1lTWF0Y2giLCJ2ZXJzaW9uQ29kZU1hdGNoIiwicHVsbEFwayIsInRtcERpciIsInBrZ1BhdGgiLCJ0bXBBcHAiLCJwdWxsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQUlBLGVBQWUsR0FBRyxFQUF0QjtBQUVBLE1BQU1DLCtCQUErQixHQUNuQyx5R0FERjs7QUFVQUQsZUFBZSxDQUFDRSxjQUFoQjtBQUFBLDZDQUFpQyxXQUFnQkMsR0FBaEIsRUFBcUI7QUFDcERDLG9CQUFJQyxLQUFKLENBQVcsOEJBQTZCRixHQUFJLEVBQTVDOztBQUNBLFVBQU1HLGdCQUFnQixHQUFHLElBQUlDLE1BQUosQ0FBWSxzQkFBcUJDLGdCQUFFQyxZQUFGLENBQWVOLEdBQWYsQ0FBb0IsWUFBckQsRUFBa0UsR0FBbEUsQ0FBekI7O0FBQ0EsUUFBSTtBQUNGLFlBQU1PLE1BQU0sU0FBUyxLQUFLQyxLQUFMLENBQVcsQ0FBQyxTQUFELEVBQVksU0FBWixFQUF1QlIsR0FBdkIsQ0FBWCxDQUFyQjtBQUNBLFlBQU1TLFdBQVcsR0FBR04sZ0JBQWdCLENBQUNPLElBQWpCLENBQXNCSCxNQUF0QixDQUFwQjs7QUFDQU4sc0JBQUlDLEtBQUosQ0FBVyxJQUFHRixHQUFJLE9BQU0sQ0FBQ1MsV0FBRCxHQUFlLE1BQWYsR0FBd0IsRUFBRyxZQUFuRDs7QUFDQSxhQUFPQSxXQUFQO0FBQ0QsS0FMRCxDQUtFLE9BQU9FLENBQVAsRUFBVTtBQUNWLFlBQU0sSUFBSUMsS0FBSixDQUFXLHFCQUFvQlosR0FBSSxtQ0FBa0NXLENBQUMsQ0FBQ0UsT0FBUSxFQUEvRSxDQUFOO0FBQ0Q7QUFDRixHQVhEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQW1CQWhCLGVBQWUsQ0FBQ2lCLFFBQWhCO0FBQUEsOENBQTJCLFdBQWdCQyxHQUFoQixFQUFxQmYsR0FBckIsRUFBMEI7QUFDbkQsUUFBSSxDQUFDZSxHQUFELElBQVEs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QVAsRUFBWTtBQUNackcsc0JBQUl5RyxJQUFKLENBQVUsVUFBU0osR0FBRyxDQUFDekYsT0FBUSw4QkFBL0I7QUFDRDs7QUFDRCxXQUFPb0wsTUFBUDtBQUNELEdBbEJEOztBQUFBO0FBQUE7QUFBQTtBQUFBOztBQW9CQXBNLGVBQWUsQ0FBQ3VNLE9BQWhCO0FBQUEsaURBQTBCLFdBQXdCcE0sR0FBeEIsRUFBNkJxTSxNQUE3QixFQUFxQztBQUM3RCxVQUFNQyxPQUFPLEdBQUcsT0FBTyxLQUFLbEgsT0FBTCxDQUFhLENBQUMsT0FBRCxFQUFVLElBQVYsRUFBZ0IsTUFBaEIsRUFBd0JwRixHQUF4QixDQUFiLENBQVAsRUFBbURpQixPQUFuRCxDQUEyRCxVQUEzRCxFQUF1RSxFQUF2RSxDQUFoQjs7QUFDQSxVQUFNc0wsTUFBTSxHQUFHakQsY0FBS0MsT0FBTCxDQUFhOEMsTUFBYixFQUFzQixHQUFFck0sR0FBSSxNQUE1QixDQUFmOztBQUNBLFVBQU0sS0FBS3dNLElBQUwsQ0FBVUYsT0FBVixFQUFtQkMsTUFBbkIsQ0FBTjs7QUFDQXRNLG9CQUFJQyxLQUFKLENBQVcsMkJBQTBCRixHQUFJLFNBQVF1TSxNQUFPLEdBQXhEOztBQUNBLFdBQU9BLE1BQVA7QUFDRCxHQU5EOztBQUFBLGtCQUF5Q0gsT0FBekM7QUFBQTtBQUFBO0FBQUE7O2VBUWV2TSxlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYnVpbGRTdGFydENtZCB9IGZyb20gJy4uL2hlbHBlcnMuanMnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlci5qcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHsgZnMsIHV0aWwsIG1rZGlycCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBzZW12ZXIgZnJvbSAnc2VtdmVyJztcbmltcG9ydCBvcyBmcm9tICdvcyc7XG5cbmxldCBhcGtVdGlsc01ldGhvZHMgPSB7fTtcblxuY29uc3QgQUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOSyA9XG4gICdodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9ibG9iL21hc3Rlci9kb2NzL2VuL3dyaXRpbmctcnVubmluZy1hcHBpdW0vYW5kcm9pZC9hY3Rpdml0eS1zdGFydHVwLm1kJztcblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHRoZSBwYXJ0aWN1bGFyIHBhY2thZ2UgaXMgcHJlc2VudCBvbiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIGNoZWNrLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgcGFja2FnZSBpcyBpbnN0YWxsZWQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGRldGVjdGluZyBhcHBsaWNhdGlvbiBzdGF0ZVxuICovXG5hcGtVdGlsc01ldGhvZHMuaXNBcHBJbnN0YWxsZWQgPSBhc3luYyBmdW5jdGlvbiAocGtnKSB7XG4gIGxvZy5kZWJ1ZyhgR2V0dGluZyBpbnN0YWxsIHN0YXR1cyBmb3IgJHtwa2d9YCk7XG4gIGNvbnN0IGluc3RhbGxlZFBhdHRlcm4gPSBuZXcgUmVnRXhwKGBeXFxcXHMqUGFja2FnZVxcXFxzK1xcXFxbJHtfLmVzY2FwZVJlZ0V4cChwa2cpfVxcXFxdW146XSs6JGAsICdtJyk7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3Rkb3V0ID0gYXdhaXQgdGhpcy5zaGVsbChbJ2R1bXBzeXMnLCAncGFja2FnZScsIHBrZ10pO1xuICAgIGNvbnN0IGlzSW5zdGFsbGVkID0gaW5zdGFsbGVkUGF0dGVybi50ZXN0KHN0ZG91dCk7XG4gICAgbG9nLmRlYnVnKGAnJHtwa2d9JyBpcyR7IWlzSW5zdGFsbGVkID8gJyBub3QnIDogJyd9IGluc3RhbGxlZGApO1xuICAgIHJldHVybiBpc0luc3RhbGxlZDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgZmluZGluZyBpZiAnJHtwa2d9JyBpcyBpbnN0YWxsZWQuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBTdGFydCB0aGUgcGFydGljdWxhciBVUkkgb24gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgLSBUaGUgbmFtZSBvZiBVUkkgdG8gc3RhcnQuXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gc3RhcnQgdGhlIFVSSSB3aXRoLlxuICovXG5hcGtVdGlsc01ldGhvZHMuc3RhcnRVcmkgPSBhc3luYyBmdW5jdGlvbiAodXJpLCBwa2cpIHtcbiAgaWYgKCF1cmkgfHwgIXBrZykge1xuICAgIHRocm93IG5ldyBFcnJvcihcIlVSSSBhbmQgcGFja2FnZSBhcmd1bWVudHMgYXJlIHJlcXVpcmVkXCIpO1xuICB9XG5cbiAgY29uc3QgYXJncyA9IFtcbiAgICBcImFtXCIsIFwic3RhcnRcIixcbiAgICBcIi1XXCIsXG4gICAgXCItYVwiLCBcImFuZHJvaWQuaW50ZW50LmFjdGlvbi5WSUVXXCIsXG4gICAgXCItZFwiLCB1cmkucmVwbGFjZSgvJi9nLCAnXFxcXCYnKSxcbiAgICBwa2csXG4gIF07XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5zaGVsbChhcmdzKTtcbiAgICBpZiAocmVzLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3VuYWJsZSB0byByZXNvbHZlIGludGVudCcpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGF0dGVtcHRpbmcgdG8gc3RhcnQgVVJJLiBPcmlnaW5hbCBlcnJvcjogJHtlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFN0YXJ0QXBwT3B0aW9uc1xuICogQHByb3BlcnR5IHshc3RyaW5nfSBhY3Rpdml0eSAtIFRoZSBuYW1lIG9mIHRoZSBtYWluIGFwcGxpY2F0aW9uIGFjdGl2aXR5XG4gKiBAcHJvcGVydHkgeyFzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBhcHBsaWNhdGlvbiBwYWNrYWdlXG4gKiBAcHJvcGVydHkgez9ib29sZWFufSByZXRyeSBbdHJ1ZV0gLSBJZiB0aGlzIHByb3BlcnR5IGlzIHNldCB0byBgdHJ1ZWBcbiAqIGFuZCB0aGUgYWN0aXZpdHkgbmFtZSBkb2VzIG5vdCBzdGFydCB3aXRoICcuJyB0aGVuIHRoZSBtZXRob2RcbiAqIHdpbGwgdHJ5IHRvIGFkZCB0aGUgbWlzc2luZyBkb3QgYW5kIHN0YXJ0IHRoZSBhY3Rpdml0eSBvbmNlIG1vcmVcbiAqIGlmIHRoZSBmaXJzdCBzdGFydHVwIHRyeSBmYWlscy5cbiAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IHN0b3BBcHAgW3RydWVdIC0gU2V0IGl0IHRvIGB0cnVlYCBpbiBvcmRlciB0byBmb3JjZWZ1bGx5XG4gKiBzdG9wIHRoZSBhY3Rpdml0eSBpZiBpdCBpcyBhbHJlYWR5IHJ1bm5pbmcuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHdhaXRQa2cgLSBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byB3YWl0IHRvIG9uXG4gKiBzdGFydHVwICh0aGlzIG9ubHkgbWFrZXMgc2Vuc2UgaWYgdGhpcyBuYW1lIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBvbmUsIHdoaWNoIGlzIHNldCBhcyBgcGtnYClcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gd2FpdEFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIGFjdGl2aXR5IHRvIHdhaXQgdG8gb25cbiAqIHN0YXJ0dXAgKHRoaXMgb25seSBtYWtlcyBzZW5zZSBpZiB0aGlzIG5hbWUgaXMgZGlmZmVyZW50IGZyb20gdGhlIG9uZSwgd2hpY2ggaXMgc2V0IGFzIGBhY3Rpdml0eWApXG4gKiBAcHJvcGVydHkgez9udW1iZXJ9IHdhaXREdXJhdGlvbiAtIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgdGhlXG4gKiBgd2FpdEFjdGl2aXR5YCBpcyBmb2N1c2VkXG4gKiBAcHJvcGVydHkgez9zdHJpbmd8bnVtYmVyfSB1c2VyIC0gVGhlIG51bWJlciBvZiB0aGUgdXNlciBwcm9maWxlIHRvIHN0YXJ0XG4gKiB0aGUgZ2l2ZW4gYWN0aXZpdHkgd2l0aC4gVGhlIGRlZmF1bHQgT1MgdXNlciBwcm9maWxlICh1c3VhbGx5IHplcm8pIGlzIHVzZWRcbiAqIHdoZW4gdGhpcyBwcm9wZXJ0eSBpcyB1bnNldFxuICovXG5cbi8qKlxuICogU3RhcnQgdGhlIHBhcnRpY3VsYXIgcGFja2FnZS9hY3Rpdml0eSBvbiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtTdGFydEFwcE9wdGlvbnN9IHN0YXJ0QXBwT3B0aW9ucyBbe31dIC0gU3RhcnR1cCBvcHRpb25zIG1hcHBpbmcuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBvdXRwdXQgb2YgdGhlIGNvcnJlc3BvbmRpbmcgYWRiIGNvbW1hbmQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgaXMgYW4gZXJyb3Igd2hpbGUgZXhlY3V0aW5nIHRoZSBhY3Rpdml0eVxuICovXG5hcGtVdGlsc01ldGhvZHMuc3RhcnRBcHAgPSBhc3luYyBmdW5jdGlvbiAoc3RhcnRBcHBPcHRpb25zID0ge30pIHtcbiAgaWYgKCFzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHkgfHwgIXN0YXJ0QXBwT3B0aW9ucy5wa2cpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJhY3Rpdml0eSBhbmQgcGtnIGFyZSByZXF1aXJlZCB0byBzdGFydCBhbiBhcHBsaWNhdGlvblwiKTtcbiAgfVxuXG4gIHN0YXJ0QXBwT3B0aW9ucyA9IF8uY2xvbmUoc3RhcnRBcHBPcHRpb25zKTtcbiAgc3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5ID0gc3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5LnJlcGxhY2UoJyQnLCAnXFxcXCQnKTtcbiAgLy8gaW5pdGlhbGl6aW5nIGRlZmF1bHRzXG4gIF8uZGVmYXVsdHMoc3RhcnRBcHBPcHRpb25zLCB7XG4gICAgd2FpdFBrZzogc3RhcnRBcHBPcHRpb25zLnBrZyxcbiAgICB3YWl0QWN0aXZpdHk6IGZhbHNlLFxuICAgIHJldHJ5OiB0cnVlLFxuICAgIHN0b3BBcHA6IHRydWVcbiAgfSk7XG4gIC8vIHByZXZlbnRpbmcgbnVsbCB3YWl0cGtnXG4gIHN0YXJ0QXBwT3B0aW9ucy53YWl0UGtnID0gc3RhcnRBcHBPcHRpb25zLndhaXRQa2cgfHwgc3RhcnRBcHBPcHRpb25zLnBrZztcblxuICBjb25zdCBhcGlMZXZlbCA9IGF3YWl0IHRoaXMuZ2V0QXBpTGV2ZWwoKTtcbiAgY29uc3QgY21kID0gYnVpbGRTdGFydENtZChzdGFydEFwcE9wdGlvbnMsIGFwaUxldmVsKTtcbiAgdHJ5IHtcbiAgICBjb25zdCBzaGVsbE9wdHMgPSB7fTtcbiAgICBpZiAoXy5pc0ludGVnZXIoc3RhcnRBcHBPcHRpb25zLndhaXREdXJhdGlvbikgJiYgc3RhcnRBcHBPcHRpb25zLndhaXREdXJhdGlvbiA+IDIwMDAwKSB7XG4gICAgICBzaGVsbE9wdHMudGltZW91dCA9IHN0YXJ0QXBwT3B0aW9ucy53YWl0RHVyYXRpb247XG4gICAgfVxuICAgIGNvbnN0IHN0ZG91dCA9IGF3YWl0IHRoaXMuc2hlbGwoY21kLCBzaGVsbE9wdHMpO1xuICAgIGlmIChzdGRvdXQuaW5jbHVkZXMoXCJFcnJvcjogQWN0aXZpdHkgY2xhc3NcIikgJiYgc3Rkb3V0LmluY2x1ZGVzKFwiZG9lcyBub3QgZXhpc3RcIikpIHtcbiAgICAgIGlmIChzdGFydEFwcE9wdGlvbnMucmV0cnkgJiYgIXN0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eS5zdGFydHNXaXRoKFwiLlwiKSkge1xuICAgICAgICBsb2cuZGVidWcoYFdlIHRyaWVkIHRvIHN0YXJ0IGFuIGFjdGl2aXR5IHRoYXQgZG9lc24ndCBleGlzdCwgYCArXG4gICAgICAgICAgICAgICAgICBgcmV0cnlpbmcgd2l0aCAnLiR7c3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5fScgYWN0aXZpdHkgbmFtZWApO1xuICAgICAgICBzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHkgPSBgLiR7c3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5fWA7XG4gICAgICAgIHN0YXJ0QXBwT3B0aW9ucy5yZXRyeSA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5zdGFydEFwcChzdGFydEFwcE9wdGlvbnMpO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBY3Rpdml0eSBuYW1lICcke3N0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eX0nIHVzZWQgdG8gc3RhcnQgdGhlIGFwcCBkb2Vzbid0IGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBleGlzdCBvciBjYW5ub3QgYmUgbGF1bmNoZWQhIE1ha2Ugc3VyZSBpdCBleGlzdHMgYW5kIGlzIGEgbGF1bmNoYWJsZSBhY3Rpdml0eWApO1xuICAgIH0gZWxzZSBpZiAoc3Rkb3V0LmluY2x1ZGVzKFwiamF2YS5sYW5nLlNlY3VyaXR5RXhjZXB0aW9uXCIpKSB7XG4gICAgICAvLyBpZiB0aGUgYXBwIGlzIGRpc2FibGVkIG9uIGEgcmVhbCBkZXZpY2UgaXQgd2lsbCB0aHJvdyBhIHNlY3VyaXR5IGV4Y2VwdGlvblxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcGVybWlzc2lvbiB0byBzdGFydCAnJHtzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHl9JyBhY3Rpdml0eSBoYXMgYmVlbiBkZW5pZWQuYCArXG4gICAgICAgICAgICAgICAgICAgICAgYE1ha2Ugc3VyZSB0aGUgYWN0aXZpdHkvcGFja2FnZSBuYW1lcyBhcmUgY29ycmVjdC5gKTtcbiAgICB9XG4gICAgaWYgKHN0YXJ0QXBwT3B0aW9ucy53YWl0QWN0aXZpdHkpIHtcbiAgICAgIGF3YWl0IHRoaXMud2FpdEZvckFjdGl2aXR5KHN0YXJ0QXBwT3B0aW9ucy53YWl0UGtnLCBzdGFydEFwcE9wdGlvbnMud2FpdEFjdGl2aXR5LCBzdGFydEFwcE9wdGlvbnMud2FpdER1cmF0aW9uKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0ZG91dDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHN0YXJ0IHRoZSAnJHtzdGFydEFwcE9wdGlvbnMucGtnfScgYXBwbGljYXRpb24uIGAgK1xuICAgICAgYFZpc2l0ICR7QUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOS30gZm9yIHRyb3VibGVzaG9vdGluZy4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFBhY2thZ2VBY3Rpdml0eUluZm9cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gYXBwUGFja2FnZSAtIFRoZSBuYW1lIG9mIGFwcGxpY2F0aW9uIHBhY2thZ2UsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgZXhhbXBsZSAnY29tLmFjbWUuYXBwJy5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gYXBwQWN0aXZpdHkgLSBUaGUgbmFtZSBvZiBtYWluIGFwcGxpY2F0aW9uIGFjdGl2aXR5LlxuICovXG5cbi8qKlxuICogR2V0IHRoZSBuYW1lIG9mIGN1cnJlbnRseSBmb2N1c2VkIHBhY2thZ2UgYW5kIGFjdGl2aXR5LlxuICpcbiAqIEByZXR1cm4ge1BhY2thZ2VBY3Rpdml0eUluZm99IFRoZSBtYXBwaW5nLCB3aGVyZSBwcm9wZXJ0eSBuYW1lcyBhcmUgJ2FwcFBhY2thZ2UnIGFuZCAnYXBwQWN0aXZpdHknLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIGlzIGFuIGVycm9yIHdoaWxlIHBhcnNpbmcgdGhlIGRhdGEuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBsb2cuZGVidWcoXCJHZXR0aW5nIGZvY3VzZWQgcGFja2FnZSBhbmQgYWN0aXZpdHlcIik7XG4gIGNvbnN0IGNtZCA9IFsnZHVtcHN5cycsICd3aW5kb3cnLCAnd2luZG93cyddO1xuICBjb25zdCBudWxsRm9jdXNlZEFwcFJlID0gbmV3IFJlZ0V4cCgvXlxccyptRm9jdXNlZEFwcD1udWxsLywgJ20nKTtcbiAgLy8gaHR0cHM6Ly9yZWdleDEwMS5jb20vci94Wjh2RjcvMVxuICBjb25zdCBmb2N1c2VkQXBwUmUgPSBuZXcgUmVnRXhwKCdeXFxcXHMqbUZvY3VzZWRBcHAuK1JlY29yZFxcXFx7LipcXFxccyhbXlxcXFxzXFxcXC9cXFxcfV0rKScgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcXFxcLyhbXlxcXFxzXFxcXC9cXFxcfVxcXFwsXSspXFxcXCw/KFxcXFxzW15cXFxcc1xcXFwvXFxcXH1dKykqXFxcXH0nLCAnbScpO1xuICBjb25zdCBudWxsQ3VycmVudEZvY3VzUmUgPSBuZXcgUmVnRXhwKC9eXFxzKm1DdXJyZW50Rm9jdXM9bnVsbC8sICdtJyk7XG4gIGNvbnN0IGN1cnJlbnRGb2N1c0FwcFJlID0gbmV3IFJlZ0V4cCgnXlxcXFxzKm1DdXJyZW50Rm9jdXMuK1xcXFx7LitcXFxccyhbXlxcXFxzXFxcXC9dKylcXFxcLyhbXlxcXFxzXSspXFxcXGInLCAnbScpO1xuXG4gIHRyeSB7XG4gICAgY29uc3Qgc3Rkb3V0ID0gYXdhaXQgdGhpcy5zaGVsbChjbWQpO1xuICAgIC8vIFRoZSBvcmRlciBtYXR0ZXJzIGhlcmVcbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgW2ZvY3VzZWRBcHBSZSwgY3VycmVudEZvY3VzQXBwUmVdKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IHBhdHRlcm4uZXhlYyhzdGRvdXQpO1xuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYXBwUGFja2FnZTogbWF0Y2hbMV0udHJpbSgpLFxuICAgICAgICAgIGFwcEFjdGl2aXR5OiBtYXRjaFsyXS50cmltKClcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgW251bGxGb2N1c2VkQXBwUmUsIG51bGxDdXJyZW50Rm9jdXNSZV0pIHtcbiAgICAgIGlmIChwYXR0ZXJuLmV4ZWMoc3Rkb3V0KSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFwcFBhY2thZ2U6IG51bGwsXG4gICAgICAgICAgYXBwQWN0aXZpdHk6IG51bGxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgcGFyc2UgYWN0aXZpdHkgZnJvbSBkdW1wc3lzXCIpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZ2V0IGZvY3VzUGFja2FnZUFuZEFjdGl2aXR5LiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogV2FpdCBmb3IgdGhlIGdpdmVuIGFjdGl2aXR5IHRvIGJlIGZvY3VzZWQvbm9uLWZvY3VzZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIHdhaXQgZm9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIGFjdGl2aXR5LCBiZWxvbmdpbmcgdG8gdGhhdCBwYWNrYWdlLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHdhaXRGb3JTdG9wIC0gV2hldGhlciB0byB3YWl0IHVudGlsIHRoZSBhY3Rpdml0eSBpcyBmb2N1c2VkICh0cnVlKVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGlzIG5vdCBmb2N1c2VkIChmYWxzZSkuXG4gKiBAcGFyYW0ge251bWJlcn0gd2FpdE1zIFsyMDAwMF0gLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHRpbWVvdXQgb2NjdXJzLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRpbWVvdXQgaGFwcGVucy5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLndhaXRGb3JBY3Rpdml0eU9yTm90ID0gYXN5bmMgZnVuY3Rpb24gKHBrZywgYWN0aXZpdHksIHdhaXRGb3JTdG9wLCB3YWl0TXMgPSAyMDAwMCkge1xuICBpZiAoIXBrZyB8fCAhYWN0aXZpdHkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhY2thZ2UgYW5kIGFjdGl2aXR5IHJlcXVpcmVkLicpO1xuICB9XG4gIGxvZy5kZWJ1ZyhgV2FpdGluZyB1cCB0byAke3dhaXRNc31tcyBmb3IgYWN0aXZpdHkgbWF0Y2hpbmcgcGtnOiAnJHtwa2d9JyBhbmQgYCArXG4gICAgICAgICAgICBgYWN0aXZpdHk6ICcke2FjdGl2aXR5fScgdG8ke3dhaXRGb3JTdG9wID8gJyBub3QnIDogJyd9IGJlIGZvY3VzZWRgKTtcblxuICBjb25zdCBzcGxpdE5hbWVzID0gKG5hbWVzKSA9PiBuYW1lcy5zcGxpdCgnLCcpLm1hcCgobmFtZSkgPT4gbmFtZS50cmltKCkpO1xuXG4gIGNvbnN0IGFsbFBhY2thZ2VzID0gc3BsaXROYW1lcyhwa2cpO1xuICBjb25zdCBhbGxBY3Rpdml0aWVzID0gc3BsaXROYW1lcyhhY3Rpdml0eSk7XG5cbiAgbGV0IHBvc3NpYmxlQWN0aXZpdHlOYW1lcyA9IFtdO1xuICBmb3IgKGxldCBvbmVBY3Rpdml0eSBvZiBhbGxBY3Rpdml0aWVzKSB7XG4gICAgaWYgKG9uZUFjdGl2aXR5LnN0YXJ0c1dpdGgoJy4nKSkge1xuICAgICAgLy8gYWRkIHRoZSBwYWNrYWdlIG5hbWUgaWYgYWN0aXZpdHkgaXMgbm90IGZ1bGwgcXVhbGlmaWVkXG4gICAgICBmb3IgKGxldCBjdXJyZW50UGtnIG9mIGFsbFBhY2thZ2VzKSB7XG4gICAgICAgIHBvc3NpYmxlQWN0aXZpdHlOYW1lcy5wdXNoKGAke2N1cnJlbnRQa2d9JHtvbmVBY3Rpdml0eX1gLnJlcGxhY2UoL1xcLisvZywgJy4nKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGFjY2VwdCBmdWxseSBxdWFsaWZpZWQgYWN0aXZpdHkgbmFtZS5cbiAgICAgIHBvc3NpYmxlQWN0aXZpdHlOYW1lcy5wdXNoKG9uZUFjdGl2aXR5KTtcbiAgICAgIHBvc3NpYmxlQWN0aXZpdHlOYW1lcy5wdXNoKGAke3BrZ30uJHtvbmVBY3Rpdml0eX1gKTtcbiAgICB9XG4gIH1cbiAgbG9nLmRlYnVnKGBQb3NzaWJsZSBhY3Rpdml0aWVzLCB0byBiZSBjaGVja2VkOiAke3Bvc3NpYmxlQWN0aXZpdHlOYW1lcy5tYXAoKG5hbWUpID0+IGAnJHtuYW1lfSdgKS5qb2luKCcsICcpfWApO1xuXG4gIGxldCBwb3NzaWJsZUFjdGl2aXR5UGF0dGVybnMgPSBwb3NzaWJsZUFjdGl2aXR5TmFtZXMubWFwKChwb3NzaWJsZUFjdGl2aXR5TmFtZSkgPT5cbiAgICBuZXcgUmVnRXhwKGBeJHtwb3NzaWJsZUFjdGl2aXR5TmFtZS5yZXBsYWNlKC9cXC4vZywgJ1xcXFwuJykucmVwbGFjZSgvXFwqL2csICcuKj8nKS5yZXBsYWNlKC9cXCQvZywgJ1xcXFwkJyl9JGApXG4gICk7XG5cbiAgLy8gZmlndXJlIG91dCB0aGUgbnVtYmVyIG9mIHJldHJpZXMuIFRyeSBvbmNlIGlmIHdhaXRNcyBpcyBsZXNzIHRoYXQgNzUwXG4gIC8vIDMwIHRpbWVzIGlmIHBhcnNpbmcgaXMgbm90IHBvc3NpYmxlXG4gIGxldCByZXRyaWVzID0gcGFyc2VJbnQod2FpdE1zIC8gNzUwLCAxMCkgfHwgMTtcbiAgcmV0cmllcyA9IGlzTmFOKHJldHJpZXMpID8gMzAgOiByZXRyaWVzO1xuICBhd2FpdCByZXRyeUludGVydmFsKHJldHJpZXMsIDc1MCwgYXN5bmMgKCkgPT4ge1xuICAgIGxldCB7YXBwUGFja2FnZSwgYXBwQWN0aXZpdHl9ID0gYXdhaXQgdGhpcy5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCk7XG4gICAgaWYgKGFwcEFjdGl2aXR5ICYmIGFwcFBhY2thZ2UpIHtcbiAgICAgIGxldCBmdWxseVF1YWxpZmllZEFjdGl2aXR5ID0gYXBwQWN0aXZpdHkuc3RhcnRzV2l0aCgnLicpID8gYCR7YXBwUGFja2FnZX0ke2FwcEFjdGl2aXR5fWAgOiBhcHBBY3Rpdml0eTtcbiAgICAgIGxvZy5kZWJ1ZyhgRm91bmQgcGFja2FnZTogJyR7YXBwUGFja2FnZX0nIGFuZCBmdWxseSBxdWFsaWZpZWQgYWN0aXZpdHkgbmFtZSA6ICcke2Z1bGx5UXVhbGlmaWVkQWN0aXZpdHl9J2ApO1xuICAgICAgbGV0IGZvdW5kQWN0ID0gKF8uaW5jbHVkZXMoYWxsUGFja2FnZXMsIGFwcFBhY2thZ2UpICYmXG4gICAgICAgICAgICAgICAgICAgICAgXy5maW5kSW5kZXgocG9zc2libGVBY3Rpdml0eVBhdHRlcm5zLCAocG9zc2libGVQYXR0ZXJuKSA9PiBwb3NzaWJsZVBhdHRlcm4udGVzdChmdWxseVF1YWxpZmllZEFjdGl2aXR5KSkgIT09IC0xKTtcbiAgICAgIGlmICgoIXdhaXRGb3JTdG9wICYmIGZvdW5kQWN0KSB8fCAod2FpdEZvclN0b3AgJiYgIWZvdW5kQWN0KSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGxvZy5kZWJ1ZygnSW5jb3JyZWN0IHBhY2thZ2UgYW5kIGFjdGl2aXR5LiBSZXRyeWluZy4nKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCR7cG9zc2libGVBY3Rpdml0eU5hbWVzLm1hcCgobmFtZSkgPT4gYCcke25hbWV9J2ApLmpvaW4oJyBvciAnKX0gbmV2ZXIgJHt3YWl0Rm9yU3RvcCA/ICdzdG9wcGVkJyA6ICdzdGFydGVkJ30uIGAgK1xuICAgICAgYFZpc2l0ICR7QUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOS30gZm9yIHRyb3VibGVzaG9vdGluZ2ApO1xuICB9KTtcbn07XG5cbi8qKlxuICogV2FpdCBmb3IgdGhlIGdpdmVuIGFjdGl2aXR5IHRvIGJlIGZvY3VzZWRcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYWN0aXZpdHkgLSBUaGUgbmFtZSBvZiB0aGUgYWN0aXZpdHksIGJlbG9uZ2luZyB0byB0aGF0IHBhY2thZ2UsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byB3YWl0IGZvci5cbiAqIEBwYXJhbSB7bnVtYmVyfSB3YWl0TXMgWzIwMDAwXSAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgdGltZW91dCBvY2N1cnMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgdGltZW91dCBoYXBwZW5zLlxuICovXG5hcGtVdGlsc01ldGhvZHMud2FpdEZvckFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gKHBrZywgYWN0LCB3YWl0TXMgPSAyMDAwMCkge1xuICBhd2FpdCB0aGlzLndhaXRGb3JBY3Rpdml0eU9yTm90KHBrZywgYWN0LCBmYWxzZSwgd2FpdE1zKTtcbn07XG5cbi8qKlxuICogV2FpdCBmb3IgdGhlIGdpdmVuIGFjdGl2aXR5IHRvIGJlIG5vbi1mb2N1c2VkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byB3YWl0IGZvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBhY3Rpdml0eSAtIFRoZSBuYW1lIG9mIHRoZSBhY3Rpdml0eSwgYmVsb25naW5nIHRvIHRoYXQgcGFja2FnZSxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIHdhaXQgZm9yLlxuICogQHBhcmFtIHtudW1iZXJ9IHdhaXRNcyBbMjAwMDBdIC0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSB0aW1lb3V0IG9jY3Vycy5cbiAqIEB0aHJvd3Mge2Vycm9yfSBJZiB0aW1lb3V0IGhhcHBlbnMuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy53YWl0Rm9yTm90QWN0aXZpdHkgPSBhc3luYyBmdW5jdGlvbiAocGtnLCBhY3QsIHdhaXRNcyA9IDIwMDAwKSB7XG4gIGF3YWl0IHRoaXMud2FpdEZvckFjdGl2aXR5T3JOb3QocGtnLCBhY3QsIHRydWUsIHdhaXRNcyk7XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFVuaW5zdGFsbE9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lb3V0IFsyMDAwMF0gLSBUaGUgY291bnQgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgdGhlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwIGlzIHVuaW5zdGFsbGVkLlxuICogQHByb3BlcnR5IHtib29sZWFufSBrZWVwRGF0YSBbZmFsc2VdIC0gU2V0IHRvIHRydWUgaW4gb3JkZXIgdG8ga2VlcCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9uIGRhdGEgYW5kIGNhY2hlIGZvbGRlcnMgYWZ0ZXIgdW5pbnN0YWxsLlxuICovXG5cbmNvbnN0IEFQS19VTklOU1RBTExfVElNRU9VVCA9IDIwMDAwO1xuXG4vKipcbiAqIFVuaW5zdGFsbCB0aGUgZ2l2ZW4gcGFja2FnZSBmcm9tIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gYmUgdW5pbnN0YWxsZWQuXG4gKiBAcGFyYW0gez9Vbmluc3RhbGxPcHRpb25zfSBvcHRpb25zIC0gVGhlIHNldCBvZiB1bmluc3RhbGxhdGlvbiBvcHRpb25zLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgcGFja2FnZSB3YXMgZm91bmQgb24gdGhlIGRldmljZSBhbmRcbiAqICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NmdWxseSB1bmluc3RhbGxlZC5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLnVuaW5zdGFsbEFwayA9IGFzeW5jIGZ1bmN0aW9uIChwa2csIG9wdGlvbnMgPSB7fSkge1xuICBsb2cuZGVidWcoYFVuaW5zdGFsbGluZyAke3BrZ31gKTtcbiAgaWYgKCFhd2FpdCB0aGlzLmlzQXBwSW5zdGFsbGVkKHBrZykpIHtcbiAgICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBub3QgdW5pbnN0YWxsZWQsIGJlY2F1c2UgaXQgd2FzIG5vdCBwcmVzZW50IG9uIHRoZSBkZXZpY2VgKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBsZXQgdGltZW91dCA9IEFQS19VTklOU1RBTExfVElNRU9VVDtcbiAgaWYgKHV0aWwuaGFzVmFsdWUob3B0aW9ucy50aW1lb3V0KSAmJiAhaXNOYU4ob3B0aW9ucy50aW1lb3V0KSkge1xuICAgIHRpbWVvdXQgPSBwYXJzZUludChvcHRpb25zLnRpbWVvdXQsIDEwKTtcbiAgfVxuICBjb25zdCBjbWQgPSBbJ3VuaW5zdGFsbCddO1xuICBpZiAob3B0aW9ucy5rZWVwRGF0YSkge1xuICAgIGNtZC5wdXNoKCctaycpO1xuICB9XG4gIGNtZC5wdXNoKHBrZyk7XG5cbiAgbGV0IHN0ZG91dDtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmZvcmNlU3RvcChwa2cpO1xuICAgIHN0ZG91dCA9IChhd2FpdCB0aGlzLmFkYkV4ZWMoY21kLCB7dGltZW91dH0pKS50cmltKCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byB1bmluc3RhbGwgQVBLLiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbiAgbG9nLmRlYnVnKGAnYWRiICR7Y21kLmpvaW4oJyAnKX0nIGNvbW1hbmQgb3V0cHV0OiAke3N0ZG91dH1gKTtcbiAgaWYgKHN0ZG91dC5pbmNsdWRlcyhcIlN1Y2Nlc3NcIikpIHtcbiAgICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBzdWNjZXNzZnVsbHkgdW5pbnN0YWxsZWRgKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBub3QgdW5pbnN0YWxsZWRgKTtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyoqXG4gKiBJbnN0YWxsIHRoZSBwYWNrYWdlIGFmdGVyIGl0IHdhcyBwdXNoZWQgdG8gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcGtQYXRoT25EZXZpY2UgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBwYWNrYWdlIG9uIHRoZSBkZXZpY2UgZmlsZSBzeXN0ZW0uXG4gKiBAcGFyYW0ge29iamVjdH0gb3B0cyBbe31dIC0gQWRkaXRpb25hbCBleGVjIG9wdGlvbnMuIFNlZSB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9ub2RlLXRlZW5fcHJvY2Vzc31cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbW9yZSBkZXRhaWxzIG9uIHRoaXMgcGFyYW1ldGVyLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRoZXJlIHdhcyBhIGZhaWx1cmUgZHVyaW5nIGFwcGxpY2F0aW9uIGluc3RhbGwuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5pbnN0YWxsRnJvbURldmljZVBhdGggPSBhc3luYyBmdW5jdGlvbiAoYXBrUGF0aE9uRGV2aWNlLCBvcHRzID0ge30pIHtcbiAgbGV0IHN0ZG91dCA9IGF3YWl0IHRoaXMuc2hlbGwoWydwbScsICdpbnN0YWxsJywgJy1yJywgYXBrUGF0aE9uRGV2aWNlXSwgb3B0cyk7XG4gIGlmIChzdGRvdXQuaW5kZXhPZihcIkZhaWx1cmVcIikgIT09IC0xKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBSZW1vdGUgaW5zdGFsbCBmYWlsZWQ6ICR7c3Rkb3V0fWApO1xuICB9XG59O1xuXG5jb25zdCBBUEtfSU5TVEFMTF9USU1FT1VUID0gNjAwMDA7XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gSW5zdGFsbE9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0aW1lb3V0IFs2MDAwMF0gLSBUaGUgY291bnQgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgdGhlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwIGlzIGluc3RhbGxlZC5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gYWxsb3dUZXN0UGFja2FnZXMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGFsbG93IHRlc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VzIGluc3RhbGxhdGlvbi5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gdXNlU2RjYXJkIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSB0byBpbnN0YWxsIHRoZSBhcHAgb24gc2RjYXJkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGVhZCBvZiB0aGUgZGV2aWNlIG1lbW9yeS5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gZ3JhbnRQZXJtaXNzaW9ucyBbZmFsc2VdIC0gU2V0IHRvIHRydWUgaW4gb3JkZXIgdG8gZ3JhbnQgYWxsIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucyByZXF1ZXN0ZWQgaW4gdGhlIGFwcGxpY2F0aW9uJ3MgbWFuaWZlc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b21hdGljYWxseSBhZnRlciB0aGUgaW5zdGFsbGF0aW9uIGlzIGNvbXBsZXRlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmRlciBBbmRyb2lkIDYrLlxuICogQHByb3BlcnR5IHtib29sZWFufSByZXBsYWNlIFt0cnVlXSAtIFNldCBpdCB0byBmYWxzZSBpZiB5b3UgZG9uJ3Qgd2FudFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBhcHBsaWNhdGlvbiB0byBiZSB1cGdyYWRlZC9yZWluc3RhbGxlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGl0IGlzIGFscmVhZHkgcHJlc2VudCBvbiB0aGUgZGV2aWNlLlxuICovXG5cbi8qKlxuICogSW5zdGFsbCB0aGUgcGFja2FnZSBmcm9tIHRoZSBsb2NhbCBmaWxlIHN5c3RlbS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgcGFja2FnZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gcmVwYWxjZSBbdHJ1ZV0gLSBXaGV0aGVyIHRvIHJlcGxhY2UgdGhlIHBhY2thZ2UgaWYgaXRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHJlYWR5IGluc3RhbGxlZC4gVHJ1ZSBieSBkZWZhdWx0LlxuICogQHBhcmFtIHs/SW5zdGFsbE9wdGlvbnN9IG9wdGlvbnMgLSBUaGUgc2V0IG9mIGluc3RhbGxhdGlvbiBvcHRpb25zLlxuICogQHRocm93cyB7ZXJyb3J9IElmIGFuIHVuZXhwZWN0ZWQgZXJyb3IgaGFwcGVucyBkdXJpbmcgaW5zdGFsbC5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmluc3RhbGwgPSBhc3luYyBmdW5jdGlvbiAoYXBrLCBvcHRpb25zID0ge30pIHtcbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKG9wdGlvbnMucmVwbGFjZSkpIHtcbiAgICBvcHRpb25zLnJlcGxhY2UgPSB0cnVlO1xuICB9XG4gIGxldCB0aW1lb3V0ID0gQVBLX0lOU1RBTExfVElNRU9VVDtcbiAgaWYgKHV0aWwuaGFzVmFsdWUob3B0aW9ucy50aW1lb3V0KSAmJiAhaXNOYU4ob3B0aW9ucy50aW1lb3V0KSkge1xuICAgIHRpbWVvdXQgPSBwYXJzZUludChvcHRpb25zLnRpbWVvdXQsIDEwKTtcbiAgfVxuXG4gIGNvbnN0IGFkZGl0aW9uYWxBcmdzID0gW107XG4gIGlmIChvcHRpb25zLmFsbG93VGVzdFBhY2thZ2VzKSB7XG4gICAgYWRkaXRpb25hbEFyZ3MucHVzaCgnLXQnKTtcbiAgfVxuICBpZiAob3B0aW9ucy51c2VTZGNhcmQpIHtcbiAgICBhZGRpdGlvbmFsQXJncy5wdXNoKCctcycpO1xuICB9XG4gIGlmIChvcHRpb25zLmdyYW50UGVybWlzc2lvbnMpIHtcbiAgICBjb25zdCBhcGlMZXZlbCA9IGF3YWl0IHRoaXMuZ2V0QXBpTGV2ZWwoKTtcbiAgICBpZiAoYXBpTGV2ZWwgPCAyMykge1xuICAgICAgbG9nLmRlYnVnKGBTa2lwcGluZyBncmFudGluZyBwZXJtaXNzaW9ucyBmb3IgJyR7YXBrfScsIHNpbmNlIGAgK1xuICAgICAgICAgICAgICAgIGB0aGUgY3VycmVudCBBUEkgbGV2ZWwgJHthcGlMZXZlbH0gZG9lcyBub3Qgc3VwcG9ydCBhcHBsaWNhdGlvbnMgYCArXG4gICAgICAgICAgICAgICAgYHBlcm1pc3Npb25zIGN1c3RvbWl6YXRpb25gKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWRkaXRpb25hbEFyZ3MucHVzaCgnLWcnKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBleGVjdXRlSW5zdGFsbCA9IGFzeW5jIChhcmdzKSA9PiB7XG4gICAgY29uc3Qgb3V0cHV0ID0gYXdhaXQgdGhpcy5hZGJFeGVjKFsnaW5zdGFsbCcsIC4uLmFyZ3MsIGFwa10sIHt0aW1lb3V0fSk7XG4gICAgY29uc3QgdHJ1bmNhdGVkT3V0cHV0ID0gKCFfLmlzU3RyaW5nKG91dHB1dCkgfHwgb3V0cHV0Lmxlbmd0aCA8PSAzMDApID9cbiAgICAgIG91dHB1dCA6IGAke291dHB1dC5zdWJzdHIoMCwgMTUwKX0uLi4ke291dHB1dC5zdWJzdHIob3V0cHV0Lmxlbmd0aCAtIDE1MCl9YDtcbiAgICBsb2cuZGVidWcoYEluc3RhbGwgY29tbWFuZCBzdGRvdXQ6ICR7dHJ1bmNhdGVkT3V0cHV0fWApO1xuICAgIGlmIChfLmlzU3RyaW5nKG91dHB1dCkgJiYgb3V0cHV0LmluY2x1ZGVzKCdJTlNUQUxMX0ZBSUxFRCcpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3Iob3V0cHV0KTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKG9wdGlvbnMucmVwbGFjZSkge1xuICAgIHJldHVybiBhd2FpdCBleGVjdXRlSW5zdGFsbChbJy1yJywgLi4uYWRkaXRpb25hbEFyZ3NdKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgZXhlY3V0ZUluc3RhbGwoYWRkaXRpb25hbEFyZ3MpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICAvLyBvbiBzb21lIHN5c3RlbXMgdGhpcyB3aWxsIHRocm93IGFuIGVycm9yIGlmIHRoZSBhcHAgYWxyZWFkeVxuICAgIC8vIGV4aXN0c1xuICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoJ0lOU1RBTExfRkFJTEVEX0FMUkVBRFlfRVhJU1RTJykpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBBcHBsaWNhdGlvbiAnJHthcGt9JyBhbHJlYWR5IGluc3RhbGxlZC4gQ29udGludWluZy5gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBJbnN0YWxsT3JVcGdyYWRlT3B0aW9uc1xuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgWzYwMDAwXSAtIFRoZSBjb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgaW5zdGFsbGVkLlxuICogQHByb3BlcnR5IHtib29sZWFufSBhbGxvd1Rlc3RQYWNrYWdlcyBbZmFsc2VdIC0gU2V0IHRvIHRydWUgaW4gb3JkZXIgdG8gYWxsb3cgdGVzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZXMgaW5zdGFsbGF0aW9uLlxuICogQHByb3BlcnR5IHtib29sZWFufSB1c2VTZGNhcmQgW2ZhbHNlXSAtIFNldCB0byB0cnVlIHRvIGluc3RhbGwgdGhlIGFwcCBvbiBzZGNhcmRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0ZWFkIG9mIHRoZSBkZXZpY2UgbWVtb3J5LlxuICogQHByb3BlcnR5IHtib29sZWFufSBncmFudFBlcm1pc3Npb25zIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBncmFudCBhbGwgdGhlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zIHJlcXVlc3RlZCBpbiB0aGUgYXBwbGljYXRpb24ncyBtYW5pZmVzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5IGFmdGVyIHRoZSBpbnN0YWxsYXRpb24gaXMgY29tcGxldGVkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuZGVyIEFuZHJvaWQgNisuXG4gKi9cblxuLyoqXG4gKiBJbnN0YWxsIHRoZSBwYWNrYWdlIGZyb20gdGhlIGxvY2FsIGZpbGUgc3lzdGVtIG9mIHVwZ3JhZGUgaXQgaWYgYW4gb2xkZXJcbiAqIHZlcnNpb24gb2YgdGhlIHNhbWUgcGFja2FnZSBpcyBhbHJlYWR5IGluc3RhbGxlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgcGFja2FnZS5cbiAqIEBwYXJhbSB7P3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIGluc3RhbGxlZCBwYWNrYWdlLiBUaGUgbWV0aG9kIHdpbGxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgcGVyZm9ybSBmYXN0ZXIgaWYgaXQgaXMgc2V0LlxuICogQHBhcmFtIHs/SW5zdGFsbE9yVXBncmFkZU9wdGlvbnN9IG9wdGlvbnMgLSBTZXQgb2YgaW5zdGFsbCBvcHRpb25zLlxuICogQHRocm93cyB7ZXJyb3J9IElmIGFuIHVuZXhwZWN0ZWQgZXJyb3IgaGFwcGVucyBkdXJpbmcgaW5zdGFsbC5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmluc3RhbGxPclVwZ3JhZGUgPSBhc3luYyBmdW5jdGlvbiAoYXBrLCBwa2cgPSBudWxsLCBvcHRpb25zID0ge30pIHtcbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKG9wdGlvbnMudGltZW91dCkpIHtcbiAgICBvcHRpb25zLnRpbWVvdXQgPSBBUEtfSU5TVEFMTF9USU1FT1VUO1xuICB9XG5cbiAgbGV0IGFwa0luZm8gPSBudWxsO1xuICBpZiAoIXBrZykge1xuICAgIGFwa0luZm8gPSBhd2FpdCB0aGlzLmdldEFwa0luZm8oYXBrKTtcbiAgICBwa2cgPSBhcGtJbmZvLm5hbWU7XG4gIH1cbiAgaWYgKCFwa2cpIHtcbiAgICBsb2cud2FybihgQ2Fubm90IHJlYWQgdGhlIHBhY2thZ2UgbmFtZSBvZiAke2Fwa30uIEFzc3VtaW5nIGNvcnJlY3QgYXBwIHZlcnNpb24gaXMgYWxyZWFkeSBpbnN0YWxsZWRgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoIWF3YWl0IHRoaXMuaXNBcHBJbnN0YWxsZWQocGtnKSkge1xuICAgIGxvZy5kZWJ1ZyhgQXBwICcke2Fwa30nIG5vdCBpbnN0YWxsZWQuIEluc3RhbGxpbmdgKTtcbiAgICBhd2FpdCB0aGlzLmluc3RhbGwoYXBrLCBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLCB7cmVwbGFjZTogZmFsc2V9KSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qge3ZlcnNpb25Db2RlOiBwa2dWZXJzaW9uQ29kZSwgdmVyc2lvbk5hbWU6IHBrZ1ZlcnNpb25OYW1lU3RyfSA9IGF3YWl0IHRoaXMuZ2V0UGFja2FnZUluZm8ocGtnKTtcbiAgY29uc3QgcGtnVmVyc2lvbk5hbWUgPSBzZW12ZXIudmFsaWQoc2VtdmVyLmNvZXJjZShwa2dWZXJzaW9uTmFtZVN0cikpO1xuICBpZiAoIWFwa0luZm8pIHtcbiAgICBhcGtJbmZvID0gYXdhaXQgdGhpcy5nZXRBcGtJbmZvKGFwayk7XG4gIH1cbiAgY29uc3Qge3ZlcnNpb25Db2RlOiBhcGtWZXJzaW9uQ29kZSwgdmVyc2lvbk5hbWU6IGFwa1ZlcnNpb25OYW1lU3RyfSA9IGFwa0luZm87XG4gIGNvbnN0IGFwa1ZlcnNpb25OYW1lID0gc2VtdmVyLnZhbGlkKHNlbXZlci5jb2VyY2UoYXBrVmVyc2lvbk5hbWVTdHIpKTtcblxuICBpZiAoIV8uaXNJbnRlZ2VyKGFwa1ZlcnNpb25Db2RlKSB8fCAhXy5pc0ludGVnZXIocGtnVmVyc2lvbkNvZGUpKSB7XG4gICAgbG9nLndhcm4oYENhbm5vdCByZWFkIHZlcnNpb24gY29kZXMgb2YgJyR7YXBrfScgYW5kL29yICcke3BrZ30nYCk7XG4gICAgaWYgKCFfLmlzU3RyaW5nKGFwa1ZlcnNpb25OYW1lKSB8fCAhXy5pc1N0cmluZyhwa2dWZXJzaW9uTmFtZSkpIHtcbiAgICAgIGxvZy53YXJuKGBDYW5ub3QgcmVhZCB2ZXJzaW9uIG5hbWVzIG9mICcke2Fwa30nIGFuZC9vciAnJHtwa2d9Jy4gQXNzdW1pbmcgY29ycmVjdCBhcHAgdmVyc2lvbiBpcyBhbHJlYWR5IGluc3RhbGxlZGApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBpZiAoXy5pc0ludGVnZXIoYXBrVmVyc2lvbkNvZGUpICYmIF8uaXNJbnRlZ2VyKHBrZ1ZlcnNpb25Db2RlKSkge1xuICAgIGlmIChwa2dWZXJzaW9uQ29kZSA+IGFwa1ZlcnNpb25Db2RlKSB7XG4gICAgICBsb2cuZGVidWcoYFRoZSBpbnN0YWxsZWQgJyR7cGtnfScgcGFja2FnZSBkb2VzIG5vdCByZXF1aXJlIHVwZ3JhZGUgKCR7cGtnVmVyc2lvbkNvZGV9ID4gJHthcGtWZXJzaW9uQ29kZX0pYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIFZlcnNpb24gY29kZXMgbWlnaHQgbm90IGJlIG1haW50YWluZWQuIENoZWNrIHZlcnNpb24gbmFtZXMuXG4gICAgaWYgKHBrZ1ZlcnNpb25Db2RlID09PSBhcGtWZXJzaW9uQ29kZSkge1xuICAgICAgaWYgKF8uaXNTdHJpbmcoYXBrVmVyc2lvbk5hbWUpICYmIF8uaXNTdHJpbmcocGtnVmVyc2lvbk5hbWUpICYmIHNlbXZlci5zYXRpc2ZpZXMocGtnVmVyc2lvbk5hbWUsIGA+PSR7YXBrVmVyc2lvbk5hbWV9YCkpIHtcbiAgICAgICAgbG9nLmRlYnVnKGBUaGUgaW5zdGFsbGVkICcke3BrZ30nIHBhY2thZ2UgZG9lcyBub3QgcmVxdWlyZSB1cGdyYWRlICgnJHtwa2dWZXJzaW9uTmFtZX0nID49ICcke2Fwa1ZlcnNpb25OYW1lfScpYCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICghXy5pc1N0cmluZyhhcGtWZXJzaW9uTmFtZSkgfHwgIV8uaXNTdHJpbmcocGtnVmVyc2lvbk5hbWUpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgVGhlIGluc3RhbGxlZCAnJHtwa2d9JyBwYWNrYWdlIGRvZXMgbm90IHJlcXVpcmUgdXBncmFkZSAoJHtwa2dWZXJzaW9uQ29kZX0gPT09ICR7YXBrVmVyc2lvbkNvZGV9KWApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcoYXBrVmVyc2lvbk5hbWUpICYmIF8uaXNTdHJpbmcocGtnVmVyc2lvbk5hbWUpICYmIHNlbXZlci5zYXRpc2ZpZXMocGtnVmVyc2lvbk5hbWUsIGA+PSR7YXBrVmVyc2lvbk5hbWV9YCkpIHtcbiAgICBsb2cuZGVidWcoYFRoZSBpbnN0YWxsZWQgJyR7cGtnfScgcGFja2FnZSBkb2VzIG5vdCByZXF1aXJlIHVwZ3JhZGUgKCcke3BrZ1ZlcnNpb25OYW1lfScgPj0gJyR7YXBrVmVyc2lvbk5hbWV9JylgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsb2cuZGVidWcoYFRoZSBpbnN0YWxsZWQgJyR7cGtnfScgcGFja2FnZSBpcyBvbGRlciB0aGFuICcke2Fwa30nIGAgK1xuICAgICAgICAgICAgYCgke3BrZ1ZlcnNpb25Db2RlfSA8ICR7YXBrVmVyc2lvbkNvZGV9IG9yICcke3BrZ1ZlcnNpb25OYW1lfScgPCAnJHthcGtWZXJzaW9uTmFtZX0nKScuIGAgK1xuICAgICAgICAgICAgYEV4ZWN1dGluZyB1cGdyYWRlYCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5pbnN0YWxsKGFwaywgT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywge3JlcGxhY2U6IHRydWV9KSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy53YXJuKGBDYW5ub3QgdXBncmFkZSAnJHtwa2d9JyBiZWNhdXNlIG9mICcke2Vyci5tZXNzYWdlfScuIFRyeWluZyBmdWxsIHJlaW5zdGFsbGApO1xuICAgIGlmICghYXdhaXQgdGhpcy51bmluc3RhbGxBcGsocGtnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGAnJHtwa2d9JyBwYWNrYWdlIGNhbm5vdCBiZSB1bmluc3RhbGxlZGApO1xuICAgIH1cbiAgICBhd2FpdCB0aGlzLmluc3RhbGwoYXBrLCBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLCB7cmVwbGFjZTogZmFsc2V9KSk7XG4gIH1cbn07XG5cbi8qKlxuICogRXh0cmFjdCBzdHJpbmcgcmVzb3VyY2VzIGZyb20gdGhlIGdpdmVuIHBhY2thZ2Ugb24gbG9jYWwgZmlsZSBzeXN0ZW0uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwayAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIGxvY2FsIHBhY2thZ2UuXG4gKiBAcGFyYW0gez9zdHJpbmd9IGxhbmd1YWdlIC0gVGhlIG5hbWUgb2YgdGhlIGxhbmd1YWdlIHRvIGV4dHJhY3QgdGhlIHJlc291cmNlcyBmb3IuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhlIGRlZmF1bHQgbGFuZ3VhZ2UgaXMgdXNlZCBpZiB0aGlzIGVxdWFscyB0byBgbnVsbGAvYHVuZGVmaW5lZGBcbiAqIEBwYXJhbSB7c3RyaW5nfSBvdXQgLSBUaGUgbmFtZSBvZiB0aGUgZGVzdGluYXRpb24gZm9sZGVyIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbSB0b1xuICogICAgICAgICAgICAgICAgICAgICAgIHN0b3JlIHRoZSBleHRyYWN0ZWQgZmlsZSB0by5cbiAqIEByZXR1cm4ge09iamVjdH0gQSBtYXBwaW5nIG9iamVjdCwgd2hlcmUgcHJvcGVydGllcyBhcmU6ICdhcGtTdHJpbmdzJywgY29udGFpbmluZ1xuICogICAgICAgICAgICAgICAgICBwYXJzZWQgcmVzb3VyY2UgZmlsZSByZXByZXNlbnRlZCBhcyBKU09OIG9iamVjdCwgYW5kICdsb2NhbFBhdGgnLFxuICogICAgICAgICAgICAgICAgICBjb250YWluaW5nIHRoZSBwYXRoIHRvIHRoZSBleHRyYWN0ZWQgZmlsZSBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0uXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5leHRyYWN0U3RyaW5nc0Zyb21BcGsgPSBhc3luYyBmdW5jdGlvbiAoYXBrLCBsYW5ndWFnZSwgb3V0KSB7XG4gIGxvZy5kZWJ1ZyhgRXh0cmFjdGluZyBzdHJpbmdzIGZvciBsYW5ndWFnZTogJHtsYW5ndWFnZSB8fCAnZGVmYXVsdCd9YCk7XG4gIGF3YWl0IHRoaXMuaW5pdEFhcHQoKTtcbiAgbGV0IHJhd0FhcHRPdXRwdXQ7XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgW1xuICAgICAgJ2QnLFxuICAgICAgJy0tdmFsdWVzJyxcbiAgICAgICdyZXNvdXJjZXMnLFxuICAgICAgYXBrLFxuICAgIF0pO1xuICAgIHJhd0FhcHRPdXRwdXQgPSBzdGRvdXQ7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBleHRyYWN0IHJlc291cmNlcyBmcm9tICcke2Fwa30nLiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cblxuICBjb25zdCBkZWZhdWx0Q29uZmlnTWFya2VyID0gJyhkZWZhdWx0KSc7XG4gIGxldCBjb25maWdNYXJrZXIgPSBsYW5ndWFnZSB8fCBkZWZhdWx0Q29uZmlnTWFya2VyO1xuICBpZiAoY29uZmlnTWFya2VyLmluY2x1ZGVzKCctJykgJiYgIWNvbmZpZ01hcmtlci5pbmNsdWRlcygnLXInKSkge1xuICAgIGNvbmZpZ01hcmtlciA9IGNvbmZpZ01hcmtlci5yZXBsYWNlKCctJywgJy1yJyk7XG4gIH1cbiAgaWYgKGNvbmZpZ01hcmtlci50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoJ2VuJykpIHtcbiAgICAvLyBBc3N1bWUgdGhlICdlbicgY29uZmlndXJhdGlvbiBpcyB0aGUgZGVmYXVsdCBvbmVcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbXG4gICAgICAnZCcsXG4gICAgICAnY29uZmlndXJhdGlvbnMnLFxuICAgICAgYXBrLFxuICAgIF0pO1xuICAgIGNvbnN0IGNvbmZpZ3MgPSBzdGRvdXQuc3BsaXQob3MuRU9MKTtcbiAgICBpZiAoIWNvbmZpZ3MuaW5jbHVkZXMoY29uZmlnTWFya2VyKSkge1xuICAgICAgbG9nLmRlYnVnKGBUaGVyZSBpcyBubyAnJHtjb25maWdNYXJrZXJ9JyBjb25maWd1cmF0aW9uLiBgICtcbiAgICAgICAgICAgICAgICBgUmVwbGFjaW5nIGl0IHdpdGggJyR7ZGVmYXVsdENvbmZpZ01hcmtlcn0nYCk7XG4gICAgICBjb25maWdNYXJrZXIgPSBkZWZhdWx0Q29uZmlnTWFya2VyO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGFwa1N0cmluZ3MgPSB7fTtcbiAgbGV0IGlzSW5Db25maWcgPSBmYWxzZTtcbiAgbGV0IGN1cnJlbnRSZXNvdXJjZUlkID0gbnVsbDtcbiAgbGV0IGlzSW5QbHVyYWxHcm91cCA9IGZhbHNlO1xuICBjb25zdCBzdGFydHNXaXRoQW55ID0gKHMsIGFycikgPT4gYXJyLnJlZHVjZSgoYWNjLCB4KSA9PiBhY2MgfHwgcy5zdGFydHNXaXRoKHgpLCBmYWxzZSk7XG4gIGNvbnN0IG5vcm1hbGl6ZVN0cmluZ01hdGNoID0gKHMpID0+IHMucmVwbGFjZSgvXCIkLywgJycpLnJlcGxhY2UoL15cIi8sICcnKS5yZXBsYWNlKC9cXFxcXCIvZywgJ1wiJyk7XG4gIGZvciAoY29uc3QgbGluZSBvZiByYXdBYXB0T3V0cHV0LnNwbGl0KG9zLkVPTCkpIHtcbiAgICBjb25zdCB0cmltbWVkTGluZSA9IGxpbmUudHJpbSgpO1xuICAgIGlmIChfLmlzRW1wdHkodHJpbW1lZExpbmUpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAoc3RhcnRzV2l0aEFueSh0cmltbWVkTGluZSwgWydjb25maWcnLCAndHlwZScsICdzcGVjJywgJ1BhY2thZ2UnXSkpIHtcbiAgICAgIGlzSW5Db25maWcgPSB0cmltbWVkTGluZS5zdGFydHNXaXRoKGBjb25maWcgJHtjb25maWdNYXJrZXJ9OmApO1xuICAgICAgY3VycmVudFJlc291cmNlSWQgPSBudWxsO1xuICAgICAgaXNJblBsdXJhbEdyb3VwID0gZmFsc2U7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAoIWlzSW5Db25maWcpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmICh0cmltbWVkTGluZS5zdGFydHNXaXRoKCdyZXNvdXJjZScpKSB7XG4gICAgICBpc0luUGx1cmFsR3JvdXAgPSBmYWxzZTtcbiAgICAgIGN1cnJlbnRSZXNvdXJjZUlkID0gbnVsbDtcblxuICAgICAgaWYgKHRyaW1tZWRMaW5lLmluY2x1ZGVzKCc6c3RyaW5nLycpKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gLzpzdHJpbmdcXC8oXFxTKyk6Ly5leGVjKHRyaW1tZWRMaW5lKTtcbiAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgY3VycmVudFJlc291cmNlSWQgPSBtYXRjaFsxXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0cmltbWVkTGluZS5pbmNsdWRlcygnOnBsdXJhbHMvJykpIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSAvOnBsdXJhbHNcXC8oXFxTKyk6Ly5leGVjKHRyaW1tZWRMaW5lKTtcbiAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgY3VycmVudFJlc291cmNlSWQgPSBtYXRjaFsxXTtcbiAgICAgICAgICBpc0luUGx1cmFsR3JvdXAgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAoY3VycmVudFJlc291cmNlSWQgJiYgdHJpbW1lZExpbmUuc3RhcnRzV2l0aCgnKHN0cmluZycpKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IC9cIlteXCJcXFxcXSooPzpcXFxcLlteXCJcXFxcXSopKlwiLy5leGVjKHRyaW1tZWRMaW5lKTtcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBhcGtTdHJpbmdzW2N1cnJlbnRSZXNvdXJjZUlkXSA9IG5vcm1hbGl6ZVN0cmluZ01hdGNoKG1hdGNoWzBdKTtcbiAgICAgIH1cbiAgICAgIGN1cnJlbnRSZXNvdXJjZUlkID0gbnVsbDtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChjdXJyZW50UmVzb3VyY2VJZCAmJiBpc0luUGx1cmFsR3JvdXAgJiYgdHJpbW1lZExpbmUuaW5jbHVkZXMoJzogKHN0cmluZycpKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IC9cIlteXCJcXFxcXSooPzpcXFxcLlteXCJcXFxcXSopKlwiLy5leGVjKHRyaW1tZWRMaW5lKTtcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBhcGtTdHJpbmdzW2N1cnJlbnRSZXNvdXJjZUlkXSA9IFtcbiAgICAgICAgICAuLi4oYXBrU3RyaW5nc1tjdXJyZW50UmVzb3VyY2VJZF0gfHwgW10pLFxuICAgICAgICAgIG5vcm1hbGl6ZVN0cmluZ01hdGNoKG1hdGNoWzBdKSxcbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChfLmlzRW1wdHkoYXBrU3RyaW5ncykpIHtcbiAgICBsb2cud2FybihgTm8gc3RyaW5ncyBoYXZlIGJlZW4gZm91bmQgaW4gJyR7YXBrfScgcmVzb3VyY2VzIGAgK1xuICAgICAgICAgICAgIGBmb3IgJyR7Y29uZmlnTWFya2VyfScgY29uZmlndXJhdGlvbmApO1xuICB9IGVsc2Uge1xuICAgIGxvZy5pbmZvKGBTdWNjZXNzZnVsbHkgZXh0cmFjdGVkICR7Xy5rZXlzKGFwa1N0cmluZ3MpLmxlbmd0aH0gc3RyaW5ncyBmcm9tICcke2Fwa30nIHJlc291cmNlcyBgICtcbiAgICAgICAgICAgICBgZm9yICcke2NvbmZpZ01hcmtlcn0nIGNvbmZpZ3VyYXRpb25gKTtcbiAgfVxuXG4gIGNvbnN0IGxvY2FsUGF0aCA9IHBhdGgucmVzb2x2ZShvdXQsICdzdHJpbmdzLmpzb24nKTtcbiAgYXdhaXQgbWtkaXJwKG91dCk7XG4gIGF3YWl0IGZzLndyaXRlRmlsZShsb2NhbFBhdGgsIEpTT04uc3RyaW5naWZ5KGFwa1N0cmluZ3MsIG51bGwsIDIpLCAndXRmLTgnKTtcbiAgcmV0dXJuIHthcGtTdHJpbmdzLCBsb2NhbFBhdGh9O1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIGxhbmd1YWdlIG5hbWUgb2YgdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIG5hbWUgb2YgZGV2aWNlIGxhbmd1YWdlLlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0RGV2aWNlTGFuZ3VhZ2UgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxldCBsYW5ndWFnZTtcbiAgaWYgKGF3YWl0IHRoaXMuZ2V0QXBpTGV2ZWwoKSA8IDIzKSB7XG4gICAgbGFuZ3VhZ2UgPSBhd2FpdCB0aGlzLmdldERldmljZVN5c0xhbmd1YWdlKCk7XG4gICAgaWYgKCFsYW5ndWFnZSkge1xuICAgICAgbGFuZ3VhZ2UgPSBhd2FpdCB0aGlzLmdldERldmljZVByb2R1Y3RMYW5ndWFnZSgpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsYW5ndWFnZSA9IChhd2FpdCB0aGlzLmdldERldmljZUxvY2FsZSgpKS5zcGxpdChcIi1cIilbMF07XG4gIH1cbiAgcmV0dXJuIGxhbmd1YWdlO1xufTtcblxuLyoqXG4gKiBTZXQgdGhlIGxhbmd1YWdlIG5hbWUgb2YgdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsYW5ndWFnZSAtIFRoZSBuYW1lIG9mIHRoZSBuZXcgZGV2aWNlIGxhbmd1YWdlLlxuICovXG5hcGtVdGlsc01ldGhvZHMuc2V0RGV2aWNlTGFuZ3VhZ2UgPSBhc3luYyBmdW5jdGlvbiAobGFuZ3VhZ2UpIHtcbiAgLy8gdGhpcyBtZXRob2QgaXMgb25seSB1c2VkIGluIEFQSSA8IDIzXG4gIGF3YWl0IHRoaXMuc2V0RGV2aWNlU3lzTGFuZ3VhZ2UobGFuZ3VhZ2UpO1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIGNvdW50cnkgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgbmFtZSBvZiBkZXZpY2UgY291bnRyeS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldERldmljZUNvdW50cnkgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIC8vIHRoaXMgbWV0aG9kIGlzIG9ubHkgdXNlZCBpbiBBUEkgPCAyM1xuICBsZXQgY291bnRyeSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlU3lzQ291bnRyeSgpO1xuICBpZiAoIWNvdW50cnkpIHtcbiAgICBjb3VudHJ5ID0gYXdhaXQgdGhpcy5nZXREZXZpY2VQcm9kdWN0Q291bnRyeSgpO1xuICB9XG4gIHJldHVybiBjb3VudHJ5O1xufTtcblxuLyoqXG4gKiBTZXQgdGhlIGNvdW50cnkgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGNvdW50cnkgLSBUaGUgbmFtZSBvZiB0aGUgbmV3IGRldmljZSBjb3VudHJ5LlxuICovXG5hcGtVdGlsc01ldGhvZHMuc2V0RGV2aWNlQ291bnRyeSA9IGFzeW5jIGZ1bmN0aW9uIChjb3VudHJ5KSB7XG4gIC8vIHRoaXMgbWV0aG9kIGlzIG9ubHkgdXNlZCBpbiBBUEkgPCAyM1xuICBhd2FpdCB0aGlzLnNldERldmljZVN5c0NvdW50cnkoY291bnRyeSk7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgbG9jYWxlIG5hbWUgb2YgdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIG5hbWUgb2YgZGV2aWNlIGxvY2FsZS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldERldmljZUxvY2FsZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgLy8gdGhpcyBtZXRob2QgaXMgb25seSB1c2VkIGluIEFQSSA+PSAyM1xuICBsZXQgbG9jYWxlID0gYXdhaXQgdGhpcy5nZXREZXZpY2VTeXNMb2NhbGUoKTtcbiAgaWYgKCFsb2NhbGUpIHtcbiAgICBsb2NhbGUgPSBhd2FpdCB0aGlzLmdldERldmljZVByb2R1Y3RMb2NhbGUoKTtcbiAgfVxuICByZXR1cm4gbG9jYWxlO1xufTtcblxuLyoqXG4gKiBTZXQgdGhlIGxvY2FsZSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdCBhbmQgdGhlIGZvcm1hdCBvZiB0aGUgbG9jYWxlIGlzIGVuLVVTLCBmb3IgZXhhbXBsZS5cbiAqIFRoaXMgbWV0aG9kIGNhbGwgc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5LCBzbywgcGxlYXNlIHVzZSBzZXREZXZpY2VMYW5ndWFnZUNvdW50cnkgYXMgcG9zc2libGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsZSAtIE5hbWVzIG9mIHRoZSBkZXZpY2UgbGFuZ3VhZ2UgYW5kIHRoZSBjb3VudHJ5IGNvbm5lY3RlZCB3aXRoIGAtYC4gZS5nLiBlbi1VUy5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLnNldERldmljZUxvY2FsZSA9IGFzeW5jIGZ1bmN0aW9uIChsb2NhbGUpIHtcbiAgY29uc3QgdmFsaWRhdGVMb2NhbGUgPSBuZXcgUmVnRXhwKC9bYS16QS1aXSstW2EtekEtWjAtOV0rLyk7XG4gIGlmICghdmFsaWRhdGVMb2NhbGUudGVzdChsb2NhbGUpKSB7XG4gICAgbG9nLndhcm4oYHNldERldmljZUxvY2FsZSByZXF1aXJlcyB0aGUgZm9sbG93aW5nIGZvcm1hdDogZW4tVVMgb3IgamEtSlBgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgc3BsaXRfbG9jYWxlID0gbG9jYWxlLnNwbGl0KFwiLVwiKTtcbiAgYXdhaXQgdGhpcy5zZXREZXZpY2VMYW5ndWFnZUNvdW50cnkoc3BsaXRfbG9jYWxlWzBdLCBzcGxpdF9sb2NhbGVbMV0pO1xufTtcblxuLyoqXG4gKiBNYWtlIHN1cmUgY3VycmVudCBkZXZpY2UgbG9jYWxlIGlzIGV4cGVjdGVkIG9yIG5vdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2UgLSBMYW5ndWFnZS4gVGhlIGxhbmd1YWdlIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gbG93ZXIgY2FzZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBjb3VudHJ5IC0gQ291bnRyeS4gVGhlIGxhbmd1YWdlIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gbG93ZXIgY2FzZS5cbiAqXG4gKiBAcmV0dXJuIHtib29sZWFufSBJZiBjdXJyZW50IGxvY2FsZSBpcyBsYW5ndWFnZSBhbmQgY291bnRyeSBhcyBhcmd1bWVudHMsIHJldHVybiB0cnVlLlxuICovXG5hcGtVdGlsc01ldGhvZHMuZW5zdXJlQ3VycmVudExvY2FsZSA9IGFzeW5jIGZ1bmN0aW9uIChsYW5ndWFnZSwgY291bnRyeSkge1xuICBjb25zdCBoYXNMYW5ndWFnZSA9IF8uaXNTdHJpbmcobGFuZ3VhZ2UpO1xuICBjb25zdCBoYXNDb3VudHJ5ID0gXy5pc1N0cmluZyhjb3VudHJ5KTtcblxuICBpZiAoIWhhc0xhbmd1YWdlICYmICFoYXNDb3VudHJ5KSB7XG4gICAgbG9nLndhcm4oJ2Vuc3VyZUN1cnJlbnRMb2NhbGUgcmVxdWlyZXMgbGFuZ3VhZ2Ugb3IgY291bnRyeScpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIGdldCBsb3dlciBjYXNlIHZlcnNpb25zIG9mIHRoZSBzdHJpbmdzXG4gIGxhbmd1YWdlID0gKGxhbmd1YWdlIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICBjb3VudHJ5ID0gKGNvdW50cnkgfHwgJycpLnRvTG93ZXJDYXNlKCk7XG5cbiAgY29uc3QgYXBpTGV2ZWwgPSBhd2FpdCB0aGlzLmdldEFwaUxldmVsKCk7XG5cbiAgcmV0dXJuIGF3YWl0IHJldHJ5SW50ZXJ2YWwoNSwgMTAwMCwgYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAoYXBpTGV2ZWwgPCAyMykge1xuICAgICAgICBsZXQgY3VyTGFuZ3VhZ2UsIGN1ckNvdW50cnk7XG4gICAgICAgIGlmIChoYXNMYW5ndWFnZSkge1xuICAgICAgICAgIGN1ckxhbmd1YWdlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTGFuZ3VhZ2UoKSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBpZiAoIWhhc0NvdW50cnkgJiYgbGFuZ3VhZ2UgPT09IGN1ckxhbmd1YWdlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc0NvdW50cnkpIHtcbiAgICAgICAgICBjdXJDb3VudHJ5ID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlQ291bnRyeSgpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIGlmICghaGFzTGFuZ3VhZ2UgJiYgY291bnRyeSA9PT0gY3VyQ291bnRyeSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChsYW5ndWFnZSA9PT0gY3VyTGFuZ3VhZ2UgJiYgY291bnRyeSA9PT0gY3VyQ291bnRyeSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjdXJMb2NhbGUgPSAoYXdhaXQgdGhpcy5nZXREZXZpY2VMb2NhbGUoKSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKGAke2xhbmd1YWdlfS0ke2NvdW50cnl9YCA9PT0gY3VyTG9jYWxlKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIGlmIHRoZXJlIGhhcyBiZWVuIGFuIGVycm9yLCByZXN0YXJ0IGFkYiBhbmQgcmV0cnlcbiAgICAgIGxvZy5lcnJvcihgVW5hYmxlIHRvIGNoZWNrIGRldmljZSBsb2NhbGl6YXRpb246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2cuZGVidWcoJ1Jlc3RhcnRpbmcgQURCIGFuZCByZXRyeWluZy4uLicpO1xuICAgICAgYXdhaXQgdGhpcy5yZXN0YXJ0QWRiKCk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogU2V0IHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIC0gTGFuZ3VhZ2UuIFRoZSBsYW5ndWFnZSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIGxvd2VyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezIsOH0uIGUuZy4gZW4sIGphIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHtzdHJpbmd9IGNvdW50cnkgLSBDb3VudHJ5LiBUaGUgY291bnRyeSAocmVnaW9uKSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHVwcGVyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezJ9IHwgWzAtOV17M30uIGUuZy4gVVMsIEpQIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICovXG5hcGtVdGlsc01ldGhvZHMuc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5ID0gYXN5bmMgZnVuY3Rpb24gKGxhbmd1YWdlLCBjb3VudHJ5KSB7XG4gIGxldCBoYXNMYW5ndWFnZSA9IGxhbmd1YWdlICYmIF8uaXNTdHJpbmcobGFuZ3VhZ2UpO1xuICBsZXQgaGFzQ291bnRyeSA9IGNvdW50cnkgJiYgXy5pc1N0cmluZyhjb3VudHJ5KTtcbiAgaWYgKCFoYXNMYW5ndWFnZSAmJiAhaGFzQ291bnRyeSkge1xuICAgIGxvZy53YXJuKGBzZXREZXZpY2VMYW5ndWFnZUNvdW50cnkgcmVxdWlyZXMgbGFuZ3VhZ2Ugb3IgY291bnRyeS5gKTtcbiAgICBsb2cud2FybihgR290IGxhbmd1YWdlOiAnJHtsYW5ndWFnZX0nIGFuZCBjb3VudHJ5OiAnJHtjb3VudHJ5fSdgKTtcbiAgICByZXR1cm47XG4gIH1cbiAgbGV0IHdhc1NldHRpbmdDaGFuZ2VkID0gZmFsc2U7XG4gIGxldCBhcGlMZXZlbCA9IGF3YWl0IHRoaXMuZ2V0QXBpTGV2ZWwoKTtcblxuICBsYW5ndWFnZSA9IChsYW5ndWFnZSB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgY291bnRyeSA9IChjb3VudHJ5IHx8ICcnKS50b1VwcGVyQ2FzZSgpO1xuXG4gIGlmIChhcGlMZXZlbCA8IDIzKSB7XG4gICAgbGV0IGN1ckxhbmd1YWdlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTGFuZ3VhZ2UoKSkudG9Mb3dlckNhc2UoKTtcbiAgICBsZXQgY3VyQ291bnRyeSA9IChhd2FpdCB0aGlzLmdldERldmljZUNvdW50cnkoKSkudG9VcHBlckNhc2UoKTtcbiAgICBpZiAoaGFzTGFuZ3VhZ2UgJiYgbGFuZ3VhZ2UgIT09IGN1ckxhbmd1YWdlKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldERldmljZUxhbmd1YWdlKGxhbmd1YWdlKTtcbiAgICAgIHdhc1NldHRpbmdDaGFuZ2VkID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGhhc0NvdW50cnkgJiYgY291bnRyeSAhPT0gY3VyQ291bnRyeSkge1xuICAgICAgYXdhaXQgdGhpcy5zZXREZXZpY2VDb3VudHJ5KGNvdW50cnkpO1xuICAgICAgd2FzU2V0dGluZ0NoYW5nZWQgPSB0cnVlO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsZXQgY3VyTG9jYWxlID0gYXdhaXQgdGhpcy5nZXREZXZpY2VMb2NhbGUoKTtcblxuICAgIGlmIChhcGlMZXZlbCA9PT0gMjMpIHtcbiAgICAgIGxldCBsb2NhbGU7XG4gICAgICBpZiAoIWhhc0NvdW50cnkpIHtcbiAgICAgICAgbG9jYWxlID0gbGFuZ3VhZ2U7XG4gICAgICB9IGVsc2UgaWYgKCFoYXNMYW5ndWFnZSkge1xuICAgICAgICBsb2NhbGUgPSBjb3VudHJ5O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9jYWxlID0gYCR7bGFuZ3VhZ2V9LSR7Y291bnRyeX1gO1xuICAgICAgfVxuXG4gICAgICBsb2cuZGVidWcoYEN1cnJlbnQgbG9jYWxlOiAnJHtjdXJMb2NhbGV9JzsgcmVxdWVzdGVkIGxvY2FsZTogJyR7bG9jYWxlfSdgKTtcbiAgICAgIGlmIChsb2NhbGUudG9Mb3dlckNhc2UoKSAhPT0gY3VyTG9jYWxlLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zZXREZXZpY2VTeXNMb2NhbGUobG9jYWxlKTtcbiAgICAgICAgd2FzU2V0dGluZ0NoYW5nZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7IC8vIEFQSSA+PSAyNFxuICAgICAgaWYgKCFoYXNDb3VudHJ5IHx8ICFoYXNMYW5ndWFnZSkge1xuICAgICAgICBsb2cud2Fybihgc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IHJlcXVpcmVzIGJvdGggbGFuZ3VhZ2UgYW5kIGNvdW50cnkgdG8gYmUgc2V0IGZvciBBUEkgMjQrYCk7XG4gICAgICAgIGxvZy53YXJuKGBHb3QgbGFuZ3VhZ2U6ICcke2xhbmd1YWdlfScgYW5kIGNvdW50cnk6ICcke2NvdW50cnl9J2ApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGxvZy5kZWJ1ZyhgQ3VycmVudCBsb2NhbGU6ICcke2N1ckxvY2FsZX0nOyByZXF1ZXN0ZWQgbG9jYWxlOiAnJHtsYW5ndWFnZX0tJHtjb3VudHJ5fSdgKTtcbiAgICAgIGlmIChgJHtsYW5ndWFnZX0tJHtjb3VudHJ5fWAudG9Mb3dlckNhc2UoKSAhPT0gY3VyTG9jYWxlLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zZXREZXZpY2VTeXNMb2NhbGVWaWFTZXR0aW5nQXBwKGxhbmd1YWdlLCBjb3VudHJ5KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAod2FzU2V0dGluZ0NoYW5nZWQpIHtcbiAgICBsb2cuaW5mbyhcIlJlYm9vdGluZyB0aGUgZGV2aWNlIGluIG9yZGVyIHRvIGFwcGx5IG5ldyBsb2NhbGUgdmlhICdzZXR0aW5nIHBlcnNpc3Quc3lzLmxvY2FsZScgY29tbWFuZC5cIik7XG4gICAgYXdhaXQgdGhpcy5yZWJvb3QoKTtcbiAgfVxufTtcblxuLyoqXG4gKiBHZXQgdGhlIHBhY2thZ2UgbmFtZSBmcm9tIGxvY2FsIGFwayBmaWxlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcGsgLSBUaGUgZnVsbCBwYXRoIHRvIGV4aXN0aW5nIC5hcGsgcGFja2FnZSBvbiB0aGUgbG9jYWxcbiAqICAgICAgICAgICAgICAgICAgICAgICBmaWxlIHN5c3RlbS5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhcnNlZCBwYWNrYWdlIG5hbWUgb3IgX251bGxfIGlmIGl0IGNhbm5vdCBiZSBwYXJzZWQuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXRQYWNrYWdlTmFtZSA9IGFzeW5jIGZ1bmN0aW9uIChhcGspIHtcbiAgbGV0IGFyZ3MgPSBbJ2R1bXAnLCAnYmFkZ2luZycsIGFwa107XG4gIGF3YWl0IHRoaXMuaW5pdEFhcHQoKTtcbiAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLmFhcHQsIGFyZ3MpO1xuICBsZXQgYXBrUGFja2FnZSA9IG5ldyBSZWdFeHAoL3BhY2thZ2U6IG5hbWU9JyhbXiddKyknL2cpLmV4ZWMoc3Rkb3V0KTtcbiAgaWYgKGFwa1BhY2thZ2UgJiYgYXBrUGFja2FnZS5sZW5ndGggPj0gMikge1xuICAgIGFwa1BhY2thZ2UgPSBhcGtQYWNrYWdlWzFdO1xuICB9IGVsc2Uge1xuICAgIGFwa1BhY2thZ2UgPSBudWxsO1xuICB9XG4gIHJldHVybiBhcGtQYWNrYWdlO1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBBcHBJbmZvXG4gKiBAcHJvcGVydHkge3N0cmluZ30gbmFtZSAtIFBhY2thZ2UgbmFtZSwgZm9yIGV4YW1wbGUgJ2NvbS5hY21lLmFwcCcuXG4gKiBAcHJvcGVydHkge251bWJlcn0gdmVyc2lvbkNvZGUgLSBWZXJzaW9uIGNvZGUuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdmVyc2lvbk5hbWUgLSBWZXJzaW9uIG5hbWUsIGZvciBleGFtcGxlICcxLjAnLlxuICovXG5cbi8qKlxuICogR2V0IHRoZSBwYWNrYWdlIGluZm8gZnJvbSBsb2NhbCBhcGsgZmlsZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gZXhpc3RpbmcgLmFwayBwYWNrYWdlIG9uIHRoZSBsb2NhbFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlIHN5c3RlbS5cbiAqIEByZXR1cm4gez9BcHBJbmZvfSBUaGUgcGFyc2VkIGFwcGxpY2F0aW9uIGluZm9ybWF0aW9uLlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0QXBrSW5mbyA9IGFzeW5jIGZ1bmN0aW9uIChhcGtQYXRoKSB7XG4gIGlmICghYXdhaXQgZnMuZXhpc3RzKGFwa1BhdGgpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgZmlsZSBhdCBwYXRoICR7YXBrUGF0aH0gZG9lcyBub3QgZXhpc3Qgb3IgaXMgbm90IGFjY2Vzc2libGVgKTtcbiAgfVxuICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgWydkJywgJ2JhZGdpbmcnLCBhcGtQYXRoXSk7XG4gICAgY29uc3QgbWF0Y2hlcyA9IG5ldyBSZWdFeHAoL3BhY2thZ2U6IG5hbWU9JyhbXiddKyknIHZlcnNpb25Db2RlPScoXFxkKyknIHZlcnNpb25OYW1lPScoW14nXSspJy8pLmV4ZWMoc3Rkb3V0KTtcbiAgICBpZiAobWF0Y2hlcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZTogbWF0Y2hlc1sxXSxcbiAgICAgICAgdmVyc2lvbkNvZGU6IHBhcnNlSW50KG1hdGNoZXNbMl0sIDEwKSxcbiAgICAgICAgdmVyc2lvbk5hbWU6IG1hdGNoZXNbM11cbiAgICAgIH07XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cud2FybihgRXJyb3IgXCIke2Vyci5tZXNzYWdlfVwiIHdoaWxlIGdldHRpbmcgYmFkZ2luZyBpbmZvYCk7XG4gIH1cbiAgcmV0dXJuIHt9O1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIHBhY2thZ2UgaW5mbyBmcm9tIHRoZSBpbnN0YWxsZWQgYXBwbGljYXRpb24uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBpbnN0YWxsZWQgcGFja2FnZS5cbiAqIEByZXR1cm4gez9BcHBJbmZvfSBUaGUgcGFyc2VkIGFwcGxpY2F0aW9uIGluZm9ybWF0aW9uLlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0UGFja2FnZUluZm8gPSBhc3luYyBmdW5jdGlvbiAocGtnKSB7XG4gIGxvZy5kZWJ1ZyhgR2V0dGluZyBwYWNrYWdlIGluZm8gZm9yICcke3BrZ30nYCk7XG4gIGxldCByZXN1bHQgPSB7bmFtZTogcGtnfTtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsnZHVtcHN5cycsICdwYWNrYWdlJywgcGtnXSk7XG4gICAgY29uc3QgdmVyc2lvbk5hbWVNYXRjaCA9IG5ldyBSZWdFeHAoL3ZlcnNpb25OYW1lPShbXFxkKy5dKykvKS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKHZlcnNpb25OYW1lTWF0Y2gpIHtcbiAgICAgIHJlc3VsdC52ZXJzaW9uTmFtZSA9IHZlcnNpb25OYW1lTWF0Y2hbMV07XG4gICAgfVxuICAgIGNvbnN0IHZlcnNpb25Db2RlTWF0Y2ggPSBuZXcgUmVnRXhwKC92ZXJzaW9uQ29kZT0oXFxkKykvKS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKHZlcnNpb25Db2RlTWF0Y2gpIHtcbiAgICAgIHJlc3VsdC52ZXJzaW9uQ29kZSA9IHBhcnNlSW50KHZlcnNpb25Db2RlTWF0Y2hbMV0sIDEwKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLndhcm4oYEVycm9yICcke2Vyci5tZXNzYWdlfScgd2hpbGUgZHVtcGluZyBwYWNrYWdlIGluZm9gKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuYXBrVXRpbHNNZXRob2RzLnB1bGxBcGsgPSBhc3luYyBmdW5jdGlvbiBwdWxsQXBrIChwa2csIHRtcERpcikge1xuICBjb25zdCBwa2dQYXRoID0gKGF3YWl0IHRoaXMuYWRiRXhlYyhbJ3NoZWxsJywgJ3BtJywgJ3BhdGgnLCBwa2ddKSkucmVwbGFjZSgncGFja2FnZTonLCAnJyk7XG4gIGNvbnN0IHRtcEFwcCA9IHBhdGgucmVzb2x2ZSh0bXBEaXIsIGAke3BrZ30uYXBrYCk7XG4gIGF3YWl0IHRoaXMucHVsbChwa2dQYXRoLCB0bXBBcHApO1xuICBsb2cuZGVidWcoYFB1bGxlZCBhcHAgZm9yIHBhY2thZ2UgJyR7cGtnfScgdG8gJyR7dG1wQXBwfSdgKTtcbiAgcmV0dXJuIHRtcEFwcDtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGFwa1V0aWxzTWV0aG9kcztcbiJdLCJmaWxlIjoibGliL3Rvb2xzL2Fway11dGlscy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
