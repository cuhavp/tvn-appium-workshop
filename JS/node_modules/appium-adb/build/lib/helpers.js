"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getAndroidPlatformAndPath = getAndroidPlatformAndPath;
exports.unzipFile = unzipFile;
exports.assertZipArchive = assertZipArchive;
exports.getIMEListFromOutput = getIMEListFromOutput;
exports.isShowingLockscreen = isShowingLockscreen;
exports.isCurrentFocusOnKeyguard = isCurrentFocusOnKeyguard;
exports.getSurfaceOrientation = getSurfaceOrientation;
exports.isScreenOnFully = isScreenOnFully;
exports.buildStartCmd = buildStartCmd;
exports.getJavaHome = getJavaHome;
exports.getApksignerForOs = getApksignerForOs;
exports.getApkanalyzerForOs = getApkanalyzerForOs;
exports.extractMatchingPermissions = exports.getOpenSslForOs = exports.getBuildToolsDirs = exports.getSdkToolsVersion = exports.rootDir = exports.getJavaForOs = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _path = _interopRequireDefault(require("path"));

var _appiumSupport = require("appium-support");

var _logger = _interopRequireDefault(require("./logger.js"));

var _teen_process = require("teen_process");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _semver = _interopRequireDefault(require("semver"));

const ZIP_MAGIC = 'PK';

const rootDir = _path.default.resolve(__dirname, process.env.NO_PRECOMPILE ? '..' : '../..');

exports.rootDir = rootDir;

function getAndroidPlatformAndPath() {
  return _getAndroidPlatformAndPath.apply(this, arguments);
}

function _getAndroidPlatformAndPath() {
  _getAndroidPlatformAndPath = (0, _asyncToGenerator2.default)(function* () {
    const androidHome = process.env.ANDROID_HOME;

    if (!_lodash.default.isString(androidHome)) {
      throw new Error("ANDROID_HOME environment variable was not exported");
    }

    let propsPaths = yield _appiumSupport.fs.glob(_path.default.resolve(androidHome, 'platforms', '*', 'build.prop'), {
      absolute: true
    });
    const platformsMapping = {};
    var _iteratorNormalCompletion5 = true;
    var _didIteratorError5 = false;
    var _iteratorError5 = undefined;

    try {
      for (var _iterator5 = propsPaths[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
        const propsPath = _step5.value;
        const propsContent = yield _appiumSupport.fs.readFile(propsPath, 'utf-8');

        const platformPath = _path.default.dirname(propsPath);

        const platform = _path.default.basename(platformPath);

        const match = /ro\.build\.version\.sdk=(\d+)/.exec(propsContent);

        if (!match) {
          _logger.default.warn(`Cannot read the SDK version from '${propsPath}'. Skipping '${platform}'`);

          continue;
        }

        platformsMapping[parseInt(match[1], 10)] = {
          platform,
          platformPath
        };
      }
    } catch (err) {
      _didIteratorError5 = true;
      _iteratorError5 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion5 && _iterator5.return != null) {
          _iterator5.return();
        }
      } finally {
        if (_didIteratorError5) {
          throw _iteratorError5;
        }
      }
    }

    if (_lodash.default.isEmpty(platformsMapping)) {
      _logger.default.warn(`Found zero platform folders at '${_path.default.resolve(androidHome, 'platforms')}'. ` + `Do you have any Android SDKs installed?`);

      return {
        platform: null,
        platformPath: null
      };
    }

    const recentSdkVersion = _lodash.default.keys(platformsMapping).sort().reverse()[0];

    const result = platformsMapping[recentSdkVersion];

    _logger.default.debug(`Found the most recent Android platform: ${JSON.stringify(result)}`);

    return result;
  });
  return _getAndroidPlatformAndPath.apply(this, arguments);
}

function unzipFile(_x) {
  return _unzipFile.apply(this, arguments);
}

function _unzipFile() {
  _unzipFile = (0, _asyncToGenerator2.default)(function* (zipPath) {
    _logger.default.debug(`Unzipping ${zipPath}`);

    try {
      yield assertZipArchive(zipPath);

      if (_appiumSupport.system.isWindows()) {
        yield _appiumSupport.zip.extractAllTo(zipPath, _path.default.dirname(zipPath));

        _logger.default.debug("Unzip successful");
      } else {
        yield (0, _teen_process.exec)('unzip', ['-o', zipPath], {
          cwd: _path.default.dirname(zipPath)
        });

        _logger.default.debug("Unzip successful");
      }
    } catch (e) {
      throw new Error(`Error occurred while unzipping. Original error: ${e.message}`);
    }
  });
  return _unzipFile.apply(this, arguments);
}

function assertZipArchive(_x2) {
  return _assertZipArchive.apply(this, arguments);
}

function _assertZipArchive() {
  _assertZipArchive = (0, _asyncToGenerator2.default)(function* (zipPath) {
    _logger.default.debug(`Testing zip archive: '${zipPath}'`);

    if (!(yield _appiumSupport.fs.exists(zipPath))) {
      throw new Error(`Zip archive does not exist at '${zipPath}'`);
    }

    const _ref3 = yield _appiumSupport.fs.stat(zipPath),
          size = _ref3.size;

    if (size < 4) {
      throw new Error(`The file at '${zipPath}' is too small to be a ZIP archive`);
    }

    const fd = yield _appiumSupport.fs.open(zipPath, 'r');
    const buffer = Buffer.alloc(ZIP_MAGIC.length);
    yield _appiumSupport.fs.read(fd, buffer, 0, ZIP_MAGIC.length, 0);

    if (buffer.toString('ascii') !== ZIP_MAGIC) {
      throw new Error(`The file signature '${buffer.toString('ascii')}' of '${zipPath}' ` + `is not equal to the expected ZIP archive signature '${ZIP_MAGIC}'`);
    }
  });
  return _assertZipArchive.apply(this, arguments);
}

function getIMEListFromOutput(stdout) {
  let engines = [];
  var _iteratorNormalCompletion = true;
  var _didIteratorError = false;
  var _iteratorError = undefined;

  try {
    for (var _iterator = stdout.split('\n')[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
      let line = _step.value;

      if (line.length > 0 && line[0] !== ' ') {
        engines.push(line.trim().replace(/:$/, ''));
      }
    }
  } catch (err) {
    _didIteratorError = true;
    _iteratorError = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion && _iterator.return != null) {
        _iterator.return();
      }
    } finally {
      if (_didIteratorError) {
        throw _iteratorError;
      }
    }
  }

  return engines;
}

const getJavaForOs = _lodash.default.memoize(() => {
  return _path.default.resolve(getJavaHome(), 'bin', `java${_appiumSupport.system.isWindows() ? '.exe' : ''}`);
});

exports.getJavaForOs = getJavaForOs;

const getOpenSslForOs = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* () {
    const binaryName = `openssl${_appiumSupport.system.isWindows() ? '.exe' : ''}`;

    try {
      return yield _appiumSupport.fs.which(binaryName);
    } catch (err) {
      throw new Error('The openssl tool must be installed on the system and available on the path');
    }
  });

  return function getOpenSslForOs() {
    return _ref.apply(this, arguments);
  };
}();

exports.getOpenSslForOs = getOpenSslForOs;

function getJavaHome() {
  if (process.env.JAVA_HOME) {
    return process.env.JAVA_HOME;
  }

  throw new Error("JAVA_HOME is not set currently. Please set JAVA_HOME.");
}

function getApksignerForOs(_x3) {
  return _getApksignerForOs.apply(this, arguments);
}

function _getApksignerForOs() {
  _getApksignerForOs = (0, _asyncToGenerator2.default)(function* (sysHelpers) {
    return yield sysHelpers.getBinaryFromSdkRoot('apksigner');
  });
  return _getApksignerForOs.apply(this, arguments);
}

function getApkanalyzerForOs(_x4) {
  return _getApkanalyzerForOs.apply(this, arguments);
}

function _getApkanalyzerForOs() {
  _getApkanalyzerForOs = (0, _asyncToGenerator2.default)(function* (sysHelpers) {
    return yield sysHelpers.getBinaryFromSdkRoot('apkanalyzer');
  });
  return _getApkanalyzerForOs.apply(this, arguments);
}

function isShowingLockscreen(dumpsys) {
  return /(mShowingLockscreen=true|mDreamingLockscreen=true)/gi.test(dumpsys);
}

function isCurrentFocusOnKeyguard(dumpsys) {
  let m = /mCurrentFocus.+Keyguard/gi.exec(dumpsys);
  return m && m.length && m[0] ? true : false;
}

function getSurfaceOrientation(dumpsys) {
  let m = /SurfaceOrientation: \d/gi.exec(dumpsys);
  return m && parseInt(m[0].split(':')[1], 10);
}

function isScreenOnFully(dumpsys) {
  let m = /mScreenOnFully=\w+/gi.exec(dumpsys);
  return !m || m && m.length > 0 && m[0].split('=')[1] === 'true' || false;
}

function buildStartCmd(startAppOptions, apiLevel) {
  let cmd = ['am', 'start'];

  if (_appiumSupport.util.hasValue(startAppOptions.user)) {
    cmd.push('--user', startAppOptions.user);
  }

  cmd.push('-W', '-n', `${startAppOptions.pkg}/${startAppOptions.activity}`);

  if (startAppOptions.stopApp && apiLevel >= 15) {
    cmd.push('-S');
  }

  if (startAppOptions.action) {
    cmd.push('-a', startAppOptions.action);
  }

  if (startAppOptions.category) {
    cmd.push('-c', startAppOptions.category);
  }

  if (startAppOptions.flags) {
    cmd.push('-f', startAppOptions.flags);
  }

  if (startAppOptions.optionalIntentArguments) {
    let parseKeyValue = function parseKeyValue(str) {
      str = str.trim();
      let space = str.indexOf(' ');

      if (space === -1) {
        return str.length ? [str] : [];
      } else {
        return [str.substring(0, space).trim(), str.substring(space + 1).trim()];
      }
    };

    let optionalIntentArguments = ` ${startAppOptions.optionalIntentArguments}`;
    let re = / (-[^\s]+) (.+)/;

    while (true) {
      let args = re.exec(optionalIntentArguments);

      if (!args) {
        if (optionalIntentArguments.length) {
          cmd.push.apply(cmd, parseKeyValue(optionalIntentArguments));
        }

        break;
      }

      let flag = args[1];
      let flagPos = optionalIntentArguments.indexOf(flag);

      if (flagPos !== 0) {
        let prevArgs = optionalIntentArguments.substring(0, flagPos);
        cmd.push.apply(cmd, parseKeyValue(prevArgs));
      }

      cmd.push(flag);
      optionalIntentArguments = args[2];
    }
  }

  return cmd;
}

const getSdkToolsVersion = _lodash.default.memoize(function () {
  var _getSdkToolsVersion = (0, _asyncToGenerator2.default)(function* () {
    const androidHome = process.env.ANDROID_HOME;

    if (!androidHome) {
      throw new Error('ANDROID_HOME environment variable is expected to be set');
    }

    const propertiesPath = _path.default.resolve(androidHome, 'tools', 'source.properties');

    if (!(yield _appiumSupport.fs.exists(propertiesPath))) {
      _logger.default.warn(`Cannot find ${propertiesPath} file to read SDK version from`);

      return;
    }

    const propertiesContent = yield _appiumSupport.fs.readFile(propertiesPath, 'utf8');
    const versionMatcher = new RegExp(/Pkg\.Revision=(\d+)\.?(\d+)?\.?(\d+)?/);
    const match = versionMatcher.exec(propertiesContent);

    if (match) {
      return {
        major: parseInt(match[1], 10),
        minor: match[2] ? parseInt(match[2], 10) : 0,
        build: match[3] ? parseInt(match[3], 10) : 0
      };
    }

    _logger.default.warn(`Cannot parse "Pkg.Revision" value from ${propertiesPath}`);
  });

  return function getSdkToolsVersion() {
    return _getSdkToolsVersion.apply(this, arguments);
  };
}());

exports.getSdkToolsVersion = getSdkToolsVersion;

const getBuildToolsDirs = _lodash.default.memoize(function () {
  var _getBuildToolsDirs = (0, _asyncToGenerator2.default)(function* (sdkRoot) {
    let buildToolsDirs = yield _appiumSupport.fs.glob(_path.default.resolve(sdkRoot, 'build-tools', '*'), {
      absolute: true
    });

    try {
      buildToolsDirs = buildToolsDirs.map(dir => [_path.default.basename(dir), dir]).sort((a, b) => _semver.default.rcompare(a[0], b[0])).map(pair => pair[1]);
    } catch (err) {
      _logger.default.warn(`Cannot sort build-tools folders ${JSON.stringify(buildToolsDirs.map(dir => _path.default.basename(dir)))} ` + `by semantic version names.`);

      _logger.default.warn(`Falling back to sorting by modification date. Original error: ${err.message}`);

      const pairs = yield _bluebird.default.map(buildToolsDirs, function () {
        var _ref2 = (0, _asyncToGenerator2.default)(function* (dir) {
          return [(yield _appiumSupport.fs.stat(dir)).mtime.valueOf(), dir];
        });

        return function (_x6) {
          return _ref2.apply(this, arguments);
        };
      }());
      buildToolsDirs = pairs.sort((a, b) => a[0] < b[0]).map(pair => pair[1]);
    }

    _logger.default.info(`Found ${buildToolsDirs.length} 'build-tools' folders under '${sdkRoot}' (newest first):`);

    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
      for (var _iterator2 = buildToolsDirs[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
        let dir = _step2.value;

        _logger.default.info(`    ${dir}`);
      }
    } catch (err) {
      _didIteratorError2 = true;
      _iteratorError2 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
          _iterator2.return();
        }
      } finally {
        if (_didIteratorError2) {
          throw _iteratorError2;
        }
      }
    }

    return buildToolsDirs;
  });

  return function getBuildToolsDirs(_x5) {
    return _getBuildToolsDirs.apply(this, arguments);
  };
}());

exports.getBuildToolsDirs = getBuildToolsDirs;

const extractMatchingPermissions = function extractMatchingPermissions(dumpsysOutput, groupNames, grantedState = null) {
  const groupPatternByName = groupName => new RegExp(`^(\\s*${_lodash.default.escapeRegExp(groupName)} permissions:[\\s\\S]+)`, 'm');

  const indentPattern = /\S|$/;
  const permissionNamePattern = /android\.permission\.\w+/;
  const grantedStatePattern = /\bgranted=(\w+)/;
  const result = [];
  var _iteratorNormalCompletion3 = true;
  var _didIteratorError3 = false;
  var _iteratorError3 = undefined;

  try {
    for (var _iterator3 = groupNames[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
      const groupName = _step3.value;
      const groupMatch = groupPatternByName(groupName).exec(dumpsysOutput);

      if (!groupMatch) {
        continue;
      }

      const lines = groupMatch[1].split('\n');

      if (lines.length < 2) {
        continue;
      }

      const titleIndent = lines[0].search(indentPattern);
      var _iteratorNormalCompletion4 = true;
      var _didIteratorError4 = false;
      var _iteratorError4 = undefined;

      try {
        for (var _iterator4 = lines.slice(1)[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
          const line = _step4.value;
          const currentIndent = line.search(indentPattern);

          if (currentIndent <= titleIndent) {
            break;
          }

          const permissionNameMatch = permissionNamePattern.exec(line);

          if (!permissionNameMatch) {
            continue;
          }

          const item = {
            permission: permissionNameMatch[0]
          };
          const grantedStateMatch = grantedStatePattern.exec(line);

          if (grantedStateMatch) {
            item.granted = grantedStateMatch[1] === 'true';
          }

          result.push(item);
        }
      } catch (err) {
        _didIteratorError4 = true;
        _iteratorError4 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion4 && _iterator4.return != null) {
            _iterator4.return();
          }
        } finally {
          if (_didIteratorError4) {
            throw _iteratorError4;
          }
        }
      }
    }
  } catch (err) {
    _didIteratorError3 = true;
    _iteratorError3 = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
        _iterator3.return();
      }
    } finally {
      if (_didIteratorError3) {
        throw _iteratorError3;
      }
    }
  }

  const filteredResult = result.filter(item => !_lodash.default.isBoolean(grantedState) || item.granted === grantedState).map(item => item.permission);

  _logger.default.debug(`Retrieved ${filteredResult.length} permission(s) from ${JSON.stringify(groupNames)} group(s)`);

  return filteredResult;
};

exports.extractMatchingPermissions = extractMatchingPermissions;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9oZWxwZXJzLmpzIl0sIm5hbWVzIjpbIlpJUF9NQUdJQyIsInJvb3REaXIiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInByb2Nlc3MiLCJlbnYiLCJOT19QUkVDT01QSUxFIiwiZ2V0QW5kcm9pZFBsYXRmb3JtQW5kUGF0aCIsImFuZHJvaWRIb21lIiwiQU5EUk9JRF9IT01FIiwiXyIsImlzU3RyaW5nIiwiRXJyb3IiLCJwcm9wc1BhdGhzIiwiZnMiLCJnbG9iIiwiYWJzb2x1dGUiLCJwbGF0Zm9ybXNNYXBwaW5nIiwicHJvcHNQYXRoIiwicHJvcHNDb250ZW50IiwicmVhZEZpbGUiLCJwbGF0Zm9ybVBhdGgiLCJkaXJuYW1lIiwicGxhdGZvcm0iLCJiYXNlbmFtZSIsIm1hdGNoIiwiZXhlYyIsImxvZyIsIndhcm4iLCJwYXJzZUludCIsImlzRW1wdHkiLCJyZWNlbnRTZGtWZXJzaW9uIiwia2V5cyIsInNvcnQiLCJyZXZlcnNlIiwicmVzdWx0IiwiZGVidWciLCJKU09OIiwic3RyaW5naWZ5IiwidW56aXBGaWxlIiwiemlwUGF0aCIsImFzc2VydFppcEFyY2hpdmUiLCJzeXN0ZW0iLCJpc1dpbmRvd3MiLCJ6aXAiLCJleHRyYWN0QWxsVG8iLCJjd2QiLCJlIiwibWVzc2FnZSIsImV4aXN0cyIsInN0YXQiLCJzaXplIiwiZmQiLCJvcGVuIiwiYnVmZmVyIiwiQnVmZmVyIiwiYWxsb2MiLCJsZW5ndGgiLCJyZWFkIiwidG9TdHJpbmciLCJnZXRJTUVMaXN0RnJvbU91dHB1dCIsInN0ZG91dCIsImVuZ2luZXMiLCJzcGxpdCIsImxpbmUiLCJwdXNoIiwidHJpbSIsInJlcGxhY2UiLCJnZXRKYXZhRm9yT3MiLCJtZW1vaXplIiwiZ2V0SmF2YUhvbWUiLCJnZXRPcGVuU3NsRm9yT3MiLCJiaW5hcnlOYW1lIiwid2hpY2giLCJlcnIiLCJKQVZBX0hPTUUiLCJnZXRBcGtzaWduZXJGb3JPcyIsInN5c0hlbHBlcnMiLCJnZXRCaW5hcnlGcm9tU2RrUm9vdCIsImdldEFwa2FuYWx5emVyRm9yT3MiLCJpc1Nob3dpbmdMb2Nrc2NyZWVuIiwiZHVtcHN5cyIsInRlc3QiLCJpc0N1cnJlbnRGb2N1c09uS2V5Z3VhcmQiLCJtIiwiZ2V0U3VyZmFjZU9yaWVudGF0aW9uIiwiaXNTY3JlZW5PbkZ1bGx5IiwiYnVpbGRTdGFydENtZCIsInN0YXJ0QXBwT3B0aW9ucyIsImFwaUxldmVsIiwiY21kIiwidXRpbCIsImhhc1ZhbHVlIiwidXNlciIsInBrZyIsImFjdGl2aXR5Iiwic3RvcEFwcCIsImFjdGlvbiIsImNhdGVnb3J5IiwiZmxhZ3MiLCJvcHRpb25hbEludGVudEFyZ3VtZW50cyIsInBhcnNlS2V5VmFsdWUiLCJzdHIiLCJzcGFjZSIsImluZGV4T2YiLCJzdWJzdHJpbmciLCJyZSIsImFyZ3MiLCJhcHBseSIsImZsYWciLCJmbGFnUG9zIiwicHJldkFyZ3MiLCJnZXRTZGtUb29sc1ZlcnNpb24iLCJwcm9wZXJ0aWVzUGF0aCIsInByb3BlcnRpZXNDb250ZW50IiwidmVyc2lvbk1hdGNoZXIiLCJSZWdFeHAiLCJtYWpvciIsIm1pbm9yIiwiYnVpbGQiLCJnZXRCdWlsZFRvb2xzRGlycyIsInNka1Jvb3QiLCJidWlsZFRvb2xzRGlycyIsIm1hcCIsImRpciIsImEiLCJiIiwic2VtdmVyIiwicmNvbXBhcmUiLCJwYWlyIiwicGFpcnMiLCJCIiwibXRpbWUiLCJ2YWx1ZU9mIiwiaW5mbyIsImV4dHJhY3RNYXRjaGluZ1Blcm1pc3Npb25zIiwiZHVtcHN5c091dHB1dCIsImdyb3VwTmFtZXMiLCJncmFudGVkU3RhdGUiLCJncm91cFBhdHRlcm5CeU5hbWUiLCJncm91cE5hbWUiLCJlc2NhcGVSZWdFeHAiLCJpbmRlbnRQYXR0ZXJuIiwicGVybWlzc2lvbk5hbWVQYXR0ZXJuIiwiZ3JhbnRlZFN0YXRlUGF0dGVybiIsImdyb3VwTWF0Y2giLCJsaW5lcyIsInRpdGxlSW5kZW50Iiwic2VhcmNoIiwic2xpY2UiLCJjdXJyZW50SW5kZW50IiwicGVybWlzc2lvbk5hbWVNYXRjaCIsIml0ZW0iLCJwZXJtaXNzaW9uIiwiZ3JhbnRlZFN0YXRlTWF0Y2giLCJncmFudGVkIiwiZmlsdGVyZWRSZXN1bHQiLCJmaWx0ZXIiLCJpc0Jvb2xlYW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsU0FBUyxHQUFHLElBQWxCOztBQUNBLE1BQU1DLE9BQU8sR0FBR0MsY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsYUFBWixHQUE0QixJQUE1QixHQUFtQyxPQUEzRCxDQUFoQjs7OztTQWVlQyx5Qjs7Ozs7K0RBQWYsYUFBNEM7QUFDMUMsVUFBTUMsV0FBVyxHQUFHSixPQUFPLENBQUNDLEdBQVIsQ0FBWUksWUFBaEM7O0FBQ0EsUUFBSSxDQUFDQyxnQkFBRUMsUUFBRixDQUFXSCxXQUFYLENBQUwsRUFBOEI7QUFDNUIsWUFBTSxJQUFJSSxLQUFKLENBQVUsb0RBQVYsQ0FBTjtBQUNEOztBQUVELFFBQUlDLFVBQVUsU0FBU0Msa0JBQUdDLElBQUgsQ0FBUWQsY0FBS0MsT0FBTCxDQUFhTSxXQUFiLEVBQTBCLFdBQTFCLEVBQXVDLEdBQXZDLEVBQTRDLFlBQTVDLENBQVIsRUFBbUU7QUFDeEZRLE1BQUFBLFFBQVEsRUFBRTtBQUQ4RSxLQUFuRSxDQUF2QjtBQUdBLFVBQU1DLGdCQUFnQixHQUFHLEVBQXpCO0FBVDBDO0FBQUE7QUFBQTs7QUFBQTtBQVUxQyw0QkFBd0JKLFVBQXhCLG1JQUFvQztBQUFBLGNBQXpCSyxTQUF5QjtBQUNsQyxjQUFNQyxZQUFZLFNBQVNMLGtCQUFHTSxRQUFILENBQVlGLFNBQVosRUFBdUIsT0FBdkIsQ0FBM0I7O0FBQ0EsY0FBTUcsWUFBWSxHQUFHcEIsY0FBS3FCLE9BQUwsQ0FBYUosU0FBYixDQUFyQjs7QUFDQSxjQUFNSyxRQUFRLEdBQUd0QixjQUFLdUIsUUFBTCxDQUFjSCxZQUFkLENBQWpC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QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBK0JuQztBQXJDMEY7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUF1QzNGLFFBQU1JLGNBQWMsR0FBR3pILE1BQU0sQ0FDMUIwSCxNQURvQixDQUNaTCxJQUFELElBQVUsQ0FBQzlJLGdCQUFFb0osU0FBRixDQUFZcEIsWUFBWixDQUFELElBQThCYyxJQUFJLENBQUNHLE9BQUwsS0FBaUJqQixZQUQ1QyxFQUVwQmYsR0FGb0IsQ0FFZjZCLElBQUQsSUFBVUEsSUFBSSxDQUFDQyxVQUZDLENBQXZCOztBQUdBOUgsa0JBQUlTLEtBQUosQ0FBVyxhQUFZd0gsY0FBYyxDQUFDbkcsTUFBTyx1QkFBc0JwQixJQUFJLENBQUNDLFNBQUwsQ0FBZW1HLFVBQWYsQ0FBMkIsV0FBOUY7O0FBQ0EsU0FBT21CLGNBQVA7QUFDRCxDQTVDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgc3lzdGVtLCBmcywgemlwLCB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlci5qcyc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgc2VtdmVyIGZyb20gJ3NlbXZlcic7XG5cbmNvbnN0IFpJUF9NQUdJQyA9ICdQSyc7XG5jb25zdCByb290RGlyID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgcHJvY2Vzcy5lbnYuTk9fUFJFQ09NUElMRSA/ICcuLicgOiAnLi4vLi4nKTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBQbGF0Zm9ybUluZm9cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gcGxhdGZvcm0gLSBUaGUgcGxhdGZvcm0gbmFtZSwgZm9yIGV4YW1wbGUgYGFuZHJvaWQtMjRgXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgYG51bGxgIGlmIGl0IGNhbm5vdCBiZSBmb3VuZFxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBwbGF0Zm9ybVBhdGggLSBGdWxsIHBhdGggdG8gdGhlIHBsYXRmb3JtIFNESyBmb2xkZXJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgYG51bGxgIGlmIGl0IGNhbm5vdCBiZSBmb3VuZFxuICovXG5cbi8qKlxuICogUmV0cmlldmUgdGhlIHBhdGggdG8gdGhlIHJlY2VudCBpbnN0YWxsZWQgQW5kcm9pZCBwbGF0Zm9ybS5cbiAqXG4gKiBAcmV0dXJuIHtQbGF0Zm9ybUluZm99IFRoZSByZXN1bHRpbmcgcGF0aCB0byB0aGUgbmV3ZXN0IGluc3RhbGxlZCBwbGF0Zm9ybS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0QW5kcm9pZFBsYXRmb3JtQW5kUGF0aCAoKSB7XG4gIGNvbnN0IGFuZHJvaWRIb21lID0gcHJvY2Vzcy5lbnYuQU5EUk9JRF9IT01FO1xuICBpZiAoIV8uaXNTdHJpbmcoYW5kcm9pZEhvbWUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQU5EUk9JRF9IT01FIGVudmlyb25tZW50IHZhcmlhYmxlIHdhcyBub3QgZXhwb3J0ZWRcIik7XG4gIH1cblxuICBsZXQgcHJvcHNQYXRocyA9IGF3YWl0IGZzLmdsb2IocGF0aC5yZXNvbHZlKGFuZHJvaWRIb21lLCAncGxhdGZvcm1zJywgJyonLCAnYnVpbGQucHJvcCcpLCB7XG4gICAgYWJzb2x1dGU6IHRydWVcbiAgfSk7XG4gIGNvbnN0IHBsYXRmb3Jtc01hcHBpbmcgPSB7fTtcbiAgZm9yIChjb25zdCBwcm9wc1BhdGggb2YgcHJvcHNQYXRocykge1xuICAgIGNvbnN0IHByb3BzQ29udGVudCA9IGF3YWl0IGZzLnJlYWRGaWxlKHByb3BzUGF0aCwgJ3V0Zi04Jyk7XG4gICAgY29uc3QgcGxhdGZvcm1QYXRoID0gcGF0aC5kaXJuYW1lKHByb3BzUGF0aCk7XG4gICAgY29uc3QgcGxhdGZvcm0gPSBwYXRoLmJhc2VuYW1lKHBsYXRmb3JtUGF0aCk7XG4gICAgY29uc3QgbWF0Y2ggPSAvcm9cXC5idWlsZFxcLnZlcnNpb25cXC5zZGs9KFxcZCspLy5leGVjKHByb3BzQ29udGVudCk7XG4gICAgaWYgKCFtYXRjaCkge1xuICAgICAgbG9nLndhcm4oYENhbm5vdCByZWFkIHRoZSBTREsgdmVyc2lvbiBmcm9tICcke3Byb3BzUGF0aH0nLiBTa2lwcGluZyAnJHtwbGF0Zm9ybX0nYCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgcGxhdGZvcm1zTWFwcGluZ1twYXJzZUludChtYXRjaFsxXSwgMTApXSA9IHtcbiAgICAgIHBsYXRmb3JtLFxuICAgICAgcGxhdGZvcm1QYXRoLFxuICAgIH07XG4gIH1cbiAgaWYgKF8uaXNFbXB0eShwbGF0Zm9ybXNNYXBwaW5nKSkge1xuICAgIGxvZy53YXJuKGBGb3VuZCB6ZXJvIHBsYXRmb3JtIGZvbGRlcnMgYXQgJyR7cGF0aC5yZXNvbHZlKGFuZHJvaWRIb21lLCAncGxhdGZvcm1zJyl9Jy4gYCArXG4gICAgICAgICAgICAgYERvIHlvdSBoYXZlIGFueSBBbmRyb2lkIFNES3MgaW5zdGFsbGVkP2ApO1xuICAgIHJldHVybiB7XG4gICAgICBwbGF0Zm9ybTogbnVsbCxcbiAgICAgIHBsYXRmb3JtUGF0aDogbnVsbCxcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgcmVjZW50U2RrVmVyc2lvbiA9IF8ua2V5cyhwbGF0Zm9ybXNNYXBwaW5nKS5zb3J0KCkucmV2ZXJzZSgpWzBdO1xuICBjb25zdCByZXN1bHQgPSBwbGF0Zm9ybXNNYXBwaW5nW3JlY2VudFNka1ZlcnNpb25dO1xuICBsb2cuZGVidWcoYEZvdW5kIHRoZSBtb3N0IHJlY2VudCBBbmRyb2lkIHBsYXRmb3JtOiAke0pTT04uc3RyaW5naWZ5KHJlc3VsdCl9YCk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVuemlwRmlsZSAoemlwUGF0aCkge1xuICBsb2cuZGVidWcoYFVuemlwcGluZyAke3ppcFBhdGh9YCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgYXNzZXJ0WmlwQXJjaGl2ZSh6aXBQYXRoKTtcbiAgICBpZiAoc3lzdGVtLmlzV2luZG93cygpKSB7XG4gICAgICBhd2FpdCB6aXAuZXh0cmFjdEFsbFRvKHppcFBhdGgsIHBhdGguZGlybmFtZSh6aXBQYXRoKSk7XG4gICAgICBsb2cuZGVidWcoXCJVbnppcCBzdWNjZXNzZnVsXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBleGVjKCd1bnppcCcsIFsnLW8nLCB6aXBQYXRoXSwge2N3ZDogcGF0aC5kaXJuYW1lKHppcFBhdGgpfSk7XG4gICAgICBsb2cuZGVidWcoXCJVbnppcCBzdWNjZXNzZnVsXCIpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3Igb2NjdXJyZWQgd2hpbGUgdW56aXBwaW5nLiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gYXNzZXJ0WmlwQXJjaGl2ZSAoemlwUGF0aCkge1xuICBsb2cuZGVidWcoYFRlc3RpbmcgemlwIGFyY2hpdmU6ICcke3ppcFBhdGh9J2ApO1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyh6aXBQYXRoKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgWmlwIGFyY2hpdmUgZG9lcyBub3QgZXhpc3QgYXQgJyR7emlwUGF0aH0nYCk7XG4gIH1cblxuICBjb25zdCB7c2l6ZX0gPSBhd2FpdCBmcy5zdGF0KHppcFBhdGgpO1xuICBpZiAoc2l6ZSA8IDQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBmaWxlIGF0ICcke3ppcFBhdGh9JyBpcyB0b28gc21hbGwgdG8gYmUgYSBaSVAgYXJjaGl2ZWApO1xuICB9XG4gIGNvbnN0IGZkID0gYXdhaXQgZnMub3Blbih6aXBQYXRoLCAncicpO1xuICBjb25zdCBidWZmZXIgPSBCdWZmZXIuYWxsb2MoWklQX01BR0lDLmxlbmd0aCk7XG4gIGF3YWl0IGZzLnJlYWQoZmQsIGJ1ZmZlciwgMCwgWklQX01BR0lDLmxlbmd0aCwgMCk7XG4gIGlmIChidWZmZXIudG9TdHJpbmcoJ2FzY2lpJykgIT09IFpJUF9NQUdJQykge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGZpbGUgc2lnbmF0dXJlICcke2J1ZmZlci50b1N0cmluZygnYXNjaWknKX0nIG9mICcke3ppcFBhdGh9JyBgICtcbiAgICAgICAgICAgICAgICAgICAgYGlzIG5vdCBlcXVhbCB0byB0aGUgZXhwZWN0ZWQgWklQIGFyY2hpdmUgc2lnbmF0dXJlICcke1pJUF9NQUdJQ30nYCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0SU1FTGlzdEZyb21PdXRwdXQgKHN0ZG91dCkge1xuICBsZXQgZW5naW5lcyA9IFtdO1xuICBmb3IgKGxldCBsaW5lIG9mIHN0ZG91dC5zcGxpdCgnXFxuJykpIHtcbiAgICBpZiAobGluZS5sZW5ndGggPiAwICYmIGxpbmVbMF0gIT09ICcgJykge1xuICAgICAgLy8gcmVtb3ZlIG5ld2xpbmUgYW5kIHRyYWlsaW5nIGNvbG9uLCBhbmQgYWRkIHRvIHRoZSBsaXN0XG4gICAgICBlbmdpbmVzLnB1c2gobGluZS50cmltKCkucmVwbGFjZSgvOiQvLCAnJykpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZW5naW5lcztcbn1cblxuY29uc3QgZ2V0SmF2YUZvck9zID0gXy5tZW1vaXplKCgpID0+IHtcbiAgcmV0dXJuIHBhdGgucmVzb2x2ZShnZXRKYXZhSG9tZSgpLCAnYmluJywgYGphdmEke3N5c3RlbS5pc1dpbmRvd3MoKSA/ICcuZXhlJyA6ICcnfWApO1xufSk7XG5cbmNvbnN0IGdldE9wZW5Tc2xGb3JPcyA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgYmluYXJ5TmFtZSA9IGBvcGVuc3NsJHtzeXN0ZW0uaXNXaW5kb3dzKCkgPyAnLmV4ZScgOiAnJ31gO1xuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCBmcy53aGljaChiaW5hcnlOYW1lKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgb3BlbnNzbCB0b29sIG11c3QgYmUgaW5zdGFsbGVkIG9uIHRoZSBzeXN0ZW0gYW5kIGF2YWlsYWJsZSBvbiB0aGUgcGF0aCcpO1xuICB9XG59O1xuXG5mdW5jdGlvbiBnZXRKYXZhSG9tZSAoKSB7XG4gIGlmIChwcm9jZXNzLmVudi5KQVZBX0hPTUUpIHtcbiAgICByZXR1cm4gcHJvY2Vzcy5lbnYuSkFWQV9IT01FO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihcIkpBVkFfSE9NRSBpcyBub3Qgc2V0IGN1cnJlbnRseS4gUGxlYXNlIHNldCBKQVZBX0hPTUUuXCIpO1xufVxuXG4vKipcbiAqIEdldCB0aGUgYWJzb2x1dGUgcGF0aCB0byBhcGtzaWduZXIgdG9vbFxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBzeXNIZWxwZXJzIC0gQW4gaW5zdGFuY2UgY29udGFpbmluZyBzeXN0ZW1DYWxsTWV0aG9kcyBoZWxwZXIgbWV0aG9kc1xuICogQHJldHVybnMge3N0cmluZ30gQW4gYWJzb2x1dGUgcGF0aCB0byBhcGtzaWduZXIgdG9vbC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgdG9vbCBpcyBub3QgcHJlc2VudCBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEFwa3NpZ25lckZvck9zIChzeXNIZWxwZXJzKSB7XG4gIHJldHVybiBhd2FpdCBzeXNIZWxwZXJzLmdldEJpbmFyeUZyb21TZGtSb290KCdhcGtzaWduZXInKTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGFic29sdXRlIHBhdGggdG8gYXBrYW5hbHl6ZXIgdG9vbC5cbiAqIGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3N0dWRpby9jb21tYW5kLWxpbmUvYXBrYW5hbHl6ZXIuaHRtbFxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBzeXNIZWxwZXJzIC0gQW4gaW5zdGFuY2UgY29udGFpbmluZyBzeXN0ZW1DYWxsTWV0aG9kcyBoZWxwZXIgbWV0aG9kc1xuICogQHJldHVybnMge3N0cmluZ30gQW4gYWJzb2x1dGUgcGF0aCB0byBhcGthbmFseXplciB0b29sLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSB0b29sIGlzIG5vdCBwcmVzZW50IG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0QXBrYW5hbHl6ZXJGb3JPcyAoc3lzSGVscGVycykge1xuICByZXR1cm4gYXdhaXQgc3lzSGVscGVycy5nZXRCaW5hcnlGcm9tU2RrUm9vdCgnYXBrYW5hbHl6ZXInKTtcbn1cblxuLyoqXG4gKiBDaGVja3MgbVNob3dpbmdMb2Nrc2NyZWVuIG9yIG1EcmVhbWluZ0xvY2tzY3JlZW4gaW4gZHVtcHN5cyBvdXRwdXQgdG8gZGV0ZXJtaW5lXG4gKiBpZiBsb2NrIHNjcmVlbiBpcyBzaG93aW5nXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGR1bXBzeXMgLSBUaGUgb3V0cHV0IG9mIGR1bXBzeXMgd2luZG93IGNvbW1hbmQuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGxvY2sgc2NyZWVuIGlzIHNob3dpbmcuXG4gKi9cbmZ1bmN0aW9uIGlzU2hvd2luZ0xvY2tzY3JlZW4gKGR1bXBzeXMpIHtcbiAgcmV0dXJuIC8obVNob3dpbmdMb2Nrc2NyZWVuPXRydWV8bURyZWFtaW5nTG9ja3NjcmVlbj10cnVlKS9naS50ZXN0KGR1bXBzeXMpO1xufVxuXG4vKlxuICogQ2hlY2tzIG1DdXJyZW50Rm9jdXMgaW4gZHVtcHN5cyBvdXRwdXQgdG8gZGV0ZXJtaW5lIGlmIEtleWd1YXJkIGlzIGFjdGl2YXRlZFxuICovXG5mdW5jdGlvbiBpc0N1cnJlbnRGb2N1c09uS2V5Z3VhcmQgKGR1bXBzeXMpIHtcbiAgbGV0IG0gPSAvbUN1cnJlbnRGb2N1cy4rS2V5Z3VhcmQvZ2kuZXhlYyhkdW1wc3lzKTtcbiAgcmV0dXJuIChtICYmIG0ubGVuZ3RoICYmIG1bMF0pID8gdHJ1ZSA6IGZhbHNlO1xufVxuXG4vKlxuICogUmVhZHMgU3VyZmFjZU9yaWVudGF0aW9uIGluIGR1bXBzeXMgb3V0cHV0XG4gKi9cbmZ1bmN0aW9uIGdldFN1cmZhY2VPcmllbnRhdGlvbiAoZHVtcHN5cykge1xuICBsZXQgbSA9IC9TdXJmYWNlT3JpZW50YXRpb246IFxcZC9naS5leGVjKGR1bXBzeXMpO1xuICByZXR1cm4gbSAmJiBwYXJzZUludChtWzBdLnNwbGl0KCc6JylbMV0sIDEwKTtcbn1cblxuLypcbiAqIENoZWNrcyBtU2NyZWVuT25GdWxseSBpbiBkdW1wc3lzIG91dHB1dCB0byBkZXRlcm1pbmUgaWYgc2NyZWVuIGlzIHNob3dpbmdcbiAqIERlZmF1bHQgaXMgdHJ1ZVxuICovXG5mdW5jdGlvbiBpc1NjcmVlbk9uRnVsbHkgKGR1bXBzeXMpIHtcbiAgbGV0IG0gPSAvbVNjcmVlbk9uRnVsbHk9XFx3Ky9naS5leGVjKGR1bXBzeXMpO1xuICByZXR1cm4gIW0gfHwgLy8gaWYgaW5mb3JtYXRpb24gaXMgbWlzc2luZyB3ZSBhc3N1bWUgc2NyZWVuIGlzIGZ1bGx5IG9uXG4gICAgICAgICAobSAmJiBtLmxlbmd0aCA+IDAgJiYgbVswXS5zcGxpdCgnPScpWzFdID09PSAndHJ1ZScpIHx8IGZhbHNlO1xufVxuXG4vKipcbiAqIEJ1aWxkcyBjb21tYW5kIGxpbmUgcmVwcmVzZW50YXRpb24gZm9yIHRoZSBnaXZlblxuICogYXBwbGljYXRpb24gc3RhcnR1cCBvcHRpb25zXG4gKlxuICogQHBhcmFtIHtTdGFydEFwcE9wdGlvbnN9IHN0YXJ0QXBwT3B0aW9ucyAtIEFwcGxpY2F0aW9uIG9wdGlvbnMgbWFwcGluZ1xuICogQHBhcmFtIHtudW1iZXJ9IGFwaUxldmVsIC0gVGhlIGFjdHVhbCBPUyBBUEkgbGV2ZWxcbiAqIEByZXR1cm5zIHtBcnJheTxTdHJpbmc+fSBUaGUgYWN0dWFsIGNvbW1hbmQgbGluZSBhcnJheVxuICovXG5mdW5jdGlvbiBidWlsZFN0YXJ0Q21kIChzdGFydEFwcE9wdGlvbnMsIGFwaUxldmVsKSB7XG4gIGxldCBjbWQgPSBbJ2FtJywgJ3N0YXJ0J107XG4gIGlmICh1dGlsLmhhc1ZhbHVlKHN0YXJ0QXBwT3B0aW9ucy51c2VyKSkge1xuICAgIGNtZC5wdXNoKCctLXVzZXInLCBzdGFydEFwcE9wdGlvbnMudXNlcik7XG4gIH1cbiAgY21kLnB1c2goJy1XJywgJy1uJywgYCR7c3RhcnRBcHBPcHRpb25zLnBrZ30vJHtzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHl9YCk7XG4gIGlmIChzdGFydEFwcE9wdGlvbnMuc3RvcEFwcCAmJiBhcGlMZXZlbCA+PSAxNSkge1xuICAgIGNtZC5wdXNoKCctUycpO1xuICB9XG4gIGlmIChzdGFydEFwcE9wdGlvbnMuYWN0aW9uKSB7XG4gICAgY21kLnB1c2goJy1hJywgc3RhcnRBcHBPcHRpb25zLmFjdGlvbik7XG4gIH1cbiAgaWYgKHN0YXJ0QXBwT3B0aW9ucy5jYXRlZ29yeSkge1xuICAgIGNtZC5wdXNoKCctYycsIHN0YXJ0QXBwT3B0aW9ucy5jYXRlZ29yeSk7XG4gIH1cbiAgaWYgKHN0YXJ0QXBwT3B0aW9ucy5mbGFncykge1xuICAgIGNtZC5wdXNoKCctZicsIHN0YXJ0QXBwT3B0aW9ucy5mbGFncyk7XG4gIH1cbiAgaWYgKHN0YXJ0QXBwT3B0aW9ucy5vcHRpb25hbEludGVudEFyZ3VtZW50cykge1xuICAgIC8vIGV4cGVjdCBvcHRpb25hbEludGVudEFyZ3VtZW50cyB0byBiZSBhIHNpbmdsZSBzdHJpbmcgb2YgdGhlIGZvcm06XG4gICAgLy8gICAgIFwiLWZsYWcga2V5XCJcbiAgICAvLyAgICAgXCItZmxhZyBrZXkgdmFsdWVcIlxuICAgIC8vIG9yIGEgY29tYmluYXRpb24gb2YgdGhlc2UgKGUuZy4sIFwiLWZsYWcxIGtleTEgLWZsYWcyIGtleTIgdmFsdWUyXCIpXG5cbiAgICAvLyB0YWtlIGEgc3RyaW5nIGFuZCBwYXJzZSBvdXQgdGhlIHBhcnQgYmVmb3JlIGFueSBzcGFjZXMsIGFuZCBhbnl0aGluZyBhZnRlclxuICAgIC8vIHRoZSBmaXJzdCBzcGFjZVxuICAgIGxldCBwYXJzZUtleVZhbHVlID0gZnVuY3Rpb24gKHN0cikge1xuICAgICAgc3RyID0gc3RyLnRyaW0oKTtcbiAgICAgIGxldCBzcGFjZSA9IHN0ci5pbmRleE9mKCcgJyk7XG4gICAgICBpZiAoc3BhY2UgPT09IC0xKSB7XG4gICAgICAgIHJldHVybiBzdHIubGVuZ3RoID8gW3N0cl0gOiBbXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBbc3RyLnN1YnN0cmluZygwLCBzcGFjZSkudHJpbSgpLCBzdHIuc3Vic3RyaW5nKHNwYWNlICsgMSkudHJpbSgpXTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gY3ljbGUgdGhyb3VnaCB0aGUgb3B0aW9uYWxJbnRlbnRBcmd1bWVudHMgYW5kIHB1bGwgb3V0IHRoZSBhcmd1bWVudHNcbiAgICAvLyBhZGQgYSBzcGFjZSBpbml0aWFsbHkgc28gZmxhZ3MgY2FuIGJlIGRpc3Rpbmd1aXNoZWQgZnJvbSBhcmd1bWVudHMgdGhhdFxuICAgIC8vIGhhdmUgaW50ZXJuYWwgaHlwaGVuc1xuICAgIGxldCBvcHRpb25hbEludGVudEFyZ3VtZW50cyA9IGAgJHtzdGFydEFwcE9wdGlvbnMub3B0aW9uYWxJbnRlbnRBcmd1bWVudHN9YDtcbiAgICBsZXQgcmUgPSAvICgtW15cXHNdKykgKC4rKS87XG4gICAgd2hpbGUgKHRydWUpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zdGFudC1jb25kaXRpb25cbiAgICAgIGxldCBhcmdzID0gcmUuZXhlYyhvcHRpb25hbEludGVudEFyZ3VtZW50cyk7XG4gICAgICBpZiAoIWFyZ3MpIHtcbiAgICAgICAgaWYgKG9wdGlvbmFsSW50ZW50QXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgIC8vIG5vIG1vcmUgZmxhZ3MsIHNvIHRoZSByZW1haW5kZXIgY2FuIGJlIHRyZWF0ZWQgYXMgJ2tleScgb3IgJ2tleSB2YWx1ZSdcbiAgICAgICAgICBjbWQucHVzaC5hcHBseShjbWQsIHBhcnNlS2V5VmFsdWUob3B0aW9uYWxJbnRlbnRBcmd1bWVudHMpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB3ZSBhcmUgZG9uZVxuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgLy8gdGFrZSB0aGUgZmxhZyBhbmQgc2VlIGlmIGl0IGlzIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHN0cmluZ1xuICAgICAgLy8gaWYgaXQgaXMgbm90LCB0aGVuIGl0IG1lYW5zIHdlIGhhdmUgYmVlbiB0aHJvdWdoIGFscmVhZHksIGFuZFxuICAgICAgLy8gd2hhdCBpcyBiZWZvcmUgdGhlIGZsYWcgaXMgdGhlIGFyZ3VtZW50IGZvciB0aGUgcHJldmlvdXMgZmxhZ1xuICAgICAgbGV0IGZsYWcgPSBhcmdzWzFdO1xuICAgICAgbGV0IGZsYWdQb3MgPSBvcHRpb25hbEludGVudEFyZ3VtZW50cy5pbmRleE9mKGZsYWcpO1xuICAgICAgaWYgKGZsYWdQb3MgIT09IDApIHtcbiAgICAgICAgbGV0IHByZXZBcmdzID0gb3B0aW9uYWxJbnRlbnRBcmd1bWVudHMuc3Vic3RyaW5nKDAsIGZsYWdQb3MpO1xuICAgICAgICBjbWQucHVzaC5hcHBseShjbWQsIHBhcnNlS2V5VmFsdWUocHJldkFyZ3MpKTtcbiAgICAgIH1cblxuICAgICAgLy8gYWRkIHRoZSBmbGFnLCBhcyB0aGVyZSBhcmUgbm8gbW9yZSBlYXJsaWVyIGFyZ3VtZW50c1xuICAgICAgY21kLnB1c2goZmxhZyk7XG5cbiAgICAgIC8vIG1ha2Ugb3B0aW9uYWxJbnRlbnRBcmd1bWVudHMgaG9sZCB0aGUgcmVtYWluZGVyXG4gICAgICBvcHRpb25hbEludGVudEFyZ3VtZW50cyA9IGFyZ3NbMl07XG4gICAgfVxuICB9XG4gIHJldHVybiBjbWQ7XG59XG5cbmNvbnN0IGdldFNka1Rvb2xzVmVyc2lvbiA9IF8ubWVtb2l6ZShhc3luYyBmdW5jdGlvbiBnZXRTZGtUb29sc1ZlcnNpb24gKCkge1xuICBjb25zdCBhbmRyb2lkSG9tZSA9IHByb2Nlc3MuZW52LkFORFJPSURfSE9NRTtcbiAgaWYgKCFhbmRyb2lkSG9tZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQU5EUk9JRF9IT01FIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIGV4cGVjdGVkIHRvIGJlIHNldCcpO1xuICB9XG4gIGNvbnN0IHByb3BlcnRpZXNQYXRoID0gcGF0aC5yZXNvbHZlKGFuZHJvaWRIb21lLCAndG9vbHMnLCAnc291cmNlLnByb3BlcnRpZXMnKTtcbiAgaWYgKCFhd2FpdCBmcy5leGlzdHMocHJvcGVydGllc1BhdGgpKSB7XG4gICAgbG9nLndhcm4oYENhbm5vdCBmaW5kICR7cHJvcGVydGllc1BhdGh9IGZpbGUgdG8gcmVhZCBTREsgdmVyc2lvbiBmcm9tYCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHByb3BlcnRpZXNDb250ZW50ID0gYXdhaXQgZnMucmVhZEZpbGUocHJvcGVydGllc1BhdGgsICd1dGY4Jyk7XG4gIGNvbnN0IHZlcnNpb25NYXRjaGVyID0gbmV3IFJlZ0V4cCgvUGtnXFwuUmV2aXNpb249KFxcZCspXFwuPyhcXGQrKT9cXC4/KFxcZCspPy8pO1xuICBjb25zdCBtYXRjaCA9IHZlcnNpb25NYXRjaGVyLmV4ZWMocHJvcGVydGllc0NvbnRlbnQpO1xuICBpZiAobWF0Y2gpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbWFqb3I6IHBhcnNlSW50KG1hdGNoWzFdLCAxMCksXG4gICAgICBtaW5vcjogbWF0Y2hbMl0gPyBwYXJzZUludChtYXRjaFsyXSwgMTApIDogMCxcbiAgICAgIGJ1aWxkOiBtYXRjaFszXSA/IHBhcnNlSW50KG1hdGNoWzNdLCAxMCkgOiAwXG4gICAgfTtcbiAgfVxuICBsb2cud2FybihgQ2Fubm90IHBhcnNlIFwiUGtnLlJldmlzaW9uXCIgdmFsdWUgZnJvbSAke3Byb3BlcnRpZXNQYXRofWApO1xufSk7XG5cbi8qKlxuICogUmV0cmlldmVzIGZ1bGwgcGF0aHMgdG8gYWxsICdidWlsZC10b29scycgc3ViZm9sZGVycyB1bmRlciB0aGUgcGFydGljdWxhclxuICogU0RLIHJvb3QgZm9sZGVyXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHNka1Jvb3QgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBBbmRyb2lkIFNESyByb290IGZvbGRlclxuICogQHJldHVybnMge0FycmF5PHN0cmluZz59IFRoZSBmdWxsIHBhdGhzIHRvIHRoZSByZXN1bHRpbmcgZm9sZGVycyBzb3J0ZWQgYnlcbiAqIG1vZGlmaWNhdGlvbiBkYXRlICh0aGUgbmV3ZXN0IGNvbWVzIGZpcnN0KSBvciBhbiBlbXB0eSBsaXN0IGlmIG5vIG1hY3RoZXMgd2VyZSBmb3VuZFxuICovXG5jb25zdCBnZXRCdWlsZFRvb2xzRGlycyA9IF8ubWVtb2l6ZShhc3luYyBmdW5jdGlvbiBnZXRCdWlsZFRvb2xzRGlycyAoc2RrUm9vdCkge1xuICBsZXQgYnVpbGRUb29sc0RpcnMgPSBhd2FpdCBmcy5nbG9iKHBhdGgucmVzb2x2ZShzZGtSb290LCAnYnVpbGQtdG9vbHMnLCAnKicpLCB7YWJzb2x1dGU6IHRydWV9KTtcbiAgdHJ5IHtcbiAgICBidWlsZFRvb2xzRGlycyA9IGJ1aWxkVG9vbHNEaXJzXG4gICAgICAubWFwKChkaXIpID0+IFtwYXRoLmJhc2VuYW1lKGRpciksIGRpcl0pXG4gICAgICAuc29ydCgoYSwgYikgPT4gc2VtdmVyLnJjb21wYXJlKGFbMF0sIGJbMF0pKVxuICAgICAgLm1hcCgocGFpcikgPT4gcGFpclsxXSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy53YXJuKGBDYW5ub3Qgc29ydCBidWlsZC10b29scyBmb2xkZXJzICR7SlNPTi5zdHJpbmdpZnkoYnVpbGRUb29sc0RpcnMubWFwKChkaXIpID0+IHBhdGguYmFzZW5hbWUoZGlyKSkpfSBgICtcbiAgICAgICAgICAgICBgYnkgc2VtYW50aWMgdmVyc2lvbiBuYW1lcy5gKTtcbiAgICBsb2cud2FybihgRmFsbGluZyBiYWNrIHRvIHNvcnRpbmcgYnkgbW9kaWZpY2F0aW9uIGRhdGUuIE9yaWdpbmFsIGVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIGNvbnN0IHBhaXJzID0gYXdhaXQgQi5tYXAoYnVpbGRUb29sc0RpcnMsIGFzeW5jIChkaXIpID0+IFsoYXdhaXQgZnMuc3RhdChkaXIpKS5tdGltZS52YWx1ZU9mKCksIGRpcl0pO1xuICAgIGJ1aWxkVG9vbHNEaXJzID0gcGFpcnNcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBhWzBdIDwgYlswXSlcbiAgICAgIC5tYXAoKHBhaXIpID0+IHBhaXJbMV0pO1xuICB9XG4gIGxvZy5pbmZvKGBGb3VuZCAke2J1aWxkVG9vbHNEaXJzLmxlbmd0aH0gJ2J1aWxkLXRvb2xzJyBmb2xkZXJzIHVuZGVyICcke3Nka1Jvb3R9JyAobmV3ZXN0IGZpcnN0KTpgKTtcbiAgZm9yIChsZXQgZGlyIG9mIGJ1aWxkVG9vbHNEaXJzKSB7XG4gICAgbG9nLmluZm8oYCAgICAke2Rpcn1gKTtcbiAgfVxuICByZXR1cm4gYnVpbGRUb29sc0RpcnM7XG59KTtcblxuLyoqXG4gKiBSZXRyaWV2ZXMgdGhlIGxpc3Qgb2YgcGVybWlzc2lvbiBuYW1lcyBlbmNvZGVkIGluIGBkdW1wc3lzIHBhY2thZ2VgIGNvbW1hbmQgb3V0cHV0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBkdW1wc3lzT3V0cHV0IC0gVGhlIGFjdHVhbCBjb21tYW5kIG91dHB1dC5cbiAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gZ3JvdXBOYW1lcyAtIFRoZSBsaXN0IG9mIGdyb3VwIG5hbWVzIHRvIGxpc3QgcGVybWlzc2lvbnMgZm9yLlxuICogQHBhcmFtIHs/Ym9vbGVhbn0gZ3JhbnRlZFN0YXRlIC0gVGhlIGV4cGVjdGVkIHN0YXRlIG9mIGBncmFudGVkYCBhdHRyaWJ1dGUgdG8gZmlsdGVyIHdpdGguXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBObyBmaWx0ZXJpbmcgaXMgZG9uZSBpZiB0aGUgcGFyYW1ldGVyIGlzIG5vdCBzZXQuXG4gKiBAcmV0dXJucyB7QXJyYXk8c3RyaW5nPn0gVGhlIGxpc3Qgb2YgbWF0Y2hlZCBwZXJtaXNzaW9uIG5hbWVzIG9yIGFuIGVtcHR5IGxpc3QgaWYgbm8gbWF0Y2hlcyB3ZXJlIGZvdW5kLlxuICovXG5jb25zdCBleHRyYWN0TWF0Y2hpbmdQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uIChkdW1wc3lzT3V0cHV0LCBncm91cE5hbWVzLCBncmFudGVkU3RhdGUgPSBudWxsKSB7XG4gIGNvbnN0IGdyb3VwUGF0dGVybkJ5TmFtZSA9IChncm91cE5hbWUpID0+IG5ldyBSZWdFeHAoYF4oXFxcXHMqJHtfLmVzY2FwZVJlZ0V4cChncm91cE5hbWUpfSBwZXJtaXNzaW9uczpbXFxcXHNcXFxcU10rKWAsICdtJyk7XG4gIGNvbnN0IGluZGVudFBhdHRlcm4gPSAvXFxTfCQvO1xuICBjb25zdCBwZXJtaXNzaW9uTmFtZVBhdHRlcm4gPSAvYW5kcm9pZFxcLnBlcm1pc3Npb25cXC5cXHcrLztcbiAgY29uc3QgZ3JhbnRlZFN0YXRlUGF0dGVybiA9IC9cXGJncmFudGVkPShcXHcrKS87XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKGNvbnN0IGdyb3VwTmFtZSBvZiBncm91cE5hbWVzKSB7XG4gICAgY29uc3QgZ3JvdXBNYXRjaCA9IGdyb3VwUGF0dGVybkJ5TmFtZShncm91cE5hbWUpLmV4ZWMoZHVtcHN5c091dHB1dCk7XG4gICAgaWYgKCFncm91cE1hdGNoKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBsaW5lcyA9IGdyb3VwTWF0Y2hbMV0uc3BsaXQoJ1xcbicpO1xuICAgIGlmIChsaW5lcy5sZW5ndGggPCAyKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCB0aXRsZUluZGVudCA9IGxpbmVzWzBdLnNlYXJjaChpbmRlbnRQYXR0ZXJuKTtcbiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMuc2xpY2UoMSkpIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRJbmRlbnQgPSBsaW5lLnNlYXJjaChpbmRlbnRQYXR0ZXJuKTtcbiAgICAgIGlmIChjdXJyZW50SW5kZW50IDw9IHRpdGxlSW5kZW50KSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBwZXJtaXNzaW9uTmFtZU1hdGNoID0gcGVybWlzc2lvbk5hbWVQYXR0ZXJuLmV4ZWMobGluZSk7XG4gICAgICBpZiAoIXBlcm1pc3Npb25OYW1lTWF0Y2gpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCBpdGVtID0ge1xuICAgICAgICBwZXJtaXNzaW9uOiBwZXJtaXNzaW9uTmFtZU1hdGNoWzBdLFxuICAgICAgfTtcbiAgICAgIGNvbnN0IGdyYW50ZWRTdGF0ZU1hdGNoID0gZ3JhbnRlZFN0YXRlUGF0dGVybi5leGVjKGxpbmUpO1xuICAgICAgaWYgKGdyYW50ZWRTdGF0ZU1hdGNoKSB7XG4gICAgICAgIGl0ZW0uZ3JhbnRlZCA9IGdyYW50ZWRTdGF0ZU1hdGNoWzFdID09PSAndHJ1ZSc7XG4gICAgICB9XG4gICAgICByZXN1bHQucHVzaChpdGVtKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBmaWx0ZXJlZFJlc3VsdCA9IHJlc3VsdFxuICAgIC5maWx0ZXIoKGl0ZW0pID0+ICFfLmlzQm9vbGVhbihncmFudGVkU3RhdGUpIHx8IGl0ZW0uZ3JhbnRlZCA9PT0gZ3JhbnRlZFN0YXRlKVxuICAgIC5tYXAoKGl0ZW0pID0+IGl0ZW0ucGVybWlzc2lvbik7XG4gIGxvZy5kZWJ1ZyhgUmV0cmlldmVkICR7ZmlsdGVyZWRSZXN1bHQubGVuZ3RofSBwZXJtaXNzaW9uKHMpIGZyb20gJHtKU09OLnN0cmluZ2lmeShncm91cE5hbWVzKX0gZ3JvdXAocylgKTtcbiAgcmV0dXJuIGZpbHRlcmVkUmVzdWx0O1xufTtcblxuZXhwb3J0IHtcbiAgZ2V0QW5kcm9pZFBsYXRmb3JtQW5kUGF0aCwgdW56aXBGaWxlLCBhc3NlcnRaaXBBcmNoaXZlLFxuICBnZXRJTUVMaXN0RnJvbU91dHB1dCwgZ2V0SmF2YUZvck9zLCBpc1Nob3dpbmdMb2Nrc2NyZWVuLCBpc0N1cnJlbnRGb2N1c09uS2V5Z3VhcmQsXG4gIGdldFN1cmZhY2VPcmllbnRhdGlvbiwgaXNTY3JlZW5PbkZ1bGx5LCBidWlsZFN0YXJ0Q21kLCBnZXRKYXZhSG9tZSxcbiAgcm9vdERpciwgZ2V0U2RrVG9vbHNWZXJzaW9uLCBnZXRBcGtzaWduZXJGb3JPcywgZ2V0QnVpbGRUb29sc0RpcnMsXG4gIGdldEFwa2FuYWx5emVyRm9yT3MsIGdldE9wZW5Tc2xGb3JPcywgZXh0cmFjdE1hdGNoaW5nUGVybWlzc2lvbnMsXG59O1xuIl0sImZpbGUiOiJsaWIvaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
