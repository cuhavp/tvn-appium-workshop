"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.AndroidDriver = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _appiumBaseDriver = require("appium-base-driver");

var _desiredCaps = _interopRequireDefault(require("./desired-caps"));

var _index = _interopRequireDefault(require("./commands/index"));

var _androidHelpers = _interopRequireDefault(require("./android-helpers"));

var _logger = _interopRequireDefault(require("./logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumAdb = require("appium-adb");

var _appiumSupport = require("appium-support");

var _asyncbox = require("asyncbox");

var _sharedPreferencesBuilder = require("shared-preferences-builder");

var _bluebird = _interopRequireDefault(require("bluebird"));

const APP_EXTENSION = '.apk';
const DEVICE_PORT = 4724;
const NO_PROXY = [['POST', new RegExp('^/session/[^/]+/context')], ['GET', new RegExp('^/session/[^/]+/context')], ['POST', new RegExp('^/session/[^/]+/appium')], ['GET', new RegExp('^/session/[^/]+/appium')], ['POST', new RegExp('^/session/[^/]+/touch/perform')], ['POST', new RegExp('^/session/[^/]+/touch/multi/perform')], ['POST', new RegExp('^/session/[^/]+/orientation')], ['GET', new RegExp('^/session/[^/]+/orientation')]];

class AndroidDriver extends _appiumBaseDriver.BaseDriver {
  constructor(opts = {}, shouldValidateCaps = true) {
    super(opts, shouldValidateCaps);
    this.locatorStrategies = ['xpath', 'id', 'class name', 'accessibility id', '-android uiautomator'];
    this.desiredCapConstraints = _desiredCaps.default;
    this.sessionChromedrivers = {};
    this.jwpProxyActive = false;
    this.jwpProxyAvoid = _lodash.default.clone(NO_PROXY);
    this.settings = new _appiumBaseDriver.DeviceSettings({
      ignoreUnimportantViews: false
    }, this.onSettingsUpdate.bind(this));
    this.chromedriver = null;
    this.apkStrings = {};
    this.bootstrapPort = opts.bootstrapPort || DEVICE_PORT;
    this.unlocker = _androidHelpers.default.unlocker;
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = _lodash.default.toPairs(_index.default)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        let _step$value = (0, _slicedToArray2.default)(_step.value, 2),
            cmd = _step$value[0],
            fn = _step$value[1];

        AndroidDriver.prototype[cmd] = fn;
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }
  }

  createSession(...args) {
    var _this = this,
        _superprop_callCreateSession = (..._args) => super.createSession(..._args);

    return (0, _asyncToGenerator2.default)(function* () {
      try {
        let _ref = yield _superprop_callCreateSession(...args),
            _ref2 = (0, _slicedToArray2.default)(_ref, 2),
            sessionId = _ref2[0],
            caps = _ref2[1];

        let serverDetails = {
          platform: 'LINUX',
          webStorageEnabled: false,
          takesScreenshot: true,
          javascriptEnabled: true,
          databaseEnabled: false,
          networkConnectionEnabled: true,
          locationContextEnabled: false,
          warnings: {},
          desired: _this.caps
        };
        _this.caps = Object.assign(serverDetails, _this.caps);
        let defaultOpts = {
          action: "android.intent.action.MAIN",
          category: "android.intent.category.LAUNCHER",
          flags: "0x10200000",
          disableAndroidWatchers: false,
          tmpDir: yield _appiumSupport.tempDir.staticDir(),
          fullReset: false,
          autoLaunch: true,
          adbPort: _appiumAdb.DEFAULT_ADB_PORT,
          androidInstallTimeout: 90000
        };

        _lodash.default.defaults(_this.opts, defaultOpts);

        if (!_this.opts.javaVersion) {
          _this.opts.javaVersion = yield _androidHelpers.default.getJavaVersion();
        }

        _this.useUnlockHelperApp = _lodash.default.isUndefined(_this.caps.unlockType);

        if (_this.opts.noReset === true) {
          _this.opts.fullReset = false;
        }

        if (_this.opts.fullReset === true) {
          _this.opts.noReset = false;
        }

        _this.opts.fastReset = !_this.opts.fullReset && !_this.opts.noReset;
        _this.opts.skipUninstall = _this.opts.fastReset || _this.opts.noReset;
        _this.curContext = _this.defaultContextName();

        if (_this.isChromeSession) {
          _logger.default.info("We're going to run a Chrome-based session");

          let _helpers$getChromePkg = _androidHelpers.default.getChromePkg(_this.opts.browserName),
              pkg = _helpers$getChromePkg.pkg,
              activity = _helpers$getChromePkg.activity;

          _this.opts.appPackage = pkg;
          _this.opts.appActivity = activity;

          _logger.default.info(`Chrome-type package and activity are ${pkg} and ${activity}`);
        }

        if (_this.opts.nativeWebScreenshot) {
          _this.jwpProxyAvoid.push(['GET', new RegExp('^/session/[^/]+/screenshot')]);
        }

        if (_this.opts.reboot) {
          _this.setAvdFromCapabilities(caps);
        }

        let _ref3 = yield _androidHelpers.default.getDeviceInfoFromCaps(_this.opts),
            udid = _ref3.udid,
            emPort = _ref3.emPort;

        _this.opts.udid = udid;
        _this.opts.emPort = emPort;
        _this.adb = yield _androidHelpers.default.createADB({
          javaVersion: _this.opts.javaVersion,
          udid: _this.opts.udid,
          emPort: _this.opts.emPort,
          adbPort: _this.opts.adbPort,
          suppressKillServer: _this.opts.suppressKillServer,
          remoteAdbHost: _this.opts.remoteAdbHost,
          clearDeviceLogsOnStart: _this.opts.clearDeviceLogsOnStart,
          adbExecTimeout: _this.opts.adbExecTimeout
        });

        if ((yield _this.adb.getApiLevel()) >= 23) {
          _logger.default.warn("Consider setting 'automationName' capability to " + "'uiautomator2' on Android >= 6, since UIAutomator framework " + "is not maintained anymore by the OS vendor.");
        }

        if (_this.helpers.isPackageOrBundle(_this.opts.app)) {
          _this.opts.appPackage = _this.opts.app;
          _this.opts.app = null;
        }

        if (_this.opts.app) {
          _this.opts.app = yield _this.helpers.configureApp(_this.opts.app, APP_EXTENSION);
          _this.opts.appIsTemp = caps.app !== _this.opts.app;
          yield _this.checkAppPresent();
        } else if (_this.appOnDevice) {
          _logger.default.info(`App file was not listed, instead we're going to run ` + `${_this.opts.appPackage} directly on the device`);

          yield _this.checkPackagePresent();
        }

        if (_appiumSupport.util.hasValue(_this.opts.networkSpeed)) {
          if (!_this.isEmulator()) {
            _logger.default.warn("Sorry, networkSpeed capability is only available for emulators");
          } else {
            let networkSpeed = _androidHelpers.default.ensureNetworkSpeed(_this.adb, _this.opts.networkSpeed);

            yield _this.adb.networkSpeed(networkSpeed);
          }
        }

        if (_appiumSupport.util.hasValue(_this.opts.gpsEnabled)) {
          if (_this.isEmulator()) {
            _logger.default.info(`Trying to ${_this.opts.gpsEnabled ? "enable" : "disable"} gps location provider`);

            yield _this.adb.toggleGPSLocationProvider(_this.opts.gpsEnabled);
          } else {
            _logger.default.warn('Sorry! gpsEnabled capability is only available for emulators');
          }
        }

        yield _this.startAndroidSession(_this.opts);
        return [sessionId, _this.caps];
      } catch (e) {
        try {
          yield _this.deleteSession();
        } catch (ign) {}

        throw e;
      }
    })();
  }

  isEmulator() {
    return !!(this.opts.avd || /emulator/.test(this.opts.udid));
  }

  setAvdFromCapabilities(caps) {
    if (this.opts.avd) {
      _logger.default.info('avd name defined, ignoring device name and platform version');
    } else {
      if (!caps.deviceName) {
        _logger.default.errorAndThrow('avd or deviceName should be specified when reboot option is enables');
      }

      if (!caps.platformVersion) {
        _logger.default.errorAndThrow('avd or platformVersion should be specified when reboot option is enabled');
      }

      let avdDevice = caps.deviceName.replace(/[^a-zA-Z0-9_.]/g, "-");
      this.opts.avd = `${avdDevice}__${caps.platformVersion}`;
    }
  }

  get appOnDevice() {
    return this.helpers.isPackageOrBundle(this.opts.app) || !this.opts.app && this.helpers.isPackageOrBundle(this.opts.appPackage);
  }

  get isChromeSession() {
    return _androidHelpers.default.isChromeBrowser(this.opts.browserName);
  }

  onSettingsUpdate(key, value) {
    var _this2 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (key === "ignoreUnimportantViews") {
        yield _this2.setCompressedLayoutHierarchy(value);
      }
    })();
  }

  startAndroidSession() {
    var _this3 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.info(`Starting Android session`);

      _this3.defaultIME = yield _androidHelpers.default.initDevice(_this3.adb, _this3.opts);
      _this3.caps.deviceName = _this3.adb.curDeviceId;
      _this3.caps.deviceUDID = _this3.opts.udid;
      _this3.caps.platformVersion = yield _this3.adb.getPlatformVersion();
      _this3.caps.deviceScreenSize = yield _this3.adb.getScreenSize();
      _this3.caps.deviceModel = yield _this3.adb.getModel();
      _this3.caps.deviceManufacturer = yield _this3.adb.getManufacturer();

      if (_this3.opts.autoLaunch) {
        yield _this3.initAUT();
      }

      if (_this3.opts.disableWindowAnimation) {
        if (yield _this3.adb.isAnimationOn()) {
          _logger.default.info('Disabling window animation as it is requested by "disableWindowAnimation" capability');

          yield _this3.adb.setAnimationState(false);
          _this3._wasWindowAnimationDisabled = true;
        } else {
          _logger.default.info('Window animation is already disabled');
        }
      }

      _this3.bootstrap = new _androidHelpers.default.bootstrap(_this3.adb, _this3.bootstrapPort, _this3.opts.websocket);
      yield _this3.bootstrap.start(_this3.opts.appPackage, _this3.opts.disableAndroidWatchers, _this3.opts.acceptSslCerts);

      _this3.bootstrap.onUnexpectedShutdown.catch(function () {
        var _ref4 = (0, _asyncToGenerator2.default)(function* (err) {
          if (!_this3.bootstrap.ignoreUnexpectedShutdown) {
            yield _this3.startUnexpectedShutdown(err);
          }
        });

        return function (_x) {
          return _ref4.apply(this, arguments);
        };
      }());

      if (!_this3.opts.skipUnlock) {
        yield _androidHelpers.default.unlock(_this3, _this3.adb, _this3.caps);
      }

      if (_this3.opts.ignoreUnimportantViews) {
        yield _this3.settings.update({
          ignoreUnimportantViews: _this3.opts.ignoreUnimportantViews
        });
      }

      if (_this3.isChromeSession) {
        yield _this3.startChromeSession();
      } else {
        if (_this3.opts.autoLaunch) {
          yield _this3.startAUT();
        }
      }

      if (_appiumSupport.util.hasValue(_this3.opts.orientation)) {
        _logger.default.debug(`Setting initial orientation to '${_this3.opts.orientation}'`);

        yield _this3.setOrientation(_this3.opts.orientation);
      }

      yield _this3.initAutoWebview();
    })();
  }

  initAutoWebview() {
    var _this4 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      if (_this4.opts.autoWebview) {
        let viewName = _this4.defaultWebviewName();

        let timeout = _this4.opts.autoWebviewTimeout || 2000;

        _logger.default.info(`Setting auto webview to context '${viewName}' with timeout ${timeout}ms`);

        yield (0, _asyncbox.retryInterval)(timeout / 500, 500, (0, _asyncToGenerator2.default)(function* () {
          yield _this4.setContext(viewName);
        }));
      }
    })();
  }

  initAUT() {
    var _this5 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let launchInfo = yield _androidHelpers.default.getLaunchInfo(_this5.adb, _this5.opts);
      Object.assign(_this5.opts, launchInfo);
      Object.assign(_this5.caps, launchInfo);

      if (_this5.opts.otherApps) {
        let otherApps;

        try {
          otherApps = _androidHelpers.default.parseArray(_this5.opts.otherApps);
        } catch (e) {
          _logger.default.errorAndThrow(`Could not parse "otherApps" capability: ${e.message}`);
        }

        otherApps = yield _bluebird.default.all(otherApps.map(app => _this5.helpers.configureApp(app, APP_EXTENSION)));
        yield _androidHelpers.default.installOtherApks(otherApps, _this5.adb, _this5.opts);
      }

      if (!_this5.opts.app) {
        if (_this5.opts.fullReset) {
          _logger.default.errorAndThrow('Full reset requires an app capability, use fastReset if app is not provided');
        }

        _logger.default.debug('No app capability. Assuming it is already on the device');

        if (_this5.opts.fastReset) {
          yield _androidHelpers.default.resetApp(_this5.adb, _this5.opts);
        }

        return;
      }

      if (!_this5.opts.skipUninstall) {
        yield _this5.adb.uninstallApk(_this5.opts.appPackage);
      }

      yield _androidHelpers.default.installApk(_this5.adb, _this5.opts);
      _this5.apkStrings[_this5.opts.language] = yield _androidHelpers.default.pushStrings(_this5.opts.language, _this5.adb, _this5.opts);

      if (!_lodash.default.isUndefined(_this5.opts.sharedPreferences)) {
        yield _this5.setSharedPreferences(_this5.opts);
      }
    })();
  }

  checkAppPresent() {
    var _this6 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug("Checking whether app is actually present");

      if (!(yield _appiumSupport.fs.exists(_this6.opts.app))) {
        _logger.default.errorAndThrow(`Could not find app apk at ${_this6.opts.app}`);
      }
    })();
  }

  checkPackagePresent() {
    var _this7 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug("Checking whether package is present on the device");

      if (!(yield _this7.adb.shell(['pm', 'list', 'packages', _this7.opts.appPackage]))) {
        _logger.default.errorAndThrow(`Could not find package ${_this7.opts.appPackage} on the device`);
      }
    })();
  }

  setCompressedLayoutHierarchy(compress) {
    var _this8 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this8.bootstrap.sendAction("compressedLayoutHierarchy", {
        compressLayout: compress
      });
    })();
  }

  deleteSession() {
    var _this9 = this,
        _superprop_callDeleteSession = (..._args2) => super.deleteSession(..._args2);

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.debug("Shutting down Android driver");

      yield _androidHelpers.default.removeAllSessionWebSocketHandlers(_this9.server, _this9.sessionId);
      yield _superprop_callDeleteSession();

      if (_this9.bootstrap) {
        yield _this9.stopChromedriverProxies();

        if (_this9.opts.unicodeKeyboard && _this9.opts.resetKeyboard && _this9.defaultIME) {
          _logger.default.debug(`Resetting IME to ${_this9.defaultIME}`);

          yield _this9.adb.setIME(_this9.defaultIME);
        }

        if (!_this9.isChromeSession) {
          yield _this9.adb.forceStop(_this9.opts.appPackage);
        }

        yield _this9.adb.goToHome();

        if (_this9.opts.fullReset && !_this9.opts.skipUninstall && !_this9.appOnDevice) {
          yield _this9.adb.uninstallApk(_this9.opts.appPackage);
        }

        yield _this9.bootstrap.shutdown();
        _this9.bootstrap = null;
      } else {
        _logger.default.debug("Called deleteSession but bootstrap wasn't active");
      }

      yield _this9.adb.stopLogcat();

      if (_this9.useUnlockHelperApp) {
        yield _this9.adb.forceStop('io.appium.unlock');
      }

      if (_this9._wasWindowAnimationDisabled) {
        _logger.default.info('Restoring window animation state');

        yield _this9.adb.setAnimationState(true);
      }

      if (_this9.opts.reboot) {
        let avdName = _this9.opts.avd.replace('@', '');

        _logger.default.debug(`closing emulator '${avdName}'`);

        yield _this9.adb.killEmulator(avdName);
      }

      if (_this9.opts.clearSystemFiles) {
        if (_this9.opts.appIsTemp) {
          _logger.default.debug(`Temporary copy of app was made: deleting '${_this9.opts.app}'`);

          try {
            yield _appiumSupport.fs.rimraf(_this9.opts.app);
          } catch (err) {
            _logger.default.warn(`Unable to delete temporary app: ${err.message}`);
          }
        } else {
          _logger.default.debug('App was not copied, so not deleting');
        }
      } else {
        _logger.default.debug('Not cleaning generated files. Add `clearSystemFiles` capability if wanted.');
      }
    })();
  }

  setSharedPreferences() {
    var _this10 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      let sharedPrefs = _this10.opts.sharedPreferences;

      _logger.default.info("Trying to set shared preferences");

      let name = sharedPrefs.name;

      if (_lodash.default.isUndefined(name)) {
        _logger.default.warn(`Skipping setting Shared preferences, name is undefined: ${JSON.stringify(sharedPrefs)}`);

        return false;
      }

      let remotePath = `/data/data/${_this10.opts.appPackage}/shared_prefs`;
      let remoteFile = `${remotePath}/${name}.xml`;
      let localPath = `/tmp/${name}.xml`;

      let builder = _this10.getPrefsBuilder();

      builder.build(sharedPrefs.prefs);

      _logger.default.info(`Creating temporary shared preferences: ${localPath}`);

      builder.toFile(localPath);

      _logger.default.info(`Creating shared_prefs remote folder: ${remotePath}`);

      yield _this10.adb.shell(['mkdir', '-p', remotePath]);

      _logger.default.info(`Pushing shared_prefs to ${remoteFile}`);

      yield _this10.adb.push(localPath, remoteFile);

      try {
        _logger.default.info(`Trying to remove shared preferences temporary file`);

        if (yield _appiumSupport.fs.exists(localPath)) {
          yield _appiumSupport.fs.unlink(localPath);
        }
      } catch (e) {
        _logger.default.warn(`Error trying to remove temporary file ${localPath}`);
      }

      return true;
    })();
  }

  getPrefsBuilder() {
    return new _sharedPreferencesBuilder.SharedPrefsBuilder();
  }

  validateDesiredCaps(caps) {
    if (!super.validateDesiredCaps(caps)) {
      return false;
    }

    return _androidHelpers.default.validateDesiredCaps(caps);
  }

  proxyActive(sessionId) {
    super.proxyActive(sessionId);
    return this.jwpProxyActive;
  }

  getProxyAvoidList(sessionId) {
    super.getProxyAvoidList(sessionId);
    return this.jwpProxyAvoid;
  }

  canProxy(sessionId) {
    super.canProxy(sessionId);
    return _lodash.default.isFunction(this.proxyReqRes);
  }

}

exports.AndroidDriver = AndroidDriver;
var _default = AndroidDriver;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kcml2ZXIuanMiXSwibmFtZXMiOlsiQVBQX0VYVEVOU0lPTiIsIkRFVklDRV9QT1JUIiwiTk9fUFJPWFkiLCJSZWdFeHAiLCJBbmRyb2lkRHJpdmVyIiwiQmFzZURyaXZlciIsImNvbnN0cnVjdG9yIiwib3B0cyIsInNob3VsZFZhbGlkYXRlQ2FwcyIsImxvY2F0b3JTdHJhdGVnaWVzIiwiZGVzaXJlZENhcENvbnN0cmFpbnRzIiwiZGVzaXJlZENvbnN0cmFpbnRzIiwic2Vzc2lvbkNocm9tZWRyaXZlcnMiLCJqd3BQcm94eUFjdGl2ZSIsImp3cFByb3h5QXZvaWQiLCJfIiwiY2xvbmUiLCJzZXR0aW5ncyIsIkRldmljZVNldHRpbmdzIiwiaWdub3JlVW5pbXBvcnRhbnRWaWV3cyIsIm9uU2V0dGluZ3NVcGRhdGUiLCJiaW5kIiwiY2hyb21lZHJpdmVyIiwiYXBrU3RyaW5ncyIsImJvb3RzdHJhcFBvcnQiLCJ1bmxvY2tlciIsImhlbHBlcnMiLCJ0b1BhaXJzIiwiY29tbWFuZHMiLCJjbWQiLCJmbiIsInByb3RvdHlwZSIsImNyZWF0ZVNlc3Npb24iLCJhcmdzIiwic2Vzc2lvbklkIiwiY2FwcyIsInNlcnZlckRldGFpbHMiLCJwbGF0Zm9ybSIsIndlYlN0b3JhZ2VFbmFibGVkIiwidGFrZXNTY3JlZW5zaG90IiwiamF2YXNjcmlwdEVuYWJsZWQiLCJkYXRhYmFzZUVuYWJsZWQiLCJuZXR3b3JrQ29ubmVjdGlvbkVuYWJsZWQiLCJsb2NhdGlvbkNvbnRleHRFbmFibGVkIiwid2FybmluZ3MiLCJkZXNpcmVkIiwiT2JqZWN0IiwiYXNzaWduIiwiZGVmYXVsdE9wdHMiLCJhY3Rpb24iLCJjYXRlZ29yeSIsImZsYWdzIiwiZGlzYWJsZUFuZHJvaWRXYXRjaGVycyIsInRtcERpciIsInRlbXBEaXIiLCJzdGF0aWNEaXIiLCJmdWxsUmVzZXQiLCJhdXRvTGF1bmNoIiwiYWRiUG9ydCIsIkRFRkFVTFRfQURCX1BPUlQiLCJhbmRyb2lkSW5zdGFsbFRpbWVvdXQiLCJkZWZhdWx0cyIsImphdmFWZXJzaW9uIiwiZ2V0SmF2YVZlcnNpb24iLCJ1c2VVbmxvY2tIZWxwZXJBcHAiLCJpc1VuZGVmaW5lZCIsInVubG9ja1R5cGUiLCJub1Jlc2V0IiwiZmFzdFJlc2V0Iiwic2tpcFVuaW5zdGFsbCIsImN1ckNvbnRleHQiLCJkZWZhdWx0Q29udGV4dE5hbWUiLCJpc0Nocm9tZVNlc3Npb24iLCJsb2ciLCJpbmZvIiwiZ2V0Q2hyb21lUGtnIiwiYnJvd3Nlck5hbWUiLCJwa2ciLCJhY3Rpdml0eSIsImFwcFBhY2thZ2UiLCJhcHBBY3Rpdml0eSIsIm5hdGl2ZVdlYlNjcmVlbnNob3QiLCJwdXNoIiwicmVib290Iiwic2V0QXZkRnJvbUNhcGFiaWxpdGllcyIsImdldERldmljZUluZm9Gcm9tQ2FwcyIsInVkaWQiLCJlbVBvcnQiLCJhZGIiLCJjcmVhdGVBREIiLCJzdXBwcmVzc0tpbGxTZXJ2ZXIiLCJyZW1vdGVBZGJIb3N0IiwiY2xlYXJEZXZpY2VMb2dzT25TdGFydCIsImFkYkV4ZWNUaW1lb3V0IiwiZ2V0QXBpTGV2ZWwiLCJ3YXJuIiwiaXNQYWNrYWdlT3JCdW5kbGUiLCJhcHAiLCJjb25maWd1cmVBcHAiLCJhcHBJc1RlbXAiLCJjaGVja0FwcFByZXNlbnQiLCJhcHBPbkRldmljZSIsImNoZWNrUGFja2FnZVByZXNlbnQiLCJ1dGlsIiwiaGFzVmFsdWUiLCJuZXR3b3JrU3BlZWQiLCJpc0VtdWxhdG9yIiwiZW5zdXJlTmV0d29ya1NwZWVkIiwiZ3BzRW5hYmxlZCIsInRvZ2dsZUdQU0xvY2F0aW9uUHJvdmlkZXIiLCJzdGFydEFuZHJvaWRTZXNzaW9uIiwiZSIsImRlbGV0ZVNlc3Npb24iLCJpZ24iLCJhdmQiLCJ0ZXN0IiwiZGV2aWNlTmFtZSIsImVycm9yQW5kVGhyb3ciLCJwbGF0Zm9ybVZlcnNpb24iLCJhdmREZXZpY2UiLCJyZXBsYWNlIiwiaXNDaHJvbWVCcm93c2VyIiwia2V5IiwidmFsdWUiLCJzZXRDb21wcmVzc2VkTGF5b3V0SGllcmFyY2h5IiwiZGVmYXVsdElNRSIsImluaXREZXZpY2UiLCJjdXJEZXZpY2VJZCIsImRldmljZVVESUQiLCJnZXRQbGF0Zm9ybVZlcnNpb24iLCJkZXZpY2VTY3JlZW5TaXplIiwiZ2V0U2NyZWVuU2l6ZSIsImRldmljZU1vZGVsIiwiZ2V0TW9kZWwiLCJkZXZpY2VNYW51ZmFjdHVyZXIiLCJnZXRNYW51ZmFjdHVyZXIiLCJpbml0QVVUIiwiZGlzYWJsZVdpbmRvd0FuaW1hdGlvbiIsImlzQW5pbWF0aW9uT24iLCJzZXRBbmltYXRpb25TdGF0ZSIsIl93YXNXaW5kb3dBbmltYXRpb25EaXNhYmxlZCIsImJvb3RzdHJhcCIsIndlYnNvY2tldCIsInN0YXJ0IiwiYWNjZXB0U3NsQ2VydHMiLCJvblVuZXhwZWN0ZWRTaHV0ZG93biIsImNhdGNoIiwiZXJyIiwiaWdub3JlVW5leHBlY3RlZFNodXRkb3duIiwic3RhcnRVbmV4cGVjdGVkU2h1dGRvd24iLCJza2lwVW5sb2NrIiwidW5sb2NrIiwidXBkYXRlIiwic3RhcnRDaHJvbWVTZXNzaW9uIiwic3RhcnRBVVQiLCJvcmllbnRhdGlvbiIsImRlYnVnIiwic2V0T3JpZW50YXRpb24iLCJpbml0QXV0b1dlYnZpZXciLCJhdXRvV2VidmlldyIsInZpZXdOYW1lIiwiZGVmYXVsdFdlYnZpZXdOYW1lIiwidGltZW91dCIsImF1dG9XZWJ2aWV3VGltZW91dCIsInNldENvbnRleHQiLCJsYXVuY2hJbmZvIiwiZ2V0TGF1bmNoSW5mbyIsIm90aGVyQXBwcyIsInBhcnNlQXJyYXkiLCJtZXNzYWdlIiwiQiIsImFsbCIsIm1hcCIsImluc3RhbGxPdGhlckFwa3MiLCJyZXNldEFwcCIsInVuaW5zdGFsbEFwayIsImluc3RhbGxBcGsiLCJsYW5ndWFnZSIsInB1c2hTdHJpbmdzIiwic2hhcmVkUHJlZmVyZW5jZXMiLCJzZXRTaGFyZWRQcmVmZXJlbmNlcyIsImZzIiwiZXhpc3RzIiwic2hlbGwiLCJjb21wcmVzcyIsInNlbmRBY3Rpb24iLCJjb21wcmVzc0xheW91dCIsInJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyIsInNlcnZlciIsInN0b3BDaHJvbWVkcml2ZXJQcm94aWVzIiwidW5pY29kZUtleWJvYXJkIiwicmVzZXRLZXlib2FyZCIsInNldElNRSIsImZvcmNlU3RvcCIsImdvVG9Ib21lIiwic2h1dGRvd24iLCJzdG9wTG9nY2F0IiwiYXZkTmFtZSIsImtpbGxFbXVsYXRvciIsImNsZWFyU3lzdGVtRmlsZXMiLCJyaW1yYWYiLCJzaGFyZWRQcmVmcyIsIm5hbWUiLCJKU09OIiwic3RyaW5naWZ5IiwicmVtb3RlUGF0aCIsInJlbW90ZUZpbGUiLCJsb2NhbFBhdGgiLCJidWlsZGVyIiwiZ2V0UHJlZnNCdWlsZGVyIiwiYnVpbGQiLCJwcmVmcyIsInRvRmlsZSIsInVubGluayIsIlNoYXJlZFByZWZzQnVpbGRlciIsInZhbGlkYXRlRGVzaXJlZENhcHMiLCJwcm94eUFjdGl2ZSIsImdldFByb3h5QXZvaWRMaXN0IiwiY2FuUHJveHkiLCJpc0Z1bmN0aW9uIiwicHJveHlSZXFSZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxhQUFhLEdBQUcsTUFBdEI7QUFDQSxNQUFNQyxXQUFXLEdBQUcsSUFBcEI7QUFJQSxNQUFNQyxRQUFRLEdBQUcsQ0FDZixDQUFDLE1BQUQsRUFBUyxJQUFJQyxNQUFKLENBQVcseUJBQVgsQ0FBVCxDQURlLEVBRWYsQ0FBQyxLQUFELEVBQVEsSUFBSUEsTUFBSixDQUFXLHlCQUFYLENBQVIsQ0FGZSxFQUdmLENBQUMsTUFBRCxFQUFTLElBQUlBLE1BQUosQ0FBVyx3QkFBWCxDQUFULENBSGUsRUFJZixDQUFDLEtBQUQsRUFBUSxJQUFJQSxNQUFKLENBQVcsd0JBQVgsQ0FBUixDQUplLEVBS2YsQ0FBQyxNQUFELEVBQVMsSUFBSUEsTUFBSixDQUFXLCtCQUFYLENBQVQsQ0FMZSxFQU1mLENBQUMsTUFB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YSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJhc2VEcml2ZXIsIERldmljZVNldHRpbmdzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCBkZXNpcmVkQ29uc3RyYWludHMgZnJvbSAnLi9kZXNpcmVkLWNhcHMnO1xuaW1wb3J0IGNvbW1hbmRzIGZyb20gJy4vY29tbWFuZHMvaW5kZXgnO1xuaW1wb3J0IGhlbHBlcnMgZnJvbSAnLi9hbmRyb2lkLWhlbHBlcnMnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgREVGQVVMVF9BREJfUE9SVCB9IGZyb20gJ2FwcGl1bS1hZGInO1xuaW1wb3J0IHsgZnMsIHRlbXBEaXIsIHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHsgU2hhcmVkUHJlZnNCdWlsZGVyIH0gZnJvbSAnc2hhcmVkLXByZWZlcmVuY2VzLWJ1aWxkZXInO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuXG5jb25zdCBBUFBfRVhURU5TSU9OID0gJy5hcGsnO1xuY29uc3QgREVWSUNFX1BPUlQgPSA0NzI0O1xuXG4vLyBUaGlzIGlzIGEgc2V0IG9mIG1ldGhvZHMgYW5kIHBhdGhzIHRoYXQgd2UgbmV2ZXIgd2FudCB0byBwcm94eSB0b1xuLy8gQ2hyb21lZHJpdmVyXG5jb25zdCBOT19QUk9YWSA9IFtcbiAgWydQT1NUJywgbmV3IFJlZ0V4cCgnXi9zZXNzaW9uL1teL10rL2NvbnRleHQnKV0sXG4gIFsnR0VUJywgbmV3IFJlZ0V4cCgnXi9zZXNzaW9uL1teL10rL2NvbnRleHQnKV0sXG4gIFsnUE9TVCcsIG5ldyBSZWdFeHAoJ14vc2Vzc2lvbi9bXi9dKy9hcHBpdW0nKV0sXG4gIFsnR0VUJywgbmV3IFJlZ0V4cCgnXi9zZXNzaW9uL1teL10rL2FwcGl1bScpXSxcbiAgWydQT1NUJywgbmV3IFJlZ0V4cCgnXi9zZXNzaW9uL1teL10rL3RvdWNoL3BlcmZvcm0nKV0sXG4gIFsnUE9TVCcsIG5ldyBSZWdFeHAoJ14vc2Vzc2lvbi9bXi9dKy90b3VjaC9tdWx0aS9wZXJmb3JtJyldLFxuICBbJ1BPU1QnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvb3JpZW50YXRpb24nKV0sXG4gIFsnR0VUJywgbmV3IFJlZ0V4cCgnXi9zZXNzaW9uL1teL10rL29yaWVudGF0aW9uJyldLFxuXTtcblxuY2xhc3MgQW5kcm9pZERyaXZlciBleHRlbmRzIEJhc2VEcml2ZXIge1xuICBjb25zdHJ1Y3RvciAob3B0cyA9IHt9LCBzaG91bGRWYWxpZGF0ZUNhcHMgPSB0cnVlKSB7XG4gICAgc3VwZXIob3B0cywgc2hvdWxkVmFsaWRhdGVDYXBzKTtcblxuICAgIHRoaXMubG9jYXRvclN0cmF0ZWdpZXMgPSBbXG4gICAgICAneHBhdGgnLFxuICAgICAgJ2lkJyxcbiAgICAgICdjbGFzcyBuYW1lJyxcbiAgICAgICdhY2Nlc3NpYmlsaXR5IGlkJyxcbiAgICAgICctYW5kcm9pZCB1aWF1dG9tYXRvcidcbiAgICBdO1xuICAgIHRoaXMuZGVzaXJlZENhcENvbnN0cmFpbnRzID0gZGVzaXJlZENvbnN0cmFpbnRzO1xuICAgIHRoaXMuc2Vzc2lvbkNocm9tZWRyaXZlcnMgPSB7fTtcbiAgICB0aGlzLmp3cFByb3h5QWN0aXZlID0gZmFsc2U7XG4gICAgdGhpcy5qd3BQcm94eUF2b2lkID0gXy5jbG9uZShOT19QUk9YWSk7XG4gICAgdGhpcy5zZXR0aW5ncyA9IG5ldyBEZXZpY2VTZXR0aW5ncyh7aWdub3JlVW5pbXBvcnRhbnRWaWV3czogZmFsc2V9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblNldHRpbmdzVXBkYXRlLmJpbmQodGhpcykpO1xuICAgIHRoaXMuY2hyb21lZHJpdmVyID0gbnVsbDtcbiAgICB0aGlzLmFwa1N0cmluZ3MgPSB7fTtcbiAgICB0aGlzLmJvb3RzdHJhcFBvcnQgPSBvcHRzLmJvb3RzdHJhcFBvcnQgfHwgREVWSUNFX1BPUlQ7XG4gICAgdGhpcy51bmxvY2tlciA9IGhlbHBlcnMudW5sb2NrZXI7XG5cbiAgICBmb3IgKGxldCBbY21kLCBmbl0gb2YgXy50b1BhaXJzKGNvbW1hbmRzKSkge1xuICAgICAgQW5kcm9pZERyaXZlci5wcm90b3R5cGVbY21kXSA9IGZuO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVNlc3Npb24gKC4uLmFyZ3MpIHtcbiAgICAvLyB0aGUgd2hvbGUgY3JlYXRlU2Vzc2lvbiBmbG93IGlzIHN1cnJvdW5kZWQgaW4gYSB0cnktY2F0Y2ggc3RhdGVtZW50XG4gICAgLy8gaWYgY3JlYXRpbmcgYSBzZXNzaW9uIGZhaWxzIGF0IGFueSBwb2ludCwgd2UgdGVhcmRvd24gZXZlcnl0aGluZyB3ZVxuICAgIC8vIHNldCB1cCBiZWZvcmUgdGhyb3dpbmcgdGhlIGVycm9yLlxuICAgIHRyeSB7XG4gICAgICBsZXQgW3Nlc3Npb25JZCwgY2Fwc10gPSBhd2FpdCBzdXBlci5jcmVhdGVTZXNzaW9uKC4uLmFyZ3MpO1xuXG4gICAgICBsZXQgc2VydmVyRGV0YWlscyA9IHtwbGF0Zm9ybTogJ0xJTlVYJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlYlN0b3JhZ2VFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRha2VzU2NyZWVuc2hvdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGphdmFzY3JpcHRFbmFibGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YWJhc2VFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldHdvcmtDb25uZWN0aW9uRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uQ29udGV4dEVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ3M6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzaXJlZDogdGhpcy5jYXBzfTtcblxuICAgICAgdGhpcy5jYXBzID0gT2JqZWN0LmFzc2lnbihzZXJ2ZXJEZXRhaWxzLCB0aGlzLmNhcHMpO1xuXG4gICAgICAvLyBhc3NpZ25pbmcgZGVmYXVsdHNcbiAgICAgIGxldCBkZWZhdWx0T3B0cyA9IHtcbiAgICAgICAgYWN0aW9uOiBcImFuZHJvaWQuaW50ZW50LmFjdGlvbi5NQUlOXCIsXG4gICAgICAgIGNhdGVnb3J5OiBcImFuZHJvaWQuaW50ZW50LmNhdGVnb3J5LkxBVU5DSEVSXCIsXG4gICAgICAgIGZsYWdzOiBcIjB4MTAyMDAwMDBcIixcbiAgICAgICAgZGlzYWJsZUFuZHJvaWRXYXRjaGVyczogZmFsc2UsXG4gICAgICAgIHRtcERpcjogYXdhaXQgdGVtcERpci5zdGF0aWNEaXIoKSxcbiAgICAgICAgZnVsbFJlc2V0OiBmYWxzZSxcbiAgICAgICAgYXV0b0xhdW5jaDogdHJ1ZSxcbiAgICAgICAgYWRiUG9ydDogREVGQVVMVF9BREJfUE9SVCxcbiAgICAgICAgYW5kcm9pZEluc3RhbGxUaW1lb3V0OiA5MDAwMCxcbiAgICAgIH07XG4gICAgICBfLmRlZmF1bHRzKHRoaXMub3B0cywgZGVmYXVsdE9wdHMpO1xuICAgICAgaWYgKCF0aGlzLm9wdHMuamF2YVZlcnNpb24pIHtcbiAgICAgICAgdGhpcy5vcHRzLmphdmFWZXJzaW9uID0gYXdhaXQgaGVscGVycy5nZXRKYXZhVmVyc2lvbigpO1xuICAgICAgfVxuICAgICAgdGhpcy51c2VVbmxvY2tIZWxwZXJBcHAgPSBfLmlzVW5kZWZpbmVkKHRoaXMuY2Fwcy51bmxvY2tUeXBlKTtcblxuICAgICAgLy8gbm90IHVzZXIgdmlzaWJsZSB2aWEgY2Fwc1xuICAgICAgaWYgKHRoaXMub3B0cy5ub1Jlc2V0ID09PSB0cnVlKSB7XG4gICAgICAgIHRoaXMub3B0cy5mdWxsUmVzZXQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm9wdHMuZnVsbFJlc2V0ID09PSB0cnVlKSB7XG4gICAgICAgIHRoaXMub3B0cy5ub1Jlc2V0ID0gZmFsc2U7XG4gICAgICB9XG4gICAgICB0aGlzLm9wdHMuZmFzdFJlc2V0ID0gIXRoaXMub3B0cy5mdWxsUmVzZXQgJiYgIXRoaXMub3B0cy5ub1Jlc2V0O1xuICAgICAgdGhpcy5vcHRzLnNraXBVbmluc3RhbGwgPSB0aGlzLm9wdHMuZmFzdFJlc2V0IHx8IHRoaXMub3B0cy5ub1Jlc2V0O1xuXG4gICAgICB0aGlzLmN1ckNvbnRleHQgPSB0aGlzLmRlZmF1bHRDb250ZXh0TmFtZSgpO1xuXG4gICAgICBpZiAodGhpcy5pc0Nocm9tZVNlc3Npb24pIHtcbiAgICAgICAgbG9nLmluZm8oXCJXZSdyZSBnb2luZyB0byBydW4gYSBDaHJvbWUtYmFzZWQgc2Vzc2lvblwiKTtcbiAgICAgICAgbGV0IHtwa2csIGFjdGl2aXR5fSA9IGhlbHBlcnMuZ2V0Q2hyb21lUGtnKHRoaXMub3B0cy5icm93c2VyTmFtZSk7XG4gICAgICAgIHRoaXMub3B0cy5hcHBQYWNrYWdlID0gcGtnO1xuICAgICAgICB0aGlzLm9wdHMuYXBwQWN0aXZpdHkgPSBhY3Rpdml0eTtcbiAgICAgICAgbG9nLmluZm8oYENocm9tZS10eXBlIHBhY2thZ2UgYW5kIGFjdGl2aXR5IGFyZSAke3BrZ30gYW5kICR7YWN0aXZpdHl9YCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdHMubmF0aXZlV2ViU2NyZWVuc2hvdCkge1xuICAgICAgICB0aGlzLmp3cFByb3h5QXZvaWQucHVzaChbJ0dFVCcsIG5ldyBSZWdFeHAoJ14vc2Vzc2lvbi9bXi9dKy9zY3JlZW5zaG90JyldKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3B0cy5yZWJvb3QpIHtcbiAgICAgICAgdGhpcy5zZXRBdmRGcm9tQ2FwYWJpbGl0aWVzKGNhcHMpO1xuICAgICAgfVxuXG4gICAgICAvLyBnZXQgZGV2aWNlIHVkaWQgZm9yIHRoaXMgc2Vzc2lvblxuICAgICAgbGV0IHt1ZGlkLCBlbVBvcnR9ID0gYXdhaXQgaGVscGVycy5nZXREZXZpY2VJbmZvRnJvbUNhcHModGhpcy5vcHRzKTtcbiAgICAgIHRoaXMub3B0cy51ZGlkID0gdWRpZDtcbiAgICAgIHRoaXMub3B0cy5lbVBvcnQgPSBlbVBvcnQ7XG5cbiAgICAgIC8vIHNldCB1cCBhbiBpbnN0YW5jZSBvZiBBREJcbiAgICAgIHRoaXMuYWRiID0gYXdhaXQgaGVscGVycy5jcmVhdGVBREIoe1xuICAgICAgICBqYXZhVmVyc2lvbjogdGhpcy5vcHRzLmphdmFWZXJzaW9uLFxuICAgICAgICB1ZGlkOiB0aGlzLm9wdHMudWRpZCxcbiAgICAgICAgZW1Qb3J0OiB0aGlzLm9wdHMuZW1Qb3J0LFxuICAgICAgICBhZGJQb3J0OiB0aGlzLm9wdHMuYWRiUG9ydCxcbiAgICAgICAgc3VwcHJlc3NLaWxsU2VydmVyOiB0aGlzLm9wdHMuc3VwcHJlc3NLaWxsU2VydmVyLFxuICAgICAgICByZW1vdGVBZGJIb3N0OiB0aGlzLm9wdHMucmVtb3RlQWRiSG9zdCxcbiAgICAgICAgY2xlYXJEZXZpY2VMb2dzT25TdGFydDogdGhpcy5vcHRzLmNsZWFyRGV2aWNlTG9nc09uU3RhcnQsXG4gICAgICAgIGFkYkV4ZWNUaW1lb3V0OiB0aGlzLm9wdHMuYWRiRXhlY1RpbWVvdXQsXG4gICAgICB9KTtcblxuICAgICAgaWYgKGF3YWl0IHRoaXMuYWRiLmdldEFwaUxldmVsKCkgPj0gMjMpIHtcbiAgICAgICAgbG9nLndhcm4oXCJDb25zaWRlciBzZXR0aW5nICdhdXRvbWF0aW9uTmFtZScgY2FwYWJpbGl0eSB0byBcIiArXG4gICAgICAgICAgXCIndWlhdXRvbWF0b3IyJyBvbiBBbmRyb2lkID49IDYsIHNpbmNlIFVJQXV0b21hdG9yIGZyYW1ld29yayBcIiArXG4gICAgICAgICAgXCJpcyBub3QgbWFpbnRhaW5lZCBhbnltb3JlIGJ5IHRoZSBPUyB2ZW5kb3IuXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5oZWxwZXJzLmlzUGFja2FnZU9yQnVuZGxlKHRoaXMub3B0cy5hcHApKSB7XG4gICAgICAgIC8vIHVzZXIgcHJvdmlkZWQgcGFja2FnZSBpbnN0ZWFkIG9mIGFwcCBmb3IgJ2FwcCcgY2FwYWJpbGl0eSwgbWFzc2FnZSBvcHRpb25zXG4gICAgICAgIHRoaXMub3B0cy5hcHBQYWNrYWdlID0gdGhpcy5vcHRzLmFwcDtcbiAgICAgICAgdGhpcy5vcHRzLmFwcCA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdHMuYXBwKSB7XG4gICAgICAgIC8vIGZpbmQgYW5kIGNvcHksIG9yIGRvd25sb2FkIGFuZCB1bnppcCBhbiBhcHAgdXJsIG9yIHBhdGhcbiAgICAgICAgdGhpcy5vcHRzLmFwcCA9IGF3YWl0IHRoaXMuaGVscGVycy5jb25maWd1cmVBcHAodGhpcy5vcHRzLmFwcCwgQVBQX0VYVEVOU0lPTik7XG4gICAgICAgIHRoaXMub3B0cy5hcHBJc1RlbXAgPSBjYXBzLmFwcCAhPT0gdGhpcy5vcHRzLmFwcDsgLy8gZGlkIHdlIG1ha2UgYSB0ZW1wb3JhcnkgY29weT9cbiAgICAgICAgYXdhaXQgdGhpcy5jaGVja0FwcFByZXNlbnQoKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5hcHBPbkRldmljZSkge1xuICAgICAgICAvLyB0aGUgYXBwIGlzbid0IGFuIGFjdHVhbCBhcHAgZmlsZSBidXQgcmF0aGVyIHNvbWV0aGluZyB3ZSB3YW50IHRvXG4gICAgICAgIC8vIGFzc3VtZSBpcyBvbiB0aGUgZGV2aWNlIGFuZCBqdXN0IGxhdW5jaCB2aWEgdGhlIGFwcFBhY2thZ2VcbiAgICAgICAgbG9nLmluZm8oYEFwcCBmaWxlIHdhcyBub3QgbGlzdGVkLCBpbnN0ZWFkIHdlJ3JlIGdvaW5nIHRvIHJ1biBgICtcbiAgICAgICAgICAgICAgICAgYCR7dGhpcy5vcHRzLmFwcFBhY2thZ2V9IGRpcmVjdGx5IG9uIHRoZSBkZXZpY2VgKTtcbiAgICAgICAgYXdhaXQgdGhpcy5jaGVja1BhY2thZ2VQcmVzZW50KCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNvbWUgY2xvdWQgc2VydmljZXMgdXNpbmcgYXBwaXVtIGxhdW5jaCB0aGUgYXZkIHRoZW1zZWx2ZXMsIHNvIHdlIGVuc3VyZSBuZXRzcGVlZFxuICAgICAgLy8gaXMgc2V0IGZvciBlbXVsYXRvcnMgYnkgY2FsbGluZyBhZGIubmV0d29ya1NwZWVkIGJlZm9yZSBydW5uaW5nIHRoZSBhcHBcbiAgICAgIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5uZXR3b3JrU3BlZWQpKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICAgICAgICBsb2cud2FybihcIlNvcnJ5LCBuZXR3b3JrU3BlZWQgY2FwYWJpbGl0eSBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCBuZXR3b3JrU3BlZWQgPSBoZWxwZXJzLmVuc3VyZU5ldHdvcmtTcGVlZCh0aGlzLmFkYiwgdGhpcy5vcHRzLm5ldHdvcmtTcGVlZCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hZGIubmV0d29ya1NwZWVkKG5ldHdvcmtTcGVlZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGNoZWNrIGlmIHdlIGhhdmUgdG8gZW5hYmxlL2Rpc2FibGUgZ3BzIGJlZm9yZSBydW5uaW5nIHRoZSBhcHBsaWNhdGlvblxuICAgICAgaWYgKHV0aWwuaGFzVmFsdWUodGhpcy5vcHRzLmdwc0VuYWJsZWQpKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRW11bGF0b3IoKSkge1xuICAgICAgICAgIGxvZy5pbmZvKGBUcnlpbmcgdG8gJHt0aGlzLm9wdHMuZ3BzRW5hYmxlZCA/IFwiZW5hYmxlXCIgOiBcImRpc2FibGVcIn0gZ3BzIGxvY2F0aW9uIHByb3ZpZGVyYCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hZGIudG9nZ2xlR1BTTG9jYXRpb25Qcm92aWRlcih0aGlzLm9wdHMuZ3BzRW5hYmxlZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbG9nLndhcm4oJ1NvcnJ5ISBncHNFbmFibGVkIGNhcGFiaWxpdHkgaXMgb25seSBhdmFpbGFibGUgZm9yIGVtdWxhdG9ycycpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGF3YWl0IHRoaXMuc3RhcnRBbmRyb2lkU2Vzc2lvbih0aGlzLm9wdHMpO1xuICAgICAgcmV0dXJuIFtzZXNzaW9uSWQsIHRoaXMuY2Fwc107XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gaWdub3JpbmcgZGVsZXRlIHNlc3Npb24gZXhjZXB0aW9uIGlmIGFueSBhbmQgdGhyb3cgdGhlIHJlYWwgZXJyb3JcbiAgICAgIC8vIHRoYXQgaGFwcGVuZWQgd2hpbGUgY3JlYXRpbmcgdGhlIHNlc3Npb24uXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmRlbGV0ZVNlc3Npb24oKTtcbiAgICAgIH0gY2F0Y2ggKGlnbikge31cbiAgICAgIHRocm93IGU7XG4gICAgfVxuICB9XG5cbiAgaXNFbXVsYXRvciAoKSB7XG4gICAgcmV0dXJuICEhKHRoaXMub3B0cy5hdmQgfHwgL2VtdWxhdG9yLy50ZXN0KHRoaXMub3B0cy51ZGlkKSk7XG4gIH1cblxuICBzZXRBdmRGcm9tQ2FwYWJpbGl0aWVzIChjYXBzKSB7XG4gICAgaWYgKHRoaXMub3B0cy5hdmQpIHtcbiAgICAgIGxvZy5pbmZvKCdhdmQgbmFtZSBkZWZpbmVkLCBpZ25vcmluZyBkZXZpY2UgbmFtZSBhbmQgcGxhdGZvcm0gdmVyc2lvbicpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIWNhcHMuZGV2aWNlTmFtZSkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdygnYXZkIG9yIGRldmljZU5hbWUgc2hvdWxkIGJlIHNwZWNpZmllZCB3aGVuIHJlYm9vdCBvcHRpb24gaXMgZW5hYmxlcycpO1xuICAgICAgfVxuICAgICAgaWYgKCFjYXBzLnBsYXRmb3JtVmVyc2lvbikge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdygnYXZkIG9yIHBsYXRmb3JtVmVyc2lvbiBzaG91bGQgYmUgc3BlY2lmaWVkIHdoZW4gcmVib290IG9wdGlvbiBpcyBlbmFibGVkJyk7XG4gICAgICB9XG4gICAgICBsZXQgYXZkRGV2aWNlID0gY2Fwcy5kZXZpY2VOYW1lLnJlcGxhY2UoL1teYS16QS1aMC05Xy5dL2csIFwiLVwiKTtcbiAgICAgIHRoaXMub3B0cy5hdmQgPSBgJHthdmREZXZpY2V9X18ke2NhcHMucGxhdGZvcm1WZXJzaW9ufWA7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGFwcE9uRGV2aWNlICgpIHtcbiAgICByZXR1cm4gdGhpcy5oZWxwZXJzLmlzUGFja2FnZU9yQnVuZGxlKHRoaXMub3B0cy5hcHApIHx8ICghdGhpcy5vcHRzLmFwcCAmJlxuICAgICAgICAgICB0aGlzLmhlbHBlcnMuaXNQYWNrYWdlT3JCdW5kbGUodGhpcy5vcHRzLmFwcFBhY2thZ2UpKTtcbiAgfVxuXG4gIGdldCBpc0Nocm9tZVNlc3Npb24gKCkge1xuICAgIHJldHVybiBoZWxwZXJzLmlzQ2hyb21lQnJvd3Nlcih0aGlzLm9wdHMuYnJvd3Nlck5hbWUpO1xuICB9XG5cbiAgYXN5bmMgb25TZXR0aW5nc1VwZGF0ZSAoa2V5LCB2YWx1ZSkge1xuICAgIGlmIChrZXkgPT09IFwiaWdub3JlVW5pbXBvcnRhbnRWaWV3c1wiKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldENvbXByZXNzZWRMYXlvdXRIaWVyYXJjaHkodmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHN0YXJ0QW5kcm9pZFNlc3Npb24gKCkge1xuICAgIGxvZy5pbmZvKGBTdGFydGluZyBBbmRyb2lkIHNlc3Npb25gKTtcbiAgICAvLyBzZXQgdXAgdGhlIGRldmljZSB0byBydW4gb24gKHJlYWwgb3IgZW11bGF0b3IsIGV0YylcbiAgICB0aGlzLmRlZmF1bHRJTUUgPSBhd2FpdCBoZWxwZXJzLmluaXREZXZpY2UodGhpcy5hZGIsIHRoaXMub3B0cyk7XG5cbiAgICAvLyBzZXQgYWN0dWFsIGRldmljZSBuYW1lLCB1ZGlkLCBwbGF0Zm9ybSB2ZXJzaW9uLCBzY3JlZW4gc2l6ZSwgbW9kZWwgYW5kIG1hbnVmYWN0dXJlciBkZXRhaWxzXG4gICAgdGhpcy5jYXBzLmRldmljZU5hbWUgPSB0aGlzLmFkYi5jdXJEZXZpY2VJZDtcbiAgICB0aGlzLmNhcHMuZGV2aWNlVURJRCA9IHRoaXMub3B0cy51ZGlkO1xuICAgIHRoaXMuY2Fwcy5wbGF0Zm9ybVZlcnNpb24gPSBhd2FpdCB0aGlzLmFkYi5nZXRQbGF0Zm9ybVZlcnNpb24oKTtcbiAgICB0aGlzLmNhcHMuZGV2aWNlU2NyZWVuU2l6ZSA9IGF3YWl0IHRoaXMuYWRiLmdldFNjcmVlblNpemUoKTtcbiAgICB0aGlzLmNhcHMuZGV2aWNlTW9kZWwgPSBhd2FpdCB0aGlzLmFkYi5nZXRNb2RlbCgpO1xuICAgIHRoaXMuY2Fwcy5kZXZpY2VNYW51ZmFjdHVyZXIgPSBhd2FpdCB0aGlzLmFkYi5nZXRNYW51ZmFjdHVyZXIoKTtcblxuICAgIC8vIElmIHRoZSB1c2VyIHNldHMgYXV0b0xhdW5jaCB0byBmYWxzZSwgdGhleSBhcmUgcmVzcG9uc2libGUgZm9yIGluaXRBVVQoKSBhbmQgc3RhcnRBVVQoKVxuICAgIGlmICh0aGlzLm9wdHMuYXV0b0xhdW5jaCkge1xuICAgICAgLy8gc2V0IHVwIGFwcCB1bmRlciB0ZXN0XG4gICAgICBhd2FpdCB0aGlzLmluaXRBVVQoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5vcHRzLmRpc2FibGVXaW5kb3dBbmltYXRpb24pIHtcbiAgICAgIGlmIChhd2FpdCB0aGlzLmFkYi5pc0FuaW1hdGlvbk9uKCkpIHtcbiAgICAgICAgbG9nLmluZm8oJ0Rpc2FibGluZyB3aW5kb3cgYW5pbWF0aW9uIGFzIGl0IGlzIHJlcXVlc3RlZCBieSBcImRpc2FibGVXaW5kb3dBbmltYXRpb25cIiBjYXBhYmlsaXR5Jyk7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRiLnNldEFuaW1hdGlvblN0YXRlKGZhbHNlKTtcbiAgICAgICAgdGhpcy5fd2FzV2luZG93QW5pbWF0aW9uRGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLmluZm8oJ1dpbmRvdyBhbmltYXRpb24gaXMgYWxyZWFkeSBkaXNhYmxlZCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHN0YXJ0IFVpQXV0b21hdG9yXG4gICAgdGhpcy5ib290c3RyYXAgPSBuZXcgaGVscGVycy5ib290c3RyYXAodGhpcy5hZGIsIHRoaXMuYm9vdHN0cmFwUG9ydCwgdGhpcy5vcHRzLndlYnNvY2tldCk7XG4gICAgYXdhaXQgdGhpcy5ib290c3RyYXAuc3RhcnQodGhpcy5vcHRzLmFwcFBhY2thZ2UsIHRoaXMub3B0cy5kaXNhYmxlQW5kcm9pZFdhdGNoZXJzLCB0aGlzLm9wdHMuYWNjZXB0U3NsQ2VydHMpO1xuICAgIC8vIGhhbmRsaW5nIHVuZXhwZWN0ZWQgc2h1dGRvd25cbiAgICB0aGlzLmJvb3RzdHJhcC5vblVuZXhwZWN0ZWRTaHV0ZG93bi5jYXRjaChhc3luYyAoZXJyKSA9PiB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tY2FsbGJhY2tzXG4gICAgICBpZiAoIXRoaXMuYm9vdHN0cmFwLmlnbm9yZVVuZXhwZWN0ZWRTaHV0ZG93bikge1xuICAgICAgICBhd2FpdCB0aGlzLnN0YXJ0VW5leHBlY3RlZFNodXRkb3duKGVycik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoIXRoaXMub3B0cy5za2lwVW5sb2NrKSB7XG4gICAgICAvLyBMZXQncyB0cnkgdG8gdW5sb2NrIHRoZSBkZXZpY2VcbiAgICAgIGF3YWl0IGhlbHBlcnMudW5sb2NrKHRoaXMsIHRoaXMuYWRiLCB0aGlzLmNhcHMpO1xuICAgIH1cblxuICAgIC8vIFNldCBDb21wcmVzc2VkTGF5b3V0SGllcmFyY2h5IG9uIHRoZSBkZXZpY2UgYmFzZWQgb24gY3VycmVudCBzZXR0aW5ncyBvYmplY3RcbiAgICAvLyB0aGlzIGhhcyB0byBoYXBwZW4gX2FmdGVyXyBib290c3RyYXAgaXMgaW5pdGlhbGl6ZWRcbiAgICBpZiAodGhpcy5vcHRzLmlnbm9yZVVuaW1wb3J0YW50Vmlld3MpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0dGluZ3MudXBkYXRlKHtpZ25vcmVVbmltcG9ydGFudFZpZXdzOiB0aGlzLm9wdHMuaWdub3JlVW5pbXBvcnRhbnRWaWV3c30pO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzQ2hyb21lU2Vzc2lvbikge1xuICAgICAgLy8gc3RhcnQgYSBjaHJvbWVkcml2ZXIgc2Vzc2lvbiBhbmQgcHJveHkgdG8gaXRcbiAgICAgIGF3YWl0IHRoaXMuc3RhcnRDaHJvbWVTZXNzaW9uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLm9wdHMuYXV0b0xhdW5jaCkge1xuICAgICAgICAvLyBzdGFydCBhcHBcbiAgICAgICAgYXdhaXQgdGhpcy5zdGFydEFVVCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5vcmllbnRhdGlvbikpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgU2V0dGluZyBpbml0aWFsIG9yaWVudGF0aW9uIHRvICcke3RoaXMub3B0cy5vcmllbnRhdGlvbn0nYCk7XG4gICAgICBhd2FpdCB0aGlzLnNldE9yaWVudGF0aW9uKHRoaXMub3B0cy5vcmllbnRhdGlvbik7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5pbml0QXV0b1dlYnZpZXcoKTtcbiAgfVxuXG4gIGFzeW5jIGluaXRBdXRvV2VidmlldyAoKSB7XG4gICAgaWYgKHRoaXMub3B0cy5hdXRvV2Vidmlldykge1xuICAgICAgbGV0IHZpZXdOYW1lID0gdGhpcy5kZWZhdWx0V2Vidmlld05hbWUoKTtcbiAgICAgIGxldCB0aW1lb3V0ID0gKHRoaXMub3B0cy5hdXRvV2Vidmlld1RpbWVvdXQpIHx8IDIwMDA7XG5cbiAgICAgIGxvZy5pbmZvKGBTZXR0aW5nIGF1dG8gd2VidmlldyB0byBjb250ZXh0ICcke3ZpZXdOYW1lfScgd2l0aCB0aW1lb3V0ICR7dGltZW91dH1tc2ApO1xuXG4gICAgICAvLyB0cnkgZXZlcnkgNTAwbXMgdW50aWwgdGltZW91dCBpcyBvdmVyXG4gICAgICBhd2FpdCByZXRyeUludGVydmFsKHRpbWVvdXQgLyA1MDAsIDUwMCwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCB0aGlzLnNldENvbnRleHQodmlld05hbWUpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgaW5pdEFVVCAoKSB7XG4gICAgLy8gcG9wdWxhdGUgYXBwUGFja2FnZSwgYXBwQWN0aXZpdHksIGFwcFdhaXRQYWNrYWdlLCBhcHBXYWl0QWN0aXZpdHksXG4gICAgLy8gYW5kIHRoZSBkZXZpY2UgYmVpbmcgdXNlZFxuICAgIC8vIGluIHRoZSBvcHRzIGFuZCBjYXBzIChzbyBpdCBnZXRzIGJhY2sgdG8gdGhlIHVzZXIgb24gc2Vzc2lvbiBjcmVhdGlvbilcbiAgICBsZXQgbGF1bmNoSW5mbyA9IGF3YWl0IGhlbHBlcnMuZ2V0TGF1bmNoSW5mbyh0aGlzLmFkYiwgdGhpcy5vcHRzKTtcbiAgICBPYmplY3QuYXNzaWduKHRoaXMub3B0cywgbGF1bmNoSW5mbyk7XG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLmNhcHMsIGxhdW5jaEluZm8pO1xuXG4gICAgLy8gSW5zdGFsbCBhbnkgXCJvdGhlckFwcHNcIiB0aGF0IHdlcmUgc3BlY2lmaWVkIGluIGNhcHNcbiAgICBpZiAodGhpcy5vcHRzLm90aGVyQXBwcykge1xuICAgICAgbGV0IG90aGVyQXBwcztcbiAgICAgIHRyeSB7XG4gICAgICAgIG90aGVyQXBwcyA9IGhlbHBlcnMucGFyc2VBcnJheSh0aGlzLm9wdHMub3RoZXJBcHBzKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBwYXJzZSBcIm90aGVyQXBwc1wiIGNhcGFiaWxpdHk6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgICAgb3RoZXJBcHBzID0gYXdhaXQgQi5hbGwob3RoZXJBcHBzLm1hcCgoYXBwKSA9PiB0aGlzLmhlbHBlcnMuY29uZmlndXJlQXBwKGFwcCwgQVBQX0VYVEVOU0lPTikpKTtcbiAgICAgIGF3YWl0IGhlbHBlcnMuaW5zdGFsbE90aGVyQXBrcyhvdGhlckFwcHMsIHRoaXMuYWRiLCB0aGlzLm9wdHMpO1xuICAgIH1cblxuICAgIC8vIGluc3RhbGwgYXBwXG4gICAgaWYgKCF0aGlzLm9wdHMuYXBwKSB7XG4gICAgICBpZiAodGhpcy5vcHRzLmZ1bGxSZXNldCkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdygnRnVsbCByZXNldCByZXF1aXJlcyBhbiBhcHAgY2FwYWJpbGl0eSwgdXNlIGZhc3RSZXNldCBpZiBhcHAgaXMgbm90IHByb3ZpZGVkJyk7XG4gICAgICB9XG4gICAgICBsb2cuZGVidWcoJ05vIGFwcCBjYXBhYmlsaXR5LiBBc3N1bWluZyBpdCBpcyBhbHJlYWR5IG9uIHRoZSBkZXZpY2UnKTtcbiAgICAgIGlmICh0aGlzLm9wdHMuZmFzdFJlc2V0KSB7XG4gICAgICAgIGF3YWl0IGhlbHBlcnMucmVzZXRBcHAodGhpcy5hZGIsIHRoaXMub3B0cyk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghdGhpcy5vcHRzLnNraXBVbmluc3RhbGwpIHtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLnVuaW5zdGFsbEFwayh0aGlzLm9wdHMuYXBwUGFja2FnZSk7XG4gICAgfVxuICAgIGF3YWl0IGhlbHBlcnMuaW5zdGFsbEFwayh0aGlzLmFkYiwgdGhpcy5vcHRzKTtcbiAgICB0aGlzLmFwa1N0cmluZ3NbdGhpcy5vcHRzLmxhbmd1YWdlXSA9IGF3YWl0IGhlbHBlcnMucHVzaFN0cmluZ3MoXG4gICAgICAgIHRoaXMub3B0cy5sYW5ndWFnZSwgdGhpcy5hZGIsIHRoaXMub3B0cyk7XG5cbiAgICAvLyBUaGlzIG11c3QgcnVuIGFmdGVyIGluc3RhbGxpbmcgdGhlIGFwaywgb3RoZXJ3aXNlIGl0IHdvdWxkIGNhdXNlIHRoZVxuICAgIC8vIGluc3RhbGwgdG8gZmFpbC4gQW5kIGJlZm9yZSBydW5uaW5nIHRoZSBhcHAuXG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKHRoaXMub3B0cy5zaGFyZWRQcmVmZXJlbmNlcykpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0U2hhcmVkUHJlZmVyZW5jZXModGhpcy5vcHRzKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjaGVja0FwcFByZXNlbnQgKCkge1xuICAgIGxvZy5kZWJ1ZyhcIkNoZWNraW5nIHdoZXRoZXIgYXBwIGlzIGFjdHVhbGx5IHByZXNlbnRcIik7XG4gICAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKHRoaXMub3B0cy5hcHApKSkge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBmaW5kIGFwcCBhcGsgYXQgJHt0aGlzLm9wdHMuYXBwfWApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNoZWNrUGFja2FnZVByZXNlbnQgKCkge1xuICAgIGxvZy5kZWJ1ZyhcIkNoZWNraW5nIHdoZXRoZXIgcGFja2FnZSBpcyBwcmVzZW50IG9uIHRoZSBkZXZpY2VcIik7XG4gICAgaWYgKCEoYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydwbScsICdsaXN0JywgJ3BhY2thZ2VzJywgdGhpcy5vcHRzLmFwcFBhY2thZ2VdKSkpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgZmluZCBwYWNrYWdlICR7dGhpcy5vcHRzLmFwcFBhY2thZ2V9IG9uIHRoZSBkZXZpY2VgKTtcbiAgICB9XG4gIH1cblxuICAvLyBTZXQgQ29tcHJlc3NlZExheW91dEhpZXJhcmNoeSBvbiB0aGUgZGV2aWNlXG4gIGFzeW5jIHNldENvbXByZXNzZWRMYXlvdXRIaWVyYXJjaHkgKGNvbXByZXNzKSB7XG4gICAgYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbihcImNvbXByZXNzZWRMYXlvdXRIaWVyYXJjaHlcIiwge2NvbXByZXNzTGF5b3V0OiBjb21wcmVzc30pO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlU2Vzc2lvbiAoKSB7XG4gICAgbG9nLmRlYnVnKFwiU2h1dHRpbmcgZG93biBBbmRyb2lkIGRyaXZlclwiKTtcbiAgICBhd2FpdCBoZWxwZXJzLnJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyh0aGlzLnNlcnZlciwgdGhpcy5zZXNzaW9uSWQpO1xuICAgIGF3YWl0IHN1cGVyLmRlbGV0ZVNlc3Npb24oKTtcbiAgICBpZiAodGhpcy5ib290c3RyYXApIHtcbiAgICAgIC8vIGNlcnRhaW4gY2xlYW51cCB3ZSBvbmx5IGNhcmUgdG8gZG8gaWYgdGhlIGJvb3RzdHJhcCB3YXMgZXZlciBydW5cbiAgICAgIGF3YWl0IHRoaXMuc3RvcENocm9tZWRyaXZlclByb3hpZXMoKTtcbiAgICAgIGlmICh0aGlzLm9wdHMudW5pY29kZUtleWJvYXJkICYmIHRoaXMub3B0cy5yZXNldEtleWJvYXJkICYmIHRoaXMuZGVmYXVsdElNRSkge1xuICAgICAgICBsb2cuZGVidWcoYFJlc2V0dGluZyBJTUUgdG8gJHt0aGlzLmRlZmF1bHRJTUV9YCk7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRiLnNldElNRSh0aGlzLmRlZmF1bHRJTUUpO1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLmlzQ2hyb21lU2Vzc2lvbikge1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi5mb3JjZVN0b3AodGhpcy5vcHRzLmFwcFBhY2thZ2UpO1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5hZGIuZ29Ub0hvbWUoKTtcbiAgICAgIGlmICh0aGlzLm9wdHMuZnVsbFJlc2V0ICYmICF0aGlzLm9wdHMuc2tpcFVuaW5zdGFsbCAmJiAhdGhpcy5hcHBPbkRldmljZSkge1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi51bmluc3RhbGxBcGsodGhpcy5vcHRzLmFwcFBhY2thZ2UpO1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5ib290c3RyYXAuc2h1dGRvd24oKTtcbiAgICAgIHRoaXMuYm9vdHN0cmFwID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nLmRlYnVnKFwiQ2FsbGVkIGRlbGV0ZVNlc3Npb24gYnV0IGJvb3RzdHJhcCB3YXNuJ3QgYWN0aXZlXCIpO1xuICAgIH1cbiAgICAvLyBzb21lIGNsZWFudXAgd2Ugd2FudCB0byBkbyByZWdhcmRsZXNzLCBpbiBjYXNlIHdlIGFyZSBzaHV0dGluZyBkb3duXG4gICAgLy8gbWlkLXN0YXJ0dXBcbiAgICBhd2FpdCB0aGlzLmFkYi5zdG9wTG9nY2F0KCk7XG4gICAgaWYgKHRoaXMudXNlVW5sb2NrSGVscGVyQXBwKSB7XG4gICAgICBhd2FpdCB0aGlzLmFkYi5mb3JjZVN0b3AoJ2lvLmFwcGl1bS51bmxvY2snKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3dhc1dpbmRvd0FuaW1hdGlvbkRpc2FibGVkKSB7XG4gICAgICBsb2cuaW5mbygnUmVzdG9yaW5nIHdpbmRvdyBhbmltYXRpb24gc3RhdGUnKTtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLnNldEFuaW1hdGlvblN0YXRlKHRydWUpO1xuICAgIH1cbiAgICBpZiAodGhpcy5vcHRzLnJlYm9vdCkge1xuICAgICAgbGV0IGF2ZE5hbWUgPSB0aGlzLm9wdHMuYXZkLnJlcGxhY2UoJ0AnLCAnJyk7XG4gICAgICBsb2cuZGVidWcoYGNsb3NpbmcgZW11bGF0b3IgJyR7YXZkTmFtZX0nYCk7XG4gICAgICBhd2FpdCB0aGlzLmFkYi5raWxsRW11bGF0b3IoYXZkTmFtZSk7XG4gICAgfVxuICAgIGlmICh0aGlzLm9wdHMuY2xlYXJTeXN0ZW1GaWxlcykge1xuICAgICAgaWYgKHRoaXMub3B0cy5hcHBJc1RlbXApIHtcbiAgICAgICAgbG9nLmRlYnVnKGBUZW1wb3JhcnkgY29weSBvZiBhcHAgd2FzIG1hZGU6IGRlbGV0aW5nICcke3RoaXMub3B0cy5hcHB9J2ApO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IGZzLnJpbXJhZih0aGlzLm9wdHMuYXBwKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgbG9nLndhcm4oYFVuYWJsZSB0byBkZWxldGUgdGVtcG9yYXJ5IGFwcDogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLmRlYnVnKCdBcHAgd2FzIG5vdCBjb3BpZWQsIHNvIG5vdCBkZWxldGluZycpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsb2cuZGVidWcoJ05vdCBjbGVhbmluZyBnZW5lcmF0ZWQgZmlsZXMuIEFkZCBgY2xlYXJTeXN0ZW1GaWxlc2AgY2FwYWJpbGl0eSBpZiB3YW50ZWQuJyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2V0U2hhcmVkUHJlZmVyZW5jZXMgKCkge1xuICAgIGxldCBzaGFyZWRQcmVmcyA9IHRoaXMub3B0cy5zaGFyZWRQcmVmZXJlbmNlcztcbiAgICBsb2cuaW5mbyhcIlRyeWluZyB0byBzZXQgc2hhcmVkIHByZWZlcmVuY2VzXCIpO1xuICAgIGxldCBuYW1lID0gc2hhcmVkUHJlZnMubmFtZTtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChuYW1lKSkge1xuICAgICAgbG9nLndhcm4oYFNraXBwaW5nIHNldHRpbmcgU2hhcmVkIHByZWZlcmVuY2VzLCBuYW1lIGlzIHVuZGVmaW5lZDogJHtKU09OLnN0cmluZ2lmeShzaGFyZWRQcmVmcyl9YCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGxldCByZW1vdGVQYXRoID0gYC9kYXRhL2RhdGEvJHt0aGlzLm9wdHMuYXBwUGFja2FnZX0vc2hhcmVkX3ByZWZzYDtcbiAgICBsZXQgcmVtb3RlRmlsZSA9IGAke3JlbW90ZVBhdGh9LyR7bmFtZX0ueG1sYDtcbiAgICBsZXQgbG9jYWxQYXRoID0gYC90bXAvJHtuYW1lfS54bWxgO1xuICAgIGxldCBidWlsZGVyID0gdGhpcy5nZXRQcmVmc0J1aWxkZXIoKTtcbiAgICBidWlsZGVyLmJ1aWxkKHNoYXJlZFByZWZzLnByZWZzKTtcbiAgICBsb2cuaW5mbyhgQ3JlYXRpbmcgdGVtcG9yYXJ5IHNoYXJlZCBwcmVmZXJlbmNlczogJHtsb2NhbFBhdGh9YCk7XG4gICAgYnVpbGRlci50b0ZpbGUobG9jYWxQYXRoKTtcbiAgICBsb2cuaW5mbyhgQ3JlYXRpbmcgc2hhcmVkX3ByZWZzIHJlbW90ZSBmb2xkZXI6ICR7cmVtb3RlUGF0aH1gKTtcbiAgICBhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ21rZGlyJywgJy1wJywgcmVtb3RlUGF0aF0pO1xuICAgIGxvZy5pbmZvKGBQdXNoaW5nIHNoYXJlZF9wcmVmcyB0byAke3JlbW90ZUZpbGV9YCk7XG4gICAgYXdhaXQgdGhpcy5hZGIucHVzaChsb2NhbFBhdGgsIHJlbW90ZUZpbGUpO1xuICAgIHRyeSB7XG4gICAgICBsb2cuaW5mbyhgVHJ5aW5nIHRvIHJlbW92ZSBzaGFyZWQgcHJlZmVyZW5jZXMgdGVtcG9yYXJ5IGZpbGVgKTtcbiAgICAgIGlmIChhd2FpdCBmcy5leGlzdHMobG9jYWxQYXRoKSkge1xuICAgICAgICBhd2FpdCBmcy51bmxpbmsobG9jYWxQYXRoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2cud2FybihgRXJyb3IgdHJ5aW5nIHRvIHJlbW92ZSB0ZW1wb3JhcnkgZmlsZSAke2xvY2FsUGF0aH1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBnZXRQcmVmc0J1aWxkZXIgKCkge1xuICAgIC8qIEFkZCB0aGlzIG1ldGhvZCB0byBjcmVhdGUgYSBuZXcgU2hhcmVkUHJlZnNCdWlsZGVyIGluc3RlYWQgb2ZcbiAgICAgKiBkaXJlY3RseSBjcmVhdGluZyB0aGUgb2JqZWN0IG9uIHNldFNoYXJlZFByZWZlcmVuY2VzIGZvciB0ZXN0aW5nIHB1cnBvc2VzXG4gICAgKi9cbiAgICByZXR1cm4gbmV3IFNoYXJlZFByZWZzQnVpbGRlcigpO1xuICB9XG5cbiAgdmFsaWRhdGVEZXNpcmVkQ2FwcyAoY2Fwcykge1xuICAgIGlmICghc3VwZXIudmFsaWRhdGVEZXNpcmVkQ2FwcyhjYXBzKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gaGVscGVycy52YWxpZGF0ZURlc2lyZWRDYXBzKGNhcHMpO1xuICB9XG5cbiAgcHJveHlBY3RpdmUgKHNlc3Npb25JZCkge1xuICAgIHN1cGVyLnByb3h5QWN0aXZlKHNlc3Npb25JZCk7XG5cbiAgICByZXR1cm4gdGhpcy5qd3BQcm94eUFjdGl2ZTtcbiAgfVxuXG4gIGdldFByb3h5QXZvaWRMaXN0IChzZXNzaW9uSWQpIHtcbiAgICBzdXBlci5nZXRQcm94eUF2b2lkTGlzdChzZXNzaW9uSWQpO1xuXG4gICAgcmV0dXJuIHRoaXMuandwUHJveHlBdm9pZDtcbiAgfVxuXG4gIGNhblByb3h5IChzZXNzaW9uSWQpIHtcbiAgICBzdXBlci5jYW5Qcm94eShzZXNzaW9uSWQpO1xuXG4gICAgLy8gdGhpcyB3aWxsIGNoYW5nZSBkZXBlbmRpbmcgb24gQ2hyb21lRHJpdmVyIHN0YXR1c1xuICAgIHJldHVybiBfLmlzRnVuY3Rpb24odGhpcy5wcm94eVJlcVJlcyk7XG4gIH1cbn1cblxuZXhwb3J0IHsgQW5kcm9pZERyaXZlciB9O1xuZXhwb3J0IGRlZmF1bHQgQW5kcm9pZERyaXZlcjtcbiJdLCJmaWxlIjoibGliL2RyaXZlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
