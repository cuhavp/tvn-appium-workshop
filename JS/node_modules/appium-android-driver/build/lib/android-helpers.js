"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _teen_process = require("teen_process");

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("./logger"));

var _appiumSupport = require("appium-support");

var _appiumAndroidIme = require("appium-android-ime");

var _ioAppium = require("io.appium.settings");

var _bootstrap = _interopRequireDefault(require("./bootstrap"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumAdb = _interopRequireDefault(require("appium-adb"));

var _unlockHelpers = _interopRequireWildcard(require("./unlock-helpers"));

const PACKAGE_INSTALL_TIMEOUT = 90000;
const CHROME_BROWSER_PACKAGE_ACTIVITY = {
  chrome: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  chromium: {
    pkg: 'org.chromium.chrome.shell',
    activity: '.ChromeShellActivity'
  },
  chromebeta: {
    pkg: 'com.chrome.beta',
    activity: 'com.google.android.apps.chrome.Main'
  },
  browser: {
    pkg: 'com.android.browser',
    activity: 'com.android.browser.BrowserActivity'
  },
  'chromium-browser': {
    pkg: 'org.chromium.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  'chromium-webview': {
    pkg: 'org.chromium.webview_shell',
    activity: 'org.chromium.webview_shell.WebViewBrowserActivity'
  },
  default: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  }
};
const SETTINGS_HELPER_PKG_ID = 'io.appium.settings';
const SETTINGS_HELPER_MAIN_ACTIVITY = '.Settings';
const SETTINGS_HELPER_UNLOCK_ACTIVITY = '.Unlock';
const UNICODE_IME_PKG_ID = 'io.appium.android.ime';
let helpers = {};
exports.helpers = helpers;

helpers.createBaseADB = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    const javaVersion = opts.javaVersion,
          adbPort = opts.adbPort,
          suppressKillServer = opts.suppressKillServer,
          remoteAdbHost = opts.remoteAdbHost,
          clearDeviceLogsOnStart = opts.clearDeviceLogsOnStart,
          adbExecTimeout = opts.adbExecTimeout,
          useKeystore = opts.useKeystore,
          keystorePath = opts.keystorePath,
          keystorePassword = opts.keystorePassword,
          keyAlias = opts.keyAlias,
          keyPassword = opts.keyPassword;
    return yield _appiumAdb.default.createADB({
      javaVersion,
      adbPort,
      suppressKillServer,
      remoteAdbHost,
      clearDeviceLogsOnStart,
      adbExecTimeout,
      useKeystore,
      keystorePath,
      keystorePassword,
      keyAlias,
      keyPassword
    });
  });

  return function () {
    return _ref.apply(this, arguments);
  };
}();

helpers.parseJavaVersion = function (stderr) {
  let lines = stderr.split("\n");
  var _iteratorNormalCompletion = true;
  var _didIteratorError = false;
  var _iteratorError = undefined;

  try {
    for (var _iterator = lines[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
      let line = _step.value;

      if (new RegExp(/(java|openjdk) version/).test(line)) {
        return line.split(" ")[2].replace(/"/g, '');
      }
    }
  } catch (err) {
    _didIteratorError = true;
    _iteratorError = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion && _iterator.return != null) {
        _iterator.return();
      }
    } finally {
      if (_didIteratorError) {
        throw _iteratorError;
      }
    }
  }

  return null;
};

helpers.getJavaVersion = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (logVersion = true) {
    let _ref3 = yield (0, _teen_process.exec)('java', ['-version']),
        stderr = _ref3.stderr;

    let javaVer = helpers.parseJavaVersion(stderr);

    if (javaVer === null) {
      throw new Error("Could not get the Java version. Is Java installed?");
    }

    if (logVersion) {
      _logger.default.info(`Java version is: ${javaVer}`);
    }

    return javaVer;
  });

  return function () {
    return _ref2.apply(this, arguments);
  };
}();

helpers.prepareEmulator = function () {
  var _ref4 = (0, _asyncToGenerator2.default)(function* (adb, opts) {
    let avd = opts.avd,
        avdArgs = opts.avdArgs,
        language = opts.language,
        locale = opts.locale,
        avdLaunchTimeout = opts.avdLaunchTimeout,
        avdReadyTimeout = opts.avdReadyTimeout;

    if (!avd) {
      throw new Error("Cannot launch AVD without AVD name");
    }

    let avdName = avd.replace('@', '');
    let runningAVD = yield adb.getRunningAVD(avdName);

    if (runningAVD !== null) {
      if (avdArgs && avdArgs.toLowerCase().indexOf("-wipe-data") > -1) {
        _logger.default.debug(`Killing '${avdName}' because it needs to be wiped at start.`);

        yield adb.killEmulator(avdName);
      } else {
        _logger.default.debug("Not launching AVD because it is already running.");

        return;
      }
    }

    avdArgs = this.prepareAVDArgs(opts, adb, avdArgs);
    yield adb.launchAVD(avd, avdArgs, language, locale, avdLaunchTimeout, avdReadyTimeout);
  });

  return function (_x, _x2) {
    return _ref4.apply(this, arguments);
  };
}();

helpers.prepareAVDArgs = function (opts, adb, avdArgs) {
  let args = avdArgs ? [avdArgs] : [];

  if (!_lodash.default.isUndefined(opts.networkSpeed)) {
    let networkSpeed = this.ensureNetworkSpeed(adb, opts.networkSpeed);
    args.push('-netspeed', networkSpeed);
  }

  if (opts.isHeadless) {
    args.push('-no-window');
  }

  return args.join(' ');
};

helpers.ensureNetworkSpeed = function (adb, networkSpeed) {
  if (_lodash.default.values(adb.NETWORK_SPEED).indexOf(networkSpeed) !== -1) {
    return networkSpeed;
  }

  _logger.default.warn(`Wrong network speed param ${networkSpeed}, using default: full. Supported values: ${_lodash.default.values(adb.NETWORK_SPEED)}`);

  return adb.NETWORK_SPEED.FULL;
};

helpers.ensureDeviceLocale = function () {
  var _ref5 = (0, _asyncToGenerator2.default)(function* (adb, language, country) {
    if (!_lodash.default.isString(language) && !_lodash.default.isString(country)) {
      _logger.default.warn(`setDeviceLanguageCountry requires language or country.`);

      _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

      return;
    }

    yield adb.setDeviceLanguageCountry(language, country);

    if (!(yield adb.ensureCurrentLocale(language, country))) {
      throw new Error(`Failed to set language: ${language} and country: ${country}`);
    }
  });

  return function (_x3, _x4, _x5) {
    return _ref5.apply(this, arguments);
  };
}();

helpers.getDeviceInfoFromCaps = function () {
  var _ref6 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    const adb = yield helpers.createBaseADB(opts);
    let udid = opts.udid;
    let emPort = null;

    if (opts.avd) {
      yield helpers.prepareEmulator(adb, opts);
      udid = adb.curDeviceId;
      emPort = adb.emulatorPort;
    } else {
      _logger.default.info("Retrieving device list");

      let devices = yield adb.getDevicesWithRetry();

      if (udid) {
        if (!_lodash.default.includes(_lodash.default.map(devices, 'udid'), udid)) {
          _logger.default.errorAndThrow(`Device ${udid} was not in the list of connected devices`);
        }

        emPort = adb.getPortFromEmulatorString(udid);
      } else if (opts.platformVersion) {
        opts.platformVersion = `${opts.platformVersion}`.trim();

        _logger.default.info(`Looking for a device with Android '${opts.platformVersion}'`);

        let availDevicesStr = [];
        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = devices[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            let device = _step2.value;
            yield adb.setDeviceId(device.udid);
            let deviceOS = yield adb.getPlatformVersion();
            availDevicesStr.push(`${device.udid} (${deviceOS})`);

            if (deviceOS.indexOf(opts.platformVersion) === 0) {
              udid = device.udid;
              break;
            }
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }

        if (!udid) {
          _logger.default.errorAndThrow(`Unable to find an active device or emulator ` + `with OS ${opts.platformVersion}. The following are available: ` + availDevicesStr.join(', '));
        }

        emPort = adb.getPortFromEmulatorString(udid);
      } else {
        udid = devices[0].udid;
        emPort = adb.getPortFromEmulatorString(udid);
      }
    }

    _logger.default.info(`Using device: ${udid}`);

    return {
      udid,
      emPort
    };
  });

  return function () {
    return _ref6.apply(this, arguments);
  };
}();

helpers.createADB = function () {
  var _ref7 = (0, _asyncToGenerator2.default)(function* (opts = {}) {
    const udid = opts.udid,
          emPort = opts.emPort;
    const adb = yield helpers.createBaseADB(opts);
    adb.setDeviceId(udid);

    if (emPort) {
      adb.setEmulatorPort(emPort);
    }

    return adb;
  });

  return function () {
    return _ref7.apply(this, arguments);
  };
}();

helpers.validatePackageActivityNames = function (opts) {
  var _arr = ['appPackage', 'appActivity', 'appWaitPackage', 'appWaitActivity'];

  for (var _i = 0; _i < _arr.length; _i++) {
    const key = _arr[_i];
    const name = opts[key];

    if (!name) {
      continue;
    }

    const match = /([^\w.*,])+/.exec(name);

    if (!match) {
      continue;
    }

    _logger.default.warn(`Capability '${key}' is expected to only include latin letters, digits, underscore, dot, comma and asterisk characters.`);

    _logger.default.warn(`Current value '${name}' has non-matching character at index ${match.index}: '${name.substring(0, match.index + 1)}'`);
  }
};

helpers.getLaunchInfo = function () {
  var _ref8 = (0, _asyncToGenerator2.default)(function* (adb, opts) {
    let app = opts.app,
        appPackage = opts.appPackage,
        appActivity = opts.appActivity,
        appWaitPackage = opts.appWaitPackage,
        appWaitActivity = opts.appWaitActivity;

    if (!app) {
      _logger.default.warn("No app sent in, not parsing package/activity");

      return;
    }

    this.validatePackageActivityNames(opts);

    if (appPackage && appActivity) {
      return;
    }

    _logger.default.debug("Parsing package and activity from app manifest");

    let _ref9 = yield adb.packageAndLaunchActivityFromManifest(app),
        apkPackage = _ref9.apkPackage,
        apkActivity = _ref9.apkActivity;

    if (apkPackage && !appPackage) {
      appPackage = apkPackage;
    }

    if (!appWaitPackage) {
      appWaitPackage = appPackage;
    }

    if (apkActivity && !appActivity) {
      appActivity = apkActivity;
    }

    if (!appWaitActivity) {
      appWaitActivity = appActivity;
    }

    _logger.default.debug(`Parsed package and activity are: ${apkPackage}/${apkActivity}`);

    return {
      appPackage,
      appWaitPackage,
      appActivity,
      appWaitActivity
    };
  });

  return function (_x6, _x7) {
    return _ref8.apply(this, arguments);
  };
}();

helpers.resetApp = function () {
  var _ref10 = (0, _asyncToGenerator2.default)(function* (adb, opts = {}) {
    const app = opts.app,
          appPackage = opts.appPackage,
          fastReset = opts.fastReset,
          fullReset = opts.fullReset,
          _opts$androidInstallT = opts.androidInstallTimeout,
          androidInstallTimeout = _opts$androidInstallT === void 0 ? PACKAGE_INSTALL_TIMEOUT : _opts$androidInstallT,
          autoGrantPermissions = opts.autoGrantPermissions,
          allowTestPackages = opts.allowTestPackages;

    if (!appPackage) {
      throw new Error("'appPackage' option is required");
    }

    const isInstalled = yield adb.isAppInstalled(appPackage);

    if (isInstalled) {
      try {
        yield adb.forceStop(appPackage);
      } catch (ign) {}

      if (!fullReset && fastReset) {
        const output = yield adb.clear(appPackage);

        if (_lodash.default.isString(output) && output.toLowerCase().includes('failed')) {
          throw new Error(`Cannot clear the application data of '${appPackage}'. Original error: ${output}`);
        }

        if (autoGrantPermissions) {
          try {
            yield adb.grantAllPermissions(appPackage);
          } catch (error) {
            _logger.default.error(`Unable to grant permissions requested. Original error: ${error.message}`);
          }
        }

        _logger.default.debug(`Performed fast reset on the installed '${appPackage}' application (stop and clear)`);

        return;
      }
    }

    if (!app) {
      throw new Error("'app' option is required for reinstall");
    }

    _logger.default.debug(`Running full reset on '${appPackage}' (reinstall)`);

    if (isInstalled) {
      yield adb.uninstallApk(appPackage);
    }

    yield adb.install(app, {
      grantPermissions: autoGrantPermissions,
      timeout: androidInstallTimeout,
      allowTestPackages
    });
  });

  return function (_x8) {
    return _ref10.apply(this, arguments);
  };
}();

helpers.installApk = function () {
  var _ref11 = (0, _asyncToGenerator2.default)(function* (adb, opts = {}) {
    const app = opts.app,
          appPackage = opts.appPackage,
          fastReset = opts.fastReset,
          fullReset = opts.fullReset,
          _opts$androidInstallT2 = opts.androidInstallTimeout,
          androidInstallTimeout = _opts$androidInstallT2 === void 0 ? PACKAGE_INSTALL_TIMEOUT : _opts$androidInstallT2,
          autoGrantPermissions = opts.autoGrantPermissions,
          allowTestPackages = opts.allowTestPackages;

    if (!app || !appPackage) {
      throw new Error("'app' and 'appPackage' options are required");
    }

    if (fullReset) {
      yield this.resetApp(adb, opts);
      return;
    }

    const shouldPerformFastReset = fastReset && (yield adb.isAppInstalled(appPackage));
    yield adb.installOrUpgrade(app, appPackage, {
      grantPermissions: autoGrantPermissions,
      timeout: androidInstallTimeout,
      allowTestPackages
    });

    if (shouldPerformFastReset) {
      _logger.default.info(`Performing fast reset on '${appPackage}'`);

      yield this.resetApp(adb, opts);
    }
  });

  return function (_x9) {
    return _ref11.apply(this, arguments);
  };
}();

helpers.installOtherApks = function () {
  var _ref12 = (0, _asyncToGenerator2.default)(function* (otherApps, adb, opts) {
    let _opts$androidInstallT3 = opts.androidInstallTimeout,
        androidInstallTimeout = _opts$androidInstallT3 === void 0 ? PACKAGE_INSTALL_TIMEOUT : _opts$androidInstallT3,
        autoGrantPermissions = opts.autoGrantPermissions,
        allowTestPackages = opts.allowTestPackages;
    yield _bluebird.default.all(otherApps.map(otherApp => {
      _logger.default.debug(`Installing app: ${otherApp}`);

      return adb.installOrUpgrade(otherApp, null, {
        grantPermissions: autoGrantPermissions,
        timeout: androidInstallTimeout,
        allowTestPackages
      });
    }));
  });

  return function (_x10, _x11, _x12) {
    return _ref12.apply(this, arguments);
  };
}();

helpers.initUnicodeKeyboard = function () {
  var _ref13 = (0, _asyncToGenerator2.default)(function* (adb) {
    _logger.default.debug('Enabling Unicode keyboard support');

    _logger.default.debug("Pushing unicode ime to device...");

    try {
      yield adb.install(_appiumAndroidIme.path, {
        replace: false
      });
    } catch (err) {
      _logger.default.info(`Performing full reinstall of ${UNICODE_IME_PKG_ID} as a possible fix for: ${err.message}`);

      yield adb.uninstallApk(UNICODE_IME_PKG_ID);
      yield adb.install(_appiumAndroidIme.path, {
        replace: false
      });
    }

    let defaultIME = yield adb.defaultIME();

    _logger.default.debug(`Unsetting previous IME ${defaultIME}`);

    const appiumIME = `${UNICODE_IME_PKG_ID}/.UnicodeIME`;

    _logger.default.debug(`Setting IME to '${appiumIME}'`);

    yield adb.enableIME(appiumIME);
    yield adb.setIME(appiumIME);
    return defaultIME;
  });

  return function (_x13) {
    return _ref13.apply(this, arguments);
  };
}();

helpers.setMockLocationApp = function () {
  var _ref14 = (0, _asyncToGenerator2.default)(function* (adb, app) {
    try {
      if ((yield adb.getApiLevel()) < 23) {
        yield adb.shell(['settings', 'put', 'secure', 'mock_location', '1']);
      } else {
        yield adb.shell(['appops', 'set', app, 'android:mock_location', 'allow']);
      }
    } catch (err) {
      _logger.default.warn(`Unable to set mock location for app '${app}': ${err.message}`);
    }
  });

  return function (_x14, _x15) {
    return _ref14.apply(this, arguments);
  };
}();

helpers.installHelperApp = function () {
  var _ref15 = (0, _asyncToGenerator2.default)(function* (adb, apkPath, packageId, appName) {
    try {
      yield adb.installOrUpgrade(apkPath, packageId, {
        grantPermissions: true
      });
    } catch (err) {
      _logger.default.warn(`Ignored error while installing Appium ${appName} helper: ` + `'${err.message}'. Manually uninstalling the application ` + `with package id '${packageId}' may help. Expect some Appium ` + `features may not work as expected unless this problem is ` + `fixed.`);
    }
  });

  return function (_x16, _x17, _x18, _x19) {
    return _ref15.apply(this, arguments);
  };
}();

helpers.pushSettingsApp = function () {
  var _ref16 = (0, _asyncToGenerator2.default)(function* (adb, throwError = false) {
    _logger.default.debug("Pushing settings apk to device...");

    yield helpers.installHelperApp(adb, _ioAppium.path, SETTINGS_HELPER_PKG_ID, 'Settings');

    if (yield adb.processExists(SETTINGS_HELPER_PKG_ID)) {
      _logger.default.debug(`${SETTINGS_HELPER_PKG_ID} is already running. ` + `There is no need to reset its permissions.`);

      return;
    }

    try {
      yield adb.startApp({
        pkg: SETTINGS_HELPER_PKG_ID,
        activity: SETTINGS_HELPER_MAIN_ACTIVITY,
        action: "android.intent.action.MAIN",
        category: "android.intent.category.LAUNCHER",
        flags: "0x10200000",
        stopApp: false
      });
    } catch (err) {
      _logger.default.warn(`Failed to launch settings app: ${err.message}`);

      if (throwError) {
        throw err;
      }
    }
  });

  return function (_x20) {
    return _ref16.apply(this, arguments);
  };
}();

helpers.pushStrings = function () {
  var _ref17 = (0, _asyncToGenerator2.default)(function* (language, adb, opts) {
    const remoteDir = '/data/local/tmp';
    const stringsJson = 'strings.json';
    const remoteFile = `${remoteDir}/${stringsJson}`;
    yield adb.rimraf(remoteFile);
    let app;

    try {
      app = opts.app || (yield adb.pullApk(opts.appPackage, opts.tmpDir));
    } catch (err) {
      _logger.default.info(`Failed to pull an apk from '${opts.appPackage}' to '${opts.tmpDir}'. Original error: ${err.message}`);
    }

    if (_lodash.default.isEmpty(opts.appPackage) || !(yield _appiumSupport.fs.exists(app))) {
      _logger.default.debug(`No app or package specified. Returning empty strings`);

      return {};
    }

    const stringsTmpDir = _path.default.resolve(opts.tmpDir, opts.appPackage);

    try {
      _logger.default.debug('Extracting strings from apk', app, language, stringsTmpDir);

      const _ref18 = yield adb.extractStringsFromApk(app, language, stringsTmpDir),
            apkStrings = _ref18.apkStrings,
            localPath = _ref18.localPath;

      yield adb.push(localPath, remoteDir);
      return apkStrings;
    } catch (err) {
      _logger.default.warn(`Could not get strings, continuing anyway. Original error: ${err.message}`);

      yield adb.shell('echo', [`'{}' > ${remoteFile}`]);
    } finally {
      yield _appiumSupport.fs.rimraf(stringsTmpDir);
    }

    return {};
  });

  return function (_x21, _x22, _x23) {
    return _ref17.apply(this, arguments);
  };
}();

helpers.unlockWithUIAutomation = function () {
  var _ref19 = (0, _asyncToGenerator2.default)(function* (driver, adb, unlockCapabilities) {
    let unlockType = unlockCapabilities.unlockType;

    if (!_unlockHelpers.default.isValidUnlockType(unlockType)) {
      throw new Error(`Invalid unlock type ${unlockType}`);
    }

    let unlockKey = unlockCapabilities.unlockKey;

    if (!_unlockHelpers.default.isValidKey(unlockType, unlockKey)) {
      throw new Error(`Missing unlockKey ${unlockKey} capability for unlockType ${unlockType}`);
    }

    const unlockMethod = {
      [_unlockHelpers.PIN_UNLOCK]: _unlockHelpers.default.pinUnlock,
      [_unlockHelpers.PASSWORD_UNLOCK]: _unlockHelpers.default.passwordUnlock,
      [_unlockHelpers.PATTERN_UNLOCK]: _unlockHelpers.default.patternUnlock,
      [_unlockHelpers.FINGERPRINT_UNLOCK]: _unlockHelpers.default.fingerprintUnlock
    }[unlockType];
    yield unlockMethod(adb, driver, unlockCapabilities);
  });

  return function (_x24, _x25, _x26) {
    return _ref19.apply(this, arguments);
  };
}();

helpers.unlockWithHelperApp = function () {
  var _ref20 = (0, _asyncToGenerator2.default)(function* (adb) {
    _logger.default.info("Unlocking screen");

    let firstRun = true;
    yield (0, _asyncbox.retry)(3, (0, _asyncToGenerator2.default)(function* () {
      if (firstRun) {
        firstRun = false;
      } else {
        try {
          if (!(yield adb.isScreenLocked())) {
            return;
          }
        } catch (e) {
          _logger.default.warn(`Error in isScreenLocked: ${e.message}`);

          _logger.default.warn("\"adb shell dumpsys window\" command has timed out.");

          _logger.default.warn("The reason of this timeout is the delayed adb response. Resetting adb server can improve it.");
        }
      }

      _logger.default.info(`Launching ${SETTINGS_HELPER_UNLOCK_ACTIVITY}`);

      yield adb.shell(['am', 'start', '-n', `${SETTINGS_HELPER_PKG_ID}/${SETTINGS_HELPER_UNLOCK_ACTIVITY}`, '-c', 'android.intent.category.LAUNCHER', '-a', 'android.intent.action.MAIN', '-f', '0x10200000']);
      yield _bluebird.default.delay(1000);
    }));
  });

  return function (_x27) {
    return _ref20.apply(this, arguments);
  };
}();

helpers.unlock = function () {
  var _ref22 = (0, _asyncToGenerator2.default)(function* (driver, adb, capabilities) {
    if (!(yield adb.isScreenLocked())) {
      _logger.default.info("Screen already unlocked, doing nothing");

      return;
    }

    _logger.default.debug("Screen is locked, trying to unlock");

    if (_lodash.default.isUndefined(capabilities.unlockType)) {
      _logger.default.warn("Using app unlock, this is going to be deprecated!");

      yield helpers.unlockWithHelperApp(adb);
    } else {
      yield helpers.unlockWithUIAutomation(driver, adb, {
        unlockType: capabilities.unlockType,
        unlockKey: capabilities.unlockKey
      });
      yield helpers.verifyUnlock(adb);
    }
  });

  return function (_x28, _x29, _x30) {
    return _ref22.apply(this, arguments);
  };
}();

helpers.verifyUnlock = function () {
  var _ref23 = (0, _asyncToGenerator2.default)(function* (adb) {
    yield (0, _asyncbox.retryInterval)(2, 1000, (0, _asyncToGenerator2.default)(function* () {
      if (yield adb.isScreenLocked()) {
        throw new Error("Screen did not unlock successfully, retrying");
      }

      _logger.default.debug("Screen unlocked successfully");
    }));
  });

  return function (_x31) {
    return _ref23.apply(this, arguments);
  };
}();

helpers.initDevice = function () {
  var _ref25 = (0, _asyncToGenerator2.default)(function* (adb, opts) {
    yield adb.waitForDevice();
    yield helpers.pushSettingsApp(adb);

    if (!opts.avd) {
      yield helpers.setMockLocationApp(adb, SETTINGS_HELPER_PKG_ID);
    }

    yield helpers.ensureDeviceLocale(adb, opts.language, opts.locale);
    yield adb.startLogcat();

    if (opts.unicodeKeyboard) {
      return yield helpers.initUnicodeKeyboard(adb);
    }
  });

  return function (_x32, _x33) {
    return _ref25.apply(this, arguments);
  };
}();

helpers.removeNullProperties = function (obj) {
  var _iteratorNormalCompletion3 = true;
  var _didIteratorError3 = false;
  var _iteratorError3 = undefined;

  try {
    for (var _iterator3 = _lodash.default.keys(obj)[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
      let key = _step3.value;

      if (_lodash.default.isNull(obj[key]) || _lodash.default.isUndefined(obj[key])) {
        delete obj[key];
      }
    }
  } catch (err) {
    _didIteratorError3 = true;
    _iteratorError3 = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion3 && _iterator3.return != null) {
        _iterator3.return();
      }
    } finally {
      if (_didIteratorError3) {
        throw _iteratorError3;
      }
    }
  }
};

helpers.truncateDecimals = function (number, digits) {
  let multiplier = Math.pow(10, digits),
      adjustedNum = number * multiplier,
      truncatedNum = Math[adjustedNum < 0 ? 'ceil' : 'floor'](adjustedNum);
  return truncatedNum / multiplier;
};

helpers.isChromeBrowser = function (browser) {
  return _lodash.default.includes(Object.keys(CHROME_BROWSER_PACKAGE_ACTIVITY), (browser || '').toLowerCase());
};

helpers.getChromePkg = function (browser) {
  return CHROME_BROWSER_PACKAGE_ACTIVITY[browser.toLowerCase()] || CHROME_BROWSER_PACKAGE_ACTIVITY.default;
};

helpers.removeAllSessionWebSocketHandlers = function () {
  var _ref26 = (0, _asyncToGenerator2.default)(function* (server, sessionId) {
    if (!server || !_lodash.default.isFunction(server.getWebSocketHandlers)) {
      return;
    }

    const activeHandlers = yield server.getWebSocketHandlers(sessionId);
    var _iteratorNormalCompletion4 = true;
    var _didIteratorError4 = false;
    var _iteratorError4 = undefined;

    try {
      for (var _iterator4 = _lodash.default.keys(activeHandlers)[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
        const pathname = _step4.value;
        yield server.removeWebSocketHandler(pathname);
      }
    } catch (err) {
      _didIteratorError4 = true;
      _iteratorError4 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion4 && _iterator4.return != null) {
          _iterator4.return();
        }
      } finally {
        if (_didIteratorError4) {
          throw _iteratorError4;
        }
      }
    }
  });

  return function (_x34, _x35) {
    return _ref26.apply(this, arguments);
  };
}();

helpers.parseArray = function (cap) {
  let parsedCaps;

  try {
    parsedCaps = JSON.parse(cap);
  } catch (ign) {}

  if (_lodash.default.isArray(parsedCaps)) {
    return parsedCaps;
  } else if (_lodash.default.isString(cap)) {
    return [cap];
  }

  throw new Error(`must provide a string or JSON Array; received ${cap}`);
};

helpers.validateDesiredCaps = function (caps) {
  if ((!caps.browserName || !this.isChromeBrowser(caps.browserName)) && !caps.app && !caps.appPackage) {
    _logger.default.errorAndThrow('The desired capabilities must include either an app, appPackage or browserName');
  }

  if (caps.browserName) {
    if (caps.app) {
      _logger.default.warn(`The desired capabilities should generally not include both an 'app' and a 'browserName'`);
    }

    if (caps.appPackage) {
      _logger.default.errorAndThrow(`The desired should not include both of an 'appPackage' and a 'browserName'`);
    }
  }

  return true;
};

helpers.bootstrap = _bootstrap.default;
helpers.unlocker = _unlockHelpers.default;
var _default = helpers;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9hbmRyb2lkLWhlbHBlcnMuanMiXSwibmFtZXMiOlsiUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQiLCJDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZIiwiY2hyb21lIiwicGtnIiwiYWN0aXZpdHkiLCJjaHJvbWl1bSIsImNocm9tZWJldGEiLCJicm93c2VyIiwiZGVmYXVsdCIsIlNFVFRJTkdTX0hFTFBFUl9QS0dfSUQiLCJTRVRUSU5HU19IRUxQRVJfTUFJTl9BQ1RJVklUWSIsIlNFVFRJTkdTX0hFTFBFUl9VTkxPQ0tfQUNUSVZJVFkiLCJVTklDT0RFX0lNRV9QS0dfSUQiLCJoZWxwZXJzIiwiY3JlYXRlQmFzZUFEQiIsIm9wdHMiLCJqYXZhVmVyc2lvbiIsImFkYlBvcnQiLCJzdXBwcmVzc0tpbGxTZXJ2ZXIiLCJyZW1vdGVBZGJIb3N0IiwiY2xlYXJEZXZpY2VMb2dzT25TdGFydCIsImFkYkV4ZWNUaW1lb3V0IiwidXNlS2V5c3RvcmUiLCJrZXlzdG9yZVBhdGgiLCJrZXlzdG9yZVBhc3N3b3JkIiwia2V5QWxpYXMiLCJrZXlQYXNzd29yZCIsIkFEQiIsImNyZWF0ZUFEQiIsInBhcnNlSmF2YVZlcnNpb24iLCJzdGRlcnIiLCJsaW5lcyIsInNwbGl0IiwibGluZSIsIlJlZ0V4cCIsInRlc3QiLCJyZXBsYWNlIiwiZ2V0SmF2YVZlcnNpb24iLCJsb2dWZXJzaW9uIiwiamF2YVZlciIsIkVycm9yIiwibG9nZ2VyIiwiaW5mbyIsInByZXBhcmVFbXVsYXRvciIsImFkYiIsImF2ZCIsImF2ZEFyZ3MiLCJsYW5ndWFnZSIsImxvY2FsZSIsImF2ZExhdW5jaFRpbWVvdXQiLCJhdmRSZWFkeVRpbWVvdXQiLCJhdmROYW1lIiwicnVubmluZ0FWRCIsImdldFJ1bm5pbmdBVkQiLCJ0b0xvd2VyQ2FzZSIsImluZGV4T2YiLCJkZWJ1ZyIsImtpbGxFbXVsYXRvciIsInByZXBhcmVBVkRBcmdzIiwibGF1bmNoQVZEIiwiYXJncyIsIl8iLCJpc1VuZGVmaW5lZCIsIm5ldHdvcmtTcGVlZCIsImVuc3VyZU5ldHdvcmtTcGVlZCIsInB1c2giLCJpc0hlYWRsZXNzIiwiam9pbiIsInZhbHVlcyIsIk5FVFdPUktfU1BFRUQiLCJ3YXJuIiwiRlVMTCIsImVuc3VyZURldmljZUxvY2FsZSIsImNvdW50cnkiLCJpc1N0cmluZyIsInNldERldmljZUxhbmd1YWdlQ291bnRyeSIsImVuc3VyZUN1cnJlbnRMb2NhbGUiLCJnZXREZXZpY2VJbmZvRnJvbUNhcHMiLCJ1ZGlkIiwiZW1Qb3J0IiwiY3VyRGV2aWNlSWQiLCJlbXVsYXRvclBvcnQiLCJkZXZpY2VzIiwiZ2V0RGV2aWNlc1dpdGhSZXRyeSIsImluY2x1ZGVzIiwibWFwIiwiZXJyb3JBbmRUaHJvdyIsImdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmciLCJwbGF0Zm9ybVZlcnNpb24iLCJ0cmltIiwiYXZhaWxEZXZpY2VzU3RyIiwiZGV2aWNlIiwic2V0RGV2aWNlSWQiLCJkZXZpY2VPUyIsImdldFBsYXRmb3JtVmVyc2lvbiIsInNldEVtdWxhdG9yUG9ydCIsInZhbGlkYXRlUGFja2FnZUFjdGl2aXR5TmFtZXMiLCJrZXkiLCJuYW1lIiwibWF0Y2giLCJleGVjIiwiaW5kZXgiLCJzdWJzdHJpbmciLCJnZXRMYXVuY2hJbmZvIiwiYXBwIiwiYXBwUGFja2FnZSIsImFwcEFjdGl2aXR5IiwiYXBwV2FpdFBhY2thZ2UiLCJhcHBXYWl0QWN0aXZpdHkiLCJwYWNrYWdlQW5kTGF1bmNoQWN0aXZpdHlGcm9tTWFuaWZlc3QiLCJhcGtQYWNrYWdlIiwiYXBrQWN0aXZpdHkiLCJyZXNldEFwcCIsImZhc3RSZXNldCIsImZ1bGxSZXNldCIsImFuZHJvaWRJbnN0YWxsVGltZW91dCIsImF1dG9HcmFudFBlcm1pc3Npb25zIiwiYWxsb3dUZXN0UGFja2FnZXMiLCJpc0luc3RhbGxlZCIsImlzQXBwSW5zdGFsbGVkIiwiZm9yY2VTdG9wIiwiaWduIiwib3V0cHV0IiwiY2xlYXIiLCJncmFudEFsbFBlcm1pc3Npb25zIiwiZXJyb3IiLCJtZXNzYWdlIiwidW5pbnN0YWxsQXBrIiwiaW5zdGFsbCIsImdyYW50UGVybWlzc2lvbnMiLCJ0aW1lb3V0IiwiaW5zdGFsbEFwayIsInNob3VsZFBlcmZvcm1GYXN0UmVzZXQiLCJpbnN0YWxsT3JVcGdyYWRlIiwiaW5zdGFsbE90aGVyQXBrcyIsIm90aGVyQXBwcyIsIkIiLCJhbGwiLCJvdGhlckFwcCIsImluaXRVbmljb2RlS2V5Ym9hcmQiLCJ1bmljb2RlSU1FUGF0aCIsImVyciIsImRlZmF1bHRJTUUiLCJhcHBpdW1JTUUiLCJlbmFibGVJTUUiLCJzZXRJTUUiLCJzZXRNb2NrTG9jYXRpb25BcHAiLCJnZXRBcGlMZXZlbCIsInNoZWxsIiwiaW5zdGFsbEhlbHBlckFwcCIsImFwa1BhdGgiLCJwYWNrYWdlSWQiLCJhcHBOYW1lIiwicHVzaFNldHRpbmdzQXBwIiwidGhyb3dFcnJvciIsInNldHRpbmdzQXBrUGF0aCIsInByb2Nlc3NFeGlzdHMiLCJzdGFydEFwcCIsImFjdGlvbiIsImNhdGVnb3J5IiwiZmxhZ3MiLCJzdG9wQXBwIiwicHVzaFN0cmluZ3MiLCJyZW1vdGVEaXIiLCJzdHJpbmdzSnNvbiIsInJlbW90ZUZpbGUiLCJyaW1yYWYiLCJwdWxsQXBrIiwidG1wRGlyIiwiaXNFbXB0eSIsImZzIiwiZXhpc3RzIiwic3RyaW5nc1RtcERpciIsInBhdGgiLCJyZXNvbHZlIiwiZXh0cmFjdFN0cmluZ3NGcm9tQXBrIiwiYXBrU3RyaW5ncyIsImxvY2FsUGF0aCIsInVubG9ja1dpdGhVSUF1dG9tYXRpb24iLCJkcml2ZXIiLCJ1bmxvY2tDYXBhYmlsaXRpZXMiLCJ1bmxvY2tUeXBlIiwidW5sb2NrZXIiLCJpc1ZhbGlkVW5sb2NrVHlwZSIsInVubG9ja0tleSIsImlzVmFsaWRLZXkiLCJ1bmxvY2tNZXRob2QiLCJQSU5fVU5MT0NLIiwicGluVW5sb2NrIiwiUEFTU1dPUkRfVU5MT0NLIiwicGFzc3dvcmRVbmxvY2siLCJQQVRURVJOX1VOTE9DSyIsInBhdHRlcm5VbmxvY2siLCJGSU5HRVJQUklOVF9VTkxPQ0siLCJmaW5nZXJwcmludFVubG9jayIsInVubG9ja1dpdGhIZWxwZXJBcHAiLCJmaXJzdFJ1biIsImlzU2NyZWVuTG9ja2VkIiwiZSIsImRlbGF5IiwidW5sb2NrIiwiY2FwYWJpbGl0aWVzIiwidmVyaWZ5VW5sb2NrIiwiaW5pdERldmljZSIsIndhaXRGb3JEZXZpY2UiLCJzdGFydExvZ2NhdCIsInVuaWNvZGVLZXlib2FyZCIsInJlbW92ZU51bGxQcm9wZXJ0aWVzIiwib2JqIiwia2V5cyIsImlzTnVsbCIsInRydW5jYXRlRGVjaW1hbHMiLCJudW1iZXIiLCJkaWdpdHMiLCJtdWx0aXBsaWVyIiwiTWF0aCIsInBvdyIsImFkanVzdGVkTnVtIiwidHJ1bmNhdGVkTnVtIiwiaXNDaHJvbWVCcm93c2VyIiwiT2JqZWN0IiwiZ2V0Q2hyb21lUGtnIiwicmVtb3ZlQWxsU2Vzc2lvbldlYlNvY2tldEhhbmRsZXJzIiwic2VydmVyIiwic2Vzc2lvbklkIiwiaXNGdW5jdGlvbiIsImdldFdlYlNvY2tldEhhbmRsZXJzIiwiYWN0aXZlSGFuZGxlcnMiLCJwYXRobmFtZSIsInJlbW92ZVdlYlNvY2tldEhhbmRsZXIiLCJwYXJzZUFycmF5IiwiY2FwIiwicGFyc2VkQ2FwcyIsIkpTT04iLCJwYXJzZSIsImlzQXJyYXkiLCJ2YWxpZGF0ZURlc2lyZWRDYXBzIiwiY2FwcyIsImJyb3dzZXJOYW1lIiwiYm9vdHN0cmFwIiwiQm9vdHN0cmFwIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBSUEsTUFBTUEsdUJBQXVCLEdBQUcsS0FBaEM7QUFDQSxNQUFNQywrQkFBK0IsR0FBRztBQUN0Q0MsRUFBQUEsTUFBTSxFQUFFO0FBQ05DLElBQUFBLEdBQUcsRUFBRSxvQkFEQztBQUVOQyxJQUFBQSxRQUFRLEVBQUU7QUFGSixHQUQ4QjtBQUt0Q0MsRUFBQUEsUUFBUSxF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LENBQVdILEdBQVgsQ0FBYjtBQUNELEdBRkQsQ0FFRSxPQUFPOUcsR0FBUCxFQUFZLENBQUc7O0FBRWpCLE1BQUk1RCxnQkFBRThLLE9BQUYsQ0FBVUgsVUFBVixDQUFKLEVBQTJCO0FBQ3pCLFdBQU9BLFVBQVA7QUFDRCxHQUZELE1BRU8sSUFBSTNLLGdCQUFFYSxRQUFGLENBQVc2SixHQUFYLENBQUosRUFBcUI7QUFDMUIsV0FBTyxDQUFDQSxHQUFELENBQVA7QUFDRDs7QUFFRCxRQUFNLElBQUkvTCxLQUFKLENBQVcsaURBQWdEK0wsR0FBSSxFQUEvRCxDQUFOO0FBQ0QsQ0FiRDs7QUFlQTFOLE9BQU8sQ0FBQytOLG1CQUFSLEdBQThCLFVBQVVDLElBQVYsRUFBZ0I7QUFFNUMsTUFBSSxDQUFDLENBQUNBLElBQUksQ0FBQ0MsV0FBTixJQUFxQixDQUFDLEtBQUtuQixlQUFMLENBQXFCa0IsSUFBSSxDQUFDQyxXQUExQixDQUF2QixLQUFrRSxDQUFDRCxJQUFJLENBQUNySSxHQUF4RSxJQUErRSxDQUFDcUksSUFBSSxDQUFDcEksVUFBekYsRUFBcUc7QUFDbkdoRSxvQkFBTzZDLGFBQVAsQ0FBcUIsZ0ZBQXJCO0FBQ0Q7O0FBQ0QsTUFBSXVKLElBQUksQ0FBQ0MsV0FBVCxFQUFzQjtBQUNwQixRQUFJRCxJQUFJLENBQUNySSxHQUFULEVBQWM7QUFFWi9ELHNCQUFPNkIsSUFBUCxDQUFhLHlGQUFiO0FBQ0Q7O0FBQ0QsUUFBSXVLLElBQUksQ0FBQ3BJLFVBQVQsRUFBcUI7QUFDbkJoRSxzQkFBTzZDLGFBQVAsQ0FBc0IsNEVBQXRCO0FBQ0Q7QUFDRjs7QUFFRCxTQUFPLElBQVA7QUFDRCxDQWhCRDs7QUFrQkF6RSxPQUFPLENBQUNrTyxTQUFSLEdBQW9CQyxrQkFBcEI7QUFDQW5PLE9BQU8sQ0FBQ3lLLFFBQVIsR0FBbUJBLHNCQUFuQjtlQUdlekssTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgcmV0cnksIHJldHJ5SW50ZXJ2YWwgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgcGF0aCBhcyB1bmljb2RlSU1FUGF0aCB9IGZyb20gJ2FwcGl1bS1hbmRyb2lkLWltZSc7XG5pbXBvcnQgeyBwYXRoIGFzIHNldHRpbmdzQXBrUGF0aCB9IGZyb20gJ2lvLmFwcGl1bS5zZXR0aW5ncyc7XG5pbXBvcnQgQm9vdHN0cmFwIGZyb20gJy4vYm9vdHN0cmFwJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBBREIgZnJvbSAnYXBwaXVtLWFkYic7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIHVubG9ja2VyLCBQSU5fVU5MT0NLLCBQQVNTV09SRF9VTkxPQ0ssXG4gICAgICAgICBQQVRURVJOX1VOTE9DSywgRklOR0VSUFJJTlRfVU5MT0NLIH0gZnJvbSAnLi91bmxvY2staGVscGVycyc7XG5cblxuY29uc3QgUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQgPSA5MDAwMDsgLy8gbWlsbGlzZWNvbmRzXG5jb25zdCBDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZID0ge1xuICBjaHJvbWU6IHtcbiAgICBwa2c6ICdjb20uYW5kcm9pZC5jaHJvbWUnLFxuICAgIGFjdGl2aXR5OiAnY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4nLFxuICB9LFxuICBjaHJvbWl1bToge1xuICAgIHBrZzogJ29yZy5jaHJvbWl1bS5jaHJvbWUuc2hlbGwnLFxuICAgIGFjdGl2aXR5OiAnLkNocm9tZVNoZWxsQWN0aXZpdHknLFxuICB9LFxuICBjaHJvbWViZXRhOiB7XG4gICAgcGtnOiAnY29tLmNocm9tZS5iZXRhJyxcbiAgICBhY3Rpdml0eTogJ2NvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluJyxcbiAgfSxcbiAgYnJvd3Nlcjoge1xuICAgIHBrZzogJ2NvbS5hbmRyb2lkLmJyb3dzZXInLFxuICAgIGFjdGl2aXR5OiAnY29tLmFuZHJvaWQuYnJvd3Nlci5Ccm93c2VyQWN0aXZpdHknLFxuICB9LFxuICAnY2hyb21pdW0tYnJvd3Nlcic6IHtcbiAgICBwa2c6ICdvcmcuY2hyb21pdW0uY2hyb21lJyxcbiAgICBhY3Rpdml0eTogJ2NvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluJyxcbiAgfSxcbiAgJ2Nocm9taXVtLXdlYnZpZXcnOiB7XG4gICAgcGtnOiAnb3JnLmNocm9taXVtLndlYnZpZXdfc2hlbGwnLFxuICAgIGFjdGl2aXR5OiAnb3JnLmNocm9taXVtLndlYnZpZXdfc2hlbGwuV2ViVmlld0Jyb3dzZXJBY3Rpdml0eScsXG4gIH0sXG4gIGRlZmF1bHQ6IHtcbiAgICBwa2c6ICdjb20uYW5kcm9pZC5jaHJvbWUnLFxuICAgIGFjdGl2aXR5OiAnY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4nLFxuICB9LFxufTtcbmNvbnN0IFNFVFRJTkdTX0hFTFBFUl9QS0dfSUQgPSAnaW8uYXBwaXVtLnNldHRpbmdzJztcbmNvbnN0IFNFVFRJTkdTX0hFTFBFUl9NQUlOX0FDVElWSVRZID0gJy5TZXR0aW5ncyc7XG5jb25zdCBTRVRUSU5HU19IRUxQRVJfVU5MT0NLX0FDVElWSVRZID0gJy5VbmxvY2snO1xuY29uc3QgVU5JQ09ERV9JTUVfUEtHX0lEID0gJ2lvLmFwcGl1bS5hbmRyb2lkLmltZSc7XG5cbmxldCBoZWxwZXJzID0ge307XG5cbmhlbHBlcnMuY3JlYXRlQmFzZUFEQiA9IGFzeW5jIGZ1bmN0aW9uIChvcHRzID0ge30pIHtcbiAgLy8gZmlsdGVyIG91dCBhbnkgdW53YW50ZWQgb3B0aW9ucyBzZW50IGluXG4gIC8vIHRoaXMgbGlzdCBzaG91bGQgYmUgdXBkYXRlZCBhcyBBREIgdGFrZXMgbW9yZSBhcmd1bWVudHNcbiAgY29uc3Qge1xuICAgIGphdmFWZXJzaW9uLFxuICAgIGFkYlBvcnQsXG4gICAgc3VwcHJlc3NLaWxsU2VydmVyLFxuICAgIHJlbW90ZUFkYkhvc3QsXG4gICAgY2xlYXJEZXZpY2VMb2dzT25TdGFydCxcbiAgICBhZGJFeGVjVGltZW91dCxcbiAgICB1c2VLZXlzdG9yZSxcbiAgICBrZXlzdG9yZVBhdGgsXG4gICAga2V5c3RvcmVQYXNzd29yZCxcbiAgICBrZXlBbGlhcyxcbiAgICBrZXlQYXNzd29yZCxcbiAgfSA9IG9wdHM7XG4gIHJldHVybiBhd2FpdCBBREIuY3JlYXRlQURCKHtcbiAgICBqYXZhVmVyc2lvbixcbiAgICBhZGJQb3J0LFxuICAgIHN1cHByZXNzS2lsbFNlcnZlcixcbiAgICByZW1vdGVBZGJIb3N0LFxuICAgIGNsZWFyRGV2aWNlTG9nc09uU3RhcnQsXG4gICAgYWRiRXhlY1RpbWVvdXQsXG4gICAgdXNlS2V5c3RvcmUsXG4gICAga2V5c3RvcmVQYXRoLFxuICAgIGtleXN0b3JlUGFzc3dvcmQsXG4gICAga2V5QWxpYXMsXG4gICAga2V5UGFzc3dvcmQsXG4gIH0pO1xufTtcblxuaGVscGVycy5wYXJzZUphdmFWZXJzaW9uID0gZnVuY3Rpb24gKHN0ZGVycikge1xuICBsZXQgbGluZXMgPSBzdGRlcnIuc3BsaXQoXCJcXG5cIik7XG4gIGZvciAobGV0IGxpbmUgb2YgbGluZXMpIHtcbiAgICBpZiAobmV3IFJlZ0V4cCgvKGphdmF8b3BlbmpkaykgdmVyc2lvbi8pLnRlc3QobGluZSkpIHtcbiAgICAgIHJldHVybiBsaW5lLnNwbGl0KFwiIFwiKVsyXS5yZXBsYWNlKC9cIi9nLCAnJyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufTtcblxuaGVscGVycy5nZXRKYXZhVmVyc2lvbiA9IGFzeW5jIGZ1bmN0aW9uIChsb2dWZXJzaW9uID0gdHJ1ZSkge1xuICBsZXQge3N0ZGVycn0gPSBhd2FpdCBleGVjKCdqYXZhJywgWyctdmVyc2lvbiddKTtcbiAgbGV0IGphdmFWZXIgPSBoZWxwZXJzLnBhcnNlSmF2YVZlcnNpb24oc3RkZXJyKTtcbiAgaWYgKGphdmFWZXIgPT09IG51bGwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZ2V0IHRoZSBKYXZhIHZlcnNpb24uIElzIEphdmEgaW5zdGFsbGVkP1wiKTtcbiAgfVxuICBpZiAobG9nVmVyc2lvbikge1xuICAgIGxvZ2dlci5pbmZvKGBKYXZhIHZlcnNpb24gaXM6ICR7amF2YVZlcn1gKTtcbiAgfVxuICByZXR1cm4gamF2YVZlcjtcbn07XG5cbmhlbHBlcnMucHJlcGFyZUVtdWxhdG9yID0gYXN5bmMgZnVuY3Rpb24gKGFkYiwgb3B0cykge1xuICBsZXQge1xuICAgIGF2ZCxcbiAgICBhdmRBcmdzLFxuICAgIGxhbmd1YWdlLFxuICAgIGxvY2FsZSxcbiAgICBhdmRMYXVuY2hUaW1lb3V0LFxuICAgIGF2ZFJlYWR5VGltZW91dCxcbiAgfSA9IG9wdHM7XG4gIGlmICghYXZkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGxhdW5jaCBBVkQgd2l0aG91dCBBVkQgbmFtZVwiKTtcbiAgfVxuICBsZXQgYXZkTmFtZSA9IGF2ZC5yZXBsYWNlKCdAJywgJycpO1xuICBsZXQgcnVubmluZ0FWRCA9IGF3YWl0IGFkYi5nZXRSdW5uaW5nQVZEKGF2ZE5hbWUpO1xuICBpZiAocnVubmluZ0FWRCAhPT0gbnVsbCkge1xuICAgIGlmIChhdmRBcmdzICYmIGF2ZEFyZ3MudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiLXdpcGUtZGF0YVwiKSA+IC0xKSB7XG4gICAgICBsb2dnZXIuZGVidWcoYEtpbGxpbmcgJyR7YXZkTmFtZX0nIGJlY2F1c2UgaXQgbmVlZHMgdG8gYmUgd2lwZWQgYXQgc3RhcnQuYCk7XG4gICAgICBhd2FpdCBhZGIua2lsbEVtdWxhdG9yKGF2ZE5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJOb3QgbGF1bmNoaW5nIEFWRCBiZWNhdXNlIGl0IGlzIGFscmVhZHkgcnVubmluZy5cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIGF2ZEFyZ3MgPSB0aGlzLnByZXBhcmVBVkRBcmdzKG9wdHMsIGFkYiwgYXZkQXJncyk7XG4gIGF3YWl0IGFkYi5sYXVuY2hBVkQoYXZkLCBhdmRBcmdzLCBsYW5ndWFnZSwgbG9jYWxlLCBhdmRMYXVuY2hUaW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICAgIGF2ZFJlYWR5VGltZW91dCk7XG59O1xuXG5oZWxwZXJzLnByZXBhcmVBVkRBcmdzID0gZnVuY3Rpb24gKG9wdHMsIGFkYiwgYXZkQXJncykge1xuICBsZXQgYXJncyA9IGF2ZEFyZ3MgPyBbYXZkQXJnc10gOiBbXTtcbiAgaWYgKCFfLmlzVW5kZWZpbmVkKG9wdHMubmV0d29ya1NwZWVkKSkge1xuICAgIGxldCBuZXR3b3JrU3BlZWQgPSB0aGlzLmVuc3VyZU5ldHdvcmtTcGVlZChhZGIsIG9wdHMubmV0d29ya1NwZWVkKTtcbiAgICBhcmdzLnB1c2goJy1uZXRzcGVlZCcsIG5ldHdvcmtTcGVlZCk7XG4gIH1cbiAgaWYgKG9wdHMuaXNIZWFkbGVzcykge1xuICAgIGFyZ3MucHVzaCgnLW5vLXdpbmRvdycpO1xuICB9XG4gIHJldHVybiBhcmdzLmpvaW4oJyAnKTtcbn07XG5cbmhlbHBlcnMuZW5zdXJlTmV0d29ya1NwZWVkID0gZnVuY3Rpb24gKGFkYiwgbmV0d29ya1NwZWVkKSB7XG4gIGlmIChfLnZhbHVlcyhhZGIuTkVUV09SS19TUEVFRCkuaW5kZXhPZihuZXR3b3JrU3BlZWQpICE9PSAtMSkge1xuICAgIHJldHVybiBuZXR3b3JrU3BlZWQ7XG4gIH1cbiAgbG9nZ2VyLndhcm4oYFdyb25nIG5ldHdvcmsgc3BlZWQgcGFyYW0gJHtuZXR3b3JrU3BlZWR9LCB1c2luZyBkZWZhdWx0OiBmdWxsLiBTdXBwb3J0ZWQgdmFsdWVzOiAke18udmFsdWVzKGFkYi5ORVRXT1JLX1NQRUVEKX1gKTtcbiAgcmV0dXJuIGFkYi5ORVRXT1JLX1NQRUVELkZVTEw7XG59O1xuXG5oZWxwZXJzLmVuc3VyZURldmljZUxvY2FsZSA9IGFzeW5jIGZ1bmN0aW9uIChhZGIsIGxhbmd1YWdlLCBjb3VudHJ5KSB7XG4gIGlmICghXy5pc1N0cmluZyhsYW5ndWFnZSkgJiYgIV8uaXNTdHJpbmcoY291bnRyeSkpIHtcbiAgICBsb2dnZXIud2Fybihgc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IHJlcXVpcmVzIGxhbmd1YWdlIG9yIGNvdW50cnkuYCk7XG4gICAgbG9nZ2VyLndhcm4oYEdvdCBsYW5ndWFnZTogJyR7bGFuZ3VhZ2V9JyBhbmQgY291bnRyeTogJyR7Y291bnRyeX0nYCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgYXdhaXQgYWRiLnNldERldmljZUxhbmd1YWdlQ291bnRyeShsYW5ndWFnZSwgY291bnRyeSk7XG5cbiAgaWYgKCFhd2FpdCBhZGIuZW5zdXJlQ3VycmVudExvY2FsZShsYW5ndWFnZSwgY291bnRyeSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBzZXQgbGFuZ3VhZ2U6ICR7bGFuZ3VhZ2V9IGFuZCBjb3VudHJ5OiAke2NvdW50cnl9YCk7XG4gIH1cbn07XG5cbmhlbHBlcnMuZ2V0RGV2aWNlSW5mb0Zyb21DYXBzID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICAvLyB3ZSBjYW4gY3JlYXRlIGEgdGhyb3dhd2F5IEFEQiBpbnN0YW5jZSBoZXJlLCBzbyB0aGVyZSBpcyBubyBkZXBlbmRlbmN5XG4gIC8vIG9uIGluc3RhbnRpYXRpbmcgb24gZWFybGllciAoYXQgdGhpcyBwb2ludCwgd2UgaGF2ZSBubyB1ZGlkKVxuICAvLyB3ZSBjYW4gb25seSB1c2UgdGhpcyBBREIgb2JqZWN0IGZvciBjb21tYW5kcyB0aGF0IHdvdWxkIG5vdCBiZSBjb25mdXNlZFxuICAvLyBpZiBtdWx0aXBsZSBkZXZpY2VzIGFyZSBjb25uZWN0ZWRcbiAgY29uc3QgYWRiID0gYXdhaXQgaGVscGVycy5jcmVhdGVCYXNlQURCKG9wdHMpO1xuICBsZXQgdWRpZCA9IG9wdHMudWRpZDtcbiAgbGV0IGVtUG9ydCA9IG51bGw7XG5cbiAgLy8gYSBzcGVjaWZpYyBhdmQgbmFtZSB3YXMgZ2l2ZW4uIHRyeSB0byBpbml0aWFsaXplIHdpdGggdGhhdFxuICBpZiAob3B0cy5hdmQpIHtcbiAgICBhd2FpdCBoZWxwZXJzLnByZXBhcmVFbXVsYXRvcihhZGIsIG9wdHMpO1xuICAgIHVkaWQgPSBhZGIuY3VyRGV2aWNlSWQ7XG4gICAgZW1Qb3J0ID0gYWRiLmVtdWxhdG9yUG9ydDtcbiAgfSBlbHNlIHtcbiAgICAvLyBubyBhdmQgZ2l2ZW4uIGxldHMgdHJ5IHdoYXRldmVyJ3MgcGx1Z2dlZCBpbiBkZXZpY2VzL2VtdWxhdG9yc1xuICAgIGxvZ2dlci5pbmZvKFwiUmV0cmlldmluZyBkZXZpY2UgbGlzdFwiKTtcbiAgICBsZXQgZGV2aWNlcyA9IGF3YWl0IGFkYi5nZXREZXZpY2VzV2l0aFJldHJ5KCk7XG5cbiAgICAvLyB1ZGlkIHdhcyBnaXZlbiwgbGV0cyB0cnkgdG8gaW5pdCB3aXRoIHRoYXQgZGV2aWNlXG4gICAgaWYgKHVkaWQpIHtcbiAgICAgIGlmICghXy5pbmNsdWRlcyhfLm1hcChkZXZpY2VzLCAndWRpZCcpLCB1ZGlkKSkge1xuICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhgRGV2aWNlICR7dWRpZH0gd2FzIG5vdCBpbiB0aGUgbGlzdCBvZiBjb25uZWN0ZWQgZGV2aWNlc2ApO1xuICAgICAgfVxuICAgICAgZW1Qb3J0ID0gYWRiLmdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmcodWRpZCk7XG4gICAgfSBlbHNlIGlmIChvcHRzLnBsYXRmb3JtVmVyc2lvbikge1xuICAgICAgb3B0cy5wbGF0Zm9ybVZlcnNpb24gPSBgJHtvcHRzLnBsYXRmb3JtVmVyc2lvbn1gLnRyaW0oKTtcblxuICAgICAgLy8gYSBwbGF0Zm9ybSB2ZXJzaW9uIHdhcyBnaXZlbi4gbGV0cyB0cnkgdG8gZmluZCBhIGRldmljZSB3aXRoIHRoZSBzYW1lIG9zXG4gICAgICBsb2dnZXIuaW5mbyhgTG9va2luZyBmb3IgYSBkZXZpY2Ugd2l0aCBBbmRyb2lkICcke29wdHMucGxhdGZvcm1WZXJzaW9ufSdgKTtcblxuICAgICAgLy8gaW4gY2FzZSB3ZSBmYWlsIHRvIGZpbmQgc29tZXRoaW5nLCBnaXZlIHRoZSB1c2VyIGEgdXNlZnVsIGxvZyB0aGF0IGhhc1xuICAgICAgLy8gdGhlIGRldmljZSB1ZGlkcyBhbmQgb3MgdmVyc2lvbnMgc28gdGhleSBrbm93IHdoYXQncyBhdmFpbGFibGVcbiAgICAgIGxldCBhdmFpbERldmljZXNTdHIgPSBbXTtcblxuICAgICAgLy8gZmlyc3QgdHJ5IHN0YXJ0ZWQgZGV2aWNlcy9lbXVsYXRvcnNcbiAgICAgIGZvciAobGV0IGRldmljZSBvZiBkZXZpY2VzKSB7XG4gICAgICAgIC8vIGRpcmVjdCBhZGIgY2FsbHMgdG8gdGhlIHNwZWNpZmljIGRldmljZVxuICAgICAgICBhd2FpdCBhZGIuc2V0RGV2aWNlSWQoZGV2aWNlLnVkaWQpO1xuICAgICAgICBsZXQgZGV2aWNlT1MgPSBhd2FpdCBhZGIuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG5cbiAgICAgICAgLy8gYnVpbGQgdXAgb3VyIGluZm8gc3RyaW5nIG9mIGF2YWlsYWJsZSBkZXZpY2VzIGFzIHdlIGl0ZXJhdGVcbiAgICAgICAgYXZhaWxEZXZpY2VzU3RyLnB1c2goYCR7ZGV2aWNlLnVkaWR9ICgke2RldmljZU9TfSlgKTtcblxuICAgICAgICAvLyB3ZSBkbyBhIGJlZ2lucyB3aXRoIGNoZWNrIGZvciBpbXBsaWVkIHdpbGRjYXJkIG1hdGNoaW5nXG4gICAgICAgIC8vIGVnOiA0IG1hdGNoZXMgNC4xLCA0LjAsIDQuMS4zLXNhbXN1bmcsIGV0Y1xuICAgICAgICBpZiAoZGV2aWNlT1MuaW5kZXhPZihvcHRzLnBsYXRmb3JtVmVyc2lvbikgPT09IDApIHtcbiAgICAgICAgICB1ZGlkID0gZGV2aWNlLnVkaWQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gd2UgY291bGRuJ3QgZmluZCBhbnl0aGluZyEgcXVpdFxuICAgICAgaWYgKCF1ZGlkKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KGBVbmFibGUgdG8gZmluZCBhbiBhY3RpdmUgZGV2aWNlIG9yIGVtdWxhdG9yIGAgK1xuICAgICAgICAgIGB3aXRoIE9TICR7b3B0cy5wbGF0Zm9ybVZlcnNpb259LiBUaGUgZm9sbG93aW5nIGFyZSBhdmFpbGFibGU6IGAgKyBhdmFpbERldmljZXNTdHIuam9pbignLCAnKSk7XG4gICAgICB9XG5cbiAgICAgIGVtUG9ydCA9IGFkYi5nZXRQb3J0RnJvbUVtdWxhdG9yU3RyaW5nKHVkaWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBhIHVkaWQgd2FzIG5vdCBnaXZlbiwgZ3JhYiB0aGUgZmlyc3QgZGV2aWNlIHdlIHNlZVxuICAgICAgdWRpZCA9IGRldmljZXNbMF0udWRpZDtcbiAgICAgIGVtUG9ydCA9IGFkYi5nZXRQb3J0RnJvbUVtdWxhdG9yU3RyaW5nKHVkaWQpO1xuICAgIH1cbiAgfVxuXG4gIGxvZ2dlci5pbmZvKGBVc2luZyBkZXZpY2U6ICR7dWRpZH1gKTtcbiAgcmV0dXJuIHt1ZGlkLCBlbVBvcnR9O1xufTtcblxuLy8gcmV0dXJucyBhIG5ldyBhZGIgaW5zdGFuY2Ugd2l0aCBkZXZpY2VJZCBzZXRcbmhlbHBlcnMuY3JlYXRlQURCID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICBjb25zdCB7dWRpZCwgZW1Qb3J0fSA9IG9wdHM7XG4gIGNvbnN0IGFkYiA9IGF3YWl0IGhlbHBlcnMuY3JlYXRlQmFzZUFEQihvcHRzKTtcbiAgYWRiLnNldERldmljZUlkKHVkaWQpO1xuICBpZiAoZW1Qb3J0KSB7XG4gICAgYWRiLnNldEVtdWxhdG9yUG9ydChlbVBvcnQpO1xuICB9XG5cbiAgcmV0dXJuIGFkYjtcbn07XG5cbmhlbHBlcnMudmFsaWRhdGVQYWNrYWdlQWN0aXZpdHlOYW1lcyA9IGZ1bmN0aW9uIChvcHRzKSB7XG4gIGZvciAoY29uc3Qga2V5IG9mIFsnYXBwUGFja2FnZScsICdhcHBBY3Rpdml0eScsICdhcHBXYWl0UGFja2FnZScsICdhcHBXYWl0QWN0aXZpdHknXSkge1xuICAgIGNvbnN0IG5hbWUgPSBvcHRzW2tleV07XG4gICAgaWYgKCFuYW1lKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBtYXRjaCA9IC8oW15cXHcuKixdKSsvLmV4ZWMobmFtZSk7XG4gICAgaWYgKCFtYXRjaCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgbG9nZ2VyLndhcm4oYENhcGFiaWxpdHkgJyR7a2V5fScgaXMgZXhwZWN0ZWQgdG8gb25seSBpbmNsdWRlIGxhdGluIGxldHRlcnMsIGRpZ2l0cywgdW5kZXJzY29yZSwgZG90LCBjb21tYSBhbmQgYXN0ZXJpc2sgY2hhcmFjdGVycy5gKTtcbiAgICBsb2dnZXIud2FybihgQ3VycmVudCB2YWx1ZSAnJHtuYW1lfScgaGFzIG5vbi1tYXRjaGluZyBjaGFyYWN0ZXIgYXQgaW5kZXggJHttYXRjaC5pbmRleH06ICcke25hbWUuc3Vic3RyaW5nKDAsIG1hdGNoLmluZGV4ICsgMSl9J2ApO1xuICB9XG59O1xuXG5oZWxwZXJzLmdldExhdW5jaEluZm8gPSBhc3luYyBmdW5jdGlvbiAoYWRiLCBvcHRzKSB7XG4gIGxldCB7YXBwLCBhcHBQYWNrYWdlLCBhcHBBY3Rpdml0eSwgYXBwV2FpdFBhY2thZ2UsIGFwcFdhaXRBY3Rpdml0eX0gPSBvcHRzO1xuICBpZiAoIWFwcCkge1xuICAgIGxvZ2dlci53YXJuKFwiTm8gYXBwIHNlbnQgaW4sIG5vdCBwYXJzaW5nIHBhY2thZ2UvYWN0aXZpdHlcIik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy52YWxpZGF0ZVBhY2thZ2VBY3Rpdml0eU5hbWVzKG9wdHMpO1xuXG4gIGlmIChhcHBQYWNrYWdlICYmIGFwcEFjdGl2aXR5KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKFwiUGFyc2luZyBwYWNrYWdlIGFuZCBhY3Rpdml0eSBmcm9tIGFwcCBtYW5pZmVzdFwiKTtcbiAgbGV0IHthcGtQYWNrYWdlLCBhcGtBY3Rpdml0eX0gPVxuICAgIGF3YWl0IGFkYi5wYWNrYWdlQW5kTGF1bmNoQWN0aXZpdHlGcm9tTWFuaWZlc3QoYXBwKTtcbiAgaWYgKGFwa1BhY2thZ2UgJiYgIWFwcFBhY2thZ2UpIHtcbiAgICBhcHBQYWNrYWdlID0gYXBrUGFja2FnZTtcbiAgfVxuICBpZiAoIWFwcFdhaXRQYWNrYWdlKSB7XG4gICAgYXBwV2FpdFBhY2thZ2UgPSBhcHBQYWNrYWdlO1xuICB9XG4gIGlmIChhcGtBY3Rpdml0eSAmJiAhYXBwQWN0aXZpdHkpIHtcbiAgICBhcHBBY3Rpdml0eSA9IGFwa0FjdGl2aXR5O1xuICB9XG4gIGlmICghYXBwV2FpdEFjdGl2aXR5KSB7XG4gICAgYXBwV2FpdEFjdGl2aXR5ID0gYXBwQWN0aXZpdHk7XG4gIH1cbiAgbG9nZ2VyLmRlYnVnKGBQYXJzZWQgcGFja2FnZSBhbmQgYWN0aXZpdHkgYXJlOiAke2Fwa1BhY2thZ2V9LyR7YXBrQWN0aXZpdHl9YCk7XG4gIHJldHVybiB7YXBwUGFja2FnZSwgYXBwV2FpdFBhY2thZ2UsIGFwcEFjdGl2aXR5LCBhcHBXYWl0QWN0aXZpdHl9O1xufTtcblxuaGVscGVycy5yZXNldEFwcCA9IGFzeW5jIGZ1bmN0aW9uIChhZGIsIG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgYXBwLFxuICAgIGFwcFBhY2thZ2UsXG4gICAgZmFzdFJlc2V0LFxuICAgIGZ1bGxSZXNldCxcbiAgICBhbmRyb2lkSW5zdGFsbFRpbWVvdXQgPSBQQUNLQUdFX0lOU1RBTExfVElNRU9VVCxcbiAgICBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICBhbGxvd1Rlc3RQYWNrYWdlc1xuICB9ID0gb3B0cztcblxuICBpZiAoIWFwcFBhY2thZ2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCInYXBwUGFja2FnZScgb3B0aW9uIGlzIHJlcXVpcmVkXCIpO1xuICB9XG5cbiAgY29uc3QgaXNJbnN0YWxsZWQgPSBhd2FpdCBhZGIuaXNBcHBJbnN0YWxsZWQoYXBwUGFja2FnZSk7XG5cbiAgaWYgKGlzSW5zdGFsbGVkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGFkYi5mb3JjZVN0b3AoYXBwUGFja2FnZSk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICAgIC8vIGZ1bGxSZXNldCBoYXMgcHJpb3JpdHkgb3ZlciBmYXN0UmVzZXRcbiAgICBpZiAoIWZ1bGxSZXNldCAmJiBmYXN0UmVzZXQpIHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGF3YWl0IGFkYi5jbGVhcihhcHBQYWNrYWdlKTtcbiAgICAgIGlmIChfLmlzU3RyaW5nKG91dHB1dCkgJiYgb3V0cHV0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2ZhaWxlZCcpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNsZWFyIHRoZSBhcHBsaWNhdGlvbiBkYXRhIG9mICcke2FwcFBhY2thZ2V9Jy4gT3JpZ2luYWwgZXJyb3I6ICR7b3V0cHV0fWApO1xuICAgICAgfVxuICAgICAgLy8gZXhlY3V0aW5nIGBzaGVsbCBwbSBjbGVhcmAgcmVzZXRzIHByZXZpb3VzbHkgYXNzaWduZWQgYXBwbGljYXRpb24gcGVybWlzc2lvbnMgYXMgd2VsbFxuICAgICAgaWYgKGF1dG9HcmFudFBlcm1pc3Npb25zKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgYWRiLmdyYW50QWxsUGVybWlzc2lvbnMoYXBwUGFja2FnZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKGBVbmFibGUgdG8gZ3JhbnQgcGVybWlzc2lvbnMgcmVxdWVzdGVkLiBPcmlnaW5hbCBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsb2dnZXIuZGVidWcoYFBlcmZvcm1lZCBmYXN0IHJlc2V0IG9uIHRoZSBpbnN0YWxsZWQgJyR7YXBwUGFja2FnZX0nIGFwcGxpY2F0aW9uIChzdG9wIGFuZCBjbGVhcilgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cblxuICBpZiAoIWFwcCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIidhcHAnIG9wdGlvbiBpcyByZXF1aXJlZCBmb3IgcmVpbnN0YWxsXCIpO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKGBSdW5uaW5nIGZ1bGwgcmVzZXQgb24gJyR7YXBwUGFja2FnZX0nIChyZWluc3RhbGwpYCk7XG4gIGlmIChpc0luc3RhbGxlZCkge1xuICAgIGF3YWl0IGFkYi51bmluc3RhbGxBcGsoYXBwUGFja2FnZSk7XG4gIH1cbiAgYXdhaXQgYWRiLmluc3RhbGwoYXBwLCB7XG4gICAgZ3JhbnRQZXJtaXNzaW9uczogYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgdGltZW91dDogYW5kcm9pZEluc3RhbGxUaW1lb3V0LFxuICAgIGFsbG93VGVzdFBhY2thZ2VzLFxuICB9KTtcbn07XG5cbmhlbHBlcnMuaW5zdGFsbEFwayA9IGFzeW5jIGZ1bmN0aW9uIChhZGIsIG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgYXBwLFxuICAgIGFwcFBhY2thZ2UsXG4gICAgZmFzdFJlc2V0LFxuICAgIGZ1bGxSZXNldCxcbiAgICBhbmRyb2lkSW5zdGFsbFRpbWVvdXQgPSBQQUNLQUdFX0lOU1RBTExfVElNRU9VVCxcbiAgICBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICBhbGxvd1Rlc3RQYWNrYWdlc1xuICB9ID0gb3B0cztcblxuICBpZiAoIWFwcCB8fCAhYXBwUGFja2FnZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIidhcHAnIGFuZCAnYXBwUGFja2FnZScgb3B0aW9ucyBhcmUgcmVxdWlyZWRcIik7XG4gIH1cblxuICBpZiAoZnVsbFJlc2V0KSB7XG4gICAgYXdhaXQgdGhpcy5yZXNldEFwcChhZGIsIG9wdHMpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIFRoZXJlIGlzIG5vIG5lZWQgdG8gcmVzZXQgdGhlIG5ld2x5IGluc3RhbGxlZCBhcHBcbiAgY29uc3Qgc2hvdWxkUGVyZm9ybUZhc3RSZXNldCA9IGZhc3RSZXNldCAmJiBhd2FpdCBhZGIuaXNBcHBJbnN0YWxsZWQoYXBwUGFja2FnZSk7XG5cbiAgYXdhaXQgYWRiLmluc3RhbGxPclVwZ3JhZGUoYXBwLCBhcHBQYWNrYWdlLCB7XG4gICAgZ3JhbnRQZXJtaXNzaW9uczogYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgdGltZW91dDogYW5kcm9pZEluc3RhbGxUaW1lb3V0LFxuICAgIGFsbG93VGVzdFBhY2thZ2VzLFxuICB9KTtcblxuICBpZiAoc2hvdWxkUGVyZm9ybUZhc3RSZXNldCkge1xuICAgIGxvZ2dlci5pbmZvKGBQZXJmb3JtaW5nIGZhc3QgcmVzZXQgb24gJyR7YXBwUGFja2FnZX0nYCk7XG4gICAgYXdhaXQgdGhpcy5yZXNldEFwcChhZGIsIG9wdHMpO1xuICB9XG59O1xuXG4vKipcbiAqIEluc3RhbGxzIGFuIGFycmF5IG9mIGFwa3NcbiAqIEBwYXJhbSB7QURCfSBhZGIgSW5zdGFuY2Ugb2YgQXBwaXVtIEFEQiBvYmplY3RcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIE9wdHMgZGVmaW5lZCBpbiBkcml2ZXIuanNcbiAqL1xuaGVscGVycy5pbnN0YWxsT3RoZXJBcGtzID0gYXN5bmMgZnVuY3Rpb24gKG90aGVyQXBwcywgYWRiLCBvcHRzKSB7XG4gIGxldCB7XG4gICAgYW5kcm9pZEluc3RhbGxUaW1lb3V0ID0gUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQsXG4gICAgYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgYWxsb3dUZXN0UGFja2FnZXNcbiAgfSA9IG9wdHM7XG5cbiAgLy8gSW5zdGFsbCBhbGwgb2YgdGhlIEFQSydzIGFzeW5jaHJvbm91c2x5XG4gIGF3YWl0IEIuYWxsKG90aGVyQXBwcy5tYXAoKG90aGVyQXBwKSA9PiB7XG4gICAgbG9nZ2VyLmRlYnVnKGBJbnN0YWxsaW5nIGFwcDogJHtvdGhlckFwcH1gKTtcbiAgICByZXR1cm4gYWRiLmluc3RhbGxPclVwZ3JhZGUob3RoZXJBcHAsIG51bGwsIHtcbiAgICAgIGdyYW50UGVybWlzc2lvbnM6IGF1dG9HcmFudFBlcm1pc3Npb25zLFxuICAgICAgdGltZW91dDogYW5kcm9pZEluc3RhbGxUaW1lb3V0LFxuICAgICAgYWxsb3dUZXN0UGFja2FnZXMsXG4gICAgfSk7XG4gIH0pKTtcbn07XG5cbmhlbHBlcnMuaW5pdFVuaWNvZGVLZXlib2FyZCA9IGFzeW5jIGZ1bmN0aW9uIChhZGIpIHtcbiAgbG9nZ2VyLmRlYnVnKCdFbmFibGluZyBVbmljb2RlIGtleWJvYXJkIHN1cHBvcnQnKTtcbiAgbG9nZ2VyLmRlYnVnKFwiUHVzaGluZyB1bmljb2RlIGltZSB0byBkZXZpY2UuLi5cIik7XG4gIHRyeSB7XG4gICAgYXdhaXQgYWRiLmluc3RhbGwodW5pY29kZUlNRVBhdGgsIHtyZXBsYWNlOiBmYWxzZX0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIuaW5mbyhgUGVyZm9ybWluZyBmdWxsIHJlaW5zdGFsbCBvZiAke1VOSUNPREVfSU1FX1BLR19JRH0gYXMgYSBwb3NzaWJsZSBmaXggZm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIGF3YWl0IGFkYi51bmluc3RhbGxBcGsoVU5JQ09ERV9JTUVfUEtHX0lEKTtcbiAgICBhd2FpdCBhZGIuaW5zdGFsbCh1bmljb2RlSU1FUGF0aCwge3JlcGxhY2U6IGZhbHNlfSk7XG4gIH1cblxuICAvLyBnZXQgdGhlIGRlZmF1bHQgSU1FIHNvIHdlIGNhbiByZXR1cm4gYmFjayB0byBpdCBsYXRlciBpZiB3ZSB3YW50XG4gIGxldCBkZWZhdWx0SU1FID0gYXdhaXQgYWRiLmRlZmF1bHRJTUUoKTtcblxuICBsb2dnZXIuZGVidWcoYFVuc2V0dGluZyBwcmV2aW91cyBJTUUgJHtkZWZhdWx0SU1FfWApO1xuICBjb25zdCBhcHBpdW1JTUUgPSBgJHtVTklDT0RFX0lNRV9QS0dfSUR9Ly5Vbmljb2RlSU1FYDtcbiAgbG9nZ2VyLmRlYnVnKGBTZXR0aW5nIElNRSB0byAnJHthcHBpdW1JTUV9J2ApO1xuICBhd2FpdCBhZGIuZW5hYmxlSU1FKGFwcGl1bUlNRSk7XG4gIGF3YWl0IGFkYi5zZXRJTUUoYXBwaXVtSU1FKTtcbiAgcmV0dXJuIGRlZmF1bHRJTUU7XG59O1xuXG5oZWxwZXJzLnNldE1vY2tMb2NhdGlvbkFwcCA9IGFzeW5jIGZ1bmN0aW9uIChhZGIsIGFwcCkge1xuICB0cnkge1xuICAgIGlmIChhd2FpdCBhZGIuZ2V0QXBpTGV2ZWwoKSA8IDIzKSB7XG4gICAgICBhd2FpdCBhZGIuc2hlbGwoWydzZXR0aW5ncycsICdwdXQnLCAnc2VjdXJlJywgJ21vY2tfbG9jYXRpb24nLCAnMSddKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgYWRiLnNoZWxsKFsnYXBwb3BzJywgJ3NldCcsIGFwcCwgJ2FuZHJvaWQ6bW9ja19sb2NhdGlvbicsICdhbGxvdyddKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci53YXJuKGBVbmFibGUgdG8gc2V0IG1vY2sgbG9jYXRpb24gZm9yIGFwcCAnJHthcHB9JzogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuaGVscGVycy5pbnN0YWxsSGVscGVyQXBwID0gYXN5bmMgZnVuY3Rpb24gKGFkYiwgYXBrUGF0aCwgcGFja2FnZUlkLCBhcHBOYW1lKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgYWRiLmluc3RhbGxPclVwZ3JhZGUoYXBrUGF0aCwgcGFja2FnZUlkLCB7Z3JhbnRQZXJtaXNzaW9uczogdHJ1ZX0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIud2FybihgSWdub3JlZCBlcnJvciB3aGlsZSBpbnN0YWxsaW5nIEFwcGl1bSAke2FwcE5hbWV9IGhlbHBlcjogYCArXG4gICAgICAgICAgICAgICAgYCcke2Vyci5tZXNzYWdlfScuIE1hbnVhbGx5IHVuaW5zdGFsbGluZyB0aGUgYXBwbGljYXRpb24gYCArXG4gICAgICAgICAgICAgICAgYHdpdGggcGFja2FnZSBpZCAnJHtwYWNrYWdlSWR9JyBtYXkgaGVscC4gRXhwZWN0IHNvbWUgQXBwaXVtIGAgK1xuICAgICAgICAgICAgICAgIGBmZWF0dXJlcyBtYXkgbm90IHdvcmsgYXMgZXhwZWN0ZWQgdW5sZXNzIHRoaXMgcHJvYmxlbSBpcyBgICtcbiAgICAgICAgICAgICAgICBgZml4ZWQuYCk7XG4gIH1cbn07XG5cbmhlbHBlcnMucHVzaFNldHRpbmdzQXBwID0gYXN5bmMgZnVuY3Rpb24gKGFkYiwgdGhyb3dFcnJvciA9IGZhbHNlKSB7XG4gIGxvZ2dlci5kZWJ1ZyhcIlB1c2hpbmcgc2V0dGluZ3MgYXBrIHRvIGRldmljZS4uLlwiKTtcblxuICBhd2FpdCBoZWxwZXJzLmluc3RhbGxIZWxwZXJBcHAoYWRiLCBzZXR0aW5nc0Fwa1BhdGgsIFNFVFRJTkdTX0hFTFBFUl9QS0dfSUQsICdTZXR0aW5ncycpO1xuXG4gIC8vIFJlaW5zdGFsbCB3aWxsIHN0b3AgdGhlIHNldHRpbmdzIGhlbHBlciBwcm9jZXNzIGFueXdheSwgc29cbiAgLy8gdGhlcmUgaXMgbm8gbmVlZCB0byBjb250aW51ZSBpZiB0aGUgYXBwbGljYXRpb24gaXMgc3RpbGwgcnVubmluZ1xuICBpZiAoYXdhaXQgYWRiLnByb2Nlc3NFeGlzdHMoU0VUVElOR1NfSEVMUEVSX1BLR19JRCkpIHtcbiAgICBsb2dnZXIuZGVidWcoYCR7U0VUVElOR1NfSEVMUEVSX1BLR19JRH0gaXMgYWxyZWFkeSBydW5uaW5nLiBgICtcbiAgICAgIGBUaGVyZSBpcyBubyBuZWVkIHRvIHJlc2V0IGl0cyBwZXJtaXNzaW9ucy5gKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBsYXVjaCBpby5hcHBpdW0uc2V0dGluZ3MgYXBwIGR1ZSB0byBzZXR0aW5ncyBmYWlsaW5nIHRvIGJlIHNldFxuICAvLyBpZiB0aGUgYXBwIGlzIG5vdCBsYXVuY2hlZCBwcmlvciB0byBzdGFydCB0aGUgc2Vzc2lvbiBvbiBhbmRyb2lkIDcrXG4gIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9pc3N1ZXMvODk1N1xuICB0cnkge1xuICAgIGF3YWl0IGFkYi5zdGFydEFwcCh7XG4gICAgICBwa2c6IFNFVFRJTkdTX0hFTFBFUl9QS0dfSUQsXG4gICAgICBhY3Rpdml0eTogU0VUVElOR1NfSEVMUEVSX01BSU5fQUNUSVZJVFksXG4gICAgICBhY3Rpb246IFwiYW5kcm9pZC5pbnRlbnQuYWN0aW9uLk1BSU5cIixcbiAgICAgIGNhdGVnb3J5OiBcImFuZHJvaWQuaW50ZW50LmNhdGVnb3J5LkxBVU5DSEVSXCIsXG4gICAgICBmbGFnczogXCIweDEwMjAwMDAwXCIsXG4gICAgICBzdG9wQXBwOiBmYWxzZSxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLndhcm4oYEZhaWxlZCB0byBsYXVuY2ggc2V0dGluZ3MgYXBwOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIGlmICh0aHJvd0Vycm9yKSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIEV4dHJhY3RzIHN0cmluZy54bWwgYW5kIGNvbnZlcnRzIGl0IHRvIHN0cmluZy5qc29uIGFuZCBwdXNoZXNcbiAqIGl0IHRvIC9kYXRhL2xvY2FsL3RtcC9zdHJpbmcuanNvbiBvbiBmb3IgdXNlIG9mIGJvb3RzdHJhcFxuICogSWYgYXBwIGlzIG5vdCBwcmVzZW50IHRvIGV4dHJhY3Qgc3RyaW5nLnhtbCBpdCBkZWxldGVzIHJlbW90ZSBzdHJpbmdzLmpzb25cbiAqIElmIGFwcCBkb2VzIG5vdCBoYXZlIHN0cmluZ3MueG1sIHdlIHB1c2ggYW4gZW1wdHkganNvbiBvYmplY3QgdG8gcmVtb3RlXG4gKlxuICogQHBhcmFtIHs/c3RyaW5nfSBsYW5ndWFnZSAtIExhbmd1YWdlIGFiYnJldmlhdGlvbiwgZm9yIGV4YW1wbGUgJ2ZyJy4gVGhlIGRlZmF1bHQgbGFuZ3VhZ2VcbiAqIGlzIHVzZWQgaWYgdGhpcyBhcmd1bWVudCBpcyBub3QgZGVmaW5lZC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBhZGIgLSBUaGUgYWRiIG1vZmR1bGUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyAtIERyaXZlciBvcHRpb25zIGRpY3Rpb25hcnkuXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBUaGUgZGljdGlvbmFyeSwgd2hlcmUgc3RyaW5nIHJlc291cnRjZXMgaWRlbnRpZmllcnMgYXJlIGtleXNcbiAqIGFsb25nIHdpdGggdGhlaXIgY29ycmVzcG9uZGluZyB2YWx1ZXMgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZSBvciBhbiBlbXB0eSBvYmplY3RcbiAqIGlmIG5vIG1hdGNoaW5nIHJlc291cmNlcyB3ZXJlIGV4dHJhY3RlZC5cbiAqL1xuaGVscGVycy5wdXNoU3RyaW5ncyA9IGFzeW5jIGZ1bmN0aW9uIChsYW5ndWFnZSwgYWRiLCBvcHRzKSB7XG4gIGNvbnN0IHJlbW90ZURpciA9ICcvZGF0YS9sb2NhbC90bXAnO1xuICBjb25zdCBzdHJpbmdzSnNvbiA9ICdzdHJpbmdzLmpzb24nO1xuICBjb25zdCByZW1vdGVGaWxlID0gYCR7cmVtb3RlRGlyfS8ke3N0cmluZ3NKc29ufWA7XG5cbiAgLy8gY2xlYW4gdXAgcmVtb3RlIHN0cmluZy5qc29uIGlmIHByZXNlbnRcbiAgYXdhaXQgYWRiLnJpbXJhZihyZW1vdGVGaWxlKTtcblxuICBsZXQgYXBwO1xuICB0cnkge1xuICAgIGFwcCA9IG9wdHMuYXBwIHx8IGF3YWl0IGFkYi5wdWxsQXBrKG9wdHMuYXBwUGFja2FnZSwgb3B0cy50bXBEaXIpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIuaW5mbyhgRmFpbGVkIHRvIHB1bGwgYW4gYXBrIGZyb20gJyR7b3B0cy5hcHBQYWNrYWdlfScgdG8gJyR7b3B0cy50bXBEaXJ9Jy4gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cblxuICBpZiAoXy5pc0VtcHR5KG9wdHMuYXBwUGFja2FnZSkgfHwgIShhd2FpdCBmcy5leGlzdHMoYXBwKSkpIHtcbiAgICBsb2dnZXIuZGVidWcoYE5vIGFwcCBvciBwYWNrYWdlIHNwZWNpZmllZC4gUmV0dXJuaW5nIGVtcHR5IHN0cmluZ3NgKTtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBjb25zdCBzdHJpbmdzVG1wRGlyID0gcGF0aC5yZXNvbHZlKG9wdHMudG1wRGlyLCBvcHRzLmFwcFBhY2thZ2UpO1xuICB0cnkge1xuICAgIGxvZ2dlci5kZWJ1ZygnRXh0cmFjdGluZyBzdHJpbmdzIGZyb20gYXBrJywgYXBwLCBsYW5ndWFnZSwgc3RyaW5nc1RtcERpcik7XG4gICAgY29uc3Qge2Fwa1N0cmluZ3MsIGxvY2FsUGF0aH0gPSBhd2FpdCBhZGIuZXh0cmFjdFN0cmluZ3NGcm9tQXBrKGFwcCwgbGFuZ3VhZ2UsIHN0cmluZ3NUbXBEaXIpO1xuICAgIGF3YWl0IGFkYi5wdXNoKGxvY2FsUGF0aCwgcmVtb3RlRGlyKTtcbiAgICByZXR1cm4gYXBrU3RyaW5ncztcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLndhcm4oYENvdWxkIG5vdCBnZXQgc3RyaW5ncywgY29udGludWluZyBhbnl3YXkuIE9yaWdpbmFsIGVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIGF3YWl0IGFkYi5zaGVsbCgnZWNobycsIFtgJ3t9JyA+ICR7cmVtb3RlRmlsZX1gXSk7XG4gIH0gZmluYWxseSB7XG4gICAgYXdhaXQgZnMucmltcmFmKHN0cmluZ3NUbXBEaXIpO1xuICB9XG4gIHJldHVybiB7fTtcbn07XG5cbmhlbHBlcnMudW5sb2NrV2l0aFVJQXV0b21hdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIChkcml2ZXIsIGFkYiwgdW5sb2NrQ2FwYWJpbGl0aWVzKSB7XG4gIGxldCB1bmxvY2tUeXBlID0gdW5sb2NrQ2FwYWJpbGl0aWVzLnVubG9ja1R5cGU7XG4gIGlmICghdW5sb2NrZXIuaXNWYWxpZFVubG9ja1R5cGUodW5sb2NrVHlwZSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgdW5sb2NrIHR5cGUgJHt1bmxvY2tUeXBlfWApO1xuICB9XG4gIGxldCB1bmxvY2tLZXkgPSB1bmxvY2tDYXBhYmlsaXRpZXMudW5sb2NrS2V5O1xuICBpZiAoIXVubG9ja2VyLmlzVmFsaWRLZXkodW5sb2NrVHlwZSwgdW5sb2NrS2V5KSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyB1bmxvY2tLZXkgJHt1bmxvY2tLZXl9IGNhcGFiaWxpdHkgZm9yIHVubG9ja1R5cGUgJHt1bmxvY2tUeXBlfWApO1xuICB9XG4gIGNvbnN0IHVubG9ja01ldGhvZCA9IHtcbiAgICBbUElOX1VOTE9DS106IHVubG9ja2VyLnBpblVubG9jayxcbiAgICBbUEFTU1dPUkRfVU5MT0NLXTogdW5sb2NrZXIucGFzc3dvcmRVbmxvY2ssXG4gICAgW1BBVFRFUk5fVU5MT0NLXTogdW5sb2NrZXIucGF0dGVyblVubG9jayxcbiAgICBbRklOR0VSUFJJTlRfVU5MT0NLXTogdW5sb2NrZXIuZmluZ2VycHJpbnRVbmxvY2tcbiAgfVt1bmxvY2tUeXBlXTtcbiAgYXdhaXQgdW5sb2NrTWV0aG9kKGFkYiwgZHJpdmVyLCB1bmxvY2tDYXBhYmlsaXRpZXMpO1xufTtcblxuaGVscGVycy51bmxvY2tXaXRoSGVscGVyQXBwID0gYXN5bmMgZnVuY3Rpb24gKGFkYikge1xuICBsb2dnZXIuaW5mbyhcIlVubG9ja2luZyBzY3JlZW5cIik7XG5cbiAgLy8gVW5sb2NrIHN1Y2NlZWQgd2l0aCBhIGNvdXBsZSBvZiByZXRyaWVzLlxuICBsZXQgZmlyc3RSdW4gPSB0cnVlO1xuICBhd2FpdCByZXRyeSgzLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgLy8gVG8gcmVkdWNlIGEgdGltZSB0byBjYWxsIGFkYi5pc1NjcmVlbkxvY2tlZCgpIHNpbmNlIGBhZGIgc2hlbGwgZHVtcHN5cyB3aW5kb3dgIGlzIGVhc3kgdG8gaGFuZyBhZGIgY29tbWFuZHNcbiAgICBpZiAoZmlyc3RSdW4pIHtcbiAgICAgIGZpcnN0UnVuID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghKGF3YWl0IGFkYi5pc1NjcmVlbkxvY2tlZCgpKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2dnZXIud2FybihgRXJyb3IgaW4gaXNTY3JlZW5Mb2NrZWQ6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgICBsb2dnZXIud2FybihcIlxcXCJhZGIgc2hlbGwgZHVtcHN5cyB3aW5kb3dcXFwiIGNvbW1hbmQgaGFzIHRpbWVkIG91dC5cIik7XG4gICAgICAgIGxvZ2dlci53YXJuKFwiVGhlIHJlYXNvbiBvZiB0aGlzIHRpbWVvdXQgaXMgdGhlIGRlbGF5ZWQgYWRiIHJlc3BvbnNlLiBSZXNldHRpbmcgYWRiIHNlcnZlciBjYW4gaW1wcm92ZSBpdC5cIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbG9nZ2VyLmluZm8oYExhdW5jaGluZyAke1NFVFRJTkdTX0hFTFBFUl9VTkxPQ0tfQUNUSVZJVFl9YCk7XG4gICAgYXdhaXQgYWRiLnNoZWxsKFtcbiAgICAgICdhbScsICdzdGFydCcsXG4gICAgICAnLW4nLCBgJHtTRVRUSU5HU19IRUxQRVJfUEtHX0lEfS8ke1NFVFRJTkdTX0hFTFBFUl9VTkxPQ0tfQUNUSVZJVFl9YCxcbiAgICAgICctYycsICdhbmRyb2lkLmludGVudC5jYXRlZ29yeS5MQVVOQ0hFUicsXG4gICAgICAnLWEnLCAnYW5kcm9pZC5pbnRlbnQuYWN0aW9uLk1BSU4nLFxuICAgICAgJy1mJywgJzB4MTAyMDAwMDAnLFxuICAgIF0pO1xuICAgIGF3YWl0IEIuZGVsYXkoMTAwMCk7XG4gIH0pO1xufTtcblxuaGVscGVycy51bmxvY2sgPSBhc3luYyBmdW5jdGlvbiAoZHJpdmVyLCBhZGIsIGNhcGFiaWxpdGllcykge1xuICBpZiAoIShhd2FpdCBhZGIuaXNTY3JlZW5Mb2NrZWQoKSkpIHtcbiAgICBsb2dnZXIuaW5mbyhcIlNjcmVlbiBhbHJlYWR5IHVubG9ja2VkLCBkb2luZyBub3RoaW5nXCIpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxvZ2dlci5kZWJ1ZyhcIlNjcmVlbiBpcyBsb2NrZWQsIHRyeWluZyB0byB1bmxvY2tcIik7XG4gIGlmIChfLmlzVW5kZWZpbmVkKGNhcGFiaWxpdGllcy51bmxvY2tUeXBlKSkge1xuICAgIGxvZ2dlci53YXJuKFwiVXNpbmcgYXBwIHVubG9jaywgdGhpcyBpcyBnb2luZyB0byBiZSBkZXByZWNhdGVkIVwiKTtcbiAgICBhd2FpdCBoZWxwZXJzLnVubG9ja1dpdGhIZWxwZXJBcHAoYWRiKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBoZWxwZXJzLnVubG9ja1dpdGhVSUF1dG9tYXRpb24oZHJpdmVyLCBhZGIsIHt1bmxvY2tUeXBlOiBjYXBhYmlsaXRpZXMudW5sb2NrVHlwZSwgdW5sb2NrS2V5OiBjYXBhYmlsaXRpZXMudW5sb2NrS2V5fSk7XG4gICAgYXdhaXQgaGVscGVycy52ZXJpZnlVbmxvY2soYWRiKTtcbiAgfVxufTtcblxuaGVscGVycy52ZXJpZnlVbmxvY2sgPSBhc3luYyBmdW5jdGlvbiAoYWRiKSB7XG4gIGF3YWl0IHJldHJ5SW50ZXJ2YWwoMiwgMTAwMCwgYXN5bmMgKCkgPT4ge1xuICAgIGlmIChhd2FpdCBhZGIuaXNTY3JlZW5Mb2NrZWQoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2NyZWVuIGRpZCBub3QgdW5sb2NrIHN1Y2Nlc3NmdWxseSwgcmV0cnlpbmdcIik7XG4gICAgfVxuICAgIGxvZ2dlci5kZWJ1ZyhcIlNjcmVlbiB1bmxvY2tlZCBzdWNjZXNzZnVsbHlcIik7XG4gIH0pO1xufTtcblxuaGVscGVycy5pbml0RGV2aWNlID0gYXN5bmMgZnVuY3Rpb24gKGFkYiwgb3B0cykge1xuICBhd2FpdCBhZGIud2FpdEZvckRldmljZSgpO1xuICAvLyBwdXNoU2V0dGluZ3NBcHAgcmVxdWlyZWQgYmVmb3JlIGNhbGxpbmcgZW5zdXJlRGV2aWNlTG9jYWxlIGZvciBBUEkgTGV2ZWwgMjQrXG4gIGF3YWl0IGhlbHBlcnMucHVzaFNldHRpbmdzQXBwKGFkYik7XG4gIGlmICghb3B0cy5hdmQpIHtcbiAgICBhd2FpdCBoZWxwZXJzLnNldE1vY2tMb2NhdGlvbkFwcChhZGIsIFNFVFRJTkdTX0hFTFBFUl9QS0dfSUQpO1xuICB9XG5cbiAgYXdhaXQgaGVscGVycy5lbnN1cmVEZXZpY2VMb2NhbGUoYWRiLCBvcHRzLmxhbmd1YWdlLCBvcHRzLmxvY2FsZSk7XG4gIGF3YWl0IGFkYi5zdGFydExvZ2NhdCgpO1xuICBpZiAob3B0cy51bmljb2RlS2V5Ym9hcmQpIHtcbiAgICByZXR1cm4gYXdhaXQgaGVscGVycy5pbml0VW5pY29kZUtleWJvYXJkKGFkYik7XG4gIH1cbn07XG5cbmhlbHBlcnMucmVtb3ZlTnVsbFByb3BlcnRpZXMgPSBmdW5jdGlvbiAob2JqKSB7XG4gIGZvciAobGV0IGtleSBvZiBfLmtleXMob2JqKSkge1xuICAgIGlmIChfLmlzTnVsbChvYmpba2V5XSkgfHwgXy5pc1VuZGVmaW5lZChvYmpba2V5XSkpIHtcbiAgICAgIGRlbGV0ZSBvYmpba2V5XTtcbiAgICB9XG4gIH1cbn07XG5cbmhlbHBlcnMudHJ1bmNhdGVEZWNpbWFscyA9IGZ1bmN0aW9uIChudW1iZXIsIGRpZ2l0cykge1xuICBsZXQgbXVsdGlwbGllciA9IE1hdGgucG93KDEwLCBkaWdpdHMpLFxuICAgICAgYWRqdXN0ZWROdW0gPSBudW1iZXIgKiBtdWx0aXBsaWVyLFxuICAgICAgdHJ1bmNhdGVkTnVtID0gTWF0aFthZGp1c3RlZE51bSA8IDAgPyAnY2VpbCcgOiAnZmxvb3InXShhZGp1c3RlZE51bSk7XG5cbiAgcmV0dXJuIHRydW5jYXRlZE51bSAvIG11bHRpcGxpZXI7XG59O1xuXG5oZWxwZXJzLmlzQ2hyb21lQnJvd3NlciA9IGZ1bmN0aW9uIChicm93c2VyKSB7XG4gIHJldHVybiBfLmluY2x1ZGVzKE9iamVjdC5rZXlzKENIUk9NRV9CUk9XU0VSX1BBQ0tBR0VfQUNUSVZJVFkpLCAoYnJvd3NlciB8fCAnJykudG9Mb3dlckNhc2UoKSk7XG59O1xuXG5oZWxwZXJzLmdldENocm9tZVBrZyA9IGZ1bmN0aW9uIChicm93c2VyKSB7XG4gIHJldHVybiBDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZW2Jyb3dzZXIudG9Mb3dlckNhc2UoKV0gfHwgQ0hST01FX0JST1dTRVJfUEFDS0FHRV9BQ1RJVklUWS5kZWZhdWx0O1xufTtcblxuaGVscGVycy5yZW1vdmVBbGxTZXNzaW9uV2ViU29ja2V0SGFuZGxlcnMgPSBhc3luYyBmdW5jdGlvbiAoc2VydmVyLCBzZXNzaW9uSWQpIHtcbiAgaWYgKCFzZXJ2ZXIgfHwgIV8uaXNGdW5jdGlvbihzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgYWN0aXZlSGFuZGxlcnMgPSBhd2FpdCBzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMoc2Vzc2lvbklkKTtcbiAgZm9yIChjb25zdCBwYXRobmFtZSBvZiBfLmtleXMoYWN0aXZlSGFuZGxlcnMpKSB7XG4gICAgYXdhaXQgc2VydmVyLnJlbW92ZVdlYlNvY2tldEhhbmRsZXIocGF0aG5hbWUpO1xuICB9XG59O1xuXG4vKipcbiAqIFRha2VzIGEgZGVzaXJlZCBjYXBhYmlsaXR5IGFuZCB0cmllcyB0byBKU09OLnBhcnNlIGl0IGFzIGFuIGFycmF5LFxuICogYW5kIGVpdGhlciByZXR1cm5zIHRoZSBwYXJzZWQgYXJyYXkgb3IgYSBzaW5nbGV0b24gYXJyYXkuXG4gKlxuICogQHBhcmFtIHthbnl9IGNhcCBBIGRlc2lyZWQgY2FwYWJpbGl0eVxuICovXG5oZWxwZXJzLnBhcnNlQXJyYXkgPSBmdW5jdGlvbiAoY2FwKSB7XG4gIGxldCBwYXJzZWRDYXBzO1xuICB0cnkge1xuICAgIHBhcnNlZENhcHMgPSBKU09OLnBhcnNlKGNhcCk7XG4gIH0gY2F0Y2ggKGlnbikgeyB9XG5cbiAgaWYgKF8uaXNBcnJheShwYXJzZWRDYXBzKSkge1xuICAgIHJldHVybiBwYXJzZWRDYXBzO1xuICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcoY2FwKSkge1xuICAgIHJldHVybiBbY2FwXTtcbiAgfVxuXG4gIHRocm93IG5ldyBFcnJvcihgbXVzdCBwcm92aWRlIGEgc3RyaW5nIG9yIEpTT04gQXJyYXk7IHJlY2VpdmVkICR7Y2FwfWApO1xufTtcblxuaGVscGVycy52YWxpZGF0ZURlc2lyZWRDYXBzID0gZnVuY3Rpb24gKGNhcHMpIHtcbiAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIGNhcGFiaWxpdGllcyBoYXZlIG9uZSBvZiBgYXBwYCwgYGFwcFBhY2thZ2VgIG9yIGBicm93c2VyYFxuICBpZiAoKCFjYXBzLmJyb3dzZXJOYW1lIHx8ICF0aGlzLmlzQ2hyb21lQnJvd3NlcihjYXBzLmJyb3dzZXJOYW1lKSkgJiYgIWNhcHMuYXBwICYmICFjYXBzLmFwcFBhY2thZ2UpIHtcbiAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdygnVGhlIGRlc2lyZWQgY2FwYWJpbGl0aWVzIG11c3QgaW5jbHVkZSBlaXRoZXIgYW4gYXBwLCBhcHBQYWNrYWdlIG9yIGJyb3dzZXJOYW1lJyk7XG4gIH1cbiAgaWYgKGNhcHMuYnJvd3Nlck5hbWUpIHtcbiAgICBpZiAoY2Fwcy5hcHApIHtcbiAgICAgIC8vIHdhcm4gaWYgdGhlIGNhcGFiaWxpdGllcyBoYXZlIGJvdGggYGFwcGAgYW5kIGBicm93c2VyLCBhbHRob3VnaCB0aGlzIGlzIGNvbW1vbiB3aXRoIHNlbGVuaXVtIGdyaWRcbiAgICAgIGxvZ2dlci53YXJuKGBUaGUgZGVzaXJlZCBjYXBhYmlsaXRpZXMgc2hvdWxkIGdlbmVyYWxseSBub3QgaW5jbHVkZSBib3RoIGFuICdhcHAnIGFuZCBhICdicm93c2VyTmFtZSdgKTtcbiAgICB9XG4gICAgaWYgKGNhcHMuYXBwUGFja2FnZSkge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYFRoZSBkZXNpcmVkIHNob3VsZCBub3QgaW5jbHVkZSBib3RoIG9mIGFuICdhcHBQYWNrYWdlJyBhbmQgYSAnYnJvd3Nlck5hbWUnYCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5oZWxwZXJzLmJvb3RzdHJhcCA9IEJvb3RzdHJhcDtcbmhlbHBlcnMudW5sb2NrZXIgPSB1bmxvY2tlcjtcblxuZXhwb3J0IHsgaGVscGVycyB9O1xuZXhwb3J0IGRlZmF1bHQgaGVscGVycztcbiJdLCJmaWxlIjoibGliL2FuZHJvaWQtaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
